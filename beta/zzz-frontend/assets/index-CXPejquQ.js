import{u as y,r as t,j as e,C as F,a as d,b as I,G as a,T as x,t as T,B as j,c as N,R as G,D as P,S as D,d as R,e as U,f as L,g as V,h as W,i as S,A as $,k as z,F as H,l as K,m as Q}from"./index-BJh-CTmR.js";import{u as q}from"./useDataEntryBase-DDLSBZ1N.js";import{d as J}from"./discSortUtil-Dfw_4W-k.js";function A(){const{database:r}=y();return q(r.displayDisc)}function X({numShowing:r,total:i,discIds:f}){const s=y().database,{filterOption:c}=A(),l=t.useCallback(u=>s.displayDisc.set({filterOption:{...c,...u}}),[s,c]);return e(t.Suspense,{fallback:e(D,{variant:"rectangular",width:"100%",height:300}),children:e(F,{children:d(I,{children:[d(a,{container:!0,children:[e(a,{item:!0,children:e(x,{variant:"h6",children:T("discFilter")})}),e(a,{item:!0,flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center",children:d(x,{children:[e("strong",{children:r})," / ",i]})}),e(a,{item:!0,children:e(j,{size:"small",color:"error",onClick:()=>s.displayDisc.set({action:"reset"}),startIcon:e(G,{}),children:e(N,{t:T,i18nKey:"ui:reset"})})})]}),e(t.Suspense,{fallback:e(D,{variant:"rectangular",width:"100%",height:400}),children:e(P,{filterOption:c,filterOptionDispatch:l,filteredIds:f})})]})})})}const v={xs:2,sm:3,md:4,lg:4,xl:6},Y={xs:10,sm:12,md:24,lg:24,xl:24};function Z({onAdd:r,onEdit:i}){const{t:f}=R("disc"),{database:s}=y(),[c,l]=U(),u=t.useDeferredValue(c),w=A(),m=t.useMemo(()=>J(),[]),g=t.useDeferredValue(w);t.useEffect(()=>s.discs.followAny(l),[s,l]);const{discIds:o,totalDiscsNum:p}=t.useMemo(()=>{const{filterOption:n}=g,h=s.discs.values;return{discIds:h.filter(L(n,m)).map(O=>O.id),totalDiscsNum:h.length,...u}},[s.discs.values,u,g,m]),B=V(),E=o.length!==p?`${o.length}/${p}`:p,{numShow:C,setTriggerElement:M}=W(Y[B],o.length),b=t.useMemo(()=>o.slice(0,C),[o,C]),k={numShowing:b.length,totalShowing:E};return d(H,{children:[e(X,{numShowing:p,total:p,discIds:o}),e(F,{bgt:"dark",children:e(I,{children:e(S,{pb:2,display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:d(x,{color:"text.secondary",children:["Showing ",e("b",{children:k.numShowing})," out of"," ",k.totalShowing," Items"]})})})}),e(a,{container:!0,columns:v,spacing:1,children:e(a,{item:!0,xs:!0,children:e(j,{fullWidth:!0,onClick:r,color:"info",startIcon:e($,{}),children:f("addNew")})})}),d(t.Suspense,{fallback:e(D,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:[e(S,{children:e(a,{container:!0,columns:v,spacing:1,children:b.map(n=>e(a,{item:!0,xs:1,children:e(z,{disc:s.discs.get(n),onEdit:()=>i==null?void 0:i(n),onDelete:()=>s.discs.remove(n),setLocation:h=>s.discs.set(n,{location:h}),onLockToggle:()=>s.discs.set(n,({lock:h})=>({lock:!h}))})},n))})}),o.length!==b.length&&e(D,{ref:n=>{n&&M(n)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})]})}function ne(){const[r,i]=t.useState({}),[f,s,c]=K(),{database:l}=y(),u=t.useCallback(()=>{i({}),s()},[s]),w=t.useCallback(m=>{const g=l.discs.get(m);g&&(i(g),s())},[l.discs,s]);return d(S,{display:"flex",flexDirection:"column",gap:1,my:1,children:[e(Q,{disc:r,allowEmpty:!0,allowUpload:!0,show:f,onClose:c,onShow:s,cancelEdit:()=>i({})}),e(Z,{onAdd:u,onEdit:w})]})}export{ne as default};
