var Ks=e=>{throw TypeError(e)};var Ls=(e,t,n)=>t.has(e)||Ks("Cannot "+n);var _e=(e,t,n)=>(Ls(e,t,"read from private field"),n?n.call(e):t.get(e)),Re=(e,t,n)=>t.has(e)?Ks("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Y=(e,t,n,o)=>(Ls(e,t,"write to private field"),o?o.call(e,n):t.set(e,n),n);import{z as _n,E as kn,c as f,H as vn,J as fr,K as gr,_ as Cn,L as j,N as sc,O as yr,P as xr,Q as te,U as be,V as Ot,W as Sn,X as Hs,Y as $r,Z as br,$ as wr,a0 as _r,j as s,a1 as kr,h as he,a2 as vr,a3 as Fs,a4 as oc,a5 as Cr,a6 as Bt,a7 as Sr,a8 as ic,a9 as ac,aa as ue,ab as yn,ac as cc,ad as os,ae as Dr,i as Mr,u as z,af as hs,ag as rc,ah as Er,ai as Tr,aj as Ir,ak as lc,al as Vt,am as jt,an as F,ao as Rr,ap as Ar,aq as P,ar as xn,as as qr,at as Pr,au as dc,av as $n,aw as zr,r as ms,a as fs,b as gs,g as ys,ax as Kt,ay as Ke,az as xs,aA as ge,d as y,p as Lt,I as Se,q as Dn,e as O,C as W,aB as is,s as ae,T as I,aC as de,M as $s,aD as $e,aE as Or,aF as Vr,n as E,aG as uc,aH as jr,aI as Wr,aJ as Nr,aK as V,aL as se,aM as Br,aN as Kr,F as Ht,aO as Gs,aP as Us,aQ as bn,aR as Lr,aS as Ce,aT as Ne,aU as hn,aV as Hr,aW as Fr,aX as Gr,aY as Wt,aZ as mn,a_ as ye,a$ as Js,b0 as _,b1 as N,b2 as w,b3 as bs,b4 as Ur,w as G,b5 as ws,b6 as D,b7 as v,b8 as pc,b9 as Jr,ba as Mn,bb as Xr,bc as Xs,bd as Qs,be as Qr,bf as Pe,bg as hc,bh as Zr,bi as _s,bj as mc,bk as fc,bl as pe,bm as gc,bn as as,bo as Yr,bp as yc,bq as xc,br as el,bs as De,B as U,bt as J,bu as tl,bv as $c,bw as bc,bx as nl,by as ze,bz as En,bA as sl,bB as ol,bC as il,bD as al,bE as wc,bF as cl,bG as rl,bH as ll,bI as dl,bJ as ul,bK as pl,bL as Zs,bM as hl,bN as re,bO as Ys,bP as ml,bQ as ks,G as ne,bR as fl,bS as eo,x as vs,S as _c,bT as gl,bU as to,bV as yl,bW as xl,bX as $l,bY as bl,bZ as wl,b_ as no,b$ as _l,c0 as kc,c1 as vc,c2 as kl,c3 as Cc,c4 as Sc,c5 as vl,c6 as Cl,c7 as Sl,c8 as Dl,c9 as so,ca as Ml,cb as El,cc as oo,cd as Tl,ce as Il,cf as Rl,cg as Al,ch as ql,ci as Pl,cj as zl,ck as Ol}from"./index-CNCSnpPZ.js";import{u as Vl}from"./useDataEntryBase-BeaU7Ed_.js";import{A as Me,g as Dc,C as jl,a as Wl,u as Nl,b as Bl,c as Kl}from"./CharacterEditor-ChUtwTNy.js";import"./discSortUtil-CtwxPIWw.js";function Ll(e){return _n("MuiCollapse",e)}kn("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const Hl=["addEndListener","children","className","collapsedSize","component","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","orientation","style","timeout","TransitionComponent"],Fl=e=>{const{orientation:t,classes:n}=e,o={root:["root",`${t}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${t}`],wrapperInner:["wrapperInner",`${t}`]};return Sn(o,Ll,n)},Gl=be("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.orientation],n.state==="entered"&&t.entered,n.state==="exited"&&!n.in&&n.collapsedSize==="0px"&&t.hidden]}})(({theme:e,ownerState:t})=>j({height:0,overflow:"hidden",transition:e.transitions.create("height")},t.orientation==="horizontal"&&{height:"auto",width:0,transition:e.transitions.create("width")},t.state==="entered"&&j({height:"auto",overflow:"visible"},t.orientation==="horizontal"&&{width:"auto"}),t.state==="exited"&&!t.in&&t.collapsedSize==="0px"&&{visibility:"hidden"})),Ul=be("div",{name:"MuiCollapse",slot:"Wrapper",overridesResolver:(e,t)=>t.wrapper})(({ownerState:e})=>j({display:"flex",width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),Jl=be("div",{name:"MuiCollapse",slot:"WrapperInner",overridesResolver:(e,t)=>t.wrapperInner})(({ownerState:e})=>j({width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),Cs=f.forwardRef(function(t,n){const o=vn({props:t,name:"MuiCollapse"}),{addEndListener:i,children:r,className:a,collapsedSize:l="0px",component:d,easing:c,in:u,onEnter:p,onEntered:h,onEntering:m,onExit:$,onExited:x,onExiting:C,orientation:S="vertical",style:M,timeout:A=gr.standard,TransitionComponent:X=fr}=o,q=Cn(o,Hl),B=j({},o,{orientation:S,collapsedSize:l}),R=Fl(B),H=sc(),oe=yr(),Z=f.useRef(null),Q=f.useRef(),le=typeof l=="number"?`${l}px`:l,xe=S==="horizontal",we=xe?"width":"height",tn=f.useRef(null),cr=xr(n,tn),Ie=T=>ie=>{if(T){const me=tn.current;ie===void 0?T(me):T(me,ie)}},Gn=()=>Z.current?Z.current[xe?"clientWidth":"clientHeight"]:0,rr=Ie((T,ie)=>{Z.current&&xe&&(Z.current.style.position="absolute"),T.style[we]=le,p&&p(T,ie)}),lr=Ie((T,ie)=>{const me=Gn();Z.current&&xe&&(Z.current.style.position="");const{duration:Rt,easing:nn}=Hs({style:M,timeout:A,easing:c},{mode:"enter"});if(A==="auto"){const Bs=H.transitions.getAutoHeightDuration(me);T.style.transitionDuration=`${Bs}ms`,Q.current=Bs}else T.style.transitionDuration=typeof Rt=="string"?Rt:`${Rt}ms`;T.style[we]=`${me}px`,T.style.transitionTimingFunction=nn,m&&m(T,ie)}),dr=Ie((T,ie)=>{T.style[we]="auto",h&&h(T,ie)}),ur=Ie(T=>{T.style[we]=`${Gn()}px`,$&&$(T)}),pr=Ie(x),hr=Ie(T=>{const ie=Gn(),{duration:me,easing:Rt}=Hs({style:M,timeout:A,easing:c},{mode:"exit"});if(A==="auto"){const nn=H.transitions.getAutoHeightDuration(ie);T.style.transitionDuration=`${nn}ms`,Q.current=nn}else T.style.transitionDuration=typeof me=="string"?me:`${me}ms`;T.style[we]=le,T.style.transitionTimingFunction=Rt,C&&C(T)}),mr=T=>{A==="auto"&&oe.start(Q.current||0,T),i&&i(tn.current,T)};return te.jsx(X,j({in:u,onEnter:rr,onEntered:dr,onEntering:lr,onExit:ur,onExited:pr,onExiting:hr,addEndListener:mr,nodeRef:tn,timeout:A==="auto"?null:A},q,{children:(T,ie)=>te.jsx(Gl,j({as:d,className:Ot(R.root,a,{entered:R.entered,exited:!u&&le==="0px"&&R.hidden}[T]),style:j({[xe?"minWidth":"minHeight"]:le},M),ref:cr},ie,{ownerState:j({},B,{state:T}),children:te.jsx(Ul,{ownerState:j({},B,{state:T}),className:R.wrapper,ref:Z,children:te.jsx(Jl,{ownerState:j({},B,{state:T}),className:R.wrapperInner,children:r})})}))}))});Cs.muiSupportAuto=!0;const Mc=f.createContext({});function Xl(e){return _n("MuiAccordion",e)}const sn=kn("MuiAccordion",["root","rounded","expanded","disabled","gutters","region"]),Ql=["children","className","defaultExpanded","disabled","disableGutters","expanded","onChange","square","slots","slotProps","TransitionComponent","TransitionProps"],Zl=e=>{const{classes:t,square:n,expanded:o,disabled:i,disableGutters:r}=e;return Sn({root:["root",!n&&"rounded",o&&"expanded",i&&"disabled",!r&&"gutters"],region:["region"]},Xl,t)},Yl=be(wr,{name:"MuiAccordion",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`& .${sn.region}`]:t.region},t.root,!n.square&&t.rounded,!n.disableGutters&&t.gutters]}})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{position:"relative",transition:e.transitions.create(["margin"],t),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(e.vars||e).palette.divider,transition:e.transitions.create(["opacity","background-color"],t)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${sn.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${sn.disabled}`]:{backgroundColor:(e.vars||e).palette.action.disabledBackground}}},({theme:e})=>({variants:[{props:t=>!t.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(e.vars||e).shape.borderRadius,borderTopRightRadius:(e.vars||e).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(e.vars||e).shape.borderRadius,borderBottomRightRadius:(e.vars||e).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:t=>!t.disableGutters,style:{[`&.${sn.expanded}`]:{margin:"16px 0"}}}]})),on=f.forwardRef(function(t,n){const o=vn({props:t,name:"MuiAccordion"}),{children:i,className:r,defaultExpanded:a=!1,disabled:l=!1,disableGutters:d=!1,expanded:c,onChange:u,square:p=!1,slots:h={},slotProps:m={},TransitionComponent:$,TransitionProps:x}=o,C=Cn(o,Ql),[S,M]=$r({controlled:c,default:a,name:"Accordion",state:"expanded"}),A=f.useCallback(xe=>{M(!S),u&&u(xe,!S)},[S,u,M]),[X,...q]=f.Children.toArray(i),B=f.useMemo(()=>({expanded:S,disabled:l,disableGutters:d,toggle:A}),[S,l,d,A]),R=j({},o,{square:p,disabled:l,disableGutters:d,expanded:S}),H=Zl(R),oe=j({transition:$},h),Z=j({transition:x},m),[Q,le]=br("transition",{elementType:Cs,externalForwardedProps:{slots:oe,slotProps:Z},ownerState:R});return te.jsxs(Yl,j({className:Ot(H.root,r),ref:n,ownerState:R,square:p},C,{children:[te.jsx(Mc.Provider,{value:B,children:X}),te.jsx(Q,j({in:S,timeout:"auto"},le,{children:te.jsx("div",{"aria-labelledby":X.props.id,id:X.props["aria-controls"],role:"region",className:H.region,children:q})}))]}))});function ed(e){return _n("MuiAccordionDetails",e)}kn("MuiAccordionDetails",["root"]);const td=["className"],nd=e=>{const{classes:t}=e;return Sn({root:["root"]},ed,t)},sd=be("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>({padding:e.spacing(1,2,2)})),an=f.forwardRef(function(t,n){const o=vn({props:t,name:"MuiAccordionDetails"}),{className:i}=o,r=Cn(o,td),a=o,l=nd(a);return te.jsx(sd,j({className:Ot(l.root,i),ref:n,ownerState:a},r))});function od(e){return _n("MuiAccordionSummary",e)}const qe=kn("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),id=["children","className","expandIcon","focusVisibleClassName","onClick"],ad=e=>{const{classes:t,expanded:n,disabled:o,disableGutters:i}=e;return Sn({root:["root",n&&"expanded",o&&"disabled",!i&&"gutters"],focusVisible:["focusVisible"],content:["content",n&&"expanded",!i&&"contentGutters"],expandIconWrapper:["expandIconWrapper",n&&"expanded"]},od,t)},cd=be(_r,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{display:"flex",minHeight:48,padding:e.spacing(0,2),transition:e.transitions.create(["min-height","background-color"],t),[`&.${qe.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${qe.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`&:hover:not(.${qe.disabled})`]:{cursor:"pointer"},variants:[{props:n=>!n.disableGutters,style:{[`&.${qe.expanded}`]:{minHeight:64}}}]}}),rd=be("div",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(e,t)=>t.content})(({theme:e})=>({display:"flex",flexGrow:1,margin:"12px 0",variants:[{props:t=>!t.disableGutters,style:{transition:e.transitions.create(["margin"],{duration:e.transitions.duration.shortest}),[`&.${qe.expanded}`]:{margin:"20px 0"}}}]})),ld=be("div",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(e,t)=>t.expandIconWrapper})(({theme:e})=>({display:"flex",color:(e.vars||e).palette.action.active,transform:"rotate(0deg)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest}),[`&.${qe.expanded}`]:{transform:"rotate(180deg)"}})),cn=f.forwardRef(function(t,n){const o=vn({props:t,name:"MuiAccordionSummary"}),{children:i,className:r,expandIcon:a,focusVisibleClassName:l,onClick:d}=o,c=Cn(o,id),{disabled:u=!1,disableGutters:p,expanded:h,toggle:m}=f.useContext(Mc),$=S=>{m&&m(S),d&&d(S)},x=j({},o,{expanded:h,disabled:u,disableGutters:p}),C=ad(x);return te.jsxs(cd,j({focusRipple:!1,disableRipple:!0,disabled:u,component:"div","aria-expanded":h,className:Ot(C.root,r),focusVisibleClassName:Ot(C.focusVisible,l),onClick:$,ref:n,ownerState:x},c,{children:[te.jsx(rd,{className:C.content,ownerState:x,children:i}),a&&te.jsx(ld,{className:C.expandIconWrapper,ownerState:x,children:a})]}))});function dd({value:e,onChange:t,...n}){const[o,i]=f.useState(e);f.useEffect(()=>{i(e)},[e]);const r=()=>t(o);return s(kr,{value:o,onChange:a=>i(a.target.value),onBlur:r,onKeyDown:a=>a.key==="Enter"&&!n.multiline&&r(),...n})}function ud(){const e=f.useRef(),t=f.useCallback(()=>{var n;return(n=e.current)==null?void 0:n.scrollIntoView({behavior:"smooth"})},[e]);return[e,t]}function pd(e){const{t}=he("ui"),n=vr({path:"/:page/*"}),o=t("pageTitle"),i=e??((n==null?void 0:n.params.page)&&t(`tabs.${n==null?void 0:n.params.page}`));f.useEffect(()=>{i?document.title=`${i} - ${o}`:document.title=o},[t,o,i])}const Ss={};class Ec{constructor(){this.internal=new hd}ref(t){return t.reduce((n,o)=>n.get(o),this.internal)}*[Symbol.iterator](){for(const[t,n]of this.internal.entries([]))"value"in n&&(yield[[...t],n.value])}*values(){for(const t of this.internal.allRefs())"value"in t&&(yield t.value)}}let hd=class Tc{constructor(){this.map=new Map}get(t){const n=this.map.get(t);if(n)return n;const o=new Tc;return this.map.set(t,o),o}*allRefs(){for(const t of this.map.values())yield*t.allRefs();yield this}*entries(t){const n=t.push(void 0)-1;for(const[o,i]of this.map.entries())t[n]=o,yield*i.entries(t);t.pop(),yield[t,this]}};class Ic{constructor(t,n){this.root=new md(t,n)}subset(t){const n=[];return this._subset(t,o=>n.push(...o[Fs].map(i=>i.value))),n}entries(t){const n=[];return this._subset(t,o=>n.push(...o[Fs])),n}_subset(t,n){const o=t.length;function i(r,a){r<o?a.subset(t[r]).forEach(l=>i(r+1,l)):n(a.leaf)}i(0,this.root)}}let md=class Rc{constructor(t,n){if(this.children=[],t>0)for(const[o,i]of Object.entries(n)){const r=new Map;for(const[a,l]of Object.entries(i))r.set(+a,new Rc(t-1,l));this.children.push({mask:+o,map:r})}else this.leaf=n}subset(t){return this.children.map(({mask:n,map:o})=>o.get(t&n)).filter(n=>!!n)}};class cs{constructor(t){this.root=new Ds(void 0),this.keys=t}at(t){const n=this.keys.get(t),o=n.reduce((i,r)=>i.child(r),this.root);return o.leaf||(o.leaf=new Ms(t,n,this.keys,o)),o.leaf}}class Ds{constructor(t){this.children=new Map,this.parent=t}child(t){let n=this.children.get(t);return n||(n=new Ds(this),this.children.set(t,n),n)}}class Ms{constructor(t,n,o,i){this.tag=Object.fromEntries(Object.entries(t).filter(([r,a])=>a!=null)),this.id=n,this.keys=o,this.internal=i}with(t){const{keys:n}=this,{id:o,firstReplacedByte:i}=n.combine(this.id,t);let r=this.internal;for(let a=i;a<n.tagLen;a++)r=r.parent;for(let a=i;a<n.tagLen;a++)r=r.child(o[a]);return r.leaf||(r.leaf=new Ms({...this.tag,...t},o,n,r)),r.leaf}}class fd{constructor(t,n){this.keys=new oc(t),this.values=new Ic(t.tagLen,n)}subset(t){return this.values.subset(this.keys.get(t))}}const Be={sum:e=>e.reduce((t,n)=>t+n,0),prod:e=>e.reduce((t,n)=>t*n,1),min:e=>Math.min(...e),max:e=>Math.max(...e),sumfrac:([e,t])=>e/(e+t),unique:([e])=>e},Es={match:([e,t])=>e===t?0:1,thres:([e,t])=>e>=t?0:1,lookup:([e],t)=>t[e]??0},rn=e=>Sr(e,"val");let Ac=class{constructor(t,...n){const o=new oc(t);this.nodes=new Ic(o.tagLen,Cr(n)),this.cache=new cs(o).at({}),this.calc=new cs(o).at({}),this.calc.val=this}withTag(t){const n=this.calc.with(t);return n.val??(n.val=Object.assign(new this.constructor(this.cache.keys),this,{cache:this.cache.with(t),calc:n}))}gather(t){return this._gather(this.cache.with(t)).pre}compute(t){return this._compute(t,this.cache)}_gather(t){if(t.val)return t.val;const n=this.nodes.entries(t.id).flatMap(({tag:o,value:i})=>i.op==="reread"?this._gather(t.with(i.tag)).pre:[this.markGathered(t.tag,o,i,this._compute(i,t))]);return t.val={pre:n}}_compute(t,n){const o=(r,a,l,d)=>Object.freeze({val:r,meta:this.computeMeta(t,r,a,l,d)}),{op:i}=t;switch(i){case"const":return o(t.ex,[],[]);case"sum":case"prod":case"min":case"max":case"sumfrac":{const r=t.x.map(a=>this._compute(a,n));return o(Be[i](rn(r)),r,[])}case"thres":case"match":case"lookup":{const r=t.br.map(c=>this._compute(c,n)),a=Es[i](rn(r),t.ex),l=[...Array(t.x.length)],d=l[a]=this._compute(t.x[a],n);return o(d.val,l,r)}case"subscript":{const r=this._compute(t.br[0],n);return o(t.ex[r.val],[],[r])}case"vtag":return o(n.tag[t.ex]??"",[],[]);case"tag":{const r=n.with(t.tag),a=this._compute(t.x[0],r);return o(a.val,[a],[],r.tag)}case"dtag":{const r=t.br.map(d=>this._compute(d,n)),a=n.with(Object.fromEntries(r.map((d,c)=>[t.ex[c],d.val]))),l=this._compute(t.x[0],a);return o(l.val,[l],r,a.tag)}case"read":{const r=n.with(t.tag),a=this._gather(r),{pre:l}=a,d=t.ex??this.defaultAccu(r.tag)??"unique";if(d!==t.ex&&(t={...t,ex:d}),a[d])return a[d];if(ic()&&d==="unique"&&l.length!==1)throw new Error(`Ill-form read for ${ac(r.tag)}`);const c=Be[d](rn(l));return a[d]=o(c,l,[],r.tag)}case"custom":{const r=t.x.map(a=>this._compute(a,n));return o(Ss[t.ex].calc(rn(r)),r,[])}default:Bt(i)}}defaultAccu(t){}markGathered(t,n,o,i){return i}computeMeta(t,n,o,i,r){}toDebug(){throw new Error("not implemented")}};function gd(e,t,n){function o(a,l){if(a.val)return a.val;const d=n(a.tag);return a.val=d?[yn(d,l)]:t.nodes.subset(a.id).flatMap(c=>c.op!=="reread"?r(c,a):o(a.with(c.tag),l)),a.val}function i(a,l){return a.every(d=>d.op==="const")?ue(Be[l](a.map(d=>d.ex))):{op:l,x:a,br:[]}}function r(a,l){const{op:d}=a;switch(d){case"const":return a;case"read":{const c=l.with(a.tag),u=a.ex??t.defaultAccu(c.tag)??"unique",p=o(c,u);return u==="unique"?p[0]??ue(void 0):i(p,u)}case"sum":case"prod":case"min":case"max":case"sumfrac":{const c=a.x.map(u=>r(u,l));return i(c,d)}case"thres":case"match":case"lookup":{const c=a.br.map(u=>r(u,l));if(c.every(u=>u.op==="const")){const u=c.map(h=>h.ex),p=Es[a.op](u,a.ex);return r(a.x[p],l)}return{...a,x:a.x.map(u=>r(u,l)),br:c}}case"subscript":{const c=r(a.br[0],l);return c.op==="const"?ue(a.ex[c.ex]):{...a,br:[c]}}case"vtag":return ue(l.tag[a.ex]??"");case"tag":return r(a.x[0],l.with(a.tag));case"dtag":{const c=a.br.map(p=>r(p,l));if(c.some(p=>p.op!=="const"))throw new Error("Dynamic tag must be resolvable during detachment");const u=l.with(Object.fromEntries(c.map((p,h)=>[a.ex[h],p.ex])));return r(a.x[0],u)}case"custom":return{...a,x:a.x.map(c=>r(c,l))};default:Bt(d)}}return e.map(a=>r(a,new cs(t.cache.keys).at({})))}function Ft(e,t){const n=new Map;function o(i){const r=n.get(i);if(r)return r;const a=i,l=Un(i.x,o),d=Un(i.br,o);(i.x!==l||i.br!==d)&&(i={...i,x:l,br:d});const c=t(i,a);return n.set(i,c),c}return Un(e,o)}function rs(e,t){const n=new Set;function o(i){n.has(i)||(t(i,o),n.add(i))}e.forEach(o)}function Un(e,t){const n=e.map(t);return e.every((o,i)=>o===n[i])?e:n}const Ts={arithmetic:Be,branching:Es};class yd extends Ac{constructor(t,n=ac,o=()=>!0){super(t.cache.keys),this.gathering=new Set,this.nodes=t.nodes,this.tagStr=n,this.filter=o,this.defaultAccu=i=>t.defaultAccu(i),this.cache=this.cache.with(t.cache.tag)}withTag(t){throw new Error("Unimplemented")}_gather(t){if(this.gathering.has(t))throw new Error(`Loop detected for ${this.tagStr(t.tag)}`);this.gathering.add(t);const n=this.__gather(t);return this.gathering.delete(t),n}__gather(t){if(t.val)return t.val;const n=this.nodes.entries(t.id).flatMap(({tag:o,value:i})=>i.op==="reread"?this._gather(t.with(i.tag)).pre.map(r=>{const a=`${this.tagStr(o)} <= ${this.tagStr(i.tag)} : ${r.meta.readSeq}`;return Object.freeze({...r,meta:{...r.meta,readSeq:a}})}):[this.markGathered(t.tag,o,i,this._compute(i,t))]);return t.val={pre:n}}_compute(t,n){try{return super._compute(t,n)}catch(o){return Object.freeze({val:NaN,meta:{formula:`${o}`,deps:[],omitted:[],val:NaN,x:[],br:[],comp:"ERR",pivot:!0,toJSON:ao}})}}markGathered(t,n,o,i){const r=`${this.tagStr(n)} <- ${this.tagStr(t)}`;return{...i,meta:{...i.meta,readSeq:r,pivot:!0}}}computeMeta(t,n,o,i,r){let a,l;const d=o.filter(m=>m).map(m=>m.meta),c=i.map(m=>m.meta),u=[],p=t.op==="read"?t.ex:t.op,h=[];if(p in Be){const m=Be[p]([]);for(const $ of[...c,...d])$.val!==m||this.filter($)?u.push($):h.push($)}else u.push(...c,...d);switch(t.op){case"const":a=io(t.ex);break;case"read":l=`gather ${d.length} node(s)`,l+=` matching ${this.tagStr(r,t.ex)}`,l+=` (for ${this.tagStr(t.tag)})`,h.length&&(l+=` <${h.length} omitted>`),a=`${this.tagStr(t.tag)}`;break;default:{const m=[];t.ex&&t.op!=="subscript"&&m.push(JSON.stringify(t.ex)),t.tag&&m.push(this.tagStr(t.tag)),m.push(...u.map($=>$.comp)),h.length&&m.push(`<${h.length} omitted>`),a=`${t.op}(`+m.join(", ")+")"}}return h.push(...u.flatMap(m=>m.pivot?[]:m.omitted)),Object.freeze({formula:`[${io(n)}] ${l??a}`,deps:[...new Set(u.flatMap(m=>m.pivot?[m]:m.deps))],omitted:[...new Set(h)],val:n,x:d,br:c,comp:a,pivot:t.op==="read",toJSON:ao})}}const io=e=>typeof e=="string"?`"${e}"`:e.toString();function ao(){const{formula:e,readSeq:t,deps:n}=this,o={readSeq:t,formula:e,deps:n};return o.readSeq||delete o.readSeq,o.deps.length||delete o.deps,Object.keys(o).length===1?o.formula:o}const{arithmetic:co}=Ts;function xd(e){return e=$d(e),e=bd(e),e=wd(e),e}function $d(e){return Ft(e,t=>{const{op:n}=t;switch(n){case"sum":case"prod":case"min":case"max":if(t.x.length===1)return t.x[0];if(t.x.some(o=>o.op===n)){const o=t.x.flatMap(i=>i.op===n?i.x:[i]);return{...t,x:o}}}return t})}function bd(e){return Ft(e,t=>{const{op:n}=t;switch(n){case"sum":case"prod":case"min":case"max":{const o=t.x.filter(i=>i.op==="const");if(o.length>1){const i=t.x.filter(a=>a.op!=="const"),r=co[n](o.map(a=>a.ex));return r===co[n]([])?{...t,x:i}:{...t,x:[ue(r),...i]}}}}return t})}function wd(e){const t=new Map,n=new Ec;return Ft(e,o=>{const{op:i}=o,r=o.x.map(c=>t.get(c)),a=o.br.map(c=>t.get(c));let l;switch(i){case"read":{const c=Object.keys(o.tag).sort();l=[i,o.ex,...c,...c.map(u=>o.tag[u])];break}case"sum":case"prod":case"min":case"max":l=[i,...r.sort()];break;case"thres":case"custom":case"sumfrac":case"lookup":case"subscript":case"const":l=[i,o.ex,...r,...a];break;case"match":l=[i,o.ex,...r,...a.sort()];break;default:Bt(i)}const d=n.ref(l);return"value"in d?d.value:(d.value=o,t.set(o,t.size),o)})}const{arithmetic:_d,branching:kd}=Ts;function vd(e,t,n,o,i){const r=new Cd(e,o,t,n);for(;r.progress;)r.progress=!1,Sd(r),Dd(r,1),Ed(r),Md(r,i);return r.nodes=xd(r.nodes),r}var ve,Oe,Ve,je,We;class Cd{constructor(t,n,o,i){Re(this,ve);Re(this,Oe);Re(this,Ve);Re(this,je);Re(this,We);this.progress=!0,Y(this,ve,t),this.minimum=n,Y(this,Oe,o),this.cat=i}get nodes(){return _e(this,ve)}set nodes(t){_e(this,ve)!==t&&(this.progress=!0,Y(this,ve,t),Y(this,je,Y(this,We,void 0)))}get candidates(){return _e(this,Oe)}set candidates(t){this.candidates!==t&&(this.progress=!0,Y(this,Oe,t),Y(this,Ve,Y(this,je,Y(this,We,void 0))))}get cndRanges(){return _e(this,Ve)??Y(this,Ve,this.candidates.map(ls))}set cndRanges(t){Y(this,Ve,t)}get nodeRanges(){return _e(this,je)??Y(this,je,qc(this.nodes,this.cat,this.cndRanges))}get monotonicities(){return _e(this,We)??Y(this,We,Td(this.nodes.slice(0,this.minimum.length),this.cat,this.nodeRanges))}}ve=new WeakMap,Oe=new WeakMap,Ve=new WeakMap,je=new WeakMap,We=new WeakMap;function Sd(e){const{nodes:t,nodeRanges:n}=e,o=Ft(t,(i,r)=>{const a=n.get(r);if(a.min===a.max)return r.op==="const"?i:ue(a.min);switch(r.op){case"thres":{const[l,d]=r.br.map(c=>n.get(c));if(l.min>=d.max)return i.x[0];if(l.max<d.min)return i.x[1];break}case"min":{const l=i.x.filter((d,c)=>n.get(r.x[c]).min<=a.max);if(l.length===1)return l[0];if(l.length!==i.x.length)return Dr(...l);break}case"max":{const l=i.x.filter((d,c)=>n.get(r.x[c]).max>=a.min);if(l.length===1)return l[0];if(l.length!==i.x.length)return os(...l);break}case"match":case"lookup":if(i.br.every(l=>l.op==="const")){const l=i.br.map(d=>d.ex);return i.x[kd[r.op](l,r.ex)]}break;case"subscript":if(i.br[0].op==="const")return ue(i.ex[i.br[0].ex]);break}return i});e.nodes=o}function Dd(e,t){const{nodeRanges:n,minimum:o,cat:i}=e,r=[...e.candidates],a=[...e.cndRanges],l=[],d=[];let c=!1;if(e.nodes.forEach((p,h)=>{if(h<o.length){if(o[h]>n.get(p).min)c=!0;else if(h>=t)return;d.push(o[h])}l.push(p)}),d.length!=o.length&&(e.nodes=l,e.minimum=d),!c)return;let u=!1;r.forEach((p,h)=>{const m=a[h],$=p.filter(x=>{a[h]=ls([x]);const C=qc(l,i,a);return d.every((S,M)=>C.get(l[M]).max>=S)});$.length!=p.length?(r[h]=$,a[h]=ls($),u=!0):a[h]=m}),u&&(e.candidates=r,e.cndRanges=a)}function Md(e,t){const n=[...e.monotonicities],o=e.candidates.map(c=>c.map(u=>{const p={incomp:[],inc:{},c:u};for(const[h,m]of n)m.inc?p.inc[h]=u[h]??0:m.dec?p.inc[h]=-(u[h]??0):p.incomp.push(u[h]??0);return p})),i=o[0][0];if(i===void 0)return;const r=Object.keys(i.inc),a=[...r].reverse(),l=!!i.incomp.length,d=o.map(c=>{const u=new Ec;return l?c.forEach(p=>{const h=u.ref(p.incomp);h.value?h.value.push(p):h.value=[p]}):u.ref([]).value=c,[...u.values()].flatMap(p=>(p.sort(({inc:h},{inc:m})=>{const $=a.find(x=>h[x]!==m[x]);return $===void 0?0:m[$]-h[$]}),p.filter(({inc:h},m)=>{let $=0;for(let x=0,C=m-t;x<=C+$;x++){const S=p[x].inc;if(r.every(M=>S[M]>=h[M])&&++$>=t)return!1}return!0})))});d.some((c,u)=>c.length!=e.candidates[u].length)&&(e.candidates=d.map(c=>c.map(u=>u.c)))}const fe=Symbol();function Ed(e){const{nodes:t,cat:n,candidates:o}=e,i=new Map;rs(t,(c,u)=>{if(c.x.forEach(u),c.br.forEach(u),c.br.length)return;const p=c.x.map(m=>i.get(m));if(p.some(m=>!m))return;let h;switch(c.op){case"sum":{h={[fe]:p.reduce((m,$)=>m+$[fe],0)};for(const m of p)for(const[$,x]of Object.entries(m))h[$]=(h[$]??0)+x;break}case"prod":{const m=c.x.findIndex(x=>x.op!=="const");if(c.x.find((x,C)=>x.op!=="const"&&C!==m))return;h=m!==-1?{...p[m]}:{[fe]:1};const $=p.reduce((x,C,S)=>S===m?x:x*C[fe],1);$!=1&&(Object.keys(h).forEach(x=>h[x]*=$),h[fe]*=$);break}case"read":h={[c.tag[n]]:1,[fe]:0};break;case"const":if(typeof c.ex!="number")return;h={[fe]:c.ex};break;default:return}i.set(c,h)});const r=new Map;if(rs(t,(c,u)=>{const p=i.get(c);p&&Object.keys(p).length?r.set(c,p):(c.x.forEach(u),c.br.forEach(u))}),![...r.keys()].some(c=>{if(c.op==="const"||c.op==="read")return!1;if(c.op==="sum"&&c.x.length===2){if(c.x[0].op==="const"&&c.x[1].op==="read")return!1;if(c.x[1].op==="const"&&c.x[0].op==="read")return!1}return!0}))return;let l=new Map([...r.values()].map(c=>{const u=Object.keys(c).sort();return u.length===1&&c[u[0]]===1?[c,u[0]]:[c,""+u.flatMap(p=>[p,c[p]]).join("")]}));if(!ic()){const c=new Map([...l.values()].map((u,p)=>[u,`c${p}`]));l=new Map([...l].map(([u,p])=>[u,c.get(p)]))}const d=new Map;for(const[c,u]of l){const p=yn({[n]:u});d.set(c,c[fe]!==0?cc(c[fe],p):p)}e.candidates=o.map(c=>c.map(u=>{const p={id:u.id};return l.forEach((h,m)=>{h in p||(p[h]=Object.entries(m).reduce(($,[x,C])=>$+(u[x]??0)*C,0))}),p})),e.nodes=Ft(t,(c,u)=>{const p=r.get(u);return p?d.get(p):c})}function ls(e){const t=e.values(),n=t.next().value;if(!n)return{};const o=Object.fromEntries(Object.entries(n).map(([i,r])=>[i,{min:r,max:r}]));for(const i of t){for(const[r,a]of Object.entries(o)){const l=i[r]??0;a.min>l&&(a.min=l),a.max<l&&(a.max=l)}for(const[r,a]of Object.entries(i))r in o||(o[r]={min:Math.min(0,a),max:Math.max(0,a)})}return o}function qc(e,t,n){const o=new Map;return rs(e,(i,r)=>{i.x.forEach(r),i.br.forEach(r);const a=i.x.map(p=>o.get(p)),l=a.map(p=>p.min),d=a.map(p=>p.max);function c(p,[h,m]){const $=_d[p],x=[$([h.min,m.min]),$([h.min,m.max]),$([h.max,m.min]),$([h.max,m.max])];return{min:Math.min(...x),max:Math.max(...x)}}let u;switch(i.op){case"const":typeof i.ex=="number"?u={min:i.ex,max:i.ex}:u={min:NaN,max:NaN};break;case"sum":u={min:l.reduce((p,h)=>p+h,0),max:d.reduce((p,h)=>p+h,0)};break;case"prod":u={min:1,max:1},u=a.reduce((p,h)=>c(i.op,[p,h]),u);break;case"min":case"max":u={min:Math[i.op](...l),max:Math[i.op](...d)};break;case"match":case"thres":u={min:Math.min(...l),max:Math.max(...d)};break;case"sumfrac":l[0]+l[1]>0||d[0]+d[1]<0?u=c(i.op,a):u={min:NaN,max:NaN};break;case"read":{u={min:0,max:0};for(const{[i.tag[t]]:p}of n)p&&(u.min+=p.min,u.max+=p.max);break}case"subscript":{if(typeof i.ex[0]!="number")u={min:NaN,max:NaN};else{u={min:1/0,max:-1/0};let{min:p,max:h}=o.get(i.br[0]);p=Math.max(0,Math.ceil(p)),h=Math.min(h,i.ex.length-1);for(let m=p;m<=h;m++){const $=i.ex[m];u.min>$&&(u.min=$),u.max<$&&(u.max=$)}u.min>u.max&&(u={min:NaN,max:NaN})}break}case"lookup":isNaN(l[0])&&isNaN(d[0])&&(l.splice(0,1),d.splice(0,1)),u={min:Math.min(...l),max:Math.max(...d)};break;case"custom":u=Ss[i.ex].range(a);break;default:Bt(i)}o.set(i,u)}),o}function Td(e,t,n){const o=new Map,i=[],r=new Map;function a(l,d){o.has(l)||o.set(l,{inc:!0,dec:!0});const c=o.get(l);if(d&&c.dec)c.dec=!1;else if(!d&&c.inc)c.inc=!1;else return;i.push({node:l,inc:d})}for(e.forEach(l=>a(l,!0));i.length;){const{node:l,inc:d}=i.pop();switch(l.op){case"read":r.set(l.tag[t],o.get(l));break;case"const":break;case"sum":case"min":case"max":l.x.forEach(c=>a(c,d));break;case"thres":{l.x.forEach(p=>a(p,d));const c=n.get(l.x[0]),u=n.get(l.x[1]);c.max>u.min&&(a(l.br[0],d),a(l.br[1],!d)),c.min<u.max&&(a(l.br[0],!d),a(l.br[1],d));break}case"sumfrac":{const[c,u]=l.x.map(p=>n.get(p));u.min<0&&a(l.x[0],!d),u.max>0&&a(l.x[0],d),c.min<0&&a(l.x[1],d),c.max>0&&a(l.x[1],!d);break}case"prod":{const c=n.get(l);if(c.min<0&&c.max>0)l.x.forEach(u=>a(u,!0)),l.x.forEach(u=>a(u,!1));else{const u=d===c.max>0;l.x.forEach(p=>a(p,u===n.get(p).max>0))}break}case"match":case"lookup":l.x.forEach(c=>a(c,d)),l.br.forEach(c=>a(c,!0)),l.br.forEach(c=>a(c,!1));break;case"subscript":{const{br:[c],ex:u}=l;if(typeof u[0]=="number"){let{min:p,max:h}=n.get(c);p=Math.max(0,Math.ceil(p)),h=Math.min(h,u.length-1);for(let m=p+1;m<=h;m++)if(u[m-1]<u[m]){a(c,d);break}for(let m=p+1;m<=h;m++)if(u[m-1]>u[m]){a(c,!d);break}}else a(c,!0),a(c,!1);break}case"custom":Ss[l.ex].monotonicity(l.x.map(c=>n.get(c))).forEach((c,u)=>{c.inc||a(l.x[u],!d),c.dec||a(l.x[u],d)});break;default:Bt(l)}}return r}function ds(e){const[t,n]=Mr();return f.useEffect(()=>e.followAny((o,i)=>i==="update"&&n()),[e,n]),t}function ee(e){const{database:t}=z();return hs(t.charOpts,e)}const{arithmetic:Id}=Ts;let Rd=class extends Ac{computeMeta({op:t,ex:n,tag:o},i,r,a,l){let d=r.filter(m=>!!m);const c=Ad(d,a);function u(m){return Object.freeze(l&&!m.tag?{tag:l,...m}:m)}function p(m,$){return u({op:m,ops:$,...c})}function h(m,$){let{meta:x}=m;return $!=null&&$.some(C=>!x.usedCats.has(C))&&(x={...x,usedCats:new Set([...x.usedCats,...$])}),u(x.conds===c.conds?x:{...x,...c})}if(t==="read"&&(l==null?void 0:l.qt)==="cond"){const{src:m,dst:$,sheet:x,q:C}=l;m&&x&&C&&(c.conds=wn(c.conds,{[$??"All"]:{[m]:{[x]:{[C]:i}}}}))}switch(t==="read"&&n!=="unique"&&([t,n]=[n,void 0]),t){case"sum":case"prod":case"min":case"max":case"sumfrac":if(d.length>1){const m=Id[t]([]);d=d.filter($=>$.val!==m)}return d.length===1?h(d[0]):p(d.length?t:"const",d);case"const":case"subscript":return p("const",[]);case"vtag":return c.usedCats=new Set([n]),p("const",[]);case"match":case"thres":case"lookup":case"read":return h(d[0]);case"tag":return h(d[0],Object.keys(o));case"dtag":return h(d[0],n);case"custom":return p(n,d);default:rc(t)}}markGathered(t,n,o,i){const{val:r}=i,a={...i.meta};let l=!1;const d=new Set([...a.usedCats,...Object.keys(n)]);return a.usedCats.size!==d.size&&(a.usedCats=d,l=!0),l?{val:r,meta:Object.freeze(a)}:i}listFormulas(t){return this.gather(t.tag).filter(n=>n.val).map(({val:n,meta:o})=>Er.withTag(o.tag)[n])}listCondFormulas(t){return this.listFormulas(t).map(n=>this.compute(n).meta.conds).reduce(wn,{})}};function Ad(e,t){var a;const n=[...e.map(l=>l.meta),...t.map(l=>l.meta)];let o={},i=new Set;for(const l of n)o=wn(o,l.conds),l.usedCats.forEach(d=>i.add(d));const r=i.size;return i=((a=n.find(l=>l.usedCats.size===r))==null?void 0:a.usedCats)??i,{usedCats:i,conds:o}}function wn(e,t){if(e===t)return e;if(typeof e!="object")throw new Error(`cannot merge ${e} and ${t}`);if(Object.keys(t).length>Object.keys(e).length&&([e,t]=[t,e]),!Object.keys(t).length)return e;let n=!1;const o={...e};for(const[i,r]of Object.entries(t)){const a=o[i],l=i in o?wn(a,r):r;a!==l&&(o[i]=l,n=!0)}return Object.freeze(n?o:e)}function qd(e){const t=new Set(e);return n=>!Pd(n,t)}function Pd(e,t){const n=e.formula.match(/(\S+) (\S+) common.count/);if(!n)return!1;const[,o,i]=n;return i==="own"&&t.has(o)}class zd extends Rd{toDebug(){return new yd(this,Tr,qd([...Vt,...jt]))}defaultAccu(t){var i,r,a,l;const{qt:n,q:o}=t;if(!(!n||!o))switch(t.et){case"own":case"target":return(r=(i=lc[n])==null?void 0:i[o])==null?void 0:r.accu;case"enemy":return(l=(a=Ir[n])==null?void 0:a[o])==null?void 0:l.accu;case"team":if(n==="common"&&o==="count")return"sum";throw new Error("non-explicit team value accumulator")}}}function fn(e,...t){return t.map(({tag:n,value:o})=>({tag:{...n,preset:e},value:o}))}function Pc(e,...t){return t.map(({tag:n,value:o})=>({tag:{...n,src:e},value:o}))}function zc(e){const{lvl:t,promotion:n,basic:o,dodge:i,special:r,chain:a,assist:l,core:d,mindscape:c}=P.char,{char:u,iso:p,[e.key]:h}=F.withAll("sheet",[]);return[u.reread(h),p.reread(h),t.add(e.level),o.add(e.basic),i.add(e.dodge),r.add(e.special),a.add(e.chain),l.add(e.assist),d.add(e.core),n.add(e.promotion),c.add(e.mindscape),xn.base.crit_.add(.05),xn.base.crit_dmg_.add(.5)]}function Od(e,t,n,o){return[F.sheet("agg").reread(F.sheet("wengine")),P.common.count.sheet(e).add(1),P.wengine.lvl.add(t),P.wengine.modification.add(n),P.wengine.phase.add(o)]}function Oc(e,t){const{common:{count:n},initial:o}=qr(lc,{sheet:"disc",et:"own"});return[F.sheet("agg").reread(F.sheet("disc")),F.withTag({sheet:"disc",qt:"initial"}).reread(F.sheet("dyn")),...Object.entries(e).map(([i,r])=>Pr(o,i).sheet("dyn").add(r)),...Object.entries(t).map(([i,r])=>n.sheet(i).add(r))]}function Vc(e){const t=F.with("et","team"),{own:n,enemy:o,teamBuff:i,notOwnBuff:r}=F.sheet("agg").withAll("et",[]);return[e.map(a=>F.withTag({et:"target",dst:a}).reread(F.withTag({et:"own",dst:null,src:a}))),e.flatMap(a=>{const l=n.with("src",a);return e.map(d=>l.reread(i.withTag({dst:a,src:d,name:null})))}),e.flatMap(a=>{const l=n.with("src",a);return e.filter(d=>d!==a).map(d=>l.reread(r.withTag({dst:a,src:d,name:null})))}),e.map(a=>o.reread(F.withTag({et:"enemyDeBuff",dst:null,src:a,name:null}))),e.flatMap((a,l)=>{const{stackIn:d,stackTmp:c}=F.withAll("qt",[]),u=F.withTag({src:a,et:"own"});return[u.with("qt","stackTmp").add(Rr(d,0,l+1)),u.with("qt","stackOut").add(Ar(c.max.with("et","team"),l+1,d))]}),e.map(a=>t.add(F.withTag({src:a,et:"own"})))].flat()}function jc(e){const t=dc($n,e);return new zd($n,zr,t)}function Vd(e){return new fd($n,dc($n,e))}var At={},ro;function jd(){if(ro)return At;ro=1;var e=ms();Object.defineProperty(At,"__esModule",{value:!0}),At.default=void 0;var t=e(fs()),n=gs(),o=(0,t.default)((0,n.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");return At.default=o,At}var Wd=jd();const ln=ys(Wd);function Nd({formulasRead:e,buffsRead:t}){var d;const n=f.useContext(Kt),o=(d=f.useContext(Ke))==null?void 0:d.withTag(n),i=o==null?void 0:o.toDebug(),[r,a]=f.useState(!1),l=c=>(u,p)=>{a(p?c:!1)};return s(W,{bgt:"dark",children:y(O,{children:[y(on,{expanded:r==="formulas",onChange:l("formulas"),slotProps:{transition:{unmountOnExit:!0}},children:[s(cn,{expandIcon:s(ln,{}),children:"All target listings"}),s(an,{children:s(is,{children:o&&i&&r==="formulas"&&o.listFormulas(e).map((c,u)=>{const p=o.compute(c),h=i.compute(c).meta,m=c.tag.name||c.tag.q;return y($e,{children:[y(I,{children:[m,": ",p.val]}),y(on,{children:[y(cn,{expandIcon:s(ln,{}),children:["debug for ",m]}),y(an,{children:["conds:",s(de,{text:ge(p.meta.conds)}),"read:",s(de,{text:ge(c)}),"formula:",s(de,{text:ge(h)})]})]})]},`${m}${u}`)})})})]}),y(on,{expanded:r==="buffs",onChange:l("buffs"),slotProps:{transition:{unmountOnExit:!0}},children:[s(cn,{expandIcon:s(ln,{}),children:"All target buffs"}),s(an,{children:s(is,{children:o&&i&&r==="buffs"&&o.listFormulas(t).map((c,u)=>{const p=o.compute(c),h=i.compute(c).meta,m=c.tag.name||c.tag.q;return y($e,{children:[y(I,{children:[m,": ",p.val]}),y(on,{children:[y(cn,{expandIcon:s(ln,{}),children:["debug for ",m]}),y(an,{children:["conds:",s(de,{text:ge(p.meta.conds)}),"read:",s(de,{text:ge(c)}),"formula:",s(de,{text:ge(h)})]})]})]},`${m}${u}`)})})})]})]})})}function Bd(){var u;const e=f.useContext(Kt),t=(u=f.useContext(Ke))==null?void 0:u.withTag(e),n=t==null?void 0:t.toDebug(),{read:o,setRead:i}=f.useContext(xs),r=o&&(t==null?void 0:t.compute(o)),a=o&&(n==null?void 0:n.compute(o)),l=(o==null?void 0:o.tag.name)||(o==null?void 0:o.tag.q),d=a==null?void 0:a.meta,c=d&&ge(d);return s($s,{open:!!o,onClose:()=>i(void 0),children:y(W,{bgt:"dark",children:[s(Lt,{title:`Debug formula for ${l}`,action:s(Se,{onClick:()=>i(void 0),children:s(Dn,{})})}),s(O,{children:s(W,{bgt:"normal",children:s(O,{children:y(is,{gap:1,children:["Computed value: ",r==null?void 0:r.val,s(ae,{}),s(I,{variant:"h6",children:"Read"}),s(de,{text:ge(o)}),s(ae,{}),s(I,{variant:"h6",children:"Calculator Tag"}),s(de,{text:JSON.stringify(t==null?void 0:t.cache.tag)}),s(ae,{}),s(I,{variant:"h6",children:"Tag Context"}),s(de,{text:JSON.stringify(e)}),s(ae,{}),s(I,{variant:"h6",children:"Conditionals"}),s(de,{text:ge(r==null?void 0:r.meta.conds)}),s(ae,{}),s(I,{variant:"h6",children:"Formula"}),s(de,{text:c||""})]})})})})]})})}function Wc({document:e,bgt:t="normal",collapse:n=!1,typoVariant:o="body1"}){switch(e.type){case"fields":return s(Kd,{fieldsDocument:e,bgt:t});case"text":return n?s(Ld,{textDocument:e,typoVariant:o}):s(Nc,{textDocument:e,typoVariant:o});case"conditional":return s(Or,{conditional:e.conditional,bgt:t});default:return null}}function Kd({fieldsDocument:e,bgt:t="normal"}){return y(W,{bgt:t,children:[e.header&&s(jr,{header:e.header,hideDivider:e.fields.length===0}),s(Wr,{bgt:t,fields:e.fields})]})}function Nc({textDocument:e,typoVariant:t}){const n=f.useContext(Ke),o=f.useContext(Kt);return n?s(I,{variant:t,children:uc(e.text,n.withTag(o))}):null}function Ld({textDocument:e,typoVariant:t}){const[n,o]=f.useState(!1),[i,r]=f.useState(!1);return y(E,{sx:{position:"relative"},children:[!n&&s(E,{sx:{pointerEvents:"none",position:"absolute",mx:"auto",width:"100%",display:"flex",justifyContent:"center",height:"100%",alignItems:"flex-end",zIndex:"10",transition:"transform 0.3s ease",transform:i?"translate(0,-5px)":void 0},children:s(Vr,{})}),s(Cs,{onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),collapsedSize:55,onClick:()=>o(a=>!a),in:n,sx:{cursor:"pointer",position:"relative",maskImage:n?void 0:"linear-gradient(to bottom, black 0%, transparent 100%)","&:hover":{maskImage:n?void 0:"linear-gradient(to bottom, black 50%, transparent 100%)"}},children:s(Nc,{textDocument:e,typoVariant:t})})]})}function Hd({numWorkers:e,setNumWorkers:t}){const{t:n}=he("page_optimize"),o=navigator.hardwareConcurrency||8;return y(se,{title:`${e} Workers`,children:[s(V,{disabled:!0,children:"Scales with available CPU cores."}),Nr(1,o).map(i=>s(V,{onClick:()=>t(i),children:n("worker",{count:i})},i))]})}function Fd({maxBuildsToShow:e,optConfigId:t}){const{database:n}=z(),{t:o}=he("page_optimize");return y(se,{title:o("build",{count:e}),children:[s(V,{children:s(I,{variant:"caption",color:"info.main",children:o("buildDropdownDesc")})}),Br.map(i=>s(V,{onClick:()=>n.optConfigs.set(t,{maxBuildsToShow:i}),children:o("build",{count:i})},i))]})}const Is=Kr(te.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever");function Gd({levelLow:e,levelHigh:t,setLow:n,setHigh:o,setBoth:i,dark:r=!1,disabled:a=!1,showLevelText:l=!1}){const{t:d}=he("wengine"),[c,u]=f.useState(e),[p,h]=f.useState(t),m=f.useCallback(($,x)=>{if(typeof x=="number")throw new TypeError;const[C,S]=x;u(C),h(S)},[u,h]);return f.useEffect(()=>u(e),[u,e]),f.useEffect(()=>h(t),[h,t]),y(E,{sx:{width:"100%",display:"flex",alignItems:"center",bgcolor:r?"contentNormal.main":"contentLight.main",overflow:"visible"},children:[y(E,{sx:{width:"max-content",height:32,display:"flex"},children:[l?y(Ht,{children:[s("span",{style:{padding:"0 1em",width:"max-content",borderRadius:"4px 0 0 4px",display:"flex",justifyContent:"center",alignItems:"center",color:"rgba(255,255,255,0.9)",backgroundColor:"rgb(30,120,200)"},children:d("levelSliderTitle")}),s(ae,{orientation:"vertical",flexItem:!0})]}):void 0,s(Us,{value:c,onChange:$=>n(Gs($??0,0,t)),sx:{px:1,width:"3em"},inputProps:{sx:{textAlign:l?"right":"center"}},disabled:a})]}),s(Lr,{sx:{flex:"0 1 100%",mx:2},getAriaLabel:()=>"Wengine Level Range",value:[c,p],onChange:m,onChangeCommitted:($,x)=>Array.isArray(x)&&i(x[0],x[1]),valueLabelDisplay:"auto",min:0,max:bn,step:1,marks:!0,disabled:a}),s(Us,{value:p,onChange:$=>o(Gs($??0,e,bn)),sx:{px:1,flex:"0 0 3em"},inputProps:{sx:{textAlign:"center"}},disabled:a})]})}function Le(){const e=f.useContext(Ke),t=f.useContext(Kt);return f.useMemo(()=>e==null?void 0:e.withTag(t),[e,t])}const Nt={initial:"Initial",combat:"Combat",final:"Final",base:"Base"};function ce({tag:e,showPercent:t}){return s(Ce,{color:Hg(e),children:s(Xd,{tag:e,showPercent:t})})}function gn({tag:e,showPercent:t}){return y(Ht,{children:[s(ce,{tag:e,showPercent:t}),Gg(e).map(n=>s(Ne,{children:Te[n]},n)),e.attribute&&s(Ne,{color:e.attribute,children:s(Me,{attribute:e.attribute})})]})}const Ud=["hp","hp_","atk","atk_","def","def_"],Jd=e=>Ud.includes(e),lo={dmg_:"DMG",common_dmg_:"DMG",resIgn_:"Res Ignore"};function Xd({tag:e,showPercent:t}){var r;const n=Le(),o=(r=Ug.subset(e)[0])==null?void 0:r.title;if(o)return o;if(e.qt==="cond"&&e.q&&e.sheet&&n){const a=us.get(`${e.sheet}:${e.q}`);if(a)return uc(a.label,n,n==null?void 0:n.compute(new hn(e,"max")).val)}const i=Bc(e);if(Jd(i))return y("span",{children:[s(Fr,{statKey:i,iconProps:Hr})," ",y("span",{children:[(e.qt&&Nt[e.qt])??e.qt," ",Gr[i],t&&Wt(i)]})]});if(lo[i]){const a=[...e.attribute?[mn[e.attribute]]:[],...e.damageType1?[Te[e.damageType1]]:[],...e.damageType2?[Te[e.damageType2]]:[],lo[i]];return s("span",{children:a.join(" ")})}return s(ye,{statKey:i,showPercent:t})}function b(e,t){return[(n,o)=>s(Js,{ns:`${e}_${t}_gen`,key18:n,values:o}),(n,o)=>s(Js,{ns:`${e}_${t}`,key18:n,values:o})]}function g(e){return{title:s(ce,{tag:e}),fieldRef:e}}function Bc(e){if(!e)return"";const{et:t,q:n,qt:o,name:i}=e;return t==="own"&&o==="formula"&&n!=="base"?i??n??"":n??""}const Tn="AstralVoice",[uo,Qd]=b("disc",Tn),po=N(Tn),Zd=_[Tn],Yd=w[Tn],eu={2:{title:s(K,{}),img:po,documents:[{type:"text",text:uo("desc2")}]},4:{title:s(L,{}),img:po,documents:[{type:"text",text:uo("desc4")},{type:"conditional",conditional:{label:Qd("set4_cond"),metadata:Zd.astral,fields:[g(Yd.set4_team_dmg_.tag)]}}]}},In="BranchBladeSong",[ho,tu]=b("disc",In),mo=N(In),nu=_[In],fo=w[In],su={2:{title:s(K,{}),img:mo,documents:[{type:"text",text:ho("desc2")}]},4:{title:s(L,{}),img:mo,documents:[{type:"text",text:ho("desc4")},{type:"fields",fields:[g(fo.set4_passive.tag)]},{type:"conditional",conditional:{label:tu("set4_cond"),metadata:nu.apply_or_trigger,fields:[g(fo.set4_cond.tag)]}}]}},Rn="ChaosJazz",[go,ou]=b("disc",Rn),yo=N(Rn),iu=_[Rn],dn=w[Rn],au={2:{title:s(K,{}),img:yo,documents:[{type:"text",text:go("desc2")}]},4:{title:s(L,{}),img:yo,documents:[{type:"text",text:go("desc4")},{type:"fields",fields:[g(dn.set4_passive_fire_dmg_.tag),g(dn.set4_passive_electric_dmg_.tag)]},{type:"conditional",conditional:{label:ou("set4_cond"),metadata:iu.while_off_field,fields:[{title:"EX Special Attack DMG",fieldRef:dn.set4_off_field_special_dmg_.tag},{title:"Assist Attack Attack DMG",fieldRef:dn.set4_off_field_assist_dmg_.tag}]}}]}},An="ChaoticMetal",[xo,cu]=b("disc",An),$o=N(An),ru=_[An],bo=w[An],lu={2:{title:s(K,{}),img:$o,documents:[{type:"text",text:xo("desc2")}]},4:{title:s(L,{}),img:$o,documents:[{type:"text",text:xo("desc4")},{type:"fields",fields:[g(bo.set4_passive.tag)]},{type:"conditional",conditional:{label:cu("set4_cond"),metadata:ru.trigger_corruption,fields:[g(bo.set4_cond_trigger_corruption.tag)]}}]}},qn="FangedMetal",[wo,du]=b("disc",qn),_o=N(qn),uu=_[qn],pu=w[qn],hu={2:{title:s(K,{}),img:_o,documents:[{type:"text",text:wo("desc2")}]},4:{title:s(L,{}),img:_o,documents:[{type:"text",text:wo("desc4")},{type:"conditional",conditional:{label:du("set4_cond"),metadata:uu.inflict_assault,fields:[g(pu.set4_cond_inflict_assault.tag)]}}]}},Kc="FreedomBlues",[ko,mx]=b("disc",Kc),vo=N(Kc),mu={2:{title:s(K,{}),img:vo,documents:[{type:"text",text:ko("desc2")}]},4:{title:s(L,{}),img:vo,documents:[{type:"text",text:ko("desc4")}]}},Pn="HormonePunk",[Co,fu]=b("disc",Pn),So=N(Pn),gu=_[Pn],yu=w[Pn],xu={2:{title:s(K,{}),img:So,documents:[{type:"text",text:Co("desc2")}]},4:{title:s(L,{}),img:So,documents:[{type:"text",text:Co("desc4")},{type:"conditional",conditional:{label:fu("set4_cond"),metadata:gu.entering_combat,fields:[g(yu.set4_cond_entering_combat.tag)]}}]}},zn="InfernoMetal",[Do,$u]=b("disc",zn),Mo=N(zn),bu=_[zn],wu=w[zn],_u={2:{title:s(K,{}),img:Mo,documents:[{type:"text",text:Do("desc2")}]},4:{title:s(L,{}),img:Mo,documents:[{type:"text",text:Do("desc4")},{type:"conditional",conditional:{label:$u("set4_cond"),metadata:bu.hitting_burning_enemy,fields:[g(wu.set4_cond_hitting_burning_enemy.tag)]}}]}},On="PhaethonsMelody",[Eo,To]=b("disc",On),Io=N(On),Ro=_[On],Ao=w[On],ku={2:{title:s(K,{}),img:Io,documents:[{type:"text",text:Eo("desc2")}]},4:{title:s(L,{}),img:Io,documents:[{type:"text",text:Eo("desc4")},{type:"conditional",conditional:{label:To("set4_cond_squad_use_ex"),metadata:Ro.squad_use_ex,fields:[g(Ao.set4_squad_anomProf.tag)]}},{type:"conditional",conditional:{label:To("set4_cond_not_char_use_ex"),metadata:Ro.not_char_use_ex,fields:[g(Ao.set4_not_self_ether_.tag)]}}]}},Vn="PolarMetal",[qo,vu]=b("disc",Vn),Po=N(Vn),Cu=_[Vn],zo=w[Vn],Su={2:{title:s(K,{}),img:Po,documents:[{type:"text",text:qo("desc2")}]},4:{title:s(L,{}),img:Po,documents:[{type:"text",text:qo("desc4")},{type:"conditional",conditional:{label:vu("set4_cond"),metadata:Cu.freeze_shatter}},{type:"fields",fields:[{title:"Basic Attack DMG",fieldRef:zo.set4_basic_dmg_.tag},{title:"Dash Attack DMG",fieldRef:zo.set4_dash_dmg_.tag}]}]}},jn="ProtoPunk",[Oo,Du]=b("disc",jn),Vo=N(jn),Mu=_[jn],Eu=w[jn],Tu={2:{title:s(K,{}),img:Vo,documents:[{type:"text",text:Oo("desc2")}]},4:{title:s(L,{}),img:Vo,documents:[{type:"text",text:Oo("desc4")},{type:"conditional",conditional:{label:Du("set4_cond"),metadata:Mu.def_assist_or_evasive_assist,fields:[g(Eu.set4_cond_def_assist_or_evasive_assist_dmg_.tag)]}}]}},Wn="PufferElectro",[jo,Iu]=b("disc",Wn),Wo=N(Wn),Ru=_[Wn],No=w[Wn],Au={2:{title:s(K,{}),img:Wo,documents:[{type:"text",text:jo("desc2")}]},4:{title:s(L,{}),img:Wo,documents:[{type:"text",text:jo("desc4")},{type:"fields",fields:[{title:"Ultimate DMG",fieldRef:No.set4_dmg_.tag}]},{type:"conditional",conditional:{label:Iu("set4_cond"),metadata:Ru.launching_ult,fields:[g(No.set4_cond_launching_ult_atk_.tag)]}}]}},Nn="ShadowHarmony",[Bo,qu]=b("disc",Nn),Ko=N(Nn),Pu=_[Nn],Lo=w[Nn],zu={2:{title:s(K,{}),img:Ko,documents:[{type:"text",text:Bo("desc2")}]},4:{title:s(L,{}),img:Ko,documents:[{type:"text",text:Bo("desc4")},{type:"conditional",conditional:{label:qu("set4_cond_stacks"),metadata:Pu.stacks,fields:[g(Lo.set4_stack_atk_.tag),g(Lo.set4_stack_crit_.tag)]}}]}},Rs="ShockstarDisco",[Ho,fx]=b("disc",Rs),Fo=N(Rs),Ou=w[Rs],Vu={2:{title:s(K,{}),img:Fo,documents:[{type:"text",text:Ho("desc2")}]},4:{title:s(L,{}),img:Fo,documents:[{type:"text",text:Ho("desc4")},{type:"fields",fields:[{title:"Basic Attack Daze",fieldRef:Ou.set4_basic_daze_.tag}]}]}},Lc="SoulRock",[Go,gx]=b("disc",Lc),Uo=N(Lc),ju={2:{title:s(K,{}),img:Uo,documents:[{type:"text",text:Go("desc2")}]},4:{title:s(L,{}),img:Uo,documents:[{type:"text",text:Go("desc4")}]}},Bn="SwingJazz",[Jo,Wu]=b("disc",Bn),Xo=N(Bn),Nu=_[Bn],Bu=w[Bn],Ku={2:{title:s(K,{}),img:Xo,documents:[{type:"text",text:Jo("desc2")}]},4:{title:s(L,{}),img:Xo,documents:[{type:"text",text:Jo("desc4")},{type:"conditional",conditional:{label:Wu("set4_cond"),metadata:Nu.chain_or_ult,fields:[g(Bu.set4_cond_chain_or_ult.tag)]}}]}},Kn="ThunderMetal",[Qo,Lu]=b("disc",Kn),Zo=N(Kn),Hu=_[Kn],Fu=w[Kn],Gu={2:{title:s(K,{}),img:Zo,documents:[{type:"text",text:Qo("desc2")}]},4:{title:s(L,{}),img:Zo,documents:[{type:"text",text:Qo("desc4")},{type:"conditional",conditional:{label:Lu("set4_cond"),metadata:Hu.enemy_shocked,fields:[g(Fu.set4_cond_enemy_shocked_atk_.tag)]}}]}},Ln="WoodpeckerElectro",[Yo,Uu]=b("disc",Ln),ei=N(Ln),Ju=_[Ln],Xu=w[Ln],Qu={2:{title:s(K,{}),img:ei,documents:[{type:"text",text:Yo("desc2")}]},4:{title:s(L,{}),img:ei,documents:[{type:"text",text:Yo("desc4")},{type:"conditional",conditional:{label:Uu("set4_cond"),metadata:Ju.crit_basic_dodge_ex,fields:[g(Xu.set4_cond_crit_basic_dodge_ex_atk_.tag)]}}]}},Hc={AstralVoice:eu,BranchBladeSong:su,ChaosJazz:au,ChaoticMetal:lu,FangedMetal:hu,FreedomBlues:mu,HormonePunk:xu,InfernoMetal:_u,PhaethonsMelody:ku,PolarMetal:Su,ProtoPunk:Tu,PufferElectro:Au,ShadowHarmony:zu,ShockstarDisco:Vu,SoulRock:ju,SwingJazz:Ku,ThunderMetal:Gu,WoodpeckerElectro:Qu};function Fc({setKey:e,fade2:t=!1,fade4:n=!1,children:o}){const i=Hc[e];return i?y(ws,{bgt:"light",sx:{height:"100%"},children:[s(Lt,{title:s(Ur,{setKey:e}),avatar:s(bs,{src:N(e),size:2})}),o,s(G,{divider:s(ae,{}),children:Object.entries(i).map(([r,a])=>s(E,{sx:{opacity:(r==="2"?t:n)?.5:1},children:s(Zu,{uiSheetElement:a,collapse:r!=="2"})},r))})]}):null}function Zu({uiSheetElement:e,collapse:t=!1}){const{documents:n,title:o}=e;return y(O,{children:[s(I,{variant:"subtitle1",children:o}),s(G,{spacing:1,children:n.map((i,r)=>s(Wc,{document:i,typoVariant:"body2",collapse:t},r))})]})}function K(){return"2-Set"}function L(){return"4-Set"}function k({wKey:e,children:t}){const n=Le();let o=1;return n&&n.compute(P.common.count.sheet(e)).val&&(o=n.compute(P.wengine.phase).val??1),t(o)}const He="BashfulDemon",[ti,Yu]=b("wengine",He),ep=D.wengine[He],tp=v(He,"icon"),np=_[He],ni=w[He],sp={title:ti("phase"),img:tp,documents:[{type:"text",text:s(k,{wKey:He,children:e=>ti(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(ni.passive_ice_dmg_.tag)]},{type:"conditional",conditional:{label:Yu("cond"),metadata:np.launch_ex_attack,fields:[g(ni.team_atk_.tag),{title:"Duration",fieldValue:ep.duration}]}}]},Gt="BigCylinder",[si,yx]=b("wengine",Gt),op=D.wengine[Gt],ip=v(Gt,"icon"),ap=pc[Gt],cp={title:si("phase"),img:ip,documents:[{type:"text",text:s(k,{wKey:Gt,children:e=>si(`phaseDescs.${e-1}`)})},{type:"fields",fields:[{title:"Additional DMG",fieldRef:ap.damage.tag},{title:"Cooldown",fieldValue:op.cooldown}]}]},Fe="BlazingLaurel",[oi,ii]=b("wengine",Fe),ai=D.wengine[Fe],rp=v(Fe,"icon"),ci=_[Fe],Jn=w[Fe],lp={title:oi("phase"),img:rp,documents:[{type:"text",text:s(k,{wKey:Fe,children:e=>oi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:ii("cond1"),metadata:ci.quickOrPerfectAssistUsed,fields:[g(Jn.impact_.tag),{title:"Duration",fieldValue:ai.duration}]}},{type:"conditional",conditional:{label:ii("cond2"),metadata:ci.wilt,fields:[g(Jn.crit_dmg_ice_.tag),g(Jn.crit_dmg_fire_.tag),{title:"Duration",fieldValue:ai.wilt_duration}]}}]},Ge="BoxCutter",[ri,dp]=b("wengine",Ge),up=D.wengine[Ge],pp=v(Ge,"icon"),hp=_[Ge],mp=w[Ge],fp={title:ri("phase"),img:pp,documents:[{type:"text",text:s(k,{wKey:Ge,children:e=>ri(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:dp("cond"),metadata:hp.launchedAftershock,fields:[g(mp.physical_dmg_.tag),{title:"Duration",fieldValue:up.duration}]}}]},Ut="BunnyBand",[li,gp]=b("wengine",Ut),yp=v(Ut,"icon"),xp=_[Ut],di=w[Ut],$p={title:li("phase"),img:yp,documents:[{type:"text",text:s(k,{wKey:Ut,children:e=>li(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(di.passive_hp_.tag)]},{type:"conditional",conditional:{label:gp("cond"),metadata:xp.wearerShielded,fields:[g(di.atk_.tag)]}}]},Ee="CannonRotor",[ui,xx]=b("wengine",Ee),bp=D.wengine[Ee],wp=v(Ee,"icon"),_p=pc[Ee],kp=w[Ee],vp={title:ui("phase"),img:wp,documents:[{type:"text",text:s(k,{wKey:Ee,children:e=>ui(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(kp.passive_atk_.tag)]},{type:"fields",fields:[{title:"Additional DMG",fieldRef:_p.damage.tag},{title:"Cooldown",fieldValue:s(k,{wKey:Ee,children:e=>bp.cooldown[e]})}]}]},Ue="DeepSeaVisitor",[pi,hi]=b("wengine",Ue),mi=D.wengine[Ue],Cp=v(Ue,"icon"),fi=_[Ue],Xn=w[Ue],Sp={title:pi("phase"),img:Cp,documents:[{type:"text",text:s(k,{wKey:Ue,children:e=>pi(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(Xn.passive_ice_dmg_.tag)]},{type:"conditional",conditional:{label:hi("cond1"),metadata:fi.basicHit,fields:[g(Xn.crit_.tag),{title:"Duration",fieldValue:mi.duration}]}},{type:"conditional",conditional:{label:hi("cond2"),metadata:fi.iceDashAtkHit,fields:[g(Xn.extra_crit_.tag),{title:"Duration",fieldValue:mi.extra_duration}]}}]},Je="DemaraBatteryMarkII",[gi,Dp]=b("wengine",Je),Mp=D.wengine[Je],Ep=v(Je,"icon"),Tp=_[Je],yi=w[Je],Ip={title:gi("phase"),img:Ep,documents:[{type:"text",text:s(k,{wKey:Je,children:e=>gi(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(yi.passive_electric_dmg_.tag)]},{type:"conditional",conditional:{label:Dp("cond"),metadata:Tp.dodgeCounterOrAssistHit,fields:[g(yi.enerRegen_.tag),{title:"Duration",fieldValue:Mp.duration}]}}]},Xe="DrillRigRedAxis",[xi,Rp]=b("wengine",Xe),$i=D.wengine[Xe],Ap=v(Xe,"icon"),qp=_[Xe],bi=w[Xe],Pp={title:xi("phase"),img:Ap,documents:[{type:"text",text:s(k,{wKey:Xe,children:e=>xi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Rp("cond"),metadata:qp.exSpecialOrChainUsed,fields:[g(bi.basic_eletric_dmg_.tag),g(bi.dash_eletric_dmg_.tag),{title:"Duration",fieldValue:$i.duration},{title:"Cooldown",fieldValue:$i.cooldown}]}}]},Jt="ElectroLipGloss",[wi,zp]=b("wengine",Jt),Op=v(Jt,"icon"),Vp=_[Jt],_i=w[Jt],jp={title:wi("phase"),img:Op,documents:[{type:"text",text:s(k,{wKey:Jt,children:e=>wi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:zp("cond"),metadata:Vp.anomalyOnEnemy,fields:[g(_i.atk_.tag),g(_i.common_dmg_.tag)]}}]},Qe="ElegantVanity",[ki,Wp]=b("wengine",Qe),Np=D.wengine[Qe],Bp=v(Qe,"icon"),Kp=_[Qe],Lp=w[Qe],Hp={title:ki("phase"),img:Bp,documents:[{type:"text",text:s(k,{wKey:Qe,children:e=>ki(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Wp("cond"),metadata:Kp.consumed25Energy,fields:[g(Lp.common_dmg_.tag),{title:"Duration",fieldValue:Np.buffDuration}]}}]},Ze="FlamemakerShaker",[vi,Ci]=b("wengine",Ze),Qn=D.wengine[Ze],Fp=v(Ze,"icon"),Si=_[Ze],Zn=w[Ze],Gp={title:vi("phase"),img:Fp,documents:[{type:"text",text:s(k,{wKey:Ze,children:e=>vi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Ci("cond1"),metadata:Si.offField,fields:[g(Zn.enerRegen.tag)]}},{type:"conditional",conditional:{label:Ci("cond2"),metadata:Si.exSpecialAssistHits,fields:[g(Zn.common_dmg_.tag),{title:"Duration",fieldValue:Qn.duration},{title:"Cooldown",fieldValue:Qn.cooldown},g(Zn.anomProf.tag),{title:"Duration",fieldValue:Qn.anomProfDuration}]}}]},Ye="FusionCompiler",[Di,Up]=b("wengine",Ye),Jp=D.wengine[Ye],Xp=v(Ye,"icon"),Qp=_[Ye],Mi=w[Ye],Zp={title:Di("phase"),img:Xp,documents:[{type:"text",text:s(k,{wKey:Ye,children:e=>Di(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(Mi.passive_atk_.tag)]},{type:"conditional",conditional:{label:Up("cond"),metadata:Qp.specialUsed,fields:[g(Mi.anomProf.tag),{title:"Duration",fieldValue:Jp.duration}]}}]},Hn="GildedBlossom",[Ei,$x]=b("wengine",Hn),Yp=v(Hn,"icon"),Ti=w[Hn],eh={title:Ei("phase"),img:Yp,documents:[{type:"text",text:s(k,{wKey:Hn,children:e=>Ei(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(Ti.passive_atk_.tag),g(Ti.passive_exSpecial_dmg_.tag)]}]},et="HailstormShrine",[Ii,th]=b("wengine",et),nh=D.wengine[et],sh=v(et,"icon"),oh=_[et],Ri=w[et],ih={title:Ii("phase"),img:sh,documents:[{type:"text",text:s(k,{wKey:et,children:e=>Ii(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(Ri.passive_crit_dmg_.tag)]},{type:"conditional",conditional:{label:th("cond"),metadata:oh.exSpecialOrAnomaly,fields:[g(Ri.ice_dmg_.tag),{title:"Duration",fieldValue:nh.duration}]}}]},tt="HeartstringNocturne",[Ai,ah]=b("wengine",tt),ch=D.wengine[tt],rh=v(tt,"icon"),lh=_[tt],Yn=w[tt],dh={title:Ai("phase"),img:rh,documents:[{type:"text",text:s(k,{wKey:tt,children:e=>Ai(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(Yn.passive_crit_dmg_.tag)]},{type:"conditional",conditional:{label:ah("cond"),metadata:lh.heartstring,fields:[g(Yn.chain_resIgn_fire_.tag),g(Yn.ult_resIgn_fire_.tag),{title:"Duration",fieldValue:ch.duration}]}}]},nt="HellfireGears",[qi,Pi]=b("wengine",nt),uh=D.wengine[nt],ph=v(nt,"icon"),zi=_[nt],Oi=w[nt],hh={title:qi("phase"),img:ph,documents:[{type:"text",text:s(k,{wKey:nt,children:e=>qi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Pi("cond1"),metadata:zi.offField,fields:[g(Oi.enerRegen.tag)]}},{type:"conditional",conditional:{label:Pi("cond1"),metadata:zi.exSpecialUsed,fields:[g(Oi.impact_.tag),{title:"Duration",fieldValue:uh.duration}]}}]},st="Housekeeper",[Vi,ji]=b("wengine",st),mh=D.wengine[st],fh=v(st,"icon"),Wi=_[st],Ni=w[st],gh={title:Vi("phase"),img:fh,documents:[{type:"text",text:s(k,{wKey:st,children:e=>Vi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:ji("cond1"),metadata:Wi.offField,fields:[g(Ni.enerRegen.tag)]}},{type:"conditional",conditional:{label:ji("cond2"),metadata:Wi.exSpecialHits,fields:[g(Ni.physical_dmg_.tag),{title:"Duration",fieldValue:mh.duration}]}}]},ot="IceJadeTeapot",[Bi,yh]=b("wengine",ot),Ki=D.wengine[ot],xh=v(ot,"icon"),$h=_[ot],Li=w[ot],bh={title:Bi("phase"),img:xh,documents:[{type:"text",text:s(k,{wKey:ot,children:e=>Bi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:yh("cond"),metadata:$h.teariffic,fields:[g(Li.impact_.tag),{title:"Duration",fieldValue:Ki.duration},g(Li.common_dmg_.tag),{title:"Duration",fieldValue:Ki.teamBuffDuration}]}}]},it="IdentityBase",[Hi,wh]=b("wengine",it),_h=D.wengine[it],kh=v(it,"icon"),vh=_[it],Ch=w[it],Sh={title:Hi("phase"),img:kh,documents:[{type:"text",text:s(k,{wKey:it,children:e=>Hi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:wh("cond"),metadata:vh.equipperAttacked,fields:[g(Ch.def_.tag),{title:"Duration",fieldValue:_h.duration}]}}]},As="IdentityInflection",[Fi,bx]=b("wengine",As),Dh=v(As,"icon"),Mh={title:Fi("phase"),img:Dh,documents:[{type:"text",text:s(k,{wKey:As,children:e=>Fi(`phaseDescs.${e-1}`)})}]},at="KaboomTheCannon",[Gi,Eh]=b("wengine",at),Th=D.wengine[at],Ih=v(at,"icon"),Rh=_[at],Ah=w[at],qh={title:Gi("phase"),img:Ih,documents:[{type:"text",text:s(k,{wKey:at,children:e=>Gi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Eh("cond"),metadata:Rh.allyHitsEnemy,fields:[g(Ah.atk_.tag),{title:"Duration",fieldValue:Th.duration}]}}]},ct="LunarDecrescent",[Ui,Ph]=b("wengine",ct),zh=D.wengine[ct],Oh=v(ct,"icon"),Vh=_[ct],jh=w[ct],Wh={title:Ui("phase"),img:Oh,documents:[{type:"text",text:s(k,{wKey:ct,children:e=>Ui(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Ph("cond"),metadata:Vh.chainOrUltUsed,fields:[g(jh.common_dmg_.tag),{title:"Duration",fieldValue:zh.duration}]}}]},qs="LunarNoviluna",[Ji,wx]=b("wengine",qs),Nh=v(qs,"icon"),Bh={title:Ji("phase"),img:Nh,documents:[{type:"text",text:s(k,{wKey:qs,children:e=>Ji(`phaseDescs.${e-1}`)})}]},Fn="LunarPleniluna",[Xi,_x]=b("wengine",Fn),Kh=v(Fn,"icon"),es=w[Fn],Lh={title:Xi("phase"),img:Kh,documents:[{type:"text",text:s(k,{wKey:Fn,children:e=>Xi(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(es.basic_dmg_.tag),g(es.dash_dmg_.tag),g(es.dodgeCounter_dmg_.tag)]}]},rt="MagneticStormAlpha",[Qi,Hh]=b("wengine",rt),Zi=D.wengine[rt],Fh=v(rt,"icon"),Gh=_[rt],Uh=w[rt],Jh={title:Qi("phase"),img:Fh,documents:[{type:"text",text:s(k,{wKey:rt,children:e=>Qi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Hh("cond"),metadata:Gh.anomalyBuildupIncreased,fields:[g(Uh.anomMas.tag),{title:"Duration",fieldValue:Zi.duration},{title:"Cooldown",fieldValue:Zi.cooldown}]}}]},lt="MagneticStormBravo",[Yi,Xh]=b("wengine",lt),ea=D.wengine[lt],Qh=v(lt,"icon"),Zh=_[lt],Yh=w[lt],em={title:Yi("phase"),img:Qh,documents:[{type:"text",text:s(k,{wKey:lt,children:e=>Yi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Xh("cond"),metadata:Zh.anomalyBuildupIncreased,fields:[g(Yh.anomProf.tag),{title:"Duration",fieldValue:ea.duration},{title:"Cooldown",fieldValue:ea.cooldown}]}}]},Ps="MagneticStormCharlie",[ta,kx]=b("wengine",Ps),tm=v(Ps,"icon"),nm={title:ta("phase"),img:tm,documents:[{type:"text",text:s(k,{wKey:Ps,children:e=>ta(`phaseDescs.${e-1}`)})}]},dt="MarcatoDesire",[na,sa]=b("wengine",dt),sm=D.wengine[dt],om=v(dt,"icon"),oa=_[dt],im=w[dt],am={title:na("phase"),img:om,documents:[{type:"text",text:s(k,{wKey:dt,children:e=>na(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:sa("cond1"),metadata:oa.exSpecialOrChainHitsEnemy,fields:[g(im.atk_.tag),{title:"Duration",fieldValue:sm.duration}]}},{type:"conditional",conditional:{label:sa("cond2"),metadata:oa.attributeAnomalyInflicted}}]},ut="OriginalTransmorpher",[ia,cm]=b("wengine",ut),rm=D.wengine[ut],lm=v(ut,"icon"),dm=_[ut],aa=w[ut],um={title:ia("phase"),img:lm,documents:[{type:"text",text:s(k,{wKey:ut,children:e=>ia(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(aa.passive_hp_.tag)]},{type:"conditional",conditional:{label:cm("cond"),metadata:dm.equipperHit,fields:[g(aa.impact_.tag),{title:"Duration",fieldValue:rm.duration}]}}]},Xt="PeacekeeperSpecialized",[ca,pm]=b("wengine",Xt),hm=v(Xt,"icon"),mm=_[Xt],fm=w[Xt],gm={title:ca("phase"),img:hm,documents:[{type:"text",text:s(k,{wKey:Xt,children:e=>ca(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:pm("cond"),metadata:mm.shielded,fields:[g(fm.enerRegen.tag)]}}]},zs="PreciousFossilizedCore",[ra,vx]=b("wengine",zs),ym=v(zs,"icon"),xm={title:ra("phase"),img:ym,documents:[{type:"text",text:s(k,{wKey:zs,children:e=>ra(`phaseDescs.${e-1}`)})}]},pt="RainforestGourmet",[la,$m]=b("wengine",pt),bm=D.wengine[pt],wm=v(pt,"icon"),_m=_[pt],km=w[pt],vm={title:la("phase"),img:wm,documents:[{type:"text",text:s(k,{wKey:pt,children:e=>la(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:$m("cond"),metadata:_m.energyConsumed,fields:[g(km.atk_.tag),{title:"Duration",fieldValue:bm.duration}]}}]},ht="ReverbMarkI",[da,Cm]=b("wengine",ht),Sm=D.wengine[ht],Dm=v(ht,"icon"),Mm=_[ht],Em=w[ht],Tm={title:da("phase"),img:Dm,documents:[{type:"text",text:s(k,{wKey:ht,children:e=>da(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Cm("cond"),metadata:Mm.exSpecialUsed,fields:[g(Em.impact_.tag),{title:"Duration",fieldValue:Sm.duration}]}}]},mt="ReverbMarkII",[ua,Im]=b("wengine",mt),Rm=D.wengine[mt],Am=v(mt,"icon"),qm=_[mt],pa=w[mt],Pm={title:ua("phase"),img:Am,documents:[{type:"text",text:s(k,{wKey:mt,children:e=>ua(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Im("cond"),metadata:qm.exSpecialOrChainUsed,fields:[g(pa.anomMas.tag),g(pa.anomProf.tag),{title:"Duration",fieldValue:Rm.duration}]}}]},ft="ReverbMarkIII",[ha,zm]=b("wengine",ft),Om=D.wengine[ft],Vm=v(ft,"icon"),jm=_[ft],Wm=w[ft],Nm={title:ha("phase"),img:Vm,documents:[{type:"text",text:s(k,{wKey:ft,children:e=>ha(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:zm("cond"),metadata:jm.chainOrUltUsed,fields:[g(Wm.atk_.tag),{title:"Duration",fieldValue:Om.duration}]}}]},Qt="RiotSuppressorMarkVI",[ma,Bm]=b("wengine",Qt),Km=v(Qt,"icon"),Lm=_[Qt],fa=w[Qt],Hm={title:ma("phase"),img:Km,documents:[{type:"text",text:s(k,{wKey:Qt,children:e=>ma(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(fa.passive_crit_.tag)]},{type:"conditional",conditional:{label:Bm("cond"),metadata:Lm.charge,fields:[g(fa.basic_ether_dmg_.tag)]}}]},gt="RoaringRide",[ga,ya]=b("wengine",gt),xa=D.wengine[gt],Fm=v(gt,"icon"),$a=_[gt],ba=w[gt],Gm={title:ga("phase"),img:Fm,documents:[{type:"text",text:s(k,{wKey:gt,children:e=>ga(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:ya("cond_atk_"),metadata:$a.atk_,fields:[g(ba.atk_.tag),{title:"Duration",fieldValue:xa.duration}]}},{type:"conditional",conditional:{label:ya("cond_anomProf"),metadata:$a.anomProf,fields:[g(ba.anomProf.tag),{title:"Duration",fieldValue:xa.duration}]}}]},yt="SeveredInnocence",[wa,Um]=b("wengine",yt),Jm=D.wengine[yt],Xm=v(yt,"icon"),Qm=_[yt],ts=w[yt],Zm={title:wa("phase"),img:Xm,documents:[{type:"text",text:s(k,{wKey:yt,children:e=>wa(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(ts.passive_crit_dmg_.tag)]},{type:"conditional",conditional:{label:Um("cond"),metadata:Qm.basicSpecialAftershockHit,fields:[g(ts.crit_dmg_.tag),g(ts.electric_dmg_.tag),{title:"Duration",fieldValue:Jm.duration}]}}]},xt="SharpenedStinger",[_a,Ym]=b("wengine",xt),ef=D.wengine[xt],tf=v(xt,"icon"),nf=_[xt],sf=w[xt],of={title:_a("phase"),img:tf,documents:[{type:"text",text:s(k,{wKey:xt,children:e=>_a(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Ym("cond"),metadata:nf.predatoryInstinct,fields:[g(sf.physical_dmg_.tag),{title:"Duration",fieldValue:ef.duration}]}}]},Os="SixShooter",[ka,Cx]=b("wengine",Os),af=v(Os,"icon"),cf={title:ka("phase"),img:af,documents:[{type:"text",text:s(k,{wKey:Os,children:e=>ka(`phaseDescs.${e-1}`)})}]},Vs="SliceOfTime",[va,Sx]=b("wengine",Vs),rf=v(Vs,"icon"),lf={title:va("phase"),img:rf,documents:[{type:"text",text:s(k,{wKey:Vs,children:e=>va(`phaseDescs.${e-1}`)})}]},$t="SpectralGaze",[Ca,Sa]=b("wengine",$t),Da=D.wengine[$t],df=v($t,"icon"),Ma=_[$t],Ea=w[$t],uf={title:Ca("phase"),img:df,documents:[{type:"text",text:s(k,{wKey:$t,children:e=>Ca(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Sa("cond1"),metadata:Ma.hit_aftershock_electric,fields:[g(Ea.cond_defRed_.tag),{title:"Duration",fieldValue:Da.duration1}]}},{type:"conditional",conditional:{label:Sa("cond2"),metadata:Ma.spiritLock,fields:[g(Ea.cond_impact_.tag),{title:"Duration",fieldValue:Da.duration2}]}}]},bt="SpringEmbrace",[Ta,pf]=b("wengine",bt),hf=D.wengine[bt],mf=v(bt,"icon"),ff=_[bt],gf=w[bt],yf={title:Ta("phase"),img:mf,documents:[{type:"text",text:s(k,{wKey:bt,children:e=>Ta(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:pf("cond"),metadata:ff.when_attacked,fields:[g(gf.cond_enerRegen_.tag),{title:"Duration",fieldValue:hf.duration}]}}]},wt="StarlightEngine",[Ia,xf]=b("wengine",wt),$f=D.wengine[wt],bf=v(wt,"icon"),wf=_[wt],_f=w[wt],kf={title:Ia("phase"),img:bf,documents:[{type:"text",text:s(k,{wKey:wt,children:e=>Ia(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:xf("cond"),metadata:wf.dodgecounter_quickassist,fields:[g(_f.cond_dmg_.tag),{title:"Duration",fieldValue:$f.duration}]}}]},_t="StarlightEngineReplica",[Ra,vf]=b("wengine",_t),Cf=D.wengine[_t],Sf=v(_t,"icon"),Df=_[_t],Mf=w[_t],Ef={title:Ra("phase"),img:Sf,documents:[{type:"text",text:s(k,{wKey:_t,children:e=>Ra(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:vf("cond"),metadata:Df.hit_away,fields:[g(Mf.cond_dmg_.tag),{title:"Duration",fieldValue:Cf.duration}]}}]},kt="SteamOven",[Aa,Tf]=b("wengine",kt),If=D.wengine[kt],Rf=v(kt,"icon"),Af=_[kt],qf=w[kt],Pf={title:Aa("phase"),img:Rf,documents:[{type:"text",text:s(k,{wKey:kt,children:e=>Aa(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Tf("cond"),metadata:Af.stacks,fields:[g(qf.cond_impact_.tag),{title:"Duration",fieldValue:If.duration}]}}]},Zt="SteelCushion",[qa,zf]=b("wengine",Zt),Of=v(Zt,"icon"),Vf=_[Zt],Pa=w[Zt],jf={title:qa("phase"),img:Of,documents:[{type:"text",text:s(k,{wKey:Zt,children:e=>qa(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(Pa.passive_physical_dmg_.tag)]},{type:"conditional",conditional:{label:zf("cond"),metadata:Vf.hit_behind,fields:[g(Pa.cond_dmg_.tag)]}}]},Yt="StreetSuperstar",[za,Wf]=b("wengine",Yt),Nf=v(Yt,"icon"),Bf=_[Yt],Kf=w[Yt],Lf={title:za("phase"),img:Nf,documents:[{type:"text",text:s(k,{wKey:Yt,children:e=>za(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Wf("cond"),metadata:Bf.charge,fields:[g(Kf.cond_ult_dmg_.tag)]}}]},vt="TheBrimstone",[Oa,Hf]=b("wengine",vt),Ff=D.wengine[vt],Gf=v(vt,"icon"),Uf=_[vt],Jf=w[vt],Xf={title:Oa("phase"),img:Gf,documents:[{type:"text",text:s(k,{wKey:vt,children:e=>Oa(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Hf("cond"),metadata:Uf.hit_basic_dash_dodge,fields:[g(Jf.cond_atk_.tag),{title:"Duration",fieldValue:Ff.duration}]}}]},js="TheRestrained",[Va,Dx]=b("wengine",js),Qf=v(js,"icon"),Zf={title:Va("phase"),img:Qf,documents:[{type:"text",text:s(k,{wKey:js,children:e=>Va(`phaseDescs.${e-1}`)})}]},Ct="TheVault",[ja,Yf]=b("wengine",Ct),eg=D.wengine[Ct],tg=v(Ct,"icon"),ng=_[Ct],sg=w[Ct],og={title:ja("phase"),img:tg,documents:[{type:"text",text:s(k,{wKey:Ct,children:e=>ja(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Yf("cond"),metadata:ng.ether_hit,fields:[g(sg.cond_dmg_.tag),{title:"Duration",fieldValue:eg.duration}]}}]},St="Timeweaver",[Wa,ig]=b("wengine",St),ag=D.wengine[St],cg=v(St,"icon"),rg=_[St],Na=w[St],lg={title:Wa("phase"),img:cg,documents:[{type:"text",text:s(k,{wKey:St,children:e=>Wa(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(Na.passive_disorder_dmg_.tag)]},{type:"conditional",conditional:{label:ig("cond"),metadata:rg.hit_anomaly,fields:[g(Na.cond_anomProf.tag),{title:"Duration",fieldValue:ag.duration}]}}]},Dt="TusksOfFury",[Ba,dg]=b("wengine",Dt),ug=D.wengine[Dt],pg=v(Dt,"icon"),hg=_[Dt],Ka=w[Dt],mg={title:Ba("phase"),img:pg,documents:[{type:"text",text:s(k,{wKey:Dt,children:e=>Ba(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(Ka.passive_shield_.tag)]},{type:"conditional",conditional:{label:dg("cond"),metadata:hg.interrupt_perfdodge,fields:[g(Ka.cond_dmg_.tag),{title:"Duration",fieldValue:ug.duration}]}}]},Mt="UnfetteredGameBall",[La,fg]=b("wengine",Mt),gg=D.wengine[Mt],yg=v(Mt,"icon"),xg=_[Mt],$g=w[Mt],bg={title:La("phase"),img:yg,documents:[{type:"text",text:s(k,{wKey:Mt,children:e=>La(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:fg("cond"),metadata:xg.anomaly_counter,fields:[g($g.cond_crit_.tag),{title:"Duration",fieldValue:gg.duration}]}}]},Ws="VortexArrow",[Ha,Mx]=b("wengine",Ws),wg=v(Ws,"icon"),_g={title:Ha("phase"),img:wg,documents:[{type:"text",text:s(k,{wKey:Ws,children:e=>Ha(`phaseDescs.${e-1}`)})}]},Et="VortexHatchet",[Fa,kg]=b("wengine",Et),Ga=D.wengine[Et],vg=v(Et,"icon"),Cg=_[Et],Sg=w[Et],Dg={title:Fa("phase"),img:vg,documents:[{type:"text",text:s(k,{wKey:Et,children:e=>Fa(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:kg("cond"),metadata:Cg.entering,fields:[g(Sg.cond_impact_.tag),{title:"Duration",fieldValue:Ga.duration},{title:"Cooldown",fieldValue:Ga.cooldown}]}}]},Ns="VortexRevolver",[Ua,Ex]=b("wengine",Ns),Mg=v(Ns,"icon"),Eg={title:Ua("phase"),img:Mg,documents:[{type:"text",text:s(k,{wKey:Ns,children:e=>Ua(`phaseDescs.${e-1}`)})}]},Tt="WeepingCradle",[Ja,Xa]=b("wengine",Tt),Tg=D.wengine[Tt],Ig=v(Tt,"icon"),Qa=_[Tt],Rg=w[Tt],Ag={title:Ja("phase"),img:Ig,documents:[{type:"text",text:s(k,{wKey:Tt,children:e=>Ja(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Xa("cond_atk"),metadata:Qa.attack}},{type:"conditional",conditional:{label:Xa("cond_stacks"),metadata:Qa.stacks,fields:[g(Rg.cond_dmg_.tag),{title:"Duration",fieldValue:Tg.duration}]}}]},en="WeepingGemini",[Za,qg]=b("wengine",en),Pg=v(en,"icon"),zg=_[en],Og=w[en],Vg={title:Za("phase"),img:Pg,documents:[{type:"text",text:s(k,{wKey:en,children:e=>Za(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:qg("cond"),metadata:zg.anomaly_stack,fields:[g(Og.anomaly_stack.tag)]}}]},It="ZanshinHerbCase",[Ya,jg]=b("wengine",It),Wg=D.wengine[It],Ng=v(It,"icon"),Bg=_[It],ns=w[It],Kg={title:Ya("phase"),img:Ng,documents:[{type:"text",text:s(k,{wKey:It,children:e=>Ya(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(ns.passive_crit_.tag),g(ns.passive_electric_dmg_.tag)]},{type:"conditional",conditional:{label:jg("cond"),metadata:Bg.apply_anom_stun,fields:[g(ns.cond_crit_.tag),{title:"Duration",fieldValue:Wg.duration}]}}]},Gc={BashfulDemon:sp,BigCylinder:cp,BlazingLaurel:lp,BoxCutter:fp,BunnyBand:$p,CannonRotor:vp,DeepSeaVisitor:Sp,DemaraBatteryMarkII:Ip,DrillRigRedAxis:Pp,ElectroLipGloss:jp,ElegantVanity:Hp,FlamemakerShaker:Gp,FusionCompiler:Zp,GildedBlossom:eh,HailstormShrine:ih,HeartstringNocturne:dh,HellfireGears:hh,Housekeeper:gh,IceJadeTeapot:bh,IdentityBase:Sh,IdentityInflection:Mh,KaboomTheCannon:qh,LunarDecrescent:Wh,LunarNoviluna:Bh,LunarPleniluna:Lh,MagneticStormAlpha:Jh,MagneticStormBravo:em,MagneticStormCharlie:nm,MarcatoDesire:am,OriginalTransmorpher:um,PeacekeeperSpecialized:gm,PreciousFossilizedCore:xm,RainforestGourmet:vm,ReverbMarkI:Tm,ReverbMarkII:Pm,ReverbMarkIII:Nm,RiotSuppressorMarkVI:Hm,RoaringRide:Gm,SeveredInnocence:Zm,SharpenedStinger:of,SixShooter:cf,SliceOfTime:lf,SpectralGaze:uf,SpringEmbrace:yf,StarlightEngine:kf,StarlightEngineReplica:Ef,SteamOven:Pf,SteelCushion:jf,StreetSuperstar:Lf,TheBrimstone:Xf,TheRestrained:Zf,TheVault:og,Timeweaver:lg,TusksOfFury:mg,UnfetteredGameBall:bg,VortexArrow:_g,VortexHatchet:Dg,VortexRevolver:Eg,WeepingCradle:Ag,WeepingGemini:Vg,ZanshinHerbCase:Kg};function Uc({headerAction:e,fade:t=!1,wengine:n}){const{key:o,level:i,phase:r,modification:a}=n,l=Gc[o],d=Jr(o,i,r,a),c="atk_base",u=Mn(o).second_statkey;return l?y(ws,{bgt:"light",sx:{height:"100%"},children:[s(Lt,{title:s(Xr,{wKey:o}),avatar:s(bs,{src:v(o,"icon"),size:2}),action:e}),y(O,{sx:{py:0},children:[y(I,{sx:{display:"flex",justifyContent:"space-between"},children:[s(ye,{statKey:"atk"}),y("span",{children:[Xs(d[c],c).toFixed(Qs(c)),Wt(c)]})]}),y(I,{sx:{display:"flex",justifyContent:"space-between"},children:[s(ye,{statKey:u}),y("span",{children:[Xs(d[u],u).toFixed(Qs(u)),Wt(u)]})]})]}),s(E,{sx:{opacity:t?.5:1},children:s(Lg,{uiSheetElement:l})})]}):null}function Lg({uiSheetElement:e}){const{documents:t,title:n}=e;return y(O,{children:[s(I,{variant:"subtitle1",children:n}),s(G,{spacing:1,children:t.map((o,i)=>s(Wc,{document:o,typoVariant:"body2",collapse:!0},i))})]})}function Hg(e){const{attribute:t}=e;if(t)return t}function Fg(e){const{q:t}=e;return["standardDmg","anomalyDmg"].includes(t)}function Gg(e){const{damageType1:t,damageType2:n}=e,o=[];return Fg(e)?(t&&o.push(t),n&&o.push(n),o):[]}const Te={basic:"Basic",dash:"Dash",dodgeCounter:"Dodge Counter",special:"Special",exSpecial:"EX Special",chain:"Chain",ult:"Ultimate",quickAssist:"Quick Assist",defensiveAssist:"Defensive Assist",evasiveAssist:"Evasive Assist",assistFollowUp:"Assist Follow Up",anomaly:"Anomaly",disorder:"Disorder",aftershock:"Aftershock",elemental:"Elemental"},Jc=["crit_","crit_dmg_","impact","pen","pen_","enerRegen","anomProf","anomMas"].map(e=>{if(Qr.includes(e)){const t={...P.final.dmg_.tag,attribute:e.slice(0,-5)};return{title:s(ye,{statKey:e}),fieldRef:t}}return e==="crit_"?{fieldRef:P.common.cappedCrit_.tag,title:s(ye,{statKey:e})}:{fieldRef:P.final[e].tag,title:s(ye,{statKey:e})}});Jc.push(...Pe.map(e=>({fieldRef:{et:"own",qt:"formula",q:"standardDmg",attribute:e,name:"standardDmgInst"},title:y(Ce,{color:e,children:[mn[e]," Damage"]})})),...Pe.flatMap(e=>hc.map(t=>({fieldRef:{et:"own",qt:"formula",q:"standardDmg",attribute:e,damageType1:t,name:"standardDmgInst"},title:y(Ce,{color:e,children:[mn[e]," ",Te[t]," Damage"]})}))),...Pe.map(e=>({fieldRef:{et:"own",qt:"formula",q:"anomalyDmg",attribute:e,damageType1:"anomaly",name:"anomalyDmgInst"},title:y(Ce,{color:e,children:[mn[e]," Anomaly Damage"]})})));const Xc=[];Jc.forEach(e=>{Xc.push({tag:e.fieldRef,value:e})});const Ug=Vd(Xc),us=new Map;function Qc(e,t){if(us.get(e))throw new Error(`Duplicate conditional ${e}`);us.set(e,t)}Object.values(Gc).forEach(({documents:e})=>{e.forEach(t=>{t.type==="conditional"&&Qc(`${t.conditional.metadata.sheet}:${t.conditional.metadata.name}`,t.conditional)})});Object.values(Hc).forEach(e=>Object.values(e).forEach(({documents:t})=>{t.forEach(n=>{n.type==="conditional"&&Qc(`${n.conditional.metadata.sheet}:${n.conditional.metadata.name}`,n.conditional)})}));function Zc(e,t=new Map){const n=t.get(e);if(n)return n;const{val:o,meta:{tag:i,op:r,ops:a,usedCats:l}}=e,d=i&&Zr(i,(S,M)=>l.has(M)),c=_s(o,Wt(Bc(i))),u=new Set;function p(S,M){return S.map((A,X)=>{const q=Zc(A,t);return q.name?(u.add(q),q.name):(q.deps.forEach(B=>u.add(B)),q.prec>=M?q.formula:y("span",{children:["(",q.formula,")"]},X))})}let h,m=1/0;switch(r){case"const":h=c,m=1/0;break;case"sum":case"prod":case"max":case"min":{const{head:S,joiner:M,end:A}=ss[r];m=ss[r].prec,h=y("span",{children:[S,p(a,m).map((X,q)=>y(f.Fragment,{children:[X,q<a.length-1&&M]},q)),A]})}break;case"sumfrac":{const[S]=p(a,2),[M,A]=p(a,1);h=y("span",{children:[S," / (",M," + ",A,")"]}),m=ss.prod.prec;break}default:rc(r)}let $,x;d&&($=d.q==="_"?void 0:y("span",{children:[s(ce,{tag:d})," ",c]}),x=void 0);const C={name:$,formula:h,prec:m,sheet:x,deps:[...new Set(u)]};return t.set(e,C),C}const ss={sum:{head:"",joiner:" + ",end:"",prec:1},prod:{head:"",joiner:" * ",end:"",prec:2},max:{head:"Max(",joiner:", ",end:")",prec:1/0},min:{head:"Min(",joiner:", ",end:")",prec:1/0}};function Jg(e){const t={},n={};return e.forEach(({setKey:o,mainStatKey:i,substats:r,level:a,rarity:l})=>{t[o]=(t[o]??0)+1,n[i]=(n[i]??0)+mc(l,i,a),r.forEach(({key:d,upgrades:c})=>{!d||!c||(n[d]=(n[d]??0)+fc(d,l)*c)})}),Oc(n,t)}function Yc({character:e,charOpt:t,wengineId:n,discIds:o,children:i}){const r=Xg(e,n,o),a=f.useMemo(()=>jc([...Vc([e.key]),...r,xn.common.critMode.add(t.critMode),pe.common.lvl.add(t.enemyLvl),pe.common.def.add(t.enemyDef),pe.common.isStunned.add(t.enemyisStunned?1:0),pe.common.stun_.add(t.enemyStunMultiplier/100),pe.common.unstun_.add(1),...t.conditionals.flatMap(({sheet:d,src:c,dst:u,condKey:p,condValue:h})=>fn("preset0",gc(d,c,u)(p,h))),...t.bonusStats.filter(({disabled:d})=>!d).flatMap(({tag:d,value:c})=>fn("preset0",{tag:{...d,src:e.key,sheet:"agg",et:"own"},value:ue(as(c,d.q??""))})),...t.enemyStats.flatMap(({tag:d,value:c})=>fn("preset0",{tag:{...d,qt:"common",et:"enemy",sheet:"agg"},value:ue(as(c,d.q??""))}))]),[r,t,e.key]),l=f.useMemo(()=>a&&new Map,[a]);return s(Yr.Provider,{value:l,children:s(Ke.Provider,{value:a,children:i})})}function Xg(e,t,n){const o=yc(t),i=xc(n),r=f.useMemo(()=>o?Od(o.key,o.level,o.modification,o.phase):[],[o]),a=f.useMemo(()=>i?Jg(Object.values(i).filter(el)):[],[i]);return f.useMemo(()=>e?Pc(e.key,...zc(e),...r,...a):[],[e,r,a])}function er({character:e,conditionals:t,children:n}){const o=f.useMemo(()=>jc([...Vc([e.key]),...Pc(e.key,...zc(e),...Oc({},De(jt,()=>4)),F.sheet("agg").reread(F.sheet("wengine")),P.wengine.lvl.add(60),P.wengine.modification.add(5),P.wengine.phase.add(1),...Vt.map(i=>P.common.count.sheet(i).add(1))),xn.common.critMode.add("avg"),pe.common.lvl.add(100),pe.common.def.add(900),pe.common.isStunned.add(0),pe.common.stun_.add(1.5),pe.common.unstun_.add(1),...t.flatMap(({sheet:i,src:r,dst:a,condKey:l,condValue:d})=>fn("preset0",gc(i,r,a)(l,d)))]),[e,t]);return s(Ke.Provider,{value:o,children:n})}function tr({isAftershock:e,setAftershock:t}){return s(U,{onClick:()=>t(!e),color:e?"success":"secondary",children:Te.aftershock})}function nr({dmgType:e,keys:t,setDmgType:n}){return y(se,{title:y(E,{sx:{textWrap:"nowrap"},children:["Dmg Type: ",e?Te[e]:"Any"]}),children:[s(V,{selected:!e,disabled:!e,onClick:()=>n(),children:"Any"},"any"),t.map(o=>s(V,{selected:e===o,disabled:e===o,onClick:()=>n(o),children:Te[o]},o))]})}function Qg(){var d;const{t:e}=he("page_optimize"),{database:t}=z(),{key:n}=J(),{bonusStats:o}=ee(n),i=(d=hs(t.charMeta,n))==null?void 0:d.description,r=f.useCallback((c,u,p,h)=>t.charOpts.setBonusStat(n,c,u,p,h),[t,n]),a=c=>t.charOpts.setBonusStat(n,sl(c),0,!1),l=f.useCallback(c=>{t.charMeta.set(n,{description:c})},[t.charMeta,n]);return y(G,{spacing:1,children:[o.map(({tag:c,value:u,disabled:p},h)=>s(Yg,{tag:c,value:u,disabled:p,setValue:m=>r(c,m,p,h),onDelete:()=>r(c,null,p,h),setTag:m=>r(m,u,p,h),toggleDisabled:()=>r(c,u,!p,h)},JSON.stringify(c)+h)),s(Zg,{onSelect:a}),s(dd,{placeholder:e("bonusStatsNotes"),value:i,disabled:!n,onChange:c=>l(c),multiline:!0,minRows:3,fullWidth:!0})]})}function Zg({tag:e,onSelect:t}){return s(se,{title:(e&&s(ce,{tag:e}))??"Add Bonus Stat",children:ol.map(n=>s(V,{onClick:()=>t(n),children:s(ye,{statKey:n,showPercent:!0})},n))})}function Yg({tag:e,setTag:t,value:n,disabled:o,setValue:i,onDelete:r,toggleDisabled:a}){var d;const l=(d=e.q)==null?void 0:d.endsWith("_");return s(W,{bgt:"light",sx:{opacity:o?.4:void 0},children:y(O,{sx:{display:"flex",gap:1,justifyContent:"space-around",alignItems:"center",flexWrap:"wrap"},children:[s(Se,{onClick:a,children:o?s($c,{}):s(bc,{})}),s(I,{children:s(ce,{tag:e})}),s(ty,{qt:e.qt,setQt:c=>t({...e,qt:c})}),e.q==="dmg_"&&s(ey,{tag:e,setAttribute:c=>{const{attribute:u,...p}=e;t(c?{...p,attribute:c}:p)}}),tl.includes(e.q)&&s(nr,{dmgType:e.damageType1,keys:nl,setDmgType:c=>{const{damageType1:u,...p}=e;t(c?{...p,damageType1:c}:p)}}),["dmg_","crit_dmg_"].includes(e.q)&&s(tr,{isAftershock:e.damageType2==="aftershock",setAftershock:c=>{const{damageType2:u,...p}=e;t(c?{...p,damageType2:"aftershock"}:p)}}),s(ze,{float:!0,value:n,sx:{flexBasis:150,flexGrow:1,height:"100%"},onChange:i,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:y(En,{position:"end",sx:{ml:0},children:[l?"%":void 0," ",s(Se,{"aria-label":"Delete Bonus Stat",onClick:r,edge:"end",children:s(Is,{fontSize:"small"})})]})}})]})})}function ey({tag:e,setAttribute:t}){return y(se,{title:e.attribute?s(Me,{attribute:e.attribute}):"No Attribute",color:e.attribute,children:[s(V,{onClick:()=>t(null),children:"No Attribute"}),Pe.map(n=>s(V,{onClick:()=>t(n),children:s(Ce,{color:n,children:s(Me,{attribute:n})})},n))]})}function ty({qt:e,setQt:t}){return s(se,{title:e&&Nt[e],children:il.map(n=>s(V,{onClick:()=>t(n),selected:e===n,disabled:e===n,children:Nt[n]},n))})}function sr(){const e=Le();return s(ws,{children:s(O,{children:e==null?void 0:e.listFormulas(P.listing.formulas).map((t,n)=>s(ny,{read:t},n))})})}function ny({read:e}){var x,C,S,M,A,X,q;const t=Le(),{setRead:n}=f.useContext(xs),o=J(),i=ee(o==null?void 0:o.key),r=e.tag.sheet===((x=i==null?void 0:i.target)==null?void 0:x.sheet)&&e.tag.name===((C=i==null?void 0:i.target)==null?void 0:C.name)||((S=i==null?void 0:i.target)==null?void 0:S.q)===e.tag.q,a=f.useMemo(()=>{var B,R,H,oe;return e.tag.sheet===((B=i==null?void 0:i.target)==null?void 0:B.sheet)&&e.tag.name===((R=i==null?void 0:i.target)==null?void 0:R.name)?al(e.tag,(H=i==null?void 0:i.target)==null?void 0:H.damageType1,(oe=i==null?void 0:i.target)==null?void 0:oe.damageType2):e.tag},[e.tag,(M=i==null?void 0:i.target)==null?void 0:M.sheet,(A=i==null?void 0:i.target)==null?void 0:A.name,(X=i==null?void 0:i.target)==null?void 0:X.damageType1,(q=i==null?void 0:i.target)==null?void 0:q.damageType2]),l=f.useMemo(()=>({...e,tag:a}),[a,e]),d=t==null?void 0:t.compute(l),c=a.name||a.q,{statHighlight:u,setStatHighlight:p}=f.useContext(wc),h=a.name?"":a.attribute?`${a.attribute}_${a.q}`:a.q==="cappedCrit_"?"crit_":a.q,m=h?cl(u,h):!1;if(!d)return null;const $=_s(d.val,Wt(c??""));return y(E,{onMouseEnter:()=>h&&p(h),onMouseLeave:()=>p(""),sx:{display:"flex",gap:1,alignItems:"center",p:.5,borderRadius:.5,backgroundColor:r?"rgba(0,200,0,0.2)":void 0,position:"relative","::after":{content:'""',position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:.5,backgroundColor:rl(m),transition:"background-color 0.3s ease-in-out",pointerEvents:"none"}},children:[s(E,{sx:{flexGrow:1},children:s(ce,{tag:a})}),$,s(ll,{tag:a,onClick:()=>{n(l)}})]})}function sy(){const{database:e}=z(),{key:t}=J(),{enemyStats:n,enemyLvl:o,enemyDef:i,enemyisStunned:r,enemyStunMultiplier:a}=ee(t),l=f.useCallback((c,u,p)=>e.charOpts.setEnemyStat(t,c,u,p),[e,t]),d=c=>e.charOpts.setEnemyStat(t,ul(c),0);return y(G,{spacing:1,children:[y(E,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[s(ze,{label:"Enemy Lvl",value:o,inputProps:{min:0,sx:{width:"4em"}},onChange:c=>e.charOpts.set(t,{enemyLvl:c})}),s(ze,{label:"Enemy DEF",value:i,inputProps:{min:0,sx:{width:"4em"}},onChange:c=>e.charOpts.set(t,{enemyDef:c})}),s(ze,{label:"Enemy Stun Multiplier",value:a,inputProps:{min:0,sx:{width:"8em"}},onChange:c=>e.charOpts.set(t,{enemyStunMultiplier:c}),InputProps:{endAdornment:s(En,{position:"end",children:"%"})}}),s(U,{onClick:()=>e.charOpts.set(t,{enemyisStunned:!r}),color:r?"success":"secondary",children:r?"Stunned":"Not Stunned"})]}),n.map(({tag:c,value:u},p)=>s(iy,{tag:c,value:u,setValue:h=>l(c,h,p),onDelete:()=>l(c,null,p),setTag:h=>l(h,u,p)},JSON.stringify(c)+p)),s(oy,{onSelect:d})]})}function oy({tag:e,onSelect:t}){return s(se,{title:(e&&s(ce,{tag:{...e,qt:"common",et:"enemy",sheet:"agg"}}))??"Add Enemy Stat",children:pl.map(n=>s(V,{onClick:()=>t(n),children:s(ce,{tag:{q:n,qt:"common",et:"enemy",sheet:"agg"},showPercent:!0})},n))})}function iy({tag:e,setTag:t,value:n,setValue:o,onDelete:i}){var a;const r=(a=e.q)==null?void 0:a.endsWith("_");return s(W,{bgt:"light",children:y(O,{sx:{display:"flex",gap:1,justifyContent:"space-around",alignItems:"center",flexWrap:"wrap"},children:[s(I,{children:s(ce,{tag:e})}),dl(["res_","resRed_"],e.q)&&s(ay,{tag:e,setAttribute:l=>{const{attribute:d,...c}=e;t(l?{...c,attribute:l}:c)}}),s(ze,{float:!0,value:n,sx:{flexBasis:150,flexGrow:1,height:"100%"},onChange:o,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:y(En,{position:"end",sx:{ml:0},children:[r?"%":void 0," ",s(Se,{"aria-label":"Delete Enemy Stat",onClick:i,edge:"end",children:s(Is,{fontSize:"small"})})]})}})]})})}function ay({tag:e,setAttribute:t}){return y(se,{title:e.attribute?s(Me,{attribute:e.attribute}):"No Attribute",color:e.attribute,children:[s(V,{onClick:()=>t(null),children:"No Attribute"}),Pe.map(n=>s(V,{onClick:()=>t(n),children:s(Ce,{color:n,children:s(Me,{attribute:n})})},n))]})}function ps(e){return e.reduce((t,n)=>t*n.length,1)}const cy=50;class ry{constructor(t){this.info=new Map,this.progress={computed:0,failed:0,skipped:0,remaining:0},this.nextReport=Date.now(),this.finalize=()=>{},this.terminate=()=>{};const{progress:n}=this,{topN:o,numWorkers:i,setProgress:r}=t,a=[...Array(i)].map(()=>new Worker(new URL(""+new URL("workerHandle-CSrCyUap.js",import.meta.url).href,import.meta.url),{type:"module"})),l=vd(t.nodes,t.candidates,"q",t.minimum,o),{nodes:d,minimum:c,candidates:u}=l;if(n.remaining=ps(u),n.skipped=ps(t.candidates)-n.remaining,n.remaining>Number.MAX_SAFE_INTEGER)throw new Error("too many combinations");this.topN=o,this.optThreshold=c[0],this.info=new Map(a.map(m=>[m,{builds:[]}]));const p=u.map(m=>m.map($=>$.id));this.state={ty:"work",works:[{ids:p,count:n.remaining}]},this.report=()=>r({...n}),this.results=new Promise((m,$)=>{this.finalize=x=>(this.report(),m(x)),this.terminate=$});const h=()=>a.forEach(m=>m.terminate());this.results.then(h,h);for(const m of a)m.onmessage=({data:$})=>{try{this.onWorkerMsg($,m)}catch(x){this.terminate(x)}},un(m,{ty:"init",nodes:d,minimum:c,candidates:u,topN:o})}distribute(t){const{state:n}=this;if(n.ty==="work"){n.works.push(...t);return}for(const o of n.workers)if(this.give(t,o))n.workers.delete(o);else return;this.state={ty:"work",works:t}}idle(t){const{state:n,progress:o,info:i}=this;if(n.ty==="idle")n.workers.add(t);else if(this.give(n.works,t)){const r=o.remaining/(i.size+.5);i.forEach((a,l)=>un(l,{ty:"work?",maxKeep:r}))}else this.state={ty:"idle",workers:new Set([t])}}give(t,n){if(!t.length)return!1;let o=this.progress.remaining/(this.info.size+.5),i=t.findIndex(a=>(o-=a.count)<0)+1;i>1&&(i-=1);const r=t.splice(0,i||t.length);return un(n,{ty:"add",works:r}),!0}onWorkerMsg(t,n){var o;switch(t.ty){case"progress":{const i=this.progress,r=this.info.get(n);i.remaining-=t.computed+t.skipped,i.computed+=t.computed,i.failed+=t.failed,i.skipped+=t.skipped,r.builds=t.builds,t.idle&&this.idle(n);const a=Date.now();if(this.nextReport<=a||!t.remaining){this.nextReport=a+cy,this.report();const l=[...this.info.values()].flatMap(c=>c.builds);l.sort((c,u)=>u.value-c.value);const d=((o=l[this.topN])==null?void 0:o.value)??-1/0;d>this.optThreshold&&(this.optThreshold=d,this.info.forEach((c,u)=>un(u,{ty:"config",threshold:d}))),this.progress.remaining||this.finalize(l.slice(0,this.topN))}break}case"add":this.distribute(t.works);break;case"err":this.terminate(t.msg+" (Worker Error)")}}}function un(e,t){e.postMessage(t)}const ly=1e-7;function dy(e,t,n,o,i,r,a,l,d,c,u){const p=new Set(jt),h=new Set(Vt),m=[cc(...n.map((x,C)=>Zs(x.multiplier,new hn({src:e,...x.tag},void 0).with("preset",`preset${C}`)))),...o.map(({tag:x,isMax:C})=>{const S={...hl(x),src:e,preset:"preset0"};return C?Zs(-1,new hn(S,void 0)):new hn(S,void 0)})],$=gd(m,t,x=>{if(x.src===e&&x.et==="own"){if(x.sheet==="dyn"&&x.qt==="initial")return x.q==="dmg_"?{q:`${x.attribute}_dmg_`}:{q:x.q};if(x.q==="count"&&p.has(x.sheet))return{q:x.sheet};if(x.qt=="wengine"&&["lvl","phase","modification"].includes(x.q))return{q:x.q};if(x.q==="count"&&h.has(x.sheet))return{q:x.sheet}}});return $.push(i.length?os(...i.map(x=>yn({q:x},"sum"))):ue(1/0),r.length?os(...r.map(x=>yn({q:x},"sum"))):ue(1/0)),{nodes:$,candidates:[a.map(uy),l[1].map(Ae),l[2].map(Ae),l[3].map(Ae),l[4].map(Ae),l[5].map(Ae),l[6].map(Ae)],minimum:[-1/0,...o.map(({value:x,isMax:C,tag:S})=>{const M=as(x,S.q??"");return(C?M*-1:M)-ly}),2,4],numWorkers:d,topN:c,setProgress:u}}function Ae(e){const{id:t,mainStatKey:n,level:o,rarity:i,setKey:r,substats:a}=e;return{id:t,[n]:mc(i,n,o),...Object.fromEntries(a.filter(({key:l,upgrades:d})=>l&&d).map(({key:l,upgrades:d})=>[l,fc(l,i)*d])),[r]:1}}function uy(e){const{id:t,key:n,level:o,modification:i,phase:r}=e;return{id:t,lvl:o,modification:i,phase:r,[n]:1}}var qt={},ec;function py(){if(ec)return qt;ec=1;var e=ms();Object.defineProperty(qt,"__esModule",{value:!0}),qt.default=void 0;var t=e(fs()),n=gs(),o=(0,t.default)((0,n.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp");return qt.default=o,qt}var hy=py();const my=ys(hy),fy=f.memo(function({disabled:t=!1}){const{database:n}=z(),{optConfigId:o,optConfig:i}=f.useContext(re);return y(W,{bgt:"light",children:[s(O,{sx:{display:"flex",gap:1},children:s(I,{sx:{fontWeight:"bold"},children:"Disc Level Filter"})}),s(ae,{}),s(ml,{levelLow:(i==null?void 0:i.levelLow)??Ys.S,levelHigh:(i==null?void 0:i.levelHigh)??Ys.S,setLow:r=>n.optConfigs.set(o,{levelLow:r}),setHigh:r=>n.optConfigs.set(o,{levelHigh:r}),setBoth:(r,a)=>n.optConfigs.set(o,{levelLow:r,levelHigh:a}),disabled:t})]})});function gy({discBySlot:e,setFilter4:t,setFilter2:n,setSetFilter4:o,setSetFilter2:i}){const r=J(),a=ee(r==null?void 0:r.key),l=f.useMemo(()=>{const d=De(jt,()=>De(ks,()=>0));return Object.values(e).forEach(c=>c.forEach(({setKey:u,slotKey:p})=>d[u][p]++)),d},[e]);return y(Ht,{children:[y(E,{sx:{display:"flex",gap:1,alignItems:"center"},children:[s(I,{variant:"h6",sx:{flexGrow:1},children:"Disc Set Config"}),s(U,{disabled:!t.length,onClick:()=>o([]),children:"Reset 4p filter"}),s(U,{disabled:!n.length,onClick:()=>i([]),children:"Reset 2p filter"})]}),s(E,{children:r&&a&&s(er,{character:r,conditionals:a.conditionals,children:s(ne,{container:!0,spacing:1,children:jt.map(d=>s(ne,{item:!0,xs:1,md:2,lg:3,children:s(yy,{numSlot:l[d],setKey:d,setFilter4:t,setFilter2:n,setSetFilter4:o,setSetFilter2:i})},d))})})})]})}function yy({numSlot:e,setKey:t,setFilter4:n,setFilter2:o,setSetFilter4:i,setSetFilter2:r}){const a=!!o.length&&!o.includes(t),l=!!n.length&&!n.includes(t);return y(Fc,{setKey:t,fade2:a,fade4:l,children:[s(E,{sx:{display:"flex",justifyContent:"space-around",pb:1},children:Object.entries(e).map(([d,c])=>s(E,{children:s(Ne,{color:c?"primary":"secondary",children:c})},d))}),y(fl,{fullWidth:!0,children:[s(U,{sx:{borderRadius:0},color:!n.length||n.includes(t)?"success":"secondary",onClick:()=>i(n.length?eo([...n],t):[t]),children:"Allow 4p"}),s(U,{sx:{borderRadius:0},color:!o.length||o.includes(t)?"success":"secondary",onClick:()=>r(o.length?eo([...o],t):[t]),children:"Allow 2p"})]})]})}function xy({discsBySlot:e}){const[t,n,o]=vs();return s(W,{bgt:"light",children:s(O,{children:y(G,{spacing:1,children:[s($e,{sx:{display:"flex",gap:2,justifyContent:"space-between"},children:ks.map(i=>s(ke,{discsBySlot:e,slotKey:i},i))}),s($y,{show:t,onClose:o,discsBySlot:e}),s(U,{color:"info",fullWidth:!0,onClick:n,children:"Disc Filter Config"})]})})})}function ke({discsBySlot:e,slotKey:t}){return y(I,{children:["Disc ",t," ",s(Ne,{color:e[t].length?"primary":"error",children:e[t].length})]})}function $y({discsBySlot:e,show:t,onClose:n,disabled:o}){const{database:i}=z(),{optConfigId:r,optConfig:a}=f.useContext(re);return s($s,{open:t,onClose:n,children:y(W,{children:[s(Lt,{title:"Disc Filter",action:s(Se,{onClick:n,children:s(Dn,{})})}),s(ae,{}),s(O,{children:s(f.Suspense,{fallback:s(_c,{width:"100%",height:"500px"}),children:y(G,{spacing:1,children:[s(fy,{disabled:o}),s(by,{discsBySlot:e,disabled:o}),s(U,{disabled:o,onClick:()=>i.optConfigs.set(r,{useEquipped:!a.useEquipped}),color:a.useEquipped?"success":"secondary",children:"Use equipped Discs"}),s(wy,{discBySlot:e,disabled:o})]})})})]})})}function by({discsBySlot:e,disabled:t}){const{database:n}=z(),{optConfigId:o,optConfig:i}=f.useContext(re),r=a=>{const l=gl([...to[a]]),d={4:i.slot4??[],5:i.slot5??[],6:i.slot6??[]},c={4:u=>n.optConfigs.set(o,{slot4:u}),5:u=>n.optConfigs.set(o,{slot5:u}),6:u=>n.optConfigs.set(o,{slot6:u})};return s($e,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:to[a].map(u=>s(U,{disabled:t,variant:d[a].includes(u)?"contained":"outlined",onClick:()=>c[a](l([...d[a]],u)),children:s(ye,{statKey:u,showPercent:!0})},u))})};return s(W,{bgt:"light",children:s(O,{children:y(G,{spacing:1,children:[y($e,{sx:{display:"flex",justifyContent:"space-between"},children:[s(ke,{slotKey:"1",discsBySlot:e}),s(ke,{slotKey:"2",discsBySlot:e}),s(ke,{slotKey:"3",discsBySlot:e})]}),s(ke,{slotKey:"4",discsBySlot:e}),r("4"),s(ke,{slotKey:"5",discsBySlot:e}),r("5"),s(ke,{slotKey:"6",discsBySlot:e}),r("6")]})})})}function wy({discBySlot:e,disabled:t}){const{database:n}=z(),{optConfigId:o,optConfig:i}=f.useContext(re),{setFilter2:r=[],setFilter4:a=[]}=i,l=f.useCallback(c=>{n.optConfigs.set(o,{setFilter2:c})},[n,o]),d=f.useCallback(c=>{n.optConfigs.set(o,{setFilter4:c})},[n,o]);return s(gy,{discBySlot:e,disabled:t,setFilter2:r,setFilter4:a,setSetFilter2:l,setSetFilter4:d})}function _y({disabled:e=!1}){const{optConfigId:t,optConfig:{statFilters:n}}=f.useContext(re),{database:o}=z(),i=f.useCallback(r=>o.optConfigs.set(t,{statFilters:r}),[o,t]);return y(W,{bgt:"light",children:[s(O,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:s(E,{display:"flex",justifyContent:"space-between",children:s(I,{sx:{fontWeight:"bold"},children:"Stat Filter"})})}),s(ae,{}),s(O,{children:s(ky,{statFilters:n,setStatFilters:i,disabled:e})})]})}function ky({statFilters:e,setStatFilters:t,disabled:n=!1}){const o=f.useCallback((c,u)=>{const p=structuredClone(e);typeof u>"u"?p.push({tag:c,value:0,isMax:!1,disabled:!1}):p[u].tag=c,t(p)},[t,e]),i=f.useCallback(c=>{const u=structuredClone(e);u.splice(c,1),t(u)},[t,e]),r=f.useCallback((c,u)=>{const p=structuredClone(e);p[c].value=u,t(p)},[t,e]),a=f.useCallback((c,u)=>{const p=structuredClone(e);p[c].isMax=u,t(p)},[t,e]),l=f.useCallback((c,u)=>{const p=structuredClone(e);p[c].disabled=u,t(p)},[t,e]),d=c=>o(xl(c));return y(E,{display:"flex",flexDirection:"column",gap:1,children:[e.map((c,u)=>s(Cy,{statFilter:c,delTarget:()=>i(u),setTarget:p=>o(p,u),setTargetValue:p=>r(u,p),setTargetisMax:p=>a(u,p),setDisabled:p=>l(u,p),disabled:n},u+JSON.stringify(c))),s(vy,{onSelect:d})]})}function vy({tag:e,onSelect:t}){return s(se,{title:(e&&s(ce,{tag:e}))??"Add Final Stat Filter",children:$l.map(n=>s(V,{onClick:()=>t(n),children:s(ye,{statKey:n,showPercent:!0})},n))})}function Cy({statFilter:e,delTarget:t,setTarget:n,setTargetValue:o,setTargetisMax:i,setDisabled:r,disabled:a}){const{tag:l,value:d,isMax:c,disabled:u}=e,p=yl(l.q??"");return s(W,{children:y(O,{sx:{display:"flex",gap:1,alignItems:"center"},children:[s(U,{color:u?"secondary":"success",onClick:()=>r(!u),disabled:a,size:"small",children:u?s($c,{}):s(bc,{})}),s(I,{children:s(ce,{tag:l})}),l.q==="dmg_"&&s(Sy,{tag:l,setAttribute:h=>{const{attribute:m,...$}=l;n(h?{...$,attribute:h}:$)}}),s(U,{onClick:()=>i(!c),size:"small",children:s("strong",{children:c?"MAX":"MIN"})}),s(ze,{float:!0,value:d,sx:{flexBasis:150,flexGrow:1,height:"100%"},disabled:a,onChange:o,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:y(En,{position:"end",sx:{ml:0},children:[p?"%":void 0," ",s(Se,{"aria-label":"Delete Stat Constraint",onClick:t,edge:"end",children:s(Is,{fontSize:"small"})})]})}})]})})}function Sy({tag:e,setAttribute:t}){return y(se,{title:e.attribute?s(Me,{attribute:e.attribute}):"No Attribute",color:e.attribute,children:[s(V,{onClick:()=>t(null),children:"No Attribute"}),Pe.map(n=>s(V,{onClick:()=>t(n),children:s(Ce,{color:n,children:s(Me,{attribute:n})})},n))]})}const Dy=f.memo(function({disabled:t=!1}){const{database:n}=z(),{optConfigId:o,optConfig:i}=f.useContext(re);return y(W,{bgt:"light",children:[s(O,{sx:{display:"flex",gap:1},children:s(I,{sx:{fontWeight:"bold"},children:"Wengine Level Filter"})}),s(ae,{}),s(Gd,{levelLow:(i==null?void 0:i.wlevelLow)??bn,levelHigh:(i==null?void 0:i.wlevelHigh)??bn,setLow:r=>n.optConfigs.set(o,{wlevelLow:r}),setHigh:r=>n.optConfigs.set(o,{wlevelHigh:r}),setBoth:(r,a)=>n.optConfigs.set(o,{wlevelLow:r,wlevelHigh:a}),disabled:t})]})});function My({wengines:e,disabled:t}){const{database:n}=z(),{optConfigId:o,optConfig:i}=f.useContext(re),[r,a,l]=vs();return s(W,{bgt:"light",children:s(O,{children:y(G,{spacing:1,children:[y($e,{sx:{display:"flex",gap:2,justifyContent:"space-between",alignItems:"center"},children:[y($e,{sx:{display:"flex",gap:1,justifyContent:"space-between"},children:["Wengines:"," ",s(Ne,{color:e.length?"primary":"error",children:e.length})]}),s(U,{sx:{flexGrow:1},startIcon:i.optWengine?s(bl,{}):s(wl,{}),color:i.optWengine?"success":"secondary",onClick:()=>n.optConfigs.set(o,{optWengine:!i.optWengine}),children:"Optimize Wengine"})]}),s(Ey,{show:r,onClose:l,wengines:e}),s(U,{color:"info",fullWidth:!0,onClick:a,disabled:t||!i.optWengine,children:"Wengine Filter Config"})]})})})}function Ey({wengines:e,show:t,onClose:n,disabled:o}){const{database:i}=z(),{optConfigId:r,optConfig:a}=f.useContext(re);return s($s,{open:t,onClose:n,children:y(W,{children:[s(Lt,{title:"Wengine Filter",action:s(Se,{onClick:n,children:s(Dn,{})})}),s(ae,{}),s(O,{children:s(f.Suspense,{fallback:s(_c,{width:"100%",height:"500px"}),children:y(G,{spacing:1,children:[s(Dy,{disabled:o}),s(Ty,{disabled:o}),s(U,{disabled:o,onClick:()=>i.optConfigs.set(r,{useEquippedWengine:!a.useEquippedWengine}),color:a.useEquippedWengine?"success":"secondary",children:"Use equipped Wengine"}),s(Iy,{wengines:e})]})})})]})})}function Ty({disabled:e}){const{database:t}=z(),{optConfigId:n,optConfig:o}=f.useContext(re),{wEngineTypes:i}=o,r=ds(t.wengines),{key:a}=J(),l=f.useMemo(()=>r&&o.optWengine?t.wengines.values.reduce((d,{key:c,level:u,location:p})=>{if(u<o.wlevelLow||u>o.wlevelHigh||p&&!o.useEquippedWengine&&p!==a)return d;const h=Mn(c).type;return h&&d[h]++,d},De(no,()=>0)):De(no,()=>0),[a,r,t.wengines,o.wlevelLow,o.wlevelHigh,o.optWengine,o.useEquippedWengine]);return s(_l,{onChange:d=>t.optConfigs.set(n,{wEngineTypes:d}),value:i,disabled:e,totals:l,fullWidth:!0})}function Iy({wengines:e}){const t=J(),n=ee(t==null?void 0:t.key),{optConfig:o}=f.useContext(re),{wEngineTypes:i}=o,r=f.useMemo(()=>i.length?Vt.filter(a=>i.includes(Mn(a).type)):Vt,[i]);return y($e,{children:[s(I,{variant:"h6",children:"Wengine Condtional Configuration"}),s(I,{children:"Wengine stats are displayed to be Lvl 60/60, P1, actual level/phase of wengine will be used in the solver."}),t&&n&&s(er,{character:t,conditionals:n.conditionals,children:s(ne,{container:!0,spacing:1,columns:{xs:2,md:3,lg:4},children:r.map(a=>s(ne,{item:!0,xs:1,children:s(Ay,{wengineKey:a,count:e.filter(l=>l.key===a).length})},a))})})]})}function Ry(e){return{key:e,level:60,modification:5,phase:1,location:"",lock:!1}}function Ay({wengineKey:e,count:t}){const n=f.useMemo(()=>Ry(e),[e]);return s(Uc,{wengine:n,headerAction:s(Ne,{color:t?"primary":"secondary",children:t}),fade:!t})}function qy(){const{key:e}=J(),{optConfigId:t}=ee(e),{database:n}=z();return f.useEffect(()=>{if(t)return;const o=n.optConfigs.new({wEngineTypes:[Dc(e).specialty]});n.charOpts.set(e,{optConfigId:o})},[n,t,e]),t?s(kc,{optConfigId:t,children:s(Py,{})}):null}function Py(){const{t:e}=he("optimize"),{database:t}=z(),n=Le(),{key:o}=J(),{target:i}=ee(o),[r,a]=f.useState(8),[l,d]=f.useState(void 0),{optConfig:c,optConfigId:u}=f.useContext(re),p=ds(t.discs),h=f.useMemo(()=>{const q={4:c.slot4,5:c.slot5,6:c.slot6},B=R=>["4","5","6"].includes(R);return p&&t.discs.values.reduce((R,H)=>{const{slotKey:oe,mainStatKey:Z,level:Q,location:le}=H;return Q<c.levelLow||Q>c.levelHigh||le&&!c.useEquipped&&le!==o||B(oe)&&!q[oe].includes(Z)||R[H.slotKey].push(H),R},{1:[],2:[],3:[],4:[],5:[],6:[]})},[o,p,t.discs,c.levelHigh,c.levelLow,c.slot4,c.slot5,c.slot6,c.useEquipped]),m=ds(t.wengines),$=f.useMemo(()=>m&&t.wengines.values.filter(({key:q,level:B,location:R})=>{if(!c.optWengine)return R===o;if(B<c.wlevelLow||B>c.wlevelHigh||R&&!c.useEquippedWengine&&R!==o)return!1;const{type:H}=Mn(q);return!!c.wEngineTypes.includes(H)}),[o,t.wengines,c.wlevelLow,c.wlevelHigh,c.optWengine,c.wEngineTypes,c.useEquippedWengine,m]),x=f.useMemo(()=>ps(Object.values(h))*$.length,[$.length,h]),[C,S]=f.useState(!1),M=f.useRef(()=>{});f.useEffect(()=>()=>M.current(),[]);const A=f.useCallback(async q=>{if(!n||!i)return;const B=new Promise(Q=>M.current=Q);d(void 0),S(!0);const R=(c.statFilters??[]).filter(Q=>!Q.disabled),H=dy(o,n,[{tag:vc(i),multiplier:1}],R,c.setFilter2,c.setFilter4,$,h,r,c.maxBuildsToShow,d);if(q.altKey){console.log(H),S(!1);return}const oe=new ry(H);B.then(()=>oe.terminate("user cancelled"));let Z;try{Z=await oe.results}catch{return}finally{M.current=()=>{},S(!1)}t.optConfigs.newOrSetGeneratedBuildList(u,{builds:Z.map(({ids:Q,value:le})=>({wengineId:Q[0],discIds:De(ks,(xe,we)=>Q[we+1]),value:le})),buildDate:Date.now()})},[n,i,c.statFilters,c.setFilter2,c.setFilter4,c.maxBuildsToShow,o,$,h,r,t.optConfigs,u]),X=f.useCallback(()=>{M.current(),S(!1)},[M]);return s(W,{children:s(O,{children:y(G,{spacing:1,children:[y(E,{sx:{display:"flex",gap:1,flexWrap:"wrap","& .MuiPaper-root":{flexGrow:1}},children:[s(_y,{}),s(My,{wengines:$}),s(xy,{discsBySlot:h})]}),l&&s(zy,{progress:l,total:x}),y(E,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[s(Fd,{maxBuildsToShow:c.maxBuildsToShow,optConfigId:u}),s(Hd,{numWorkers:r,setNumWorkers:a}),s(U,{disabled:!x||!i,onClick:C?X:A,color:C?"error":"primary",startIcon:C?s(Dn,{}):s(my,{}),children:e(C?"cancel":"optimize")})]})]})})})}function pn({value:e}){const t=e.toLocaleString();return s(E,{component:"span",sx:{fontFamily:"Monospace",display:"inline"},children:t})}function zy(e){const{t}=he("optimize"),{computed:n,remaining:o,skipped:i}=e.progress,r=n+o,a=Math.log1p(r)/Math.log1p(e.total),l=o/r*a;return y(E,{children:[y(I,{children:[t("computed"),": ",s(pn,{value:n})," /"," ",s(pn,{value:r})," "]}),y(I,{children:[t("computed + skipped"),": ",s(pn,{value:n+i})," /"," ",s(pn,{value:e.total})]}),s(kl,{variant:"determinate",value:(1-l)*100,sx:{height:10,borderRadius:5}})]})}const Oy={xs:2,sm:1,md:2,lg:3,xl:4};function Vy({onClick:e}){const t=f.useContext(Cc);return s(Sc,{discIds:t==null?void 0:t.equippedDiscs,wengineId:t==null?void 0:t.equippedWengine,onClick:e,columns:Oy})}var Pt={},tc;function jy(){if(tc)return Pt;tc=1;var e=ms();Object.defineProperty(Pt,"__esModule",{value:!0}),Pt.default=void 0;var t=e(fs()),n=gs(),o=(0,t.default)((0,n.jsx)("path",{d:"M21.6 18.2 13 11.75v-.91c1.65-.49 2.8-2.17 2.43-4.05-.26-1.31-1.3-2.4-2.61-2.7C10.54 3.57 8.5 5.3 8.5 7.5h2c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5c0 .84-.69 1.52-1.53 1.5-.54-.01-.97.45-.97.99v1.76L2.4 18.2c-.77.58-.36 1.8.6 1.8h18c.96 0 1.37-1.22.6-1.8zM6 18l6-4.5 6 4.5H6z"}),"Checkroom");return Pt.default=o,Pt}var Wy=jy();const Ny=ys(Wy);function By(e){const{database:t}=z();return hs(t.generatedBuildList,e)}const Ky=f.memo(function(){const{optConfig:t}=f.useContext(re),n=By(t.generatedBuildListId??"");return s(G,{spacing:1,children:n==null?void 0:n.builds.map((o,i)=>s(Hy,{build:o,index:i},`${i}-${o.wengineId}-${Object.values(o.discIds).join("-")}`))})});function Ly({build:{discIds:e,wengineId:t}}){const{t:n}=he("build"),{database:o}=z(),{key:i}=J()??{},r=f.useCallback(()=>{i&&(Object.entries(e).forEach(([a,l])=>l&&o.discs.set(l,{location:i})),t&&o.wengines.set(t,{location:i}))},[i,e,t,o.wengines,o.discs]);return s(U,{color:"info",size:"small",startIcon:s(Ny,{}),onClick:r,children:n("buildDisplay.equipToCrr")})}function Hy({build:e,index:t}){const n=J(),o=ee(n.key);return s(Yc,{character:n,charOpt:o,discIds:e.discIds,wengineId:e.wengineId,children:s(W,{children:s(O,{children:y(G,{spacing:1,children:[y(E,{sx:{display:"flex",justifyContent:"space-between",gap:1},children:[y(I,{children:["Build ",t+1,": ",_s(e.value)]}),s(Ly,{build:e})]}),s(E,{children:y(ne,{container:!0,spacing:1,children:[s(ne,{item:!0,xs:6,md:4,lg:3,xl:3,children:s(sr,{})}),s(ne,{item:!0,xs:6,md:8,lg:9,xl:9,children:s(Sc,{discIds:e.discIds,wengineId:e.wengineId})})]})})]})})})})}const Fy=210,or=f.createContext(Fy),Gy=0,zt=33,ir=f.createContext(0);function Uy(){const[e,t]=f.useState(""),n=f.useMemo(()=>({statHighlight:e,setStatHighlight:t}),[e,t]),o=f.useMemo(()=>[["char",s(Jy,{},"char")],["opt",s(Xy,{},"opt")],["builds",s(Qy,{},"builds")]],[]);return s(wc.Provider,{value:n,children:s(ir.Provider,{value:o.length,children:s(G,{gap:1,children:o.map(([i,r],a)=>s(ar,{title:i,index:a,zIndex:100,children:r},i))})})})}function ar({index:e,title:t,children:n,zIndex:o,top:i=0,bottom:r=0}){const{t:a}=he("page_optimize"),[l,d]=ud(),c=f.useContext(ir),u=f.useContext(or);return y(Ht,{children:[s(W,{sx:p=>({outline:`2px solid ${p.palette.secondary.main}`,position:"sticky",top:u+e*zt+i,bottom:Gy+(c-1-e)*zt+r,zIndex:o}),children:s(Cl,{onClick:d,sx:{px:2},children:s(I,{variant:"h6",children:a(`${t}`)})})}),s(E,{ref:l,sx:{scrollMarginTop:u+(e+1)*zt+i},children:n})]})}function Jy(){const e=J(),{key:t}=e,[n,o]=f.useState(void 0),i=f.useCallback(()=>{e!=null&&e.key&&o(e.key)},[e]),r=f.useMemo(()=>[["eq",s(Vy,{onClick:i},"eq")],["Conditionals",s(Zy,{},"conditionals")],["bonusStats",s(Qg,{},"bonusStats")],["enemyStats",s(sy,{},"enemyStats")]],[i]),a=sc(),l=vl(a.breakpoints.up("sm"));return y(Ht,{children:[s(jl,{characterKey:n,onClose:()=>o(void 0)}),y(G,{spacing:1,children:[s(W,{sx:{overflow:"visible"},children:s(O,{sx:{display:"flex",gap:1,overflow:"visible"},children:y(ne,{container:!0,spacing:2,sx:{flexWrap:"wrap",overflow:"visible"},children:[s(ne,{item:!0,xs:12,sm:7,md:5,lg:4,xl:3,sx:{height:l?"100%":void 0,overflow:"visible"},children:y(G,{spacing:1,sx:l?{height:"100%"}:void 0,children:[s(Wl,{characterKey:t,onClick:i}),s(E,{sx:{flexGrow:1},children:s(E,{sx:l?{position:"sticky",top:"115px",bottom:"0px"}:void 0,children:s(sr,{})})})]})}),s(ne,{item:!0,xs:12,sm:5,md:7,lg:8,xl:9,children:s(G,{spacing:1.5,children:r.map(([d,c],u)=>s(ar,{title:d,index:u,zIndex:99,top:zt,bottom:zt*2,children:c},d))})})]})})}),s(Nd,{formulasRead:P.listing.formulas,buffsRead:P.listing.buffs})]})]})}function Xy(){return s(qy,{})}function Qy(){const{key:e}=J(),{optConfigId:t}=ee(e);return t?s(kc,{optConfigId:t,children:s(Ky,{})}):null}function Zy(){const{equippedDiscs:e,equippedWengine:t}=J(),n=xc(e),o=Sl(n),i=yc(t);return s(E,{children:y(ne,{container:!0,spacing:1,columns:{xs:1,sm:1,md:2,lg:3},children:[i&&s(ne,{item:!0,xs:1,children:s(Uc,{wengine:i})}),Object.entries(o).map(([r,a])=>s(ne,{item:!0,xs:1,children:s(Fc,{setKey:r,fade2:a<2,fade4:a<4})},r))]})})}const nc={avg:"Average",crit:"Crit Hit",nonCrit:"Non-Crit Hit"};function Yy(){const{database:e}=z(),t=J(),n=ee(t.key),{critMode:o}=n;return s(se,{title:y(E,{sx:{textWrap:"nowrap"},children:["Hit mode: ",nc[o]]}),children:Dl.map(i=>s(V,{selected:o===i,disabled:o===i,onClick:()=>e.charOpts.set(t.key,{critMode:i}),children:nc[i]},i))})}const ex=[P.final.atk,P.final.hp,P.final.def,P.final.enerRegen,P.final.anomProf,P.final.anomMas];function tx({character:{key:e},charOpt:{target:t}}){const n=Le(),{database:o}=z(),i=f.useMemo(()=>{if(t)return vc(t)},[t]);return y(se,{color:i?"success":"warning",title:i?y(E,{sx:{display:"flex",gap:1},children:[s("strong",{children:"Optimization Target: "}),s(gn,{tag:i})]}):"Select an Optimization Target",variant:i?"outlined":void 0,sx:{height:"100%",flexGrow:1},children:[n==null?void 0:n.listFormulas(P.listing.formulas).map(({tag:r},a)=>{const{name:l,sheet:d}=r;if(!(!l||!d))return s(V,{onClick:()=>o.charOpts.set(e,{target:{sheet:d,name:l}}),children:s(so,{children:s(E,{sx:{display:"flex",gap:1},children:s(gn,{tag:r})})})},`${a}_${r.sheet}_${r.name}`)}),ex.map(({tag:r},a)=>{const{q:l,qt:d}=r;if(!(!l||!d))return s(V,{onClick:()=>o.charOpts.set(e,{target:{q:l,qt:d}}),children:s(so,{children:s(E,{sx:{display:"flex",gap:1},children:s(gn,{tag:r})})})},`${a}_${l}_${d}`)})]})}function nx(){const{database:e}=z(),t=J(),n=ee(t.key),{target:o}=n,i=f.useCallback(r=>e.charOpts.set(t.key,({target:a={}})=>{const{damageType1:l,...d}=a;return r?{target:{...d,damageType1:r}}:{target:d}}),[e,t.key]);return(o==null?void 0:o.name)!=="standardDmgInst"?null:s(nr,{dmgType:o==null?void 0:o.damageType1,keys:hc,setDmgType:i})}function sx({character:e,charOpt:t}){return y(E,{display:"flex",gap:1,sx:{position:"sticky",top:36,zIndex:100,background:"#0C1020"},children:[s(tx,{character:e,charOpt:t}),s(ix,{}),s(nx,{}),s(ox,{}),s(Yy,{})]})}function ox(){const{database:e}=z(),t=J(),n=ee(t.key),{target:o}=n,i=f.useCallback(r=>e.charOpts.set(t.key,({target:a={}})=>{const{damageType2:l,...d}=a;return r?{target:{...d,damageType2:"aftershock"}}:{target:d}}),[e,t.key]);return(o==null?void 0:o.name)!=="standardDmgInst"?null:s(tr,{isAftershock:(o==null?void 0:o.damageType2)==="aftershock",setAftershock:i})}function ix(){const{database:e}=z(),t=J(),n=ee(t.key),{target:o}=n,{q:i,qt:r}=o??{};return!i||!r?null:s(se,{title:Nt[r],children:["final","initial"].map(a=>s(V,{selected:a===r,disabled:a===r,onClick:()=>e.charOpts.set(t.key,{target:{q:i,qt:a}}),children:Nt[a]},a))})}function Tx(){const{database:e}=z(),{optCharKey:t}=Vl(e.dbMeta),n=t??Ml[0],[o,i,r]=vs(),a=f.useCallback(C=>e.dbMeta.set({optCharKey:C}),[e.dbMeta]),{t:l}=he(["charNames_gen","page_character"]),d=Nl(n);f.useEffect(()=>{n&&!d&&e.chars.getOrCreate(n)},[n,d,e.chars]);const c=ee(n);f.useEffect(()=>{n&&!c&&e.charOpts.getOrCreate(n)},[n,c,e.charOpts]),pd(f.useMemo(()=>{const C=n&&l(`charNames_gen:${n}`);return C?`Optimize - ${C}`:"Optimize"},[n,l]));const u=f.useMemo(()=>{const S=De(n?[n]:[],M=>s(Bl,{characterKey:M}));return{srcDisplay:S,dstDisplay:S}},[n]),p=f.useCallback((C,S,M,A,X)=>{!El(C)||!oo(M)||!(A===null||oo(A))||!Tl(C,S)||e.charOpts.setConditional(n,C,S,M,A,X)},[n,e.charOpts]),h=f.useMemo(()=>({src:n,dst:n,preset:"preset0"}),[n]),[m,$]=f.useState(),x=f.useMemo(()=>({read:m,setRead:$}),[m]);return s(ax,{children:y(E,{children:[s(f.Suspense,{fallback:!1,children:s(Kl,{show:o,onHide:r,onSelect:a})}),s(E,{sx:{position:"sticky",top:0,zIndex:100,background:"#0C1020"},children:s(U,{fullWidth:!0,color:Dc(n).attribute,sx:{justifyContent:"flex-start",pl:"6px"},onClick:i,children:y(E,{sx:{display:"flex",gap:1,alignItems:"center"},children:[s(bs,{size:2,src:Il(n,"circle")}),l(`charNames_gen:${n}`)]})})}),d&&c&&s(Cc.Provider,{value:d,children:s(Kt.Provider,{value:h,children:s(Yc,{character:d,charOpt:c,wengineId:d.equippedWengine,discIds:d.equippedDiscs,children:s(Rl.Provider,{value:u,children:s(Al.Provider,{value:c.conditionals,children:s(ql.Provider,{value:p,children:y(xs.Provider,{value:x,children:[s(Bd,{}),y(E,{sx:{display:"flex",gap:1,flexDirection:"column",mt:1},children:[s(sx,{character:d,charOpt:c}),s(or.Provider,{value:74,children:s(Uy,{})})]})]})})})})})})})]})})}function ax({children:e}){return s(Ol.Provider,{value:Zc,children:s(Pl.Provider,{value:ce,children:s(zl.Provider,{value:gn,children:e})})})}export{Tx as default};
