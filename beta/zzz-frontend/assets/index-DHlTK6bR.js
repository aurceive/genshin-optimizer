import{d as G,u as U,r as l,cU as ne,j as e,C as M,a as c,b as O,G as d,T as L,B as R,c as F,R as te,i as W,bd as j,ay as _,cV as $,bZ as se,cW as ie,cX as le,cY as ae,cZ as oe,c_ as ce,cj as P,bP as re,c$ as de,d0 as ue,bC as ge,d1 as pe,bl as A,d2 as he,bY as ye,d3 as me,e as fe,d4 as we,f as Te,cm as We,g as xe,h as ke,d5 as be,cM as Se,N as Ce,cq as Ie,cN as qe,S as ve,d6 as Ee,d7 as Be,d8 as V}from"./index-CKARXDv9.js";import{u as H}from"./useDataEntryBase-Cq49Dqtj.js";const Y=["locked","unlocked"],De=re([...Y]);function Ke({numShowing:f,total:t,wengineIds:x}){const{t:r}=G(["page_wengine","ui"]),{database:a}=U(),k=H(a.displayWengine),{speciality:b,rarity:S,locked:C,showEquipped:u,showInventory:y,locations:z}=k,{lockedTotal:w,equippedTotal:m,locationTotal:I,wengineTotals:q,wengineRarityTotals:v}=l.useMemo(()=>{const i={lockedTotal:["locked","unlocked"],equippedTotal:["equipped","unequipped"],locationTotal:[...me,""],wengineTotals:[...ye],wengineRarityTotals:[...he]};return ne(i,s=>a.wengines.entries.forEach(([E,o])=>{const g=o.location,B=o.lock?"locked":"unlocked",T=g?"equipped":"unequipped",D=A(o.key).type,p=A(o.key).rarity;s.lockedTotal[B].total++,s.equippedTotal[T].total++,s.locationTotal[g].total++,s.wengineTotals[D].total++,p&&s.wengineRarityTotals[p].total++,x.includes(E)&&(s.lockedTotal[B].current++,s.equippedTotal[T].current++,s.locationTotal[g].current++,s.wengineTotals[D].current++,p&&s.wengineRarityTotals[p].current++)}))},[a.wengines.entries,x]);return e(M,{children:c(O,{sx:{display:"flex",flexDirection:"column",gap:1},children:[c(d,{container:!0,children:[e(d,{item:!0,children:e(L,{variant:"h6",children:r("wengineFilterTitle")})}),e(d,{item:!0,flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center",children:c(L,{children:[e("strong",{children:f})," / ",t]})}),e(d,{item:!0,children:e(R,{size:"small",color:"error",onClick:()=>a.displayWengine.set({action:"reset"}),startIcon:e(te,{}),children:e(F,{t:r,i18nKey:"ui:reset"})})})]}),e(W,{children:c(d,{container:!0,spacing:1,children:[c(d,{item:!0,xs:12,md:6,display:"flex",flexDirection:"column",children:[e(F,{t:r,i18nKey:"subheadings.general"}),c(j,{spacing:1,children:[e(_,{sx:{bgcolor:$.palette.contentNormal.light}}),e(se,{fullWidth:!0,onChange:i=>a.displayWengine.set({speciality:i}),value:b,totals:q,size:"small"}),e(ie,{sx:{height:"100%"},fullWidth:!0,onChange:i=>a.displayWengine.set({rarity:i}),value:S,totals:v,size:"small"})]})]}),e(d,{item:!0,xs:12,md:6,display:"flex",flexDirection:"column",gap:1,children:c(W,{children:[e(F,{t:r,i18nKey:"subheadings.inventory"}),c(j,{spacing:1,children:[e(_,{sx:{bgcolor:$.palette.contentNormal.light}}),e(le,{fullWidth:!0,value:C,size:"small",children:Y.map((i,s)=>c(ae,{value:i,sx:{display:"flex",gap:1},onClick:()=>a.displayWengine.set({locked:De(C,i)}),children:[s?e(oe,{}):e(ce,{}),e(F,{t:r,i18nKey:`ui:${i}`}),e(P,{label:w[s?"unlocked":"locked"],size:"small"})]},i))}),c(R,{startIcon:e(de,{}),color:y?"success":"secondary",onClick:()=>a.displayWengine.set({showInventory:!y}),children:[r("wengineInInv")," ",e(P,{sx:{ml:1},label:m.unequipped,size:"small"})]}),c(R,{startIcon:e(ue,{}),color:u?"success":"secondary",onClick:()=>a.displayWengine.set({showEquipped:!u}),children:[r("equippedWengine")," ",e(P,{sx:{ml:1},label:m.equipped,size:"small"})]})]}),e(j,{spacing:1.5,pt:1.5,children:e(l.Suspense,{fallback:null,children:e(ge,{title:u?r("locationsTooltip"):"",placement:"top",children:e("span",{children:e(pe,{totals:I,locations:u?[]:z,setLocations:i=>a.displayWengine.set({locations:i}),disabled:u})})})})})]})})]})})]})})}const Fe={xs:2,sm:3,md:4,lg:4,xl:6},Re={xs:10,sm:12,md:24,lg:24,xl:24},ze=Object.keys(V);function Pe(){const{t:f}=G(["page_wengine","ui"]),{database:t}=U(),[x,r]=l.useState(!1),a=H(t.displayWengine),[k,b]=fe();l.useEffect(()=>t.wengines.followAny((n,h)=>(h==="new"||h==="remove"||h==="update")&&b()),[b,t]);const[S,C]=l.useState(""),u=l.useDeferredValue(S),y=l.useCallback(n=>{t.displayWengine.set({editWengineId:n})},[t]),z=l.useCallback(n=>{y(t.wengines.new(we(n)))},[t.wengines,y]),{sortType:w,ascending:m,speciality:I,rarity:q,locked:v,showEquipped:i,showInventory:s,locations:E}=a,{wengineIds:o,totalWengineNum:g}=l.useMemo(()=>{const n=t.wengines.values,h=n.length,J=n.filter(Te({speciality:I,rarity:q,name:u,locked:v,showInventory:s,showEquipped:i,locations:E},Ee())).sort(We(V[w]??[],m,Be())).map(ee=>ee.id);return k&&{wengineIds:J,totalWengineNum:h}},[t.wengines.values,I,q,u,v,s,i,E,w,m,k]),B=xe(),{numShow:T,setTriggerElement:D}=ke(Re[B],o.length),p=l.useMemo(()=>o.slice(0,T),[o,T]),N=l.useCallback(()=>t.displayWengine.set({editWengineId:""}),[t]),{editWengineId:K}=a;l.useEffect(()=>{K&&(t.wengines.get(K)||N())},[t,K,N]);const Z=o.length!==g?`${o.length}/${g}`:`${g}`,Q={numShowing:p.length,total:Z,t:f,namespace:"page_wengine"},X={sortKeys:[...ze],value:w,onChange:n=>t.displayWengine.set({sortType:n}),ascending:m,onChangeAsc:n=>t.displayWengine.set({ascending:n})};return c(W,{display:"flex",flexDirection:"column",gap:1,children:[e(l.Suspense,{fallback:!1,children:e(be,{show:x,onHide:()=>r(!1),onSelect:z})}),e(l.Suspense,{fallback:!1,children:e(Se,{wengineId:K,footer:!0,onClose:N})}),e(Ke,{numShowing:o.length,total:g,wengineIds:o}),e(M,{children:e(O,{sx:{display:"flex",flexDirection:"column",gap:1},children:c(W,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:[e(Ce,{autoFocus:!0,size:"small",value:S,onChange:n=>C(n.target.value),label:f("wengineName"),sx:{height:"100%"},InputProps:{sx:{height:"100%"}}}),e(Ie,{showingTextProps:Q,sortByButtonProps:X})]})})}),e(R,{fullWidth:!0,onClick:()=>r(!0),color:"info",children:f("page_wengine:addWengine")}),e(W,{children:e(d,{container:!0,spacing:1,columns:Fe,children:p.map(n=>e(d,{item:!0,xs:1,children:e(qe,{wengineId:n,onEdit:y,setLocation:h=>t.wengines.set(n,{location:h})})},n))})}),o.length!==p.length&&e(ve,{ref:n=>{n&&D(n)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{Pe as default};
