import{i as H,u as O,a as V,d as c,hE as Y,j as e,C as _,e as l,f as $,G as u,T as j,B as D,h as K,R as Z,o as x,y as F,v as L,hF as G,by as ee,hG as ne,hH as te,hI as se,hJ as ie,hK as le,c5 as N,bp as ae,hL as oe,hM as ce,hN as re,hO as de,aC as M,hP as ge,bx as ue,hQ as he,z as pe,hR as ye,k as me,l as fe,c9 as we,m as Te,n as We,hS as xe,cQ as ke,cd as Se,ce as Ce,hT as be,S as Ie,hU as qe,hV as ve,hW as A}from"./index-2G5tNwBr.js";const Q=["locked","unlocked"],Be=ae([...Q]);function Ee({numShowing:p,total:i,wengineIds:k}){const{t:r}=H(["page_wengine","ui"]),{database:a}=O(),S=V(a.displayWengine),{speciality:C,rarity:R,locked:y,showEquipped:d,showInventory:b,locations:m}=S,{lockedTotal:f,equippedTotal:w,locationTotal:I,wengineTotals:q,wengineRarityTotals:v}=c.useMemo(()=>{const s={lockedTotal:["locked","unlocked"],equippedTotal:["equipped","unequipped"],locationTotal:[...he,""],wengineTotals:[...ue],wengineRarityTotals:[...ge]};return Y(s,t=>a.wengines.entries.forEach(([T,g])=>{const o=g.location,B=g.lock?"locked":"unlocked",W=o?"equipped":"unequipped",E=M(g.key).type,h=M(g.key).rarity;t.lockedTotal[B].total++,t.equippedTotal[W].total++,t.locationTotal[o].total++,t.wengineTotals[E].total++,h&&t.wengineRarityTotals[h].total++,k.includes(T)&&(t.lockedTotal[B].current++,t.equippedTotal[W].current++,t.locationTotal[o].current++,t.wengineTotals[E].current++,h&&t.wengineRarityTotals[h].current++)}))},[a.wengines.entries,k]);return e(_,{children:l($,{sx:{display:"flex",flexDirection:"column",gap:1},children:[l(u,{container:!0,children:[e(u,{item:!0,children:e(j,{variant:"h6",children:r("wengineFilterTitle")})}),e(u,{item:!0,flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center",children:l(j,{children:[e("strong",{children:p})," / ",i]})}),e(u,{item:!0,children:e(D,{size:"small",color:"error",onClick:()=>a.displayWengine.set({action:"reset"}),startIcon:e(Z,{}),children:e(K,{t:r,i18nKey:"ui:reset"})})})]}),e(x,{children:l(u,{container:!0,spacing:1,children:[l(u,{item:!0,xs:12,md:6,display:"flex",flexDirection:"column",children:[e(K,{t:r,i18nKey:"subheadings.general"}),l(F,{spacing:1,children:[e(L,{sx:{bgcolor:G.palette.contentNormal.light}}),e(ee,{fullWidth:!0,onChange:s=>a.displayWengine.set({speciality:s}),value:C,totals:q,size:"small"}),e(ne,{sx:{height:"100%"},fullWidth:!0,onChange:s=>a.displayWengine.set({rarity:s}),value:R,totals:v,size:"small"})]})]}),e(u,{item:!0,xs:12,md:6,display:"flex",flexDirection:"column",gap:1,children:l(x,{children:[e(K,{t:r,i18nKey:"subheadings.inventory"}),l(F,{spacing:1,children:[e(L,{sx:{bgcolor:G.palette.contentNormal.light}}),e(te,{fullWidth:!0,value:y,size:"small",children:Q.map((s,t)=>l(se,{value:s,sx:{display:"flex",gap:1},onClick:()=>a.displayWengine.set({locked:Be(y,s)}),children:[t?e(ie,{}):e(le,{}),e(K,{t:r,i18nKey:`ui:${s}`}),e(N,{label:f[t?"unlocked":"locked"],size:"small"})]},s))}),l(D,{startIcon:e(oe,{}),color:b?"success":"secondary",onClick:()=>a.displayWengine.set({showInventory:!b}),children:[r("wengineInInv")," ",e(N,{sx:{ml:1},label:w.unequipped,size:"small"})]}),l(D,{startIcon:e(ce,{}),color:d?"success":"secondary",onClick:()=>a.displayWengine.set({showEquipped:!d}),children:[r("equippedWengine")," ",e(N,{sx:{ml:1},label:w.equipped,size:"small"})]})]}),e(F,{spacing:1.5,pt:1.5,children:e(c.Suspense,{fallback:null,children:e(re,{title:d?r("locationsTooltip"):"",placement:"top",children:e("span",{children:e(de,{totals:I,locations:d?[]:m,setLocations:s=>a.displayWengine.set({locations:s}),disabled:d})})})})})]})})]})})]})})}const Ke={xs:2,sm:3,md:4,lg:4,xl:6},De={xs:10,sm:12,md:24,lg:24,xl:24},Re=Object.keys(A);function Fe(){const{t:p}=H(["page_wengine","ui"]),{database:i}=O(),[k,r,a]=pe(!1),S=V(i.displayWengine),[C,R]=c.useState(""),y=c.useDeferredValue(C),d=c.useCallback(n=>{i.displayWengine.set({editWengineId:n})},[i]),b=c.useCallback(n=>{d(i.wengines.new(ye(n)))},[i.wengines,d]),{sortType:m,ascending:f,speciality:w,rarity:I,locked:q,showEquipped:v,showInventory:s,locations:t}=S,T=me(i.wengines),g=T.length,o=c.useMemo(()=>T.filter(fe({speciality:w,rarity:I,name:y,locked:q,showInventory:s,showEquipped:v,locations:t},qe())).sort(we(A[m]??[],f,ve())).map(n=>n.id),[T,w,I,y,q,s,v,t,m,f]),B=Te(),{numShow:W,setTriggerElement:E}=We(De[B],o.length),h=c.useMemo(()=>o.slice(0,W),[o,W]),P=c.useCallback(()=>i.displayWengine.set({editWengineId:""}),[i]),{editWengineId:z}=S;z&&!i.wengines.get(z)&&P();const U=o.length!==g?`${o.length}/${g}`:`${g}`,J={numShowing:h.length,total:U,t:p,namespace:"page_wengine"},X={sortKeys:[...Re],value:m,onChange:n=>i.displayWengine.set({sortType:n}),ascending:f,onChangeAsc:n=>i.displayWengine.set({ascending:n})};return l(x,{display:"flex",flexDirection:"column",gap:1,children:[e(c.Suspense,{fallback:!1,children:e(xe,{show:k,onHide:a,onSelect:b})}),e(c.Suspense,{fallback:!1,children:e(ke,{wengineId:z,footer:!0,onClose:P})}),e(Ee,{numShowing:o.length,total:g,wengineIds:o}),e(_,{children:e($,{sx:{display:"flex",flexDirection:"column",gap:1},children:l(x,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:[e(Se,{autoFocus:!0,size:"small",value:C,onChange:n=>R(n.target.value),label:p("wengineName"),sx:{height:"100%"},InputProps:{sx:{height:"100%"}}}),e(Ce,{showingTextProps:J,sortByButtonProps:X})]})})}),e(D,{fullWidth:!0,onClick:r,color:"info",children:p("page_wengine:addWengine")}),e(x,{children:e(u,{container:!0,spacing:1,columns:Ke,children:h.map(n=>e(u,{item:!0,xs:1,children:e(be,{wengineId:n,onEdit:d},n)},n))})}),o.length!==h.length&&e(Ie,{ref:n=>{n&&E(n)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{Fe as default};
