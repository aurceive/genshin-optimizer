var Ks=e=>{throw TypeError(e)};var Bs=(e,t,n)=>t.has(e)||Ks("Cannot "+n);var we=(e,t,n)=>(Bs(e,t,"read from private field"),n?n.call(e):t.get(e)),Te=(e,t,n)=>t.has(e)?Ks("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Y=(e,t,n,o)=>(Bs(e,t,"write to private field"),o?o.call(e,n):t.set(e,n),n);import{n as wn,o as _n,r as f,p as kn,q as rr,s as lr,_ as vn,v as j,w as nc,x as dr,y as ur,z as ne,E as xe,H as Vt,I as Cn,J as Ls,K as pr,L as hr,P as mr,M as fr,j as s,N as gr,d as be,O as yr,Q as Hs,U as sc,V as xr,W as Nt,X as br,Y as oc,Z as ic,$ as le,a0 as gn,a1 as ac,a2 as os,a3 as $r,e as wr,u as O,a4 as ps,a5 as cc,a6 as _r,a7 as kr,a8 as vr,a9 as rc,aa as Ot,ab as Pt,ac as G,ad as Cr,ae as Sr,af as z,ag as yn,ah as Dr,ai as Mr,aj as lc,ak as xn,al as Er,am as hs,an as ms,ao as fs,ap as gs,aq as Kt,ar as Ne,as as ys,at as fe,a as y,au as Bt,av as Ke,aw as Sn,b as V,C as W,ax as is,ay as ee,T as R,az as re,aA as xs,aB as ye,aC as Tr,aD as Ir,i as M,aE as Rr,aF as Ar,aG as qr,aH as zr,aI as L,aJ as ie,aK as Vr,F as Lt,aL as Fs,aM as Gs,aN as bn,aO as Or,aP as dc,aQ as uc,aR as ue,aS as pc,aT as as,aU as hc,aV as mc,aW as Pr,aX as Ce,aY as jr,aZ as ge,a_ as Ae,a$ as hn,b0 as ve,b1 as fc,b2 as Us,b3 as je,b4 as Wr,b5 as Nr,b6 as Kr,b7 as jt,b8 as _,b9 as N,ba as w,bb as bs,bc as Br,bd as B,be as $s,bf as Lr,bg as ws,bh as D,bi as v,bj as gc,bk as Hr,bl as Dn,bm as Fr,bn as Js,bo as Xs,B as U,bp as J,bq as Gr,br as Ur,bs as qe,bt as Mn,bu as Jr,bv as Xr,bw as Qr,bx as Zr,by as yc,bz as Yr,bA as el,bB as tl,bC as nl,bD as sl,bE as ol,bF as il,bG as Qs,bH as Gn,bI as al,bJ as ae,bK as Zs,bL as cl,bM as _s,G as se,bN as rl,bO as Ys,l as ks,S as xc,bP as ll,bQ as eo,bR as dl,bS as ul,bT as pl,bU as hl,bV as ml,bW as fl,bX as gl,bY as to,bZ as yl,b_ as bc,b$ as $c,c0 as xl,c1 as wc,c2 as _c,c3 as bl,c4 as $l,c5 as wl,c6 as _l,c7 as no,c8 as kl,c9 as vl,ca as so,cb as Cl,cc as Sl,cd as Dl,ce as Ml,cf as El}from"./index-CKARXDv9.js";import{u as Tl}from"./useDataEntryBase-Cq49Dqtj.js";import{A as Se,g as kc,C as Il,a as Rl,u as Al,b as ql,c as zl}from"./CharacterEditor-od1iZACa.js";import"./discSortUtil-Dgg54zTX.js";function Vl(e){return wn("MuiCollapse",e)}_n("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const Ol=["addEndListener","children","className","collapsedSize","component","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","orientation","style","timeout","TransitionComponent"],Pl=e=>{const{orientation:t,classes:n}=e,o={root:["root",`${t}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${t}`],wrapperInner:["wrapperInner",`${t}`]};return Cn(o,Vl,n)},jl=xe("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.orientation],n.state==="entered"&&t.entered,n.state==="exited"&&!n.in&&n.collapsedSize==="0px"&&t.hidden]}})(({theme:e,ownerState:t})=>j({height:0,overflow:"hidden",transition:e.transitions.create("height")},t.orientation==="horizontal"&&{height:"auto",width:0,transition:e.transitions.create("width")},t.state==="entered"&&j({height:"auto",overflow:"visible"},t.orientation==="horizontal"&&{width:"auto"}),t.state==="exited"&&!t.in&&t.collapsedSize==="0px"&&{visibility:"hidden"})),Wl=xe("div",{name:"MuiCollapse",slot:"Wrapper",overridesResolver:(e,t)=>t.wrapper})(({ownerState:e})=>j({display:"flex",width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),Nl=xe("div",{name:"MuiCollapse",slot:"WrapperInner",overridesResolver:(e,t)=>t.wrapperInner})(({ownerState:e})=>j({width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),vs=f.forwardRef(function(t,n){const o=kn({props:t,name:"MuiCollapse"}),{addEndListener:i,children:r,className:a,collapsedSize:l="0px",component:d,easing:c,in:u,onEnter:p,onEntered:h,onEntering:m,onExit:g,onExited:$,onExiting:C,orientation:S="vertical",style:E,timeout:A=lr.standard,TransitionComponent:X=rr}=o,q=vn(o,Ol),K=j({},o,{orientation:S,collapsedSize:l}),I=Pl(K),P=nc(),Q=dr(),Z=f.useRef(null),pe=f.useRef(),ce=typeof l=="number"?`${l}px`:l,$e=S==="horizontal",Tt=$e?"width":"height",tn=f.useRef(null),er=ur(n,tn),Ee=T=>oe=>{if(T){const he=tn.current;oe===void 0?T(he):T(he,oe)}},Fn=()=>Z.current?Z.current[$e?"clientWidth":"clientHeight"]:0,tr=Ee((T,oe)=>{Z.current&&$e&&(Z.current.style.position="absolute"),T.style[Tt]=ce,p&&p(T,oe)}),nr=Ee((T,oe)=>{const he=Fn();Z.current&&$e&&(Z.current.style.position="");const{duration:It,easing:nn}=Ls({style:E,timeout:A,easing:c},{mode:"enter"});if(A==="auto"){const Ns=P.transitions.getAutoHeightDuration(he);T.style.transitionDuration=`${Ns}ms`,pe.current=Ns}else T.style.transitionDuration=typeof It=="string"?It:`${It}ms`;T.style[Tt]=`${he}px`,T.style.transitionTimingFunction=nn,m&&m(T,oe)}),sr=Ee((T,oe)=>{T.style[Tt]="auto",h&&h(T,oe)}),or=Ee(T=>{T.style[Tt]=`${Fn()}px`,g&&g(T)}),ir=Ee($),ar=Ee(T=>{const oe=Fn(),{duration:he,easing:It}=Ls({style:E,timeout:A,easing:c},{mode:"exit"});if(A==="auto"){const nn=P.transitions.getAutoHeightDuration(oe);T.style.transitionDuration=`${nn}ms`,pe.current=nn}else T.style.transitionDuration=typeof he=="string"?he:`${he}ms`;T.style[Tt]=ce,T.style.transitionTimingFunction=It,C&&C(T)}),cr=T=>{A==="auto"&&Q.start(pe.current||0,T),i&&i(tn.current,T)};return ne.jsx(X,j({in:u,onEnter:tr,onEntered:sr,onEntering:nr,onExit:or,onExited:ir,onExiting:ar,addEndListener:cr,nodeRef:tn,timeout:A==="auto"?null:A},q,{children:(T,oe)=>ne.jsx(jl,j({as:d,className:Vt(I.root,a,{entered:I.entered,exited:!u&&ce==="0px"&&I.hidden}[T]),style:j({[$e?"minWidth":"minHeight"]:ce},E),ref:er},oe,{ownerState:j({},K,{state:T}),children:ne.jsx(Wl,{ownerState:j({},K,{state:T}),className:I.wrapper,ref:Z,children:ne.jsx(Nl,{ownerState:j({},K,{state:T}),className:I.wrapperInner,children:r})})}))}))});vs.muiSupportAuto=!0;const vc=f.createContext({});function Kl(e){return wn("MuiAccordion",e)}const sn=_n("MuiAccordion",["root","rounded","expanded","disabled","gutters","region"]),Bl=["children","className","defaultExpanded","disabled","disableGutters","expanded","onChange","square","slots","slotProps","TransitionComponent","TransitionProps"],Ll=e=>{const{classes:t,square:n,expanded:o,disabled:i,disableGutters:r}=e;return Cn({root:["root",!n&&"rounded",o&&"expanded",i&&"disabled",!r&&"gutters"],region:["region"]},Kl,t)},Hl=xe(mr,{name:"MuiAccordion",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`& .${sn.region}`]:t.region},t.root,!n.square&&t.rounded,!n.disableGutters&&t.gutters]}})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{position:"relative",transition:e.transitions.create(["margin"],t),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(e.vars||e).palette.divider,transition:e.transitions.create(["opacity","background-color"],t)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${sn.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${sn.disabled}`]:{backgroundColor:(e.vars||e).palette.action.disabledBackground}}},({theme:e})=>({variants:[{props:t=>!t.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(e.vars||e).shape.borderRadius,borderTopRightRadius:(e.vars||e).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(e.vars||e).shape.borderRadius,borderBottomRightRadius:(e.vars||e).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:t=>!t.disableGutters,style:{[`&.${sn.expanded}`]:{margin:"16px 0"}}}]})),on=f.forwardRef(function(t,n){const o=kn({props:t,name:"MuiAccordion"}),{children:i,className:r,defaultExpanded:a=!1,disabled:l=!1,disableGutters:d=!1,expanded:c,onChange:u,square:p=!1,slots:h={},slotProps:m={},TransitionComponent:g,TransitionProps:$}=o,C=vn(o,Bl),[S,E]=pr({controlled:c,default:a,name:"Accordion",state:"expanded"}),A=f.useCallback($e=>{E(!S),u&&u($e,!S)},[S,u,E]),[X,...q]=f.Children.toArray(i),K=f.useMemo(()=>({expanded:S,disabled:l,disableGutters:d,toggle:A}),[S,l,d,A]),I=j({},o,{square:p,disabled:l,disableGutters:d,expanded:S}),P=Ll(I),Q=j({transition:g},h),Z=j({transition:$},m),[pe,ce]=hr("transition",{elementType:vs,externalForwardedProps:{slots:Q,slotProps:Z},ownerState:I});return ne.jsxs(Hl,j({className:Vt(P.root,r),ref:n,ownerState:I,square:p},C,{children:[ne.jsx(vc.Provider,{value:K,children:X}),ne.jsx(pe,j({in:S,timeout:"auto"},ce,{children:ne.jsx("div",{"aria-labelledby":X.props.id,id:X.props["aria-controls"],role:"region",className:P.region,children:q})}))]}))});function Fl(e){return wn("MuiAccordionDetails",e)}_n("MuiAccordionDetails",["root"]);const Gl=["className"],Ul=e=>{const{classes:t}=e;return Cn({root:["root"]},Fl,t)},Jl=xe("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>({padding:e.spacing(1,2,2)})),an=f.forwardRef(function(t,n){const o=kn({props:t,name:"MuiAccordionDetails"}),{className:i}=o,r=vn(o,Gl),a=o,l=Ul(a);return ne.jsx(Jl,j({className:Vt(l.root,i),ref:n,ownerState:a},r))});function Xl(e){return wn("MuiAccordionSummary",e)}const Re=_n("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),Ql=["children","className","expandIcon","focusVisibleClassName","onClick"],Zl=e=>{const{classes:t,expanded:n,disabled:o,disableGutters:i}=e;return Cn({root:["root",n&&"expanded",o&&"disabled",!i&&"gutters"],focusVisible:["focusVisible"],content:["content",n&&"expanded",!i&&"contentGutters"],expandIconWrapper:["expandIconWrapper",n&&"expanded"]},Xl,t)},Yl=xe(fr,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{display:"flex",minHeight:48,padding:e.spacing(0,2),transition:e.transitions.create(["min-height","background-color"],t),[`&.${Re.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${Re.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`&:hover:not(.${Re.disabled})`]:{cursor:"pointer"},variants:[{props:n=>!n.disableGutters,style:{[`&.${Re.expanded}`]:{minHeight:64}}}]}}),ed=xe("div",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(e,t)=>t.content})(({theme:e})=>({display:"flex",flexGrow:1,margin:"12px 0",variants:[{props:t=>!t.disableGutters,style:{transition:e.transitions.create(["margin"],{duration:e.transitions.duration.shortest}),[`&.${Re.expanded}`]:{margin:"20px 0"}}}]})),td=xe("div",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(e,t)=>t.expandIconWrapper})(({theme:e})=>({display:"flex",color:(e.vars||e).palette.action.active,transform:"rotate(0deg)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest}),[`&.${Re.expanded}`]:{transform:"rotate(180deg)"}})),cn=f.forwardRef(function(t,n){const o=kn({props:t,name:"MuiAccordionSummary"}),{children:i,className:r,expandIcon:a,focusVisibleClassName:l,onClick:d}=o,c=vn(o,Ql),{disabled:u=!1,disableGutters:p,expanded:h,toggle:m}=f.useContext(vc),g=S=>{m&&m(S),d&&d(S)},$=j({},o,{expanded:h,disabled:u,disableGutters:p}),C=Zl($);return ne.jsxs(Yl,j({focusRipple:!1,disableRipple:!0,disabled:u,component:"div","aria-expanded":h,className:Vt(C.root,r),focusVisibleClassName:Vt(C.focusVisible,l),onClick:g,ref:n,ownerState:$},c,{children:[ne.jsx(ed,{className:C.content,ownerState:$,children:i}),a&&ne.jsx(td,{className:C.expandIconWrapper,ownerState:$,children:a})]}))});function nd({value:e,onChange:t,...n}){const[o,i]=f.useState(e);f.useEffect(()=>{i(e)},[e]);const r=()=>t(o);return s(gr,{value:o,onChange:a=>i(a.target.value),onBlur:r,onKeyDown:a=>a.key==="Enter"&&!n.multiline&&r(),...n})}function sd(){const e=f.useRef(),t=f.useCallback(()=>{var n;return(n=e.current)==null?void 0:n.scrollIntoView({behavior:"smooth"})},[e]);return[e,t]}function od(e){const{t}=be("ui"),n=yr({path:"/:page/*"}),o=t("pageTitle"),i=e??((n==null?void 0:n.params.page)&&t(`tabs.${n==null?void 0:n.params.page}`));f.useEffect(()=>{i?document.title=`${i} - ${o}`:document.title=o},[t,o,i])}const Cs={};class Cc{constructor(){this.internal=new id}ref(t){return t.reduce((n,o)=>n.get(o),this.internal)}*[Symbol.iterator](){for(const[t,n]of this.internal.entries([]))"value"in n&&(yield[[...t],n.value])}*values(){for(const t of this.internal.allRefs())"value"in t&&(yield t.value)}}let id=class Sc{constructor(){this.map=new Map}get(t){const n=this.map.get(t);if(n)return n;const o=new Sc;return this.map.set(t,o),o}*allRefs(){for(const t of this.map.values())yield*t.allRefs();yield this}*entries(t){const n=t.push(void 0)-1;for(const[o,i]of this.map.entries())t[n]=o,yield*i.entries(t);t.pop(),yield[t,this]}};class Dc{constructor(t,n){this.root=new ad(t,n)}subset(t){const n=[];return this._subset(t,o=>n.push(...o[Hs].map(i=>i.value))),n}entries(t){const n=[];return this._subset(t,o=>n.push(...o[Hs])),n}_subset(t,n){const o=t.length;function i(r,a){r<o?a.subset(t[r]).forEach(l=>i(r+1,l)):n(a.leaf)}i(0,this.root)}}let ad=class Mc{constructor(t,n){if(this.children=[],t>0)for(const[o,i]of Object.entries(n)){const r=new Map;for(const[a,l]of Object.entries(i))r.set(+a,new Mc(t-1,l));this.children.push({mask:+o,map:r})}else this.leaf=n}subset(t){return this.children.map(({mask:n,map:o})=>o.get(t&n)).filter(n=>!!n)}};class cs{constructor(t){this.root=new Ss(void 0),this.keys=t}at(t){const n=this.keys.get(t),o=n.reduce((i,r)=>i.child(r),this.root);return o.leaf||(o.leaf=new Ds(t,n,this.keys,o)),o.leaf}}class Ss{constructor(t){this.children=new Map,this.parent=t}child(t){let n=this.children.get(t);return n||(n=new Ss(this),this.children.set(t,n),n)}}class Ds{constructor(t,n,o,i){this.tag=Object.fromEntries(Object.entries(t).filter(([r,a])=>a!=null)),this.id=n,this.keys=o,this.internal=i}with(t){const{keys:n}=this,{id:o,firstReplacedByte:i}=n.combine(this.id,t);let r=this.internal;for(let a=i;a<n.tagLen;a++)r=r.parent;for(let a=i;a<n.tagLen;a++)r=r.child(o[a]);return r.leaf||(r.leaf=new Ds({...this.tag,...t},o,n,r)),r.leaf}}class cd{constructor(t,n){this.keys=new sc(t),this.values=new Dc(t.tagLen,n)}subset(t){return this.values.subset(this.keys.get(t))}}const We={sum:e=>e.reduce((t,n)=>t+n,0),prod:e=>e.reduce((t,n)=>t*n,1),min:e=>Math.min(...e),max:e=>Math.max(...e),sumfrac:([e,t])=>e/(e+t),unique:([e])=>e},Ms={match:([e,t])=>e===t?0:1,thres:([e,t])=>e>=t?0:1,lookup:([e],t)=>t[e]??0},rn=e=>br(e,"val");let Ec=class{constructor(t,...n){const o=new sc(t);this.nodes=new Dc(o.tagLen,xr(n)),this.cache=new cs(o).at({}),this.calc=new cs(o).at({}),this.calc.val=this}withTag(t){const n=this.calc.with(t);return n.val??(n.val=Object.assign(new this.constructor(this.cache.keys),this,{cache:this.cache.with(t),calc:n}))}gather(t){return this._gather(this.cache.with(t)).pre}compute(t){return this._compute(t,this.cache)}_gather(t){if(t.val)return t.val;const n=this.nodes.entries(t.id).flatMap(({tag:o,value:i})=>i.op==="reread"?this._gather(t.with(i.tag)).pre:[this.markGathered(t.tag,o,i,this._compute(i,t))]);return t.val={pre:n}}_compute(t,n){const o=(r,a,l,d)=>Object.freeze({val:r,meta:this.computeMeta(t,r,a,l,d)}),{op:i}=t;switch(i){case"const":return o(t.ex,[],[]);case"sum":case"prod":case"min":case"max":case"sumfrac":{const r=t.x.map(a=>this._compute(a,n));return o(We[i](rn(r)),r,[])}case"thres":case"match":case"lookup":{const r=t.br.map(c=>this._compute(c,n)),a=Ms[i](rn(r),t.ex),l=[...Array(t.x.length)],d=l[a]=this._compute(t.x[a],n);return o(d.val,l,r)}case"subscript":{const r=this._compute(t.br[0],n);return o(t.ex[r.val],[],[r])}case"vtag":return o(n.tag[t.ex]??"",[],[]);case"tag":{const r=n.with(t.tag),a=this._compute(t.x[0],r);return o(a.val,[a],[],r.tag)}case"dtag":{const r=t.br.map(d=>this._compute(d,n)),a=n.with(Object.fromEntries(r.map((d,c)=>[t.ex[c],d.val]))),l=this._compute(t.x[0],a);return o(l.val,[l],r,a.tag)}case"read":{const r=n.with(t.tag),a=this._gather(r),{pre:l}=a,d=t.ex??this.defaultAccu(r.tag)??"unique";if(d!==t.ex&&(t={...t,ex:d}),a[d])return a[d];if(oc()&&d==="unique"&&l.length!==1)throw new Error(`Ill-form read for ${ic(r.tag)}`);const c=We[d](rn(l));return a[d]=o(c,l,[],r.tag)}case"custom":{const r=t.x.map(a=>this._compute(a,n));return o(Cs[t.ex].calc(rn(r)),r,[])}default:Nt(i)}}defaultAccu(t){}markGathered(t,n,o,i){return i}computeMeta(t,n,o,i,r){}toDebug(){throw new Error("not implemented")}};function rd(e,t,n){function o(a,l){if(a.val)return a.val;const d=n(a.tag);return a.val=d?[gn(d,l)]:t.nodes.subset(a.id).flatMap(c=>c.op!=="reread"?r(c,a):o(a.with(c.tag),l)),a.val}function i(a,l){return a.every(d=>d.op==="const")?le(We[l](a.map(d=>d.ex))):{op:l,x:a,br:[]}}function r(a,l){const{op:d}=a;switch(d){case"const":return a;case"read":{const c=l.with(a.tag),u=a.ex??t.defaultAccu(c.tag)??"unique",p=o(c,u);return u==="unique"?p[0]??le(void 0):i(p,u)}case"sum":case"prod":case"min":case"max":case"sumfrac":{const c=a.x.map(u=>r(u,l));return i(c,d)}case"thres":case"match":case"lookup":{const c=a.br.map(u=>r(u,l));if(c.every(u=>u.op==="const")){const u=c.map(h=>h.ex),p=Ms[a.op](u,a.ex);return r(a.x[p],l)}return{...a,x:a.x.map(u=>r(u,l)),br:c}}case"subscript":{const c=r(a.br[0],l);return c.op==="const"?le(a.ex[c.ex]):{...a,br:[c]}}case"vtag":return le(l.tag[a.ex]??"");case"tag":return r(a.x[0],l.with(a.tag));case"dtag":{const c=a.br.map(p=>r(p,l));if(c.some(p=>p.op!=="const"))throw new Error("Dynamic tag must be resolvable during detachment");const u=l.with(Object.fromEntries(c.map((p,h)=>[a.ex[h],p.ex])));return r(a.x[0],u)}case"custom":return{...a,x:a.x.map(c=>r(c,l))};default:Nt(d)}}return e.map(a=>r(a,new cs(t.cache.keys).at({})))}function Ht(e,t){const n=new Map;function o(i){const r=n.get(i);if(r)return r;const a=i,l=Un(i.x,o),d=Un(i.br,o);(i.x!==l||i.br!==d)&&(i={...i,x:l,br:d});const c=t(i,a);return n.set(i,c),c}return Un(e,o)}function rs(e,t){const n=new Set;function o(i){n.has(i)||(t(i,o),n.add(i))}e.forEach(o)}function Un(e,t){const n=e.map(t);return e.every((o,i)=>o===n[i])?e:n}const Es={arithmetic:We,branching:Ms};class ld extends Ec{constructor(t,n=ic,o=()=>!0){super(t.cache.keys),this.gathering=new Set,this.nodes=t.nodes,this.tagStr=n,this.filter=o,this.defaultAccu=i=>t.defaultAccu(i),this.cache=this.cache.with(t.cache.tag)}withTag(t){throw new Error("Unimplemented")}_gather(t){if(this.gathering.has(t))throw new Error(`Loop detected for ${this.tagStr(t.tag)}`);this.gathering.add(t);const n=this.__gather(t);return this.gathering.delete(t),n}__gather(t){if(t.val)return t.val;const n=this.nodes.entries(t.id).flatMap(({tag:o,value:i})=>i.op==="reread"?this._gather(t.with(i.tag)).pre.map(r=>{const a=`${this.tagStr(o)} <= ${this.tagStr(i.tag)} : ${r.meta.readSeq}`;return Object.freeze({...r,meta:{...r.meta,readSeq:a}})}):[this.markGathered(t.tag,o,i,this._compute(i,t))]);return t.val={pre:n}}_compute(t,n){try{return super._compute(t,n)}catch(o){return Object.freeze({val:NaN,meta:{formula:`${o}`,deps:[],omitted:[],val:NaN,x:[],br:[],comp:"ERR",pivot:!0,toJSON:io}})}}markGathered(t,n,o,i){const r=`${this.tagStr(n)} <- ${this.tagStr(t)}`;return{...i,meta:{...i.meta,readSeq:r,pivot:!0}}}computeMeta(t,n,o,i,r){let a,l;const d=o.filter(m=>m).map(m=>m.meta),c=i.map(m=>m.meta),u=[],p=t.op==="read"?t.ex:t.op,h=[];if(p in We){const m=We[p]([]);for(const g of[...c,...d])g.val!==m||this.filter(g)?u.push(g):h.push(g)}else u.push(...c,...d);switch(t.op){case"const":a=oo(t.ex);break;case"read":l=`gather ${d.length} node(s)`,l+=` matching ${this.tagStr(r,t.ex)}`,l+=` (for ${this.tagStr(t.tag)})`,h.length&&(l+=` <${h.length} omitted>`),a=`${this.tagStr(t.tag)}`;break;default:{const m=[];t.ex&&t.op!=="subscript"&&m.push(JSON.stringify(t.ex)),t.tag&&m.push(this.tagStr(t.tag)),m.push(...u.map(g=>g.comp)),h.length&&m.push(`<${h.length} omitted>`),a=`${t.op}(`+m.join(", ")+")"}}return h.push(...u.flatMap(m=>m.pivot?[]:m.omitted)),Object.freeze({formula:`[${oo(n)}] ${l??a}`,deps:[...new Set(u.flatMap(m=>m.pivot?[m]:m.deps))],omitted:[...new Set(h)],val:n,x:d,br:c,comp:a,pivot:t.op==="read",toJSON:io})}}const oo=e=>typeof e=="string"?`"${e}"`:e.toString();function io(){const{formula:e,readSeq:t,deps:n}=this,o={readSeq:t,formula:e,deps:n};return o.readSeq||delete o.readSeq,o.deps.length||delete o.deps,Object.keys(o).length===1?o.formula:o}const{arithmetic:ao}=Es;function dd(e){return e=ud(e),e=pd(e),e=hd(e),e}function ud(e){return Ht(e,t=>{const{op:n}=t;switch(n){case"sum":case"prod":case"min":case"max":if(t.x.length===1)return t.x[0];if(t.x.some(o=>o.op===n)){const o=t.x.flatMap(i=>i.op===n?i.x:[i]);return{...t,x:o}}}return t})}function pd(e){return Ht(e,t=>{const{op:n}=t;switch(n){case"sum":case"prod":case"min":case"max":{const o=t.x.filter(i=>i.op==="const");if(o.length>1){const i=t.x.filter(a=>a.op!=="const"),r=ao[n](o.map(a=>a.ex));return r===ao[n]([])?{...t,x:i}:{...t,x:[le(r),...i]}}}}return t})}function hd(e){const t=new Map,n=new Cc;return Ht(e,o=>{const{op:i}=o,r=o.x.map(c=>t.get(c)),a=o.br.map(c=>t.get(c));let l;switch(i){case"read":{const c=Object.keys(o.tag).sort();l=[i,o.ex,...c,...c.map(u=>o.tag[u])];break}case"sum":case"prod":case"min":case"max":l=[i,...r.sort()];break;case"thres":case"custom":case"sumfrac":case"lookup":case"subscript":case"const":l=[i,o.ex,...r,...a];break;case"match":l=[i,o.ex,...r,...a.sort()];break;default:Nt(i)}const d=n.ref(l);return"value"in d?d.value:(d.value=o,t.set(o,t.size),o)})}const{arithmetic:md,branching:fd}=Es;function gd(e,t,n,o,i){const r=new yd(e,o,t,n);for(;r.progress;)r.progress=!1,xd(r),bd(r,1),wd(r),$d(r,i);return r.nodes=dd(r.nodes),r}var ke,ze,Ve,Oe,Pe;class yd{constructor(t,n,o,i){Te(this,ke);Te(this,ze);Te(this,Ve);Te(this,Oe);Te(this,Pe);this.progress=!0,Y(this,ke,t),this.minimum=n,Y(this,ze,o),this.cat=i}get nodes(){return we(this,ke)}set nodes(t){we(this,ke)!==t&&(this.progress=!0,Y(this,ke,t),Y(this,Oe,Y(this,Pe,void 0)))}get candidates(){return we(this,ze)}set candidates(t){this.candidates!==t&&(this.progress=!0,Y(this,ze,t),Y(this,Ve,Y(this,Oe,Y(this,Pe,void 0))))}get cndRanges(){return we(this,Ve)??Y(this,Ve,this.candidates.map(ls))}set cndRanges(t){Y(this,Ve,t)}get nodeRanges(){return we(this,Oe)??Y(this,Oe,Tc(this.nodes,this.cat,this.cndRanges))}get monotonicities(){return we(this,Pe)??Y(this,Pe,_d(this.nodes.slice(0,this.minimum.length),this.cat,this.nodeRanges))}}ke=new WeakMap,ze=new WeakMap,Ve=new WeakMap,Oe=new WeakMap,Pe=new WeakMap;function xd(e){const{nodes:t,nodeRanges:n}=e,o=Ht(t,(i,r)=>{const a=n.get(r);if(a.min===a.max)return r.op==="const"?i:le(a.min);switch(r.op){case"thres":{const[l,d]=r.br.map(c=>n.get(c));if(l.min>=d.max)return i.x[0];if(l.max<d.min)return i.x[1];break}case"min":{const l=i.x.filter((d,c)=>n.get(r.x[c]).min<=a.max);if(l.length===1)return l[0];if(l.length!==i.x.length)return $r(...l);break}case"max":{const l=i.x.filter((d,c)=>n.get(r.x[c]).max>=a.min);if(l.length===1)return l[0];if(l.length!==i.x.length)return os(...l);break}case"match":case"lookup":if(i.br.every(l=>l.op==="const")){const l=i.br.map(d=>d.ex);return i.x[fd[r.op](l,r.ex)]}break;case"subscript":if(i.br[0].op==="const")return le(i.ex[i.br[0].ex]);break}return i});e.nodes=o}function bd(e,t){const{nodeRanges:n,minimum:o,cat:i}=e,r=[...e.candidates],a=[...e.cndRanges],l=[],d=[];let c=!1;if(e.nodes.forEach((p,h)=>{if(h<o.length){if(o[h]>n.get(p).min)c=!0;else if(h>=t)return;d.push(o[h])}l.push(p)}),d.length!=o.length&&(e.nodes=l,e.minimum=d),!c)return;let u=!1;r.forEach((p,h)=>{const m=a[h],g=p.filter($=>{a[h]=ls([$]);const C=Tc(l,i,a);return d.every((S,E)=>C.get(l[E]).max>=S)});g.length!=p.length?(r[h]=g,a[h]=ls(g),u=!0):a[h]=m}),u&&(e.candidates=r,e.cndRanges=a)}function $d(e,t){const n=[...e.monotonicities],o=e.candidates.map(c=>c.map(u=>{const p={incomp:[],inc:{},c:u};for(const[h,m]of n)m.inc?p.inc[h]=u[h]??0:m.dec?p.inc[h]=-(u[h]??0):p.incomp.push(u[h]??0);return p})),i=o[0][0];if(i===void 0)return;const r=Object.keys(i.inc),a=[...r].reverse(),l=!!i.incomp.length,d=o.map(c=>{const u=new Cc;return l?c.forEach(p=>{const h=u.ref(p.incomp);h.value?h.value.push(p):h.value=[p]}):u.ref([]).value=c,[...u.values()].flatMap(p=>(p.sort(({inc:h},{inc:m})=>{const g=a.find($=>h[$]!==m[$]);return g===void 0?0:m[g]-h[g]}),p.filter(({inc:h},m)=>{let g=0;for(let $=0,C=m-t;$<=C+g;$++){const S=p[$].inc;if(r.every(E=>S[E]>=h[E])&&++g>=t)return!1}return!0})))});d.some((c,u)=>c.length!=e.candidates[u].length)&&(e.candidates=d.map(c=>c.map(u=>u.c)))}const me=Symbol();function wd(e){const{nodes:t,cat:n,candidates:o}=e,i=new Map;rs(t,(c,u)=>{if(c.x.forEach(u),c.br.forEach(u),c.br.length)return;const p=c.x.map(m=>i.get(m));if(p.some(m=>!m))return;let h;switch(c.op){case"sum":{h={[me]:p.reduce((m,g)=>m+g[me],0)};for(const m of p)for(const[g,$]of Object.entries(m))h[g]=(h[g]??0)+$;break}case"prod":{const m=c.x.findIndex($=>$.op!=="const");if(c.x.find(($,C)=>$.op!=="const"&&C!==m))return;h=m!==-1?{...p[m]}:{[me]:1};const g=p.reduce(($,C,S)=>S===m?$:$*C[me],1);g!=1&&(Object.keys(h).forEach($=>h[$]*=g),h[me]*=g);break}case"read":h={[c.tag[n]]:1,[me]:0};break;case"const":if(typeof c.ex!="number")return;h={[me]:c.ex};break;default:return}i.set(c,h)});const r=new Map;if(rs(t,(c,u)=>{const p=i.get(c);p&&Object.keys(p).length?r.set(c,p):(c.x.forEach(u),c.br.forEach(u))}),![...r.keys()].some(c=>{if(c.op==="const"||c.op==="read")return!1;if(c.op==="sum"&&c.x.length===2){if(c.x[0].op==="const"&&c.x[1].op==="read")return!1;if(c.x[1].op==="const"&&c.x[0].op==="read")return!1}return!0}))return;let l=new Map([...r.values()].map(c=>{const u=Object.keys(c).sort();return u.length===1&&c[u[0]]===1?[c,u[0]]:[c,""+u.flatMap(p=>[p,c[p]]).join("")]}));if(!oc()){const c=new Map([...l.values()].map((u,p)=>[u,`c${p}`]));l=new Map([...l].map(([u,p])=>[u,c.get(p)]))}const d=new Map;for(const[c,u]of l){const p=gn({[n]:u});d.set(c,c[me]!==0?ac(c[me],p):p)}e.candidates=o.map(c=>c.map(u=>{const p={id:u.id};return l.forEach((h,m)=>{h in p||(p[h]=Object.entries(m).reduce((g,[$,C])=>g+(u[$]??0)*C,0))}),p})),e.nodes=Ht(t,(c,u)=>{const p=r.get(u);return p?d.get(p):c})}function ls(e){const t=e.values(),n=t.next().value;if(!n)return{};const o=Object.fromEntries(Object.entries(n).map(([i,r])=>[i,{min:r,max:r}]));for(const i of t){for(const[r,a]of Object.entries(o)){const l=i[r]??0;a.min>l&&(a.min=l),a.max<l&&(a.max=l)}for(const[r,a]of Object.entries(i))r in o||(o[r]={min:Math.min(0,a),max:Math.max(0,a)})}return o}function Tc(e,t,n){const o=new Map;return rs(e,(i,r)=>{i.x.forEach(r),i.br.forEach(r);const a=i.x.map(p=>o.get(p)),l=a.map(p=>p.min),d=a.map(p=>p.max);function c(p,[h,m]){const g=md[p],$=[g([h.min,m.min]),g([h.min,m.max]),g([h.max,m.min]),g([h.max,m.max])];return{min:Math.min(...$),max:Math.max(...$)}}let u;switch(i.op){case"const":typeof i.ex=="number"?u={min:i.ex,max:i.ex}:u={min:NaN,max:NaN};break;case"sum":u={min:l.reduce((p,h)=>p+h,0),max:d.reduce((p,h)=>p+h,0)};break;case"prod":u={min:1,max:1},u=a.reduce((p,h)=>c(i.op,[p,h]),u);break;case"min":case"max":u={min:Math[i.op](...l),max:Math[i.op](...d)};break;case"match":case"thres":u={min:Math.min(...l),max:Math.max(...d)};break;case"sumfrac":l[0]+l[1]>0||d[0]+d[1]<0?u=c(i.op,a):u={min:NaN,max:NaN};break;case"read":{u={min:0,max:0};for(const{[i.tag[t]]:p}of n)p&&(u.min+=p.min,u.max+=p.max);break}case"subscript":{if(typeof i.ex[0]!="number")u={min:NaN,max:NaN};else{u={min:1/0,max:-1/0};let{min:p,max:h}=o.get(i.br[0]);p=Math.max(0,Math.ceil(p)),h=Math.min(h,i.ex.length-1);for(let m=p;m<=h;m++){const g=i.ex[m];u.min>g&&(u.min=g),u.max<g&&(u.max=g)}u.min>u.max&&(u={min:NaN,max:NaN})}break}case"lookup":isNaN(l[0])&&isNaN(d[0])&&(l.splice(0,1),d.splice(0,1)),u={min:Math.min(...l),max:Math.max(...d)};break;case"custom":u=Cs[i.ex].range(a);break;default:Nt(i)}o.set(i,u)}),o}function _d(e,t,n){const o=new Map,i=[],r=new Map;function a(l,d){o.has(l)||o.set(l,{inc:!0,dec:!0});const c=o.get(l);if(d&&c.dec)c.dec=!1;else if(!d&&c.inc)c.inc=!1;else return;i.push({node:l,inc:d})}for(e.forEach(l=>a(l,!0));i.length;){const{node:l,inc:d}=i.pop();switch(l.op){case"read":r.set(l.tag[t],o.get(l));break;case"const":break;case"sum":case"min":case"max":l.x.forEach(c=>a(c,d));break;case"thres":{l.x.forEach(p=>a(p,d));const c=n.get(l.x[0]),u=n.get(l.x[1]);c.max>u.min&&(a(l.br[0],d),a(l.br[1],!d)),c.min<u.max&&(a(l.br[0],!d),a(l.br[1],d));break}case"sumfrac":{const[c,u]=l.x.map(p=>n.get(p));u.min<0&&a(l.x[0],!d),u.max>0&&a(l.x[0],d),c.min<0&&a(l.x[1],d),c.max>0&&a(l.x[1],!d);break}case"prod":{const c=n.get(l);if(c.min<0&&c.max>0)l.x.forEach(u=>a(u,!0)),l.x.forEach(u=>a(u,!1));else{const u=d===c.max>0;l.x.forEach(p=>a(p,u===n.get(p).max>0))}break}case"match":case"lookup":l.x.forEach(c=>a(c,d)),l.br.forEach(c=>a(c,!0)),l.br.forEach(c=>a(c,!1));break;case"subscript":{const{br:[c],ex:u}=l;if(typeof u[0]=="number"){let{min:p,max:h}=n.get(c);p=Math.max(0,Math.ceil(p)),h=Math.min(h,u.length-1);for(let m=p+1;m<=h;m++)if(u[m-1]<u[m]){a(c,d);break}for(let m=p+1;m<=h;m++)if(u[m-1]>u[m]){a(c,!d);break}}else a(c,!0),a(c,!1);break}case"custom":Cs[l.ex].monotonicity(l.x.map(c=>n.get(c))).forEach((c,u)=>{c.inc||a(l.x[u],!d),c.dec||a(l.x[u],d)});break;default:Nt(l)}}return r}function ds(e){const[t,n]=wr();return f.useEffect(()=>e.followAny((o,i)=>i==="update"&&n()),[e,n]),t}function te(e){const{database:t}=O();return ps(t.charOpts,e)}const{arithmetic:kd}=Es;let vd=class extends Ec{computeMeta({op:t,ex:n,tag:o},i,r,a,l){let d=r.filter(m=>!!m);const c=Cd(d,a);function u(m){return Object.freeze(l&&!m.tag?{tag:l,...m}:m)}function p(m,g){return u({op:m,ops:g,...c})}function h(m,g){let{meta:$}=m;return g!=null&&g.some(C=>!$.usedCats.has(C))&&($={...$,usedCats:new Set([...$.usedCats,...g])}),u($.conds===c.conds?$:{...$,...c})}if(t==="read"&&(l==null?void 0:l.qt)==="cond"){const{src:m,dst:g,sheet:$,q:C}=l;m&&$&&C&&(c.conds=$n(c.conds,{[g??"All"]:{[m]:{[$]:{[C]:i}}}}))}switch(t==="read"&&n!=="unique"&&([t,n]=[n,void 0]),t){case"sum":case"prod":case"min":case"max":case"sumfrac":if(d.length>1){const m=kd[t]([]);d=d.filter(g=>g.val!==m)}return d.length===1?h(d[0]):p(d.length?t:"const",d);case"const":case"subscript":return p("const",[]);case"vtag":return c.usedCats=new Set([n]),p("const",[]);case"match":case"thres":case"lookup":case"read":return h(d[0]);case"tag":return h(d[0],Object.keys(o));case"dtag":return h(d[0],n);case"custom":return p(n,d);default:cc(t)}}markGathered(t,n,o,i){const{val:r}=i,a={...i.meta};let l=!1;const d=new Set([...a.usedCats,...Object.keys(n)]);return a.usedCats.size!==d.size&&(a.usedCats=d,l=!0),l?{val:r,meta:Object.freeze(a)}:i}listFormulas(t){return this.gather(t.tag).filter(n=>n.val).map(({val:n,meta:o})=>_r.withTag(o.tag)[n])}listCondFormulas(t){return this.listFormulas(t).map(n=>this.compute(n).meta.conds).reduce($n,{})}};function Cd(e,t){var a;const n=[...e.map(l=>l.meta),...t.map(l=>l.meta)];let o={},i=new Set;for(const l of n)o=$n(o,l.conds),l.usedCats.forEach(d=>i.add(d));const r=i.size;return i=((a=n.find(l=>l.usedCats.size===r))==null?void 0:a.usedCats)??i,{usedCats:i,conds:o}}function $n(e,t){if(e===t)return e;if(typeof e!="object")throw new Error(`cannot merge ${e} and ${t}`);if(Object.keys(t).length>Object.keys(e).length&&([e,t]=[t,e]),!Object.keys(t).length)return e;let n=!1;const o={...e};for(const[i,r]of Object.entries(t)){const a=o[i],l=i in o?$n(a,r):r;a!==l&&(o[i]=l,n=!0)}return Object.freeze(n?o:e)}function Sd(e){const t=new Set(e);return n=>!Dd(n,t)}function Dd(e,t){const n=e.formula.match(/(\S+) (\S+) common.count/);if(!n)return!1;const[,o,i]=n;return i==="own"&&t.has(o)}class Md extends vd{toDebug(){return new ld(this,kr,Sd([...Ot,...Pt]))}defaultAccu(t){var i,r,a,l;const{qt:n,q:o}=t;if(!(!n||!o))switch(t.et){case"own":case"target":return(r=(i=rc[n])==null?void 0:i[o])==null?void 0:r.accu;case"enemy":return(l=(a=vr[n])==null?void 0:a[o])==null?void 0:l.accu;case"team":if(n==="common"&&o==="count")return"sum";throw new Error("non-explicit team value accumulator")}}}function mn(e,...t){return t.map(({tag:n,value:o})=>({tag:{...n,preset:e},value:o}))}function Ic(e,...t){return t.map(({tag:n,value:o})=>({tag:{...n,src:e},value:o}))}function Rc(e){const{lvl:t,promotion:n,basic:o,dodge:i,special:r,chain:a,assist:l,core:d,mindscape:c}=z.char,{char:u,iso:p,[e.key]:h}=G.withAll("sheet",[]);return[u.reread(h),p.reread(h),t.add(e.level),o.add(e.basic),i.add(e.dodge),r.add(e.special),a.add(e.chain),l.add(e.assist),d.add(e.core),n.add(e.promotion),c.add(e.mindscape),yn.base.crit_.add(.05),yn.base.crit_dmg_.add(.5)]}function Ed(e,t,n,o){return[G.sheet("agg").reread(G.sheet("wengine")),z.common.count.sheet(e).add(1),z.wengine.lvl.add(t),z.wengine.modification.add(n),z.wengine.phase.add(o)]}function Ac(e,t){const{common:{count:n},initial:o}=Dr(rc,{sheet:"disc",et:"own"});return[G.sheet("agg").reread(G.sheet("disc")),G.withTag({sheet:"disc",qt:"initial"}).reread(G.sheet("dyn")),...Object.entries(e).map(([i,r])=>Mr(o,i).sheet("dyn").add(r)),...Object.entries(t).map(([i,r])=>n.sheet(i).add(r))]}function qc(e){const t=G.with("et","team"),{own:n,enemy:o,teamBuff:i,notOwnBuff:r}=G.sheet("agg").withAll("et",[]);return[e.map(a=>G.withTag({et:"target",dst:a}).reread(G.withTag({et:"own",dst:null,src:a}))),e.flatMap(a=>{const l=n.with("src",a);return e.map(d=>l.reread(i.withTag({dst:a,src:d,name:null})))}),e.flatMap(a=>{const l=n.with("src",a);return e.filter(d=>d!==a).map(d=>l.reread(r.withTag({dst:a,src:d,name:null})))}),e.map(a=>o.reread(G.withTag({et:"enemyDeBuff",dst:null,src:a,name:null}))),e.flatMap((a,l)=>{const{stackIn:d,stackTmp:c}=G.withAll("qt",[]),u=G.withTag({src:a,et:"own"});return[u.with("qt","stackTmp").add(Cr(d,0,l+1)),u.with("qt","stackOut").add(Sr(c.max.with("et","team"),l+1,d))]}),e.map(a=>t.add(G.withTag({src:a,et:"own"})))].flat()}function zc(e){const t=lc(xn,e);return new Md(xn,Er,t)}function Td(e){return new cd(xn,lc(xn,e))}var Rt={},co;function Id(){if(co)return Rt;co=1;var e=hs();Object.defineProperty(Rt,"__esModule",{value:!0}),Rt.default=void 0;var t=e(ms()),n=fs(),o=(0,t.default)((0,n.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");return Rt.default=o,Rt}var Rd=Id();const ln=gs(Rd);function Ad({formulasRead:e,buffsRead:t}){var d;const n=f.useContext(Kt),o=(d=f.useContext(Ne))==null?void 0:d.withTag(n),i=o==null?void 0:o.toDebug(),[r,a]=f.useState(!1),l=c=>(u,p)=>{a(p?c:!1)};return s(W,{bgt:"dark",children:y(V,{children:[y(on,{expanded:r==="formulas",onChange:l("formulas"),slotProps:{transition:{unmountOnExit:!0}},children:[s(cn,{expandIcon:s(ln,{}),children:"All target listings"}),s(an,{children:s(is,{children:o&&i&&r==="formulas"&&o.listFormulas(e).map((c,u)=>{const p=o.compute(c),h=i.compute(c).meta,m=c.tag.name||c.tag.q;return y(ye,{children:[y(R,{children:[m,": ",p.val]}),y(on,{children:[y(cn,{expandIcon:s(ln,{}),children:["debug for ",m]}),y(an,{children:["conds:",s(re,{text:fe(p.meta.conds)}),"read:",s(re,{text:fe(c)}),"formula:",s(re,{text:fe(h)})]})]})]},`${m}${u}`)})})})]}),y(on,{expanded:r==="buffs",onChange:l("buffs"),slotProps:{transition:{unmountOnExit:!0}},children:[s(cn,{expandIcon:s(ln,{}),children:"All target buffs"}),s(an,{children:s(is,{children:o&&i&&r==="buffs"&&o.listFormulas(t).map((c,u)=>{const p=o.compute(c),h=i.compute(c).meta,m=c.tag.name||c.tag.q;return y(ye,{children:[y(R,{children:[m,": ",p.val]}),y(on,{children:[y(cn,{expandIcon:s(ln,{}),children:["debug for ",m]}),y(an,{children:["conds:",s(re,{text:fe(p.meta.conds)}),"read:",s(re,{text:fe(c)}),"formula:",s(re,{text:fe(h)})]})]})]},`${m}${u}`)})})})]})]})})}function qd(){var u;const e=f.useContext(Kt),t=(u=f.useContext(Ne))==null?void 0:u.withTag(e),n=t==null?void 0:t.toDebug(),{read:o,setRead:i}=f.useContext(ys),r=o&&(t==null?void 0:t.compute(o)),a=o&&(n==null?void 0:n.compute(o)),l=(o==null?void 0:o.tag.name)||(o==null?void 0:o.tag.q),d=a==null?void 0:a.meta,c=d&&fe(d);return s(xs,{open:!!o,onClose:()=>i(void 0),children:y(W,{bgt:"dark",children:[s(Bt,{title:`Debug formula for ${l}`,action:s(Ke,{onClick:()=>i(void 0),children:s(Sn,{})})}),s(V,{children:s(W,{bgt:"normal",children:s(V,{children:y(is,{gap:1,children:["Computed value: ",r==null?void 0:r.val,s(ee,{}),s(R,{variant:"h6",children:"Read"}),s(re,{text:fe(o)}),s(ee,{}),s(R,{variant:"h6",children:"Calculator Tag"}),s(re,{text:JSON.stringify(t==null?void 0:t.cache.tag)}),s(ee,{}),s(R,{variant:"h6",children:"Tag Context"}),s(re,{text:JSON.stringify(e)}),s(ee,{}),s(R,{variant:"h6",children:"Conditionals"}),s(re,{text:fe(r==null?void 0:r.meta.conds)}),s(ee,{}),s(R,{variant:"h6",children:"Formula"}),s(re,{text:c||""})]})})})})]})})}function Vc({document:e,bgt:t="normal",collapse:n=!1,typoVariant:o="body1"}){switch(e.type){case"fields":return s(zd,{fieldsDocument:e,bgt:t});case"text":return n?s(Vd,{textDocument:e,typoVariant:o}):s(Oc,{textDocument:e,typoVariant:o});case"conditional":return s(Tr,{conditional:e.conditional,bgt:t});default:return null}}function zd({fieldsDocument:e,bgt:t="normal"}){return y(W,{bgt:t,children:[e.header&&s(Ar,{header:e.header,hideDivider:e.fields.length===0}),s(qr,{bgt:t,fields:e.fields})]})}function Oc({textDocument:e,typoVariant:t}){const n=f.useContext(Ne),o=f.useContext(Kt);return n?s(R,{variant:t,children:Rr(e.text,n.withTag(o))}):null}function Vd({textDocument:e,typoVariant:t}){const[n,o]=f.useState(!1),[i,r]=f.useState(!1);return y(M,{sx:{position:"relative"},children:[!n&&s(M,{sx:{pointerEvents:"none",position:"absolute",mx:"auto",width:"100%",display:"flex",justifyContent:"center",height:"100%",alignItems:"flex-end",zIndex:"10",transition:"transform 0.3s ease",transform:i?"translate(0,-5px)":void 0},children:s(Ir,{})}),s(vs,{onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),collapsedSize:55,onClick:()=>o(a=>!a),in:n,sx:{cursor:"pointer",position:"relative",maskImage:n?void 0:"linear-gradient(to bottom, black 0%, transparent 100%)","&:hover":{maskImage:n?void 0:"linear-gradient(to bottom, black 50%, transparent 100%)"}},children:s(Oc,{textDocument:e,typoVariant:t})})]})}function Od({numWorkers:e,setNumWorkers:t}){const n=navigator.hardwareConcurrency||8;return y(ie,{title:`${e} Workers`,children:[s(L,{disabled:!0,children:"Scales with available CPU cores."}),zr(1,n).map(o=>y(L,{onClick:()=>t(o),children:[o," Workers"]},o))]})}const Ts=Vr(ne.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever");function Pd({levelLow:e,levelHigh:t,setLow:n,setHigh:o,setBoth:i,dark:r=!1,disabled:a=!1,showLevelText:l=!1}){const{t:d}=be("wengine"),[c,u]=f.useState(e),[p,h]=f.useState(t),m=f.useCallback((g,$)=>{if(typeof $=="number")throw new TypeError;const[C,S]=$;u(C),h(S)},[u,h]);return f.useEffect(()=>u(e),[u,e]),f.useEffect(()=>h(t),[h,t]),y(M,{sx:{width:"100%",display:"flex",alignItems:"center",bgcolor:r?"contentNormal.main":"contentLight.main",overflow:"visible"},children:[y(M,{sx:{width:"max-content",height:32,display:"flex"},children:[l?y(Lt,{children:[s("span",{style:{padding:"0 1em",width:"max-content",borderRadius:"4px 0 0 4px",display:"flex",justifyContent:"center",alignItems:"center",color:"rgba(255,255,255,0.9)",backgroundColor:"rgb(30,120,200)"},children:d("levelSliderTitle")}),s(ee,{orientation:"vertical",flexItem:!0})]}):void 0,s(Gs,{value:c,onChange:g=>n(Fs(g??0,0,t)),sx:{px:1,width:"3em"},inputProps:{sx:{textAlign:l?"right":"center"}},disabled:a})]}),s(Or,{sx:{flex:"0 1 100%",mx:2},getAriaLabel:()=>"Wengine Level Range",value:[c,p],onChange:m,onChangeCommitted:(g,$)=>Array.isArray($)&&i($[0],$[1]),valueLabelDisplay:"auto",min:0,max:bn,step:1,marks:!0,disabled:a}),s(Gs,{value:p,onChange:g=>o(Fs(g??0,e,bn)),sx:{px:1,flex:"0 0 3em"},inputProps:{sx:{textAlign:"center"}},disabled:a})]})}function jd(e){const t={},n={};return e.forEach(({setKey:o,mainStatKey:i,substats:r,level:a,rarity:l})=>{t[o]=(t[o]??0)+1,n[i]=(n[i]??0)+dc(l,i,a),r.forEach(({key:d,upgrades:c})=>{!d||!c||(n[d]=(n[d]??0)+uc(d,l)*c)})}),Ac(n,t)}function Pc({character:e,charOpt:t,wengineId:n,discIds:o,children:i}){const r=Wd(e,n,o),a=f.useMemo(()=>zc([...qc([e.key]),...r,yn.common.critMode.add(t.critMode),ue.common.lvl.add(t.enemyLvl),ue.common.def.add(t.enemyDef),ue.common.isStunned.add(t.enemyisStunned?1:0),ue.common.stun_.add(t.enemyStunMultiplier/100),ue.common.unstun_.add(1),...t.conditionals.flatMap(({sheet:l,src:d,dst:c,condKey:u,condValue:p})=>mn("preset0",pc(l,d,c)(u,p))),...t.bonusStats.flatMap(({tag:l,value:d})=>mn("preset0",{tag:{...l,src:e.key,sheet:"agg",et:"own"},value:le(as(d,l.q??""))})),...t.enemyStats.flatMap(({tag:l,value:d})=>mn("preset0",{tag:{...l,qt:"common",et:"enemy",sheet:"agg"},value:le(as(d,l.q??""))}))]),[r,t,e.key]);return s(Ne.Provider,{value:a,children:i})}function Wd(e,t,n){const o=hc(t),i=mc(n),r=f.useMemo(()=>o?Ed(o.key,o.level,o.modification,o.phase):[],[o]),a=f.useMemo(()=>i?jd(Object.values(i).filter(Pr)):[],[i]);return f.useMemo(()=>e?Ic(e.key,...Rc(e),...r,...a):[],[e,r,a])}function jc({character:e,conditionals:t,children:n}){const o=f.useMemo(()=>zc([...qc([e.key]),...Ic(e.key,...Rc(e),...Ac({},Ce(Pt,()=>4)),G.sheet("agg").reread(G.sheet("wengine")),z.wengine.lvl.add(60),z.wengine.modification.add(5),z.wengine.phase.add(1),...Ot.map(i=>z.common.count.sheet(i).add(1))),yn.common.critMode.add("avg"),ue.common.lvl.add(100),ue.common.def.add(900),ue.common.isStunned.add(0),ue.common.stun_.add(1.5),ue.common.unstun_.add(1),...t.flatMap(({sheet:i,src:r,dst:a,condKey:l,condValue:d})=>mn("preset0",pc(i,r,a)(l,d)))]),[e,t]);return s(Ne.Provider,{value:o,children:n})}function Nd(e){const{attribute:t}=e;if(t)return t}function Kd(e){const{q:t}=e;return["standardDmg","anomalyDmg"].includes(t)}function Bd(e){const{damageType1:t,damageType2:n}=e,o=[];return Kd(e)?(t&&o.push(t),n&&o.push(n),o):[]}const De={basic:"Basic",dash:"Dash",dodgeCounter:"Dodge Counter",special:"Special",exSpecial:"EX Special",chain:"Chain",ult:"Ultimate",quickAssist:"Quick Assist",defensiveAssist:"Defensive Assist",evasiveAssist:"Evasive Assist",assistFollowUp:"Assist Follow Up",anomaly:"Anomaly",disorder:"Disorder",aftershock:"Aftershock",elemental:"Elemental"},Wc=["crit_","crit_dmg_","impact","pen","pen_","enerRegen","anomProf","anomMas"].map(e=>{if(jr.includes(e)){const t={...z.final.dmg_.tag,attribute:e.slice(0,-5)};return{title:s(ge,{statKey:e}),fieldRef:t}}return e==="crit_"?{fieldRef:z.common.cappedCrit_.tag,title:s(ge,{statKey:e})}:{fieldRef:z.final[e].tag,title:s(ge,{statKey:e})}});Wc.push(...Ae.map(e=>({fieldRef:{et:"own",qt:"formula",q:"standardDmg",attribute:e,name:"standardDmgInst"},title:y(ve,{color:e,children:[hn[e]," Damage"]})})),...Ae.flatMap(e=>fc.map(t=>({fieldRef:{et:"own",qt:"formula",q:"standardDmg",attribute:e,damageType1:t,name:"standardDmgInst"},title:y(ve,{color:e,children:[hn[e]," ",De[t]," Damage"]})}))),...Ae.map(e=>({fieldRef:{et:"own",qt:"formula",q:"anomalyDmg",attribute:e,damageType1:"anomaly",name:"anomalyDmgInst"},title:y(ve,{color:e,children:[hn[e]," Anomaly Damage"]})})));const Nc=[];Wc.forEach(e=>{Nc.push({tag:e.fieldRef,value:e})});const Ld=Td(Nc);function b(e,t){return[(n,o)=>s(Us,{ns:`${e}_${t}_gen`,key18:n,values:o}),(n,o)=>s(Us,{ns:`${e}_${t}`,key18:n,values:o})]}function x(e){return{title:s(de,{tag:e}),fieldRef:e}}function Kc(e){if(!e)return"";const{et:t,q:n,qt:o,name:i}=e;return t==="own"&&o==="formula"&&n!=="base"?i??n??"":n??""}const Wt={initial:"Initial",combat:"Combat",final:"Final",base:"Base"};function de({tag:e,showPercent:t}){return s(ve,{color:Nd(e),children:s(Gd,{tag:e,showPercent:t})})}function fn({tag:e}){return y(Lt,{children:[s(de,{tag:e}),Bd(e).map(t=>s(je,{children:De[t]},t)),e.attribute&&s(je,{color:e.attribute,children:s(Se,{attribute:e.attribute})})]})}const Hd=["hp","hp_","atk","atk_","def","def_"],Fd=e=>Hd.includes(e),ro={dmg_:"DMG",common_dmg_:"DMG",resIgn_:"Res Ignore"};function Gd({tag:e,showPercent:t}){var i;const n=(i=Ld.subset(e)[0])==null?void 0:i.title;if(n)return n;const o=Kc(e);if(Fd(o))return y("span",{children:[s(Nr,{statKey:o,iconProps:Wr})," ",y("span",{children:[(e.qt&&Wt[e.qt])??e.qt," ",Kr[o],t&&jt(o)]})]});if(ro[o]){const r=[...e.attribute?[hn[e.attribute]]:[],...e.damageType1?[De[e.damageType1]]:[],...e.damageType2?[De[e.damageType2]]:[],ro[o]];return s("span",{children:r.join(" ")})}return s(ge,{statKey:o,showPercent:t})}const En="AstralVoice",[lo,Ud]=b("disc",En),uo=N(En),Jd=_[En],Xd=w[En],Qd={2:{title:s(H,{}),img:uo,documents:[{type:"text",text:lo("desc2")}]},4:{title:s(F,{}),img:uo,documents:[{type:"text",text:lo("desc4")},{type:"conditional",conditional:{label:Ud("set4_cond"),metadata:Jd.astral,fields:[x(Xd.set4_team_dmg_.tag)]}}]}},Tn="BranchBladeSong",[po,Zd]=b("disc",Tn),ho=N(Tn),Yd=_[Tn],mo=w[Tn],eu={2:{title:s(H,{}),img:ho,documents:[{type:"text",text:po("desc2")}]},4:{title:s(F,{}),img:ho,documents:[{type:"text",text:po("desc4")},{type:"fields",fields:[x(mo.set4_passive.tag)]},{type:"conditional",conditional:{label:Zd("set4_cond"),metadata:Yd.apply_or_trigger,fields:[x(mo.set4_cond.tag)]}}]}},In="ChaosJazz",[fo,tu]=b("disc",In),go=N(In),nu=_[In],dn=w[In],su={2:{title:s(H,{}),img:go,documents:[{type:"text",text:fo("desc2")}]},4:{title:s(F,{}),img:go,documents:[{type:"text",text:fo("desc4")},{type:"fields",fields:[x(dn.set4_passive_fire_dmg_.tag),x(dn.set4_passive_electric_dmg_.tag)]},{type:"conditional",conditional:{label:tu("set4_cond"),metadata:nu.while_off_field,fields:[{title:"EX Special Attack DMG",fieldRef:dn.set4_off_field_special_dmg_.tag},{title:"Assist Attack Attack DMG",fieldRef:dn.set4_off_field_assist_dmg_.tag}]}}]}},Rn="ChaoticMetal",[yo,ou]=b("disc",Rn),xo=N(Rn),iu=_[Rn],bo=w[Rn],au={2:{title:s(H,{}),img:xo,documents:[{type:"text",text:yo("desc2")}]},4:{title:s(F,{}),img:xo,documents:[{type:"text",text:yo("desc4")},{type:"fields",fields:[x(bo.set4_passive.tag)]},{type:"conditional",conditional:{label:ou("set4_cond"),metadata:iu.trigger_corruption,fields:[x(bo.set4_cond_trigger_corruption.tag)]}}]}},An="FangedMetal",[$o,cu]=b("disc",An),wo=N(An),ru=_[An],lu=w[An],du={2:{title:s(H,{}),img:wo,documents:[{type:"text",text:$o("desc2")}]},4:{title:s(F,{}),img:wo,documents:[{type:"text",text:$o("desc4")},{type:"conditional",conditional:{label:cu("set4_cond"),metadata:ru.inflict_assault,fields:[x(lu.set4_cond_inflict_assault.tag)]}}]}},Bc="FreedomBlues",[_o,ix]=b("disc",Bc),ko=N(Bc),uu={2:{title:s(H,{}),img:ko,documents:[{type:"text",text:_o("desc2")}]},4:{title:s(F,{}),img:ko,documents:[{type:"text",text:_o("desc4")}]}},qn="HormonePunk",[vo,pu]=b("disc",qn),Co=N(qn),hu=_[qn],mu=w[qn],fu={2:{title:s(H,{}),img:Co,documents:[{type:"text",text:vo("desc2")}]},4:{title:s(F,{}),img:Co,documents:[{type:"text",text:vo("desc4")},{type:"conditional",conditional:{label:pu("set4_cond"),metadata:hu.entering_combat,fields:[x(mu.set4_cond_entering_combat.tag)]}}]}},zn="InfernoMetal",[So,gu]=b("disc",zn),Do=N(zn),yu=_[zn],xu=w[zn],bu={2:{title:s(H,{}),img:Do,documents:[{type:"text",text:So("desc2")}]},4:{title:s(F,{}),img:Do,documents:[{type:"text",text:So("desc4")},{type:"conditional",conditional:{label:gu("set4_cond"),metadata:yu.hitting_burning_enemy,fields:[x(xu.set4_cond_hitting_burning_enemy.tag)]}}]}},Vn="PhaethonsMelody",[Mo,Eo]=b("disc",Vn),To=N(Vn),Io=_[Vn],Ro=w[Vn],$u={2:{title:s(H,{}),img:To,documents:[{type:"text",text:Mo("desc2")}]},4:{title:s(F,{}),img:To,documents:[{type:"text",text:Mo("desc4")},{type:"conditional",conditional:{label:Eo("set4_cond_squad_use_ex"),metadata:Io.squad_use_ex,fields:[x(Ro.set4_squad_anomProf.tag)]}},{type:"conditional",conditional:{label:Eo("set4_cond_not_char_use_ex"),metadata:Io.not_char_use_ex,fields:[x(Ro.set4_not_self_ether_.tag)]}}]}},On="PolarMetal",[Ao,wu]=b("disc",On),qo=N(On),_u=_[On],zo=w[On],ku={2:{title:s(H,{}),img:qo,documents:[{type:"text",text:Ao("desc2")}]},4:{title:s(F,{}),img:qo,documents:[{type:"text",text:Ao("desc4")},{type:"conditional",conditional:{label:wu("set4_cond"),metadata:_u.freeze_shatter}},{type:"fields",fields:[{title:"Basic Attack DMG",fieldRef:zo.set4_basic_dmg_.tag},{title:"Dash Attack DMG",fieldRef:zo.set4_dash_dmg_.tag}]}]}},Pn="ProtoPunk",[Vo,vu]=b("disc",Pn),Oo=N(Pn),Cu=_[Pn],Su=w[Pn],Du={2:{title:s(H,{}),img:Oo,documents:[{type:"text",text:Vo("desc2")}]},4:{title:s(F,{}),img:Oo,documents:[{type:"text",text:Vo("desc4")},{type:"conditional",conditional:{label:vu("set4_cond"),metadata:Cu.def_assist_or_evasive_assist,fields:[x(Su.set4_cond_def_assist_or_evasive_assist_dmg_.tag)]}}]}},jn="PufferElectro",[Po,Mu]=b("disc",jn),jo=N(jn),Eu=_[jn],Wo=w[jn],Tu={2:{title:s(H,{}),img:jo,documents:[{type:"text",text:Po("desc2")}]},4:{title:s(F,{}),img:jo,documents:[{type:"text",text:Po("desc4")},{type:"fields",fields:[{title:"Ultimate DMG",fieldRef:Wo.set4_dmg_.tag}]},{type:"conditional",conditional:{label:Mu("set4_cond"),metadata:Eu.launching_ult,fields:[x(Wo.set4_cond_launching_ult_atk_.tag)]}}]}},Wn="ShadowHarmony",[No,Iu]=b("disc",Wn),Ko=N(Wn),Ru=_[Wn],Bo=w[Wn],Au={2:{title:s(H,{}),img:Ko,documents:[{type:"text",text:No("desc2")}]},4:{title:s(F,{}),img:Ko,documents:[{type:"text",text:No("desc4")},{type:"conditional",conditional:{label:Iu("set4_cond_stacks"),metadata:Ru.stacks,fields:[x(Bo.set4_stack_atk_.tag),x(Bo.set4_stack_crit_.tag)]}}]}},Is="ShockstarDisco",[Lo,ax]=b("disc",Is),Ho=N(Is),qu=w[Is],zu={2:{title:s(H,{}),img:Ho,documents:[{type:"text",text:Lo("desc2")}]},4:{title:s(F,{}),img:Ho,documents:[{type:"text",text:Lo("desc4")},{type:"fields",fields:[{title:"Basic Attack Daze",fieldRef:qu.set4_basic_daze_.tag}]}]}},Lc="SoulRock",[Fo,cx]=b("disc",Lc),Go=N(Lc),Vu={2:{title:s(H,{}),img:Go,documents:[{type:"text",text:Fo("desc2")}]},4:{title:s(F,{}),img:Go,documents:[{type:"text",text:Fo("desc4")}]}},Nn="SwingJazz",[Uo,Ou]=b("disc",Nn),Jo=N(Nn),Pu=_[Nn],ju=w[Nn],Wu={2:{title:s(H,{}),img:Jo,documents:[{type:"text",text:Uo("desc2")}]},4:{title:s(F,{}),img:Jo,documents:[{type:"text",text:Uo("desc4")},{type:"conditional",conditional:{label:Ou("set4_cond"),metadata:Pu.chain_or_ult,fields:[x(ju.set4_cond_chain_or_ult.tag)]}}]}},Kn="ThunderMetal",[Xo,Nu]=b("disc",Kn),Qo=N(Kn),Ku=_[Kn],Bu=w[Kn],Lu={2:{title:s(H,{}),img:Qo,documents:[{type:"text",text:Xo("desc2")}]},4:{title:s(F,{}),img:Qo,documents:[{type:"text",text:Xo("desc4")},{type:"conditional",conditional:{label:Nu("set4_cond"),metadata:Ku.enemy_shocked,fields:[x(Bu.set4_cond_enemy_shocked_atk_.tag)]}}]}},Bn="WoodpeckerElectro",[Zo,Hu]=b("disc",Bn),Yo=N(Bn),Fu=_[Bn],Gu=w[Bn],Uu={2:{title:s(H,{}),img:Yo,documents:[{type:"text",text:Zo("desc2")}]},4:{title:s(F,{}),img:Yo,documents:[{type:"text",text:Zo("desc4")},{type:"conditional",conditional:{label:Hu("set4_cond"),metadata:Fu.crit_basic_dodge_ex,fields:[x(Gu.set4_cond_crit_basic_dodge_ex_atk_.tag)]}}]}},Ju={AstralVoice:Qd,BranchBladeSong:eu,ChaosJazz:su,ChaoticMetal:au,FangedMetal:du,FreedomBlues:uu,HormonePunk:fu,InfernoMetal:bu,PhaethonsMelody:$u,PolarMetal:ku,ProtoPunk:Du,PufferElectro:Tu,ShadowHarmony:Au,ShockstarDisco:zu,SoulRock:Vu,SwingJazz:Wu,ThunderMetal:Lu,WoodpeckerElectro:Uu};function Hc({setKey:e,fade2:t=!1,fade4:n=!1,children:o}){const i=Ju[e];return i?y($s,{bgt:"light",sx:{height:"100%"},children:[s(Bt,{title:s(Br,{setKey:e}),avatar:s(bs,{src:N(e),size:2})}),o,s(B,{divider:s(ee,{}),children:Object.entries(i).map(([r,a])=>s(M,{sx:{opacity:(r==="2"?t:n)?.5:1},children:s(Xu,{uiSheetElement:a,collapse:r!=="2"})},r))})]}):null}function Xu({uiSheetElement:e,collapse:t=!1}){const{documents:n,title:o}=e;return y(V,{children:[s(R,{variant:"subtitle1",children:o}),s(B,{spacing:1,children:n.map((i,r)=>s(Vc,{document:i,typoVariant:"body2",collapse:t},r))})]})}function H(){return"2-Set"}function F(){return"4-Set"}function Fc(e,t=new Map){const n=t.get(e);if(n)return n;const{val:o,meta:{tag:i,op:r,ops:a,usedCats:l}}=e,d=i&&Lr(i,(S,E)=>l.has(E)),c=ws(o,jt(Kc(i))),u=new Set;function p(S,E){return S.map((A,X)=>{const q=Fc(A,t);return q.name?(u.add(q),q.name):(q.deps.forEach(K=>u.add(K)),q.prec>=E?q.formula:y("span",{children:["(",q.formula,")"]},X))})}let h,m=1/0;switch(r){case"const":h=c,m=1/0;break;case"sum":case"prod":case"max":case"min":{const{head:S,joiner:E,end:A}=Jn[r];m=Jn[r].prec,h=y("span",{children:[S,p(a,m).map((X,q)=>y(f.Fragment,{children:[X,q<a.length-1&&E]},q)),A]})}break;case"sumfrac":{const[S]=p(a,2),[E,A]=p(a,1);h=y("span",{children:[S," / (",E," + ",A,")"]}),m=Jn.prod.prec;break}default:cc(r)}let g,$;d&&(g=y("span",{children:[s(de,{tag:d})," ",c]}),$=void 0);const C={name:g,formula:h,prec:m,sheet:$,deps:[...new Set(u)]};return t.set(e,C),C}const Jn={sum:{head:"",joiner:" + ",end:"",prec:1},prod:{head:"",joiner:" * ",end:"",prec:2},max:{head:"Max(",joiner:", ",end:")",prec:1/0},min:{head:"Min(",joiner:", ",end:")",prec:1/0}};function Ft(){const e=f.useContext(Ne),t=f.useContext(Kt);return f.useMemo(()=>e==null?void 0:e.withTag(t),[e,t])}function k({wKey:e,children:t}){const n=Ft();let o=1;return n&&n.compute(z.common.count.sheet(e)).val&&(o=n.compute(z.wengine.phase).val??1),t(o)}const Be="BashfulDemon",[ei,Qu]=b("wengine",Be),Zu=D.wengine[Be],Yu=v(Be,"icon"),ep=_[Be],ti=w[Be],tp={title:ei("phase"),img:Yu,documents:[{type:"text",text:s(k,{wKey:Be,children:e=>ei(`phaseDescs.${e-1}`)})},{type:"fields",fields:[x(ti.passive_ice_dmg_.tag)]},{type:"conditional",conditional:{label:Qu("cond"),metadata:ep.launch_ex_attack,fields:[x(ti.team_atk_.tag),{title:"Duration",fieldValue:Zu.duration}]}}]},Gt="BigCylinder",[ni,rx]=b("wengine",Gt),np=D.wengine[Gt],sp=v(Gt,"icon"),op=gc[Gt],ip={title:ni("phase"),img:sp,documents:[{type:"text",text:s(k,{wKey:Gt,children:e=>ni(`phaseDescs.${e-1}`)})},{type:"fields",fields:[{title:"Additional DMG",fieldRef:op.damage.tag},{title:"Cooldown",fieldValue:np.cooldown}]}]},Le="BlazingLaurel",[si,oi]=b("wengine",Le),ii=D.wengine[Le],ap=v(Le,"icon"),ai=_[Le],Xn=w[Le],cp={title:si("phase"),img:ap,documents:[{type:"text",text:s(k,{wKey:Le,children:e=>si(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:oi("cond1"),metadata:ai.quickOrPerfectAssistUsed,fields:[x(Xn.impact_.tag),{title:"Duration",fieldValue:ii.duration}]}},{type:"conditional",conditional:{label:oi("cond2"),metadata:ai.wilt,fields:[x(Xn.crit_dmg_ice_.tag),x(Xn.crit_dmg_fire_.tag),{title:"Duration",fieldValue:ii.wilt_duration}]}}]},He="BoxCutter",[ci,rp]=b("wengine",He),lp=D.wengine[He],dp=v(He,"icon"),up=_[He],pp=w[He],hp={title:ci("phase"),img:dp,documents:[{type:"text",text:s(k,{wKey:He,children:e=>ci(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:rp("cond"),metadata:up.launchedAftershock,fields:[x(pp.physical_dmg_.tag),{title:"Duration",fieldValue:lp.duration}]}}]},Ut="BunnyBand",[ri,mp]=b("wengine",Ut),fp=v(Ut,"icon"),gp=_[Ut],li=w[Ut],yp={title:ri("phase"),img:fp,documents:[{type:"text",text:s(k,{wKey:Ut,children:e=>ri(`phaseDescs.${e-1}`)})},{type:"fields",fields:[x(li.passive_hp_.tag)]},{type:"conditional",conditional:{label:mp("cond"),metadata:gp.wearerShielded,fields:[x(li.atk_.tag)]}}]},Me="CannonRotor",[di,lx]=b("wengine",Me),xp=D.wengine[Me],bp=v(Me,"icon"),$p=gc[Me],wp=w[Me],_p={title:di("phase"),img:bp,documents:[{type:"text",text:s(k,{wKey:Me,children:e=>di(`phaseDescs.${e-1}`)})},{type:"fields",fields:[x(wp.passive_atk_.tag)]},{type:"fields",fields:[{title:"Additional DMG",fieldRef:$p.damage.tag},{title:"Cooldown",fieldValue:s(k,{wKey:Me,children:e=>xp.cooldown[e]})}]}]},Fe="DeepSeaVisitor",[ui,pi]=b("wengine",Fe),hi=D.wengine[Fe],kp=v(Fe,"icon"),mi=_[Fe],Qn=w[Fe],vp={title:ui("phase"),img:kp,documents:[{type:"text",text:s(k,{wKey:Fe,children:e=>ui(`phaseDescs.${e-1}`)})},{type:"fields",fields:[x(Qn.passive_ice_dmg_.tag)]},{type:"conditional",conditional:{label:pi("cond1"),metadata:mi.basicHit,fields:[x(Qn.crit_.tag),{title:"Duration",fieldValue:hi.duration}]}},{type:"conditional",conditional:{label:pi("cond2"),metadata:mi.iceDashAtkHit,fields:[x(Qn.extra_crit_.tag),{title:"Duration",fieldValue:hi.extra_duration}]}}]},Ge="DemaraBatteryMarkII",[fi,Cp]=b("wengine",Ge),Sp=D.wengine[Ge],Dp=v(Ge,"icon"),Mp=_[Ge],gi=w[Ge],Ep={title:fi("phase"),img:Dp,documents:[{type:"text",text:s(k,{wKey:Ge,children:e=>fi(`phaseDescs.${e-1}`)})},{type:"fields",fields:[x(gi.passive_electric_dmg_.tag)]},{type:"conditional",conditional:{label:Cp("cond"),metadata:Mp.dodgeCounterOrAssistHit,fields:[x(gi.enerRegen_.tag),{title:"Duration",fieldValue:Sp.duration}]}}]},Ue="DrillRigRedAxis",[yi,Tp]=b("wengine",Ue),xi=D.wengine[Ue],Ip=v(Ue,"icon"),Rp=_[Ue],bi=w[Ue],Ap={title:yi("phase"),img:Ip,documents:[{type:"text",text:s(k,{wKey:Ue,children:e=>yi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Tp("cond"),metadata:Rp.exSpecialOrChainUsed,fields:[x(bi.basic_eletric_dmg_.tag),x(bi.dash_eletric_dmg_.tag),{title:"Duration",fieldValue:xi.duration},{title:"Cooldown",fieldValue:xi.cooldown}]}}]},Jt="ElectroLipGloss",[$i,qp]=b("wengine",Jt),zp=v(Jt,"icon"),Vp=_[Jt],wi=w[Jt],Op={title:$i("phase"),img:zp,documents:[{type:"text",text:s(k,{wKey:Jt,children:e=>$i(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:qp("cond"),metadata:Vp.anomalyOnEnemy,fields:[x(wi.atk_.tag),x(wi.common_dmg_.tag)]}}]},Je="ElegantVanity",[_i,Pp]=b("wengine",Je),jp=D.wengine[Je],Wp=v(Je,"icon"),Np=_[Je],Kp=w[Je],Bp={title:_i("phase"),img:Wp,documents:[{type:"text",text:s(k,{wKey:Je,children:e=>_i(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Pp("cond"),metadata:Np.consumed25Energy,fields:[x(Kp.common_dmg_.tag),{title:"Duration",fieldValue:jp.buffDuration}]}}]},Xe="FlamemakerShaker",[ki,vi]=b("wengine",Xe),Zn=D.wengine[Xe],Lp=v(Xe,"icon"),Ci=_[Xe],Yn=w[Xe],Hp={title:ki("phase"),img:Lp,documents:[{type:"text",text:s(k,{wKey:Xe,children:e=>ki(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:vi("cond1"),metadata:Ci.offField,fields:[x(Yn.enerRegen.tag)]}},{type:"conditional",conditional:{label:vi("cond2"),metadata:Ci.exSpecialAssistHits,fields:[x(Yn.common_dmg_.tag),{title:"Duration",fieldValue:Zn.duration},{title:"Cooldown",fieldValue:Zn.cooldown},x(Yn.anomProf.tag),{title:"Duration",fieldValue:Zn.anomProfDuration}]}}]},Qe="FusionCompiler",[Si,Fp]=b("wengine",Qe),Gp=D.wengine[Qe],Up=v(Qe,"icon"),Jp=_[Qe],Di=w[Qe],Xp={title:Si("phase"),img:Up,documents:[{type:"text",text:s(k,{wKey:Qe,children:e=>Si(`phaseDescs.${e-1}`)})},{type:"fields",fields:[x(Di.passive_atk_.tag)]},{type:"conditional",conditional:{label:Fp("cond"),metadata:Jp.specialUsed,fields:[x(Di.anomProf.tag),{title:"Duration",fieldValue:Gp.duration}]}}]},Ln="GildedBlossom",[Mi,dx]=b("wengine",Ln),Qp=v(Ln,"icon"),Ei=w[Ln],Zp={title:Mi("phase"),img:Qp,documents:[{type:"text",text:s(k,{wKey:Ln,children:e=>Mi(`phaseDescs.${e-1}`)})},{type:"fields",fields:[x(Ei.passive_atk_.tag),x(Ei.passive_exSpecial_dmg_.tag)]}]},Ze="HailstormShrine",[Ti,Yp]=b("wengine",Ze),eh=D.wengine[Ze],th=v(Ze,"icon"),nh=_[Ze],Ii=w[Ze],sh={title:Ti("phase"),img:th,documents:[{type:"text",text:s(k,{wKey:Ze,children:e=>Ti(`phaseDescs.${e-1}`)})},{type:"fields",fields:[x(Ii.passive_crit_dmg_.tag)]},{type:"conditional",conditional:{label:Yp("cond"),metadata:nh.exSpecialOrAnomaly,fields:[x(Ii.ice_dmg_.tag),{title:"Duration",fieldValue:eh.duration}]}}]},Ye="HeartstringNocturne",[Ri,oh]=b("wengine",Ye),ih=D.wengine[Ye],ah=v(Ye,"icon"),ch=_[Ye],es=w[Ye],rh={title:Ri("phase"),img:ah,documents:[{type:"text",text:s(k,{wKey:Ye,children:e=>Ri(`phaseDescs.${e-1}`)})},{type:"fields",fields:[x(es.passive_crit_dmg_.tag)]},{type:"conditional",conditional:{label:oh("cond"),metadata:ch.heartstring,fields:[x(es.chain_resIgn_fire_.tag),x(es.ult_resIgn_fire_.tag),{title:"Duration",fieldValue:ih.duration}]}}]},et="HellfireGears",[Ai,qi]=b("wengine",et),lh=D.wengine[et],dh=v(et,"icon"),zi=_[et],Vi=w[et],uh={title:Ai("phase"),img:dh,documents:[{type:"text",text:s(k,{wKey:et,children:e=>Ai(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:qi("cond1"),metadata:zi.offField,fields:[x(Vi.enerRegen.tag)]}},{type:"conditional",conditional:{label:qi("cond1"),metadata:zi.exSpecialUsed,fields:[x(Vi.impact_.tag),{title:"Duration",fieldValue:lh.duration}]}}]},tt="Housekeeper",[Oi,Pi]=b("wengine",tt),ph=D.wengine[tt],hh=v(tt,"icon"),ji=_[tt],Wi=w[tt],mh={title:Oi("phase"),img:hh,documents:[{type:"text",text:s(k,{wKey:tt,children:e=>Oi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Pi("cond1"),metadata:ji.offField,fields:[x(Wi.enerRegen.tag)]}},{type:"conditional",conditional:{label:Pi("cond2"),metadata:ji.exSpecialHits,fields:[x(Wi.physical_dmg_.tag),{title:"Duration",fieldValue:ph.duration}]}}]},nt="IceJadeTeapot",[Ni,fh]=b("wengine",nt),Ki=D.wengine[nt],gh=v(nt,"icon"),yh=_[nt],Bi=w[nt],xh={title:Ni("phase"),img:gh,documents:[{type:"text",text:s(k,{wKey:nt,children:e=>Ni(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:fh("cond"),metadata:yh.teariffic,fields:[x(Bi.impact_.tag),{title:"Duration",fieldValue:Ki.duration},x(Bi.common_dmg_.tag),{title:"Duration",fieldValue:Ki.teamBuffDuration}]}}]},st="IdentityBase",[Li,bh]=b("wengine",st),$h=D.wengine[st],wh=v(st,"icon"),_h=_[st],kh=w[st],vh={title:Li("phase"),img:wh,documents:[{type:"text",text:s(k,{wKey:st,children:e=>Li(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:bh("cond"),metadata:_h.equipperAttacked,fields:[x(kh.def_.tag),{title:"Duration",fieldValue:$h.duration}]}}]},Rs="IdentityInflection",[Hi,ux]=b("wengine",Rs),Ch=v(Rs,"icon"),Sh={title:Hi("phase"),img:Ch,documents:[{type:"text",text:s(k,{wKey:Rs,children:e=>Hi(`phaseDescs.${e-1}`)})}]},ot="KaboomTheCannon",[Fi,Dh]=b("wengine",ot),Mh=D.wengine[ot],Eh=v(ot,"icon"),Th=_[ot],Ih=w[ot],Rh={title:Fi("phase"),img:Eh,documents:[{type:"text",text:s(k,{wKey:ot,children:e=>Fi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Dh("cond"),metadata:Th.allyHitsEnemy,fields:[x(Ih.atk_.tag),{title:"Duration",fieldValue:Mh.duration}]}}]},it="LunarDecrescent",[Gi,Ah]=b("wengine",it),qh=D.wengine[it],zh=v(it,"icon"),Vh=_[it],Oh=w[it],Ph={title:Gi("phase"),img:zh,documents:[{type:"text",text:s(k,{wKey:it,children:e=>Gi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Ah("cond"),metadata:Vh.chainOrUltUsed,fields:[x(Oh.common_dmg_.tag),{title:"Duration",fieldValue:qh.duration}]}}]},As="LunarNoviluna",[Ui,px]=b("wengine",As),jh=v(As,"icon"),Wh={title:Ui("phase"),img:jh,documents:[{type:"text",text:s(k,{wKey:As,children:e=>Ui(`phaseDescs.${e-1}`)})}]},Hn="LunarPleniluna",[Ji,hx]=b("wengine",Hn),Nh=v(Hn,"icon"),ts=w[Hn],Kh={title:Ji("phase"),img:Nh,documents:[{type:"text",text:s(k,{wKey:Hn,children:e=>Ji(`phaseDescs.${e-1}`)})},{type:"fields",fields:[x(ts.basic_dmg_.tag),x(ts.dash_dmg_.tag),x(ts.dodgeCounter_dmg_.tag)]}]},at="MagneticStormAlpha",[Xi,Bh]=b("wengine",at),Qi=D.wengine[at],Lh=v(at,"icon"),Hh=_[at],Fh=w[at],Gh={title:Xi("phase"),img:Lh,documents:[{type:"text",text:s(k,{wKey:at,children:e=>Xi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Bh("cond"),metadata:Hh.anomalyBuildupIncreased,fields:[x(Fh.anomMas.tag),{title:"Duration",fieldValue:Qi.duration},{title:"Cooldown",fieldValue:Qi.cooldown}]}}]},ct="MagneticStormBravo",[Zi,Uh]=b("wengine",ct),Yi=D.wengine[ct],Jh=v(ct,"icon"),Xh=_[ct],Qh=w[ct],Zh={title:Zi("phase"),img:Jh,documents:[{type:"text",text:s(k,{wKey:ct,children:e=>Zi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Uh("cond"),metadata:Xh.anomalyBuildupIncreased,fields:[x(Qh.anomProf.tag),{title:"Duration",fieldValue:Yi.duration},{title:"Cooldown",fieldValue:Yi.cooldown}]}}]},qs="MagneticStormCharlie",[ea,mx]=b("wengine",qs),Yh=v(qs,"icon"),em={title:ea("phase"),img:Yh,documents:[{type:"text",text:s(k,{wKey:qs,children:e=>ea(`phaseDescs.${e-1}`)})}]},rt="MarcatoDesire",[ta,na]=b("wengine",rt),tm=D.wengine[rt],nm=v(rt,"icon"),sa=_[rt],sm=w[rt],om={title:ta("phase"),img:nm,documents:[{type:"text",text:s(k,{wKey:rt,children:e=>ta(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:na("cond1"),metadata:sa.exSpecialOrChainHitsEnemy,fields:[x(sm.atk_.tag),{title:"Duration",fieldValue:tm.duration}]}},{type:"conditional",conditional:{label:na("cond2"),metadata:sa.attributeAnomalyInflicted}}]},lt="OriginalTransmorpher",[oa,im]=b("wengine",lt),am=D.wengine[lt],cm=v(lt,"icon"),rm=_[lt],ia=w[lt],lm={title:oa("phase"),img:cm,documents:[{type:"text",text:s(k,{wKey:lt,children:e=>oa(`phaseDescs.${e-1}`)})},{type:"fields",fields:[x(ia.passive_hp_.tag)]},{type:"conditional",conditional:{label:im("cond"),metadata:rm.equipperHit,fields:[x(ia.impact_.tag),{title:"Duration",fieldValue:am.duration}]}}]},Xt="PeacekeeperSpecialized",[aa,dm]=b("wengine",Xt),um=v(Xt,"icon"),pm=_[Xt],hm=w[Xt],mm={title:aa("phase"),img:um,documents:[{type:"text",text:s(k,{wKey:Xt,children:e=>aa(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:dm("cond"),metadata:pm.shielded,fields:[x(hm.enerRegen.tag)]}}]},zs="PreciousFossilizedCore",[ca,fx]=b("wengine",zs),fm=v(zs,"icon"),gm={title:ca("phase"),img:fm,documents:[{type:"text",text:s(k,{wKey:zs,children:e=>ca(`phaseDescs.${e-1}`)})}]},dt="RainforestGourmet",[ra,ym]=b("wengine",dt),xm=D.wengine[dt],bm=v(dt,"icon"),$m=_[dt],wm=w[dt],_m={title:ra("phase"),img:bm,documents:[{type:"text",text:s(k,{wKey:dt,children:e=>ra(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:ym("cond"),metadata:$m.energyConsumed,fields:[x(wm.atk_.tag),{title:"Duration",fieldValue:xm.duration}]}}]},ut="ReverbMarkI",[la,km]=b("wengine",ut),vm=D.wengine[ut],Cm=v(ut,"icon"),Sm=_[ut],Dm=w[ut],Mm={title:la("phase"),img:Cm,documents:[{type:"text",text:s(k,{wKey:ut,children:e=>la(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:km("cond"),metadata:Sm.exSpecialUsed,fields:[x(Dm.impact_.tag),{title:"Duration",fieldValue:vm.duration}]}}]},pt="ReverbMarkII",[da,Em]=b("wengine",pt),Tm=D.wengine[pt],Im=v(pt,"icon"),Rm=_[pt],ua=w[pt],Am={title:da("phase"),img:Im,documents:[{type:"text",text:s(k,{wKey:pt,children:e=>da(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Em("cond"),metadata:Rm.exSpecialOrChainUsed,fields:[x(ua.anomMas.tag),x(ua.anomProf.tag),{title:"Duration",fieldValue:Tm.duration}]}}]},ht="ReverbMarkIII",[pa,qm]=b("wengine",ht),zm=D.wengine[ht],Vm=v(ht,"icon"),Om=_[ht],Pm=w[ht],jm={title:pa("phase"),img:Vm,documents:[{type:"text",text:s(k,{wKey:ht,children:e=>pa(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:qm("cond"),metadata:Om.chainOrUltUsed,fields:[x(Pm.atk_.tag),{title:"Duration",fieldValue:zm.duration}]}}]},Qt="RiotSuppressorMarkVI",[ha,Wm]=b("wengine",Qt),Nm=v(Qt,"icon"),Km=_[Qt],ma=w[Qt],Bm={title:ha("phase"),img:Nm,documents:[{type:"text",text:s(k,{wKey:Qt,children:e=>ha(`phaseDescs.${e-1}`)})},{type:"fields",fields:[x(ma.passive_crit_.tag)]},{type:"conditional",conditional:{label:Wm("cond"),metadata:Km.charge,fields:[x(ma.basic_ether_dmg_.tag)]}}]},mt="RoaringRide",[fa,ga]=b("wengine",mt),ya=D.wengine[mt],Lm=v(mt,"icon"),xa=_[mt],ba=w[mt],Hm={title:fa("phase"),img:Lm,documents:[{type:"text",text:s(k,{wKey:mt,children:e=>fa(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:ga("cond_atk_"),metadata:xa.atk_,fields:[x(ba.atk_.tag),{title:"Duration",fieldValue:ya.duration}]}},{type:"conditional",conditional:{label:ga("cond_anomProf"),metadata:xa.anomProf,fields:[x(ba.anomProf.tag),{title:"Duration",fieldValue:ya.duration}]}}]},ft="SeveredInnocence",[$a,Fm]=b("wengine",ft),Gm=D.wengine[ft],Um=v(ft,"icon"),Jm=_[ft],ns=w[ft],Xm={title:$a("phase"),img:Um,documents:[{type:"text",text:s(k,{wKey:ft,children:e=>$a(`phaseDescs.${e-1}`)})},{type:"fields",fields:[x(ns.passive_crit_dmg_.tag)]},{type:"conditional",conditional:{label:Fm("cond"),metadata:Jm.basicSpecialAftershockHit,fields:[x(ns.crit_dmg_.tag),x(ns.electric_dmg_.tag),{title:"Duration",fieldValue:Gm.duration}]}}]},gt="SharpenedStinger",[wa,Qm]=b("wengine",gt),Zm=D.wengine[gt],Ym=v(gt,"icon"),ef=_[gt],tf=w[gt],nf={title:wa("phase"),img:Ym,documents:[{type:"text",text:s(k,{wKey:gt,children:e=>wa(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Qm("cond"),metadata:ef.predatoryInstinct,fields:[x(tf.physical_dmg_.tag),{title:"Duration",fieldValue:Zm.duration}]}}]},Vs="SixShooter",[_a,gx]=b("wengine",Vs),sf=v(Vs,"icon"),of={title:_a("phase"),img:sf,documents:[{type:"text",text:s(k,{wKey:Vs,children:e=>_a(`phaseDescs.${e-1}`)})}]},Os="SliceOfTime",[ka,yx]=b("wengine",Os),af=v(Os,"icon"),cf={title:ka("phase"),img:af,documents:[{type:"text",text:s(k,{wKey:Os,children:e=>ka(`phaseDescs.${e-1}`)})}]},yt="SpectralGaze",[va,Ca]=b("wengine",yt),Sa=D.wengine[yt],rf=v(yt,"icon"),Da=_[yt],Ma=w[yt],lf={title:va("phase"),img:rf,documents:[{type:"text",text:s(k,{wKey:yt,children:e=>va(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Ca("cond1"),metadata:Da.hit_aftershock_electric,fields:[x(Ma.cond_defRed_.tag),{title:"Duration",fieldValue:Sa.duration1}]}},{type:"conditional",conditional:{label:Ca("cond2"),metadata:Da.spiritLock,fields:[x(Ma.cond_impact_.tag),{title:"Duration",fieldValue:Sa.duration2}]}}]},xt="SpringEmbrace",[Ea,df]=b("wengine",xt),uf=D.wengine[xt],pf=v(xt,"icon"),hf=_[xt],mf=w[xt],ff={title:Ea("phase"),img:pf,documents:[{type:"text",text:s(k,{wKey:xt,children:e=>Ea(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:df("cond"),metadata:hf.when_attacked,fields:[x(mf.cond_enerRegen_.tag),{title:"Duration",fieldValue:uf.duration}]}}]},bt="StarlightEngine",[Ta,gf]=b("wengine",bt),yf=D.wengine[bt],xf=v(bt,"icon"),bf=_[bt],$f=w[bt],wf={title:Ta("phase"),img:xf,documents:[{type:"text",text:s(k,{wKey:bt,children:e=>Ta(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:gf("cond"),metadata:bf.dodgecounter_quickassist,fields:[x($f.cond_dmg_.tag),{title:"Duration",fieldValue:yf.duration}]}}]},$t="StarlightEngineReplica",[Ia,_f]=b("wengine",$t),kf=D.wengine[$t],vf=v($t,"icon"),Cf=_[$t],Sf=w[$t],Df={title:Ia("phase"),img:vf,documents:[{type:"text",text:s(k,{wKey:$t,children:e=>Ia(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:_f("cond"),metadata:Cf.hit_away,fields:[x(Sf.cond_dmg_.tag),{title:"Duration",fieldValue:kf.duration}]}}]},wt="SteamOven",[Ra,Mf]=b("wengine",wt),Ef=D.wengine[wt],Tf=v(wt,"icon"),If=_[wt],Rf=w[wt],Af={title:Ra("phase"),img:Tf,documents:[{type:"text",text:s(k,{wKey:wt,children:e=>Ra(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Mf("cond"),metadata:If.stacks,fields:[x(Rf.cond_impact_.tag),{title:"Duration",fieldValue:Ef.duration}]}}]},Zt="SteelCushion",[Aa,qf]=b("wengine",Zt),zf=v(Zt,"icon"),Vf=_[Zt],qa=w[Zt],Of={title:Aa("phase"),img:zf,documents:[{type:"text",text:s(k,{wKey:Zt,children:e=>Aa(`phaseDescs.${e-1}`)})},{type:"fields",fields:[x(qa.passive_physical_dmg_.tag)]},{type:"conditional",conditional:{label:qf("cond"),metadata:Vf.hit_behind,fields:[x(qa.cond_dmg_.tag)]}}]},Yt="StreetSuperstar",[za,Pf]=b("wengine",Yt),jf=v(Yt,"icon"),Wf=_[Yt],Nf=w[Yt],Kf={title:za("phase"),img:jf,documents:[{type:"text",text:s(k,{wKey:Yt,children:e=>za(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Pf("cond"),metadata:Wf.charge,fields:[x(Nf.cond_ult_dmg_.tag)]}}]},_t="TheBrimstone",[Va,Bf]=b("wengine",_t),Lf=D.wengine[_t],Hf=v(_t,"icon"),Ff=_[_t],Gf=w[_t],Uf={title:Va("phase"),img:Hf,documents:[{type:"text",text:s(k,{wKey:_t,children:e=>Va(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Bf("cond"),metadata:Ff.hit_basic_dash_dodge,fields:[x(Gf.cond_atk_.tag),{title:"Duration",fieldValue:Lf.duration}]}}]},Ps="TheRestrained",[Oa,xx]=b("wengine",Ps),Jf=v(Ps,"icon"),Xf={title:Oa("phase"),img:Jf,documents:[{type:"text",text:s(k,{wKey:Ps,children:e=>Oa(`phaseDescs.${e-1}`)})}]},kt="TheVault",[Pa,Qf]=b("wengine",kt),Zf=D.wengine[kt],Yf=v(kt,"icon"),eg=_[kt],tg=w[kt],ng={title:Pa("phase"),img:Yf,documents:[{type:"text",text:s(k,{wKey:kt,children:e=>Pa(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Qf("cond"),metadata:eg.ether_hit,fields:[x(tg.cond_dmg_.tag),{title:"Duration",fieldValue:Zf.duration}]}}]},vt="Timeweaver",[ja,sg]=b("wengine",vt),og=D.wengine[vt],ig=v(vt,"icon"),ag=_[vt],Wa=w[vt],cg={title:ja("phase"),img:ig,documents:[{type:"text",text:s(k,{wKey:vt,children:e=>ja(`phaseDescs.${e-1}`)})},{type:"fields",fields:[x(Wa.passive_disorder_dmg_.tag)]},{type:"conditional",conditional:{label:sg("cond"),metadata:ag.hit_anomaly,fields:[x(Wa.cond_anomProf.tag),{title:"Duration",fieldValue:og.duration}]}}]},Ct="TusksOfFury",[Na,rg]=b("wengine",Ct),lg=D.wengine[Ct],dg=v(Ct,"icon"),ug=_[Ct],Ka=w[Ct],pg={title:Na("phase"),img:dg,documents:[{type:"text",text:s(k,{wKey:Ct,children:e=>Na(`phaseDescs.${e-1}`)})},{type:"fields",fields:[x(Ka.passive_shield_.tag)]},{type:"conditional",conditional:{label:rg("cond"),metadata:ug.interrupt_perfdodge,fields:[x(Ka.cond_dmg_.tag),{title:"Duration",fieldValue:lg.duration}]}}]},St="UnfetteredGameBall",[Ba,hg]=b("wengine",St),mg=D.wengine[St],fg=v(St,"icon"),gg=_[St],yg=w[St],xg={title:Ba("phase"),img:fg,documents:[{type:"text",text:s(k,{wKey:St,children:e=>Ba(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:hg("cond"),metadata:gg.anomaly_counter,fields:[x(yg.cond_crit_.tag),{title:"Duration",fieldValue:mg.duration}]}}]},js="VortexArrow",[La,bx]=b("wengine",js),bg=v(js,"icon"),$g={title:La("phase"),img:bg,documents:[{type:"text",text:s(k,{wKey:js,children:e=>La(`phaseDescs.${e-1}`)})}]},Dt="VortexHatchet",[Ha,wg]=b("wengine",Dt),Fa=D.wengine[Dt],_g=v(Dt,"icon"),kg=_[Dt],vg=w[Dt],Cg={title:Ha("phase"),img:_g,documents:[{type:"text",text:s(k,{wKey:Dt,children:e=>Ha(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:wg("cond"),metadata:kg.entering,fields:[x(vg.cond_impact_.tag),{title:"Duration",fieldValue:Fa.duration},{title:"Cooldown",fieldValue:Fa.cooldown}]}}]},Ws="VortexRevolver",[Ga,$x]=b("wengine",Ws),Sg=v(Ws,"icon"),Dg={title:Ga("phase"),img:Sg,documents:[{type:"text",text:s(k,{wKey:Ws,children:e=>Ga(`phaseDescs.${e-1}`)})}]},Mt="WeepingCradle",[Ua,Ja]=b("wengine",Mt),Mg=D.wengine[Mt],Eg=v(Mt,"icon"),Xa=_[Mt],Tg=w[Mt],Ig={title:Ua("phase"),img:Eg,documents:[{type:"text",text:s(k,{wKey:Mt,children:e=>Ua(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Ja("cond_atk"),metadata:Xa.attack}},{type:"conditional",conditional:{label:Ja("cond_stacks"),metadata:Xa.stacks,fields:[x(Tg.cond_dmg_.tag),{title:"Duration",fieldValue:Mg.duration}]}}]},en="WeepingGemini",[Qa,Rg]=b("wengine",en),Ag=v(en,"icon"),qg=_[en],zg=w[en],Vg={title:Qa("phase"),img:Ag,documents:[{type:"text",text:s(k,{wKey:en,children:e=>Qa(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Rg("cond"),metadata:qg.anomaly_stack,fields:[x(zg.anomaly_stack.tag)]}}]},Et="ZanshinHerbCase",[Za,Og]=b("wengine",Et),Pg=D.wengine[Et],jg=v(Et,"icon"),Wg=_[Et],ss=w[Et],Ng={title:Za("phase"),img:jg,documents:[{type:"text",text:s(k,{wKey:Et,children:e=>Za(`phaseDescs.${e-1}`)})},{type:"fields",fields:[x(ss.passive_crit_.tag),x(ss.passive_electric_dmg_.tag)]},{type:"conditional",conditional:{label:Og("cond"),metadata:Wg.apply_anom_stun,fields:[x(ss.cond_crit_.tag),{title:"Duration",fieldValue:Pg.duration}]}}]},Kg={BashfulDemon:tp,BigCylinder:ip,BlazingLaurel:cp,BoxCutter:hp,BunnyBand:yp,CannonRotor:_p,DeepSeaVisitor:vp,DemaraBatteryMarkII:Ep,DrillRigRedAxis:Ap,ElectroLipGloss:Op,ElegantVanity:Bp,FlamemakerShaker:Hp,FusionCompiler:Xp,GildedBlossom:Zp,HailstormShrine:sh,HeartstringNocturne:rh,HellfireGears:uh,Housekeeper:mh,IceJadeTeapot:xh,IdentityBase:vh,IdentityInflection:Sh,KaboomTheCannon:Rh,LunarDecrescent:Ph,LunarNoviluna:Wh,LunarPleniluna:Kh,MagneticStormAlpha:Gh,MagneticStormBravo:Zh,MagneticStormCharlie:em,MarcatoDesire:om,OriginalTransmorpher:lm,PeacekeeperSpecialized:mm,PreciousFossilizedCore:gm,RainforestGourmet:_m,ReverbMarkI:Mm,ReverbMarkII:Am,ReverbMarkIII:jm,RiotSuppressorMarkVI:Bm,RoaringRide:Hm,SeveredInnocence:Xm,SharpenedStinger:nf,SixShooter:of,SliceOfTime:cf,SpectralGaze:lf,SpringEmbrace:ff,StarlightEngine:wf,StarlightEngineReplica:Df,SteamOven:Af,SteelCushion:Of,StreetSuperstar:Kf,TheBrimstone:Uf,TheRestrained:Xf,TheVault:ng,Timeweaver:cg,TusksOfFury:pg,UnfetteredGameBall:xg,VortexArrow:$g,VortexHatchet:Cg,VortexRevolver:Dg,WeepingCradle:Ig,WeepingGemini:Vg,ZanshinHerbCase:Ng};function Gc({headerAction:e,fade:t=!1,wengine:n}){const{key:o,level:i,phase:r,modification:a}=n,l=Kg[o],d=Hr(o,i,r,a),c="atk_base",u=Dn(o).second_statkey;return l?y($s,{bgt:"light",sx:{height:"100%"},children:[s(Bt,{title:s(Fr,{wKey:o}),avatar:s(bs,{src:v(o,"icon"),size:2}),action:e}),y(V,{sx:{py:0},children:[y(R,{sx:{display:"flex",justifyContent:"space-between"},children:[s(ge,{statKey:"atk"}),y("span",{children:[Js(d[c],c).toFixed(Xs(c)),jt(c)]})]}),y(R,{sx:{display:"flex",justifyContent:"space-between"},children:[s(ge,{statKey:u}),y("span",{children:[Js(d[u],u).toFixed(Xs(u)),jt(u)]})]})]}),s(M,{sx:{opacity:t?.5:1},children:s(Bg,{uiSheetElement:l})})]}):null}function Bg({uiSheetElement:e}){const{documents:t,title:n}=e;return y(V,{children:[s(R,{variant:"subtitle1",children:n}),s(B,{spacing:1,children:t.map((o,i)=>s(Vc,{document:o,typoVariant:"body2",collapse:!0},i))})]})}function Uc({isAftershock:e,setAftershock:t}){return s(U,{onClick:()=>t(!e),color:e?"success":"secondary",children:De.aftershock})}function Jc({dmgType:e,keys:t,setDmgType:n}){return y(ie,{title:y(M,{sx:{textWrap:"nowrap"},children:["Dmg Type: ",e?De[e]:"Any"]}),children:[s(L,{selected:!e,disabled:!e,onClick:()=>n(),children:"Any"},"any"),t.map(o=>s(L,{selected:e===o,disabled:e===o,onClick:()=>n(o),children:De[o]},o))]})}function Lg(){var d;const{t:e}=be("page_optimize"),{database:t}=O(),{key:n}=J(),{bonusStats:o}=te(n),i=(d=ps(t.charMeta,n))==null?void 0:d.description,r=f.useCallback((c,u,p)=>t.charOpts.setBonusStat(n,c,u,p),[t,n]),a=c=>t.charOpts.setBonusStat(n,Jr(c),0),l=f.useCallback(c=>{t.charMeta.set(n,{description:c})},[t.charMeta,n]);return y(B,{spacing:1,children:[o.map(({tag:c,value:u},p)=>s(Fg,{tag:c,value:u,setValue:h=>r(c,h,p),onDelete:()=>r(c,null,p),setTag:h=>r(h,u,p)},JSON.stringify(c)+p)),s(Hg,{onSelect:a}),s(nd,{placeholder:e("bonusStatsNotes"),value:i,disabled:!n,onChange:c=>l(c),multiline:!0,minRows:3,fullWidth:!0})]})}function Hg({tag:e,onSelect:t}){return s(ie,{title:(e&&s(de,{tag:e}))??"Add Bonus Stat",children:Xr.map(n=>s(L,{onClick:()=>t(n),children:s(ge,{statKey:n,showPercent:!0})},n))})}function Fg({tag:e,setTag:t,value:n,setValue:o,onDelete:i}){var a;const r=(a=e.q)==null?void 0:a.endsWith("_");return s(W,{bgt:"light",children:y(V,{sx:{display:"flex",gap:1,justifyContent:"space-around",alignItems:"center",flexWrap:"wrap"},children:[s(R,{children:s(de,{tag:e})}),s(Ug,{qt:e.qt,setQt:l=>t({...e,qt:l})}),e.q==="dmg_"&&s(Gg,{tag:e,setAttribute:l=>{const{attribute:d,...c}=e;t(l?{...c,attribute:l}:c)}}),Gr.includes(e.q)&&s(Jc,{dmgType:e.damageType1,keys:Ur,setDmgType:l=>{const{damageType1:d,...c}=e;t(l?{...c,damageType1:l}:c)}}),["dmg_","crit_dmg_"].includes(e.q)&&s(Uc,{isAftershock:e.damageType2==="aftershock",setAftershock:l=>{const{damageType2:d,...c}=e;t(l?{...c,damageType2:"aftershock"}:c)}}),s(qe,{float:!0,value:n,sx:{flexBasis:150,flexGrow:1,height:"100%"},onChange:o,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:y(Mn,{position:"end",sx:{ml:0},children:[r?"%":void 0," ",s(Ke,{"aria-label":"Delete Bonus Stat",onClick:i,edge:"end",children:s(Ts,{fontSize:"small"})})]})}})]})})}function Gg({tag:e,setAttribute:t}){return y(ie,{title:e.attribute?s(Se,{attribute:e.attribute}):"No Attribute",color:e.attribute,children:[s(L,{onClick:()=>t(null),children:"No Attribute"}),Ae.map(n=>s(L,{onClick:()=>t(n),children:s(ve,{color:n,children:s(Se,{attribute:n})})},n))]})}function Ug({qt:e,setQt:t}){return s(ie,{title:e&&Wt[e],children:Qr.map(n=>s(L,{onClick:()=>t(n),selected:e===n,disabled:e===n,children:Wt[n]},n))})}function Xc(){const e=Ft();return s($s,{children:s(V,{children:e==null?void 0:e.listFormulas(z.listing.formulas).map((t,n)=>s(Jg,{read:t},n))})})}function Jg({read:e}){var C,S,E,A,X,q,K;const t=Ft(),{setRead:n}=f.useContext(ys),o=J(),i=te(o==null?void 0:o.key),r=e.tag.sheet===((C=i==null?void 0:i.target)==null?void 0:C.sheet)&&e.tag.name===((S=i==null?void 0:i.target)==null?void 0:S.name)||((E=i==null?void 0:i.target)==null?void 0:E.q)===e.tag.q,a=f.useMemo(()=>{var I,P,Q,Z;return e.tag.sheet===((I=i==null?void 0:i.target)==null?void 0:I.sheet)&&e.tag.name===((P=i==null?void 0:i.target)==null?void 0:P.name)?Zr(e.tag,(Q=i==null?void 0:i.target)==null?void 0:Q.damageType1,(Z=i==null?void 0:i.target)==null?void 0:Z.damageType2):e.tag},[e.tag,(A=i==null?void 0:i.target)==null?void 0:A.sheet,(X=i==null?void 0:i.target)==null?void 0:X.name,(q=i==null?void 0:i.target)==null?void 0:q.damageType1,(K=i==null?void 0:i.target)==null?void 0:K.damageType2]),l=f.useMemo(()=>({...e,tag:a}),[a,e]),d=t==null?void 0:t.compute(l),c=a.name||a.q,u=d&&Fc(d),{statHighlight:p,setStatHighlight:h}=f.useContext(yc),m=a.name?"":a.attribute?`${a.attribute}_${a.q}`:a.q==="cappedCrit_"?"crit_":a.q,g=m?Yr(p,m):!1;if(!d)return null;const $=ws(d.val,jt(c??""));return y(M,{onMouseEnter:()=>m&&h(m),onMouseLeave:()=>h(""),sx:{display:"flex",gap:1,alignItems:"center",p:.5,borderRadius:.5,backgroundColor:r?"rgba(0,200,0,0.2)":void 0,position:"relative","::after":{content:'""',position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:.5,backgroundColor:el(g),transition:"background-color 0.3s ease-in-out",pointerEvents:"none"}},onClick:()=>{n(l)},children:[s(M,{sx:{flexGrow:1},children:s(de,{tag:a})}),$,s(nl,{title:y(R,{component:"div",children:[y(M,{sx:{display:"flex",gap:1},children:[s(fn,{tag:a}),s("span",{children:$})]}),s(ee,{}),s(M,{children:u==null?void 0:u.formula}),s(B,{spacing:1,sx:{pl:1,pt:1},children:u==null?void 0:u.deps.map((I,P)=>y(M,{children:[s(M,{children:I.name}),s(ee,{}),y(M,{children:[" ",I.formula]})]},P))})]}),children:s(tl,{})})]})}function Xg(){const{database:e}=O(),{key:t}=J(),{enemyStats:n,enemyLvl:o,enemyDef:i,enemyisStunned:r,enemyStunMultiplier:a}=te(t),l=f.useCallback((c,u,p)=>e.charOpts.setEnemyStat(t,c,u,p),[e,t]),d=c=>e.charOpts.setEnemyStat(t,ol(c),0);return y(B,{spacing:1,children:[y(M,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[s(qe,{label:"Enemy Lvl",value:o,inputProps:{min:0,sx:{width:"4em"}},onChange:c=>e.charOpts.set(t,{enemyLvl:c})}),s(qe,{label:"Enemy DEF",value:i,inputProps:{min:0,sx:{width:"4em"}},onChange:c=>e.charOpts.set(t,{enemyDef:c})}),s(qe,{label:"Enemy Stun Multiplier",value:a,inputProps:{min:0,sx:{width:"8em"}},onChange:c=>e.charOpts.set(t,{enemyStunMultiplier:c}),InputProps:{endAdornment:s(Mn,{position:"end",children:"%"})}}),s(U,{onClick:()=>e.charOpts.set(t,{enemyisStunned:!r}),color:r?"success":"secondary",children:r?"Stunned":"Not Stunned"})]}),n.map(({tag:c,value:u},p)=>s(Zg,{tag:c,value:u,setValue:h=>l(c,h,p),onDelete:()=>l(c,null,p),setTag:h=>l(h,u,p)},JSON.stringify(c)+p)),s(Qg,{onSelect:d})]})}function Qg({tag:e,onSelect:t}){return s(ie,{title:(e&&s(de,{tag:{...e,qt:"common",et:"enemy",sheet:"agg"}}))??"Add Enemy Stat",children:il.map(n=>s(L,{onClick:()=>t(n),children:s(de,{tag:{q:n,qt:"common",et:"enemy",sheet:"agg"},showPercent:!0})},n))})}function Zg({tag:e,setTag:t,value:n,setValue:o,onDelete:i}){var a;const r=(a=e.q)==null?void 0:a.endsWith("_");return s(W,{bgt:"light",children:y(V,{sx:{display:"flex",gap:1,justifyContent:"space-around",alignItems:"center",flexWrap:"wrap"},children:[s(R,{children:s(de,{tag:e})}),sl(["res_","resRed_"],e.q)&&s(Yg,{tag:e,setAttribute:l=>{const{attribute:d,...c}=e;t(l?{...c,attribute:l}:c)}}),s(qe,{float:!0,value:n,sx:{flexBasis:150,flexGrow:1,height:"100%"},onChange:o,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:y(Mn,{position:"end",sx:{ml:0},children:[r?"%":void 0," ",s(Ke,{"aria-label":"Delete Enemy Stat",onClick:i,edge:"end",children:s(Ts,{fontSize:"small"})})]})}})]})})}function Yg({tag:e,setAttribute:t}){return y(ie,{title:e.attribute?s(Se,{attribute:e.attribute}):"No Attribute",color:e.attribute,children:[s(L,{onClick:()=>t(null),children:"No Attribute"}),Ae.map(n=>s(L,{onClick:()=>t(n),children:s(ve,{color:n,children:s(Se,{attribute:n})})},n))]})}function us(e){return e.reduce((t,n)=>t*n.length,1)}const ey=50;class ty{constructor(t){this.info=new Map,this.progress={computed:0,failed:0,skipped:0,remaining:0},this.nextReport=Date.now(),this.finalize=()=>{},this.terminate=()=>{};const{progress:n}=this,{topN:o,numWorkers:i,setProgress:r}=t,a=[...Array(i)].map(()=>new Worker(new URL(""+new URL("workerHandle-CSrCyUap.js",import.meta.url).href,import.meta.url),{type:"module"})),l=gd(t.nodes,t.candidates,"q",t.minimum,o),{nodes:d,minimum:c,candidates:u}=l;if(n.remaining=us(u),n.skipped=us(t.candidates)-n.remaining,n.remaining>Number.MAX_SAFE_INTEGER)throw new Error("too many combinations");this.topN=o,this.optThreshold=c[0],this.info=new Map(a.map(m=>[m,{builds:[]}]));const p=u.map(m=>m.map(g=>g.id));this.state={ty:"work",works:[{ids:p,count:n.remaining}]},this.report=()=>r({...n}),this.results=new Promise((m,g)=>{this.finalize=$=>(this.report(),m($)),this.terminate=g});const h=()=>a.forEach(m=>m.terminate());this.results.then(h,h);for(const m of a)m.onmessage=({data:g})=>{try{this.onWorkerMsg(g,m)}catch($){this.terminate($)}},un(m,{ty:"init",nodes:d,minimum:c,candidates:u,topN:o})}distribute(t){const{state:n}=this;if(n.ty==="work"){n.works.push(...t);return}for(const o of n.workers)if(this.give(t,o))n.workers.delete(o);else return;this.state={ty:"work",works:t}}idle(t){const{state:n,progress:o,info:i}=this;if(n.ty==="idle")n.workers.add(t);else if(this.give(n.works,t)){const r=o.remaining/(i.size+.5);i.forEach((a,l)=>un(l,{ty:"work?",maxKeep:r}))}else this.state={ty:"idle",workers:new Set([t])}}give(t,n){if(!t.length)return!1;let o=this.progress.remaining/(this.info.size+.5),i=t.findIndex(a=>(o-=a.count)<0)+1;i>1&&(i-=1);const r=t.splice(0,i||t.length);return un(n,{ty:"add",works:r}),!0}onWorkerMsg(t,n){var o;switch(t.ty){case"progress":{const i=this.progress,r=this.info.get(n);i.remaining-=t.computed+t.skipped,i.computed+=t.computed,i.failed+=t.failed,i.skipped+=t.skipped,r.builds=t.builds,t.idle&&this.idle(n);const a=Date.now();if(this.nextReport<=a||!t.remaining){this.nextReport=a+ey,this.report();const l=[...this.info.values()].flatMap(c=>c.builds);l.sort((c,u)=>u.value-c.value);const d=((o=l[this.topN])==null?void 0:o.value)??-1/0;d>this.optThreshold&&(this.optThreshold=d,this.info.forEach((c,u)=>un(u,{ty:"config",threshold:d}))),this.progress.remaining||this.finalize(l.slice(0,this.topN))}break}case"add":this.distribute(t.works);break;case"err":this.terminate(t.msg+" (Worker Error)")}}}function un(e,t){e.postMessage(t)}function ny(e,t,n,o,i,r,a,l,d,c){const u=new Set(Pt),p=new Set(Ot),h=[ac(...n.map((g,$)=>Qs(g.multiplier,new Gn({src:e,...g.tag},void 0).with("preset",`preset${$}`)))),...o.map(({tag:g,isMax:$})=>{const C={...al(g),src:e,preset:"preset0"};return $?Qs(-1,new Gn(C,void 0)):new Gn(C,void 0)})],m=rd(h,t,g=>{if(g.src===e&&g.et==="own"){if(g.sheet==="dyn"&&g.qt==="initial")return g.q==="dmg_"?{q:`${g.attribute}_dmg_`}:{q:g.q};if(g.q==="count"&&u.has(g.sheet))return{q:g.sheet};if(g.qt=="wengine"&&["lvl","phase","modification"].includes(g.q))return{q:g.q};if(g.q==="count"&&p.has(g.sheet))return{q:g.sheet}}});return m.push(i.length?os(...i.map(g=>gn({q:g},"sum"))):le(1/0),r.length?os(...r.map(g=>gn({q:g},"sum"))):le(1/0)),new ty({nodes:m,candidates:[a.map(sy),l[1].map(Ie),l[2].map(Ie),l[3].map(Ie),l[4].map(Ie),l[5].map(Ie),l[6].map(Ie)],minimum:[-1/0,...o.map(({value:g,isMax:$,tag:C})=>{const S=as(g,C.q??"");return $?S*-1:S}),2,4],numWorkers:d,topN:10,setProgress:c})}function Ie(e){const{id:t,mainStatKey:n,level:o,rarity:i,setKey:r,substats:a}=e;return{id:t,[n]:dc(i,n,o),...Object.fromEntries(a.filter(({key:l,upgrades:d})=>l&&d).map(({key:l,upgrades:d})=>[l,uc(l,i)*d])),[r]:1}}function sy(e){const{id:t,key:n,level:o,modification:i,phase:r}=e;return{id:t,lvl:o,modification:i,phase:r,[n]:1}}var At={},Ya;function oy(){if(Ya)return At;Ya=1;var e=hs();Object.defineProperty(At,"__esModule",{value:!0}),At.default=void 0;var t=e(ms()),n=fs(),o=(0,t.default)((0,n.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp");return At.default=o,At}var iy=oy();const ay=gs(iy),cy=f.memo(function({disabled:t=!1}){const{database:n}=O(),{optConfigId:o,optConfig:i}=f.useContext(ae);return y(W,{bgt:"light",children:[s(V,{sx:{display:"flex",gap:1},children:s(R,{sx:{fontWeight:"bold"},children:"Disc Level Filter"})}),s(ee,{}),s(cl,{levelLow:(i==null?void 0:i.levelLow)??Zs.S,levelHigh:(i==null?void 0:i.levelHigh)??Zs.S,setLow:r=>n.optConfigs.set(o,{levelLow:r}),setHigh:r=>n.optConfigs.set(o,{levelHigh:r}),setBoth:(r,a)=>n.optConfigs.set(o,{levelLow:r,levelHigh:a}),disabled:t})]})});function ry({discBySlot:e,setFilter4:t,setFilter2:n,setSetFilter4:o,setSetFilter2:i}){const r=J(),a=te(r==null?void 0:r.key),l=f.useMemo(()=>{const d=Ce(Pt,()=>Ce(_s,()=>0));return Object.values(e).forEach(c=>c.forEach(({setKey:u,slotKey:p})=>d[u][p]++)),d},[e]);return y(Lt,{children:[y(M,{sx:{display:"flex",gap:1,alignItems:"center"},children:[s(R,{variant:"h6",sx:{flexGrow:1},children:"Disc Set Config"}),s(U,{disabled:!t.length,onClick:()=>o([]),children:"Reset 4p filter"}),s(U,{disabled:!n.length,onClick:()=>i([]),children:"Reset 2p filter"})]}),s(M,{children:r&&a&&s(jc,{character:r,conditionals:a.conditionals,children:s(se,{container:!0,spacing:1,children:Pt.map(d=>s(se,{item:!0,xs:1,md:2,lg:3,children:s(ly,{numSlot:l[d],setKey:d,setFilter4:t,setFilter2:n,setSetFilter4:o,setSetFilter2:i})},d))})})})]})}function ly({numSlot:e,setKey:t,setFilter4:n,setFilter2:o,setSetFilter4:i,setSetFilter2:r}){const a=!!o.length&&!o.includes(t),l=!!n.length&&!n.includes(t);return y(Hc,{setKey:t,fade2:a,fade4:l,children:[s(M,{sx:{display:"flex",justifyContent:"space-around",pb:1},children:Object.entries(e).map(([d,c])=>s(M,{children:s(je,{color:c?"primary":"secondary",children:c})},d))}),y(rl,{fullWidth:!0,children:[s(U,{sx:{borderRadius:0},color:!n.length||n.includes(t)?"success":"secondary",onClick:()=>i(n.length?Ys([...n],t):[t]),children:"Allow 4p"}),s(U,{sx:{borderRadius:0},color:!o.length||o.includes(t)?"success":"secondary",onClick:()=>r(o.length?Ys([...o],t):[t]),children:"Allow 2p"})]})]})}function dy({discsBySlot:e}){const[t,n,o]=ks();return s(W,{bgt:"light",children:s(V,{children:y(B,{spacing:1,children:[s(ye,{sx:{display:"flex",gap:2,justifyContent:"space-between"},children:_s.map(i=>s(_e,{discsBySlot:e,slotKey:i},i))}),s(uy,{show:t,onClose:o,discsBySlot:e}),s(U,{color:"info",fullWidth:!0,onClick:n,children:"Disc Filter Config"})]})})})}function _e({discsBySlot:e,slotKey:t}){return y(R,{children:["Disc ",t," ",s(je,{color:e[t].length?"primary":"error",children:e[t].length})]})}function uy({discsBySlot:e,show:t,onClose:n,disabled:o}){const{database:i}=O(),{optConfigId:r,optConfig:a}=f.useContext(ae);return s(xs,{open:t,onClose:n,children:y(W,{children:[s(Bt,{title:"Disc Filter",action:s(Ke,{onClick:n,children:s(Sn,{})})}),s(ee,{}),s(V,{children:s(f.Suspense,{fallback:s(xc,{width:"100%",height:"500px"}),children:y(B,{spacing:1,children:[s(cy,{disabled:o}),s(py,{discsBySlot:e,disabled:o}),s(U,{disabled:o,onClick:()=>i.optConfigs.set(r,{useEquipped:!a.useEquipped}),color:a.useEquipped?"success":"secondary",children:"Use equipped Discs"}),s(hy,{discBySlot:e,disabled:o})]})})})]})})}function py({discsBySlot:e,disabled:t}){const{database:n}=O(),{optConfigId:o,optConfig:i}=f.useContext(ae),r=a=>{const l=ll([...eo[a]]),d={4:i.slot4??[],5:i.slot5??[],6:i.slot6??[]},c={4:u=>n.optConfigs.set(o,{slot4:u}),5:u=>n.optConfigs.set(o,{slot5:u}),6:u=>n.optConfigs.set(o,{slot6:u})};return s(ye,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:eo[a].map(u=>s(U,{disabled:t,variant:d[a].includes(u)?"contained":"outlined",onClick:()=>c[a](l([...d[a]],u)),children:s(ge,{statKey:u,showPercent:!0})},u))})};return s(W,{bgt:"light",children:s(V,{children:y(B,{spacing:1,children:[y(ye,{sx:{display:"flex",justifyContent:"space-between"},children:[s(_e,{slotKey:"1",discsBySlot:e}),s(_e,{slotKey:"2",discsBySlot:e}),s(_e,{slotKey:"3",discsBySlot:e})]}),s(_e,{slotKey:"4",discsBySlot:e}),r("4"),s(_e,{slotKey:"5",discsBySlot:e}),r("5"),s(_e,{slotKey:"6",discsBySlot:e}),r("6")]})})})}function hy({discBySlot:e,disabled:t}){const{database:n}=O(),{optConfigId:o,optConfig:i}=f.useContext(ae),{setFilter2:r=[],setFilter4:a=[]}=i,l=f.useCallback(c=>{n.optConfigs.set(o,{setFilter2:c})},[n,o]),d=f.useCallback(c=>{n.optConfigs.set(o,{setFilter4:c})},[n,o]);return s(ry,{discBySlot:e,disabled:t,setFilter2:r,setFilter4:a,setSetFilter2:l,setSetFilter4:d})}function my({disabled:e=!1}){const{optConfigId:t,optConfig:{statFilters:n}}=f.useContext(ae),{database:o}=O(),i=f.useCallback(r=>o.optConfigs.set(t,{statFilters:r}),[o,t]);return y(W,{bgt:"light",children:[s(V,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:s(M,{display:"flex",justifyContent:"space-between",children:s(R,{sx:{fontWeight:"bold"},children:"Stat Filter"})})}),s(ee,{}),s(V,{children:s(fy,{statFilters:n,setStatFilters:i,disabled:e})})]})}function fy({statFilters:e,setStatFilters:t,disabled:n=!1}){const o=f.useCallback((c,u)=>{const p=structuredClone(e);typeof u>"u"?p.push({tag:c,value:0,isMax:!1,disabled:!1}):p[u].tag=c,t(p)},[t,e]),i=f.useCallback(c=>{const u=structuredClone(e);u.splice(c,1),t(u)},[t,e]),r=f.useCallback((c,u)=>{const p=structuredClone(e);p[c].value=u,t(p)},[t,e]),a=f.useCallback((c,u)=>{const p=structuredClone(e);p[c].isMax=u,t(p)},[t,e]),l=f.useCallback((c,u)=>{const p=structuredClone(e);p[c].disabled=u,t(p)},[t,e]),d=c=>o(hl(c));return y(M,{display:"flex",flexDirection:"column",gap:1,children:[e.map((c,u)=>s(yy,{statFilter:c,delTarget:()=>i(u),setTarget:p=>o(p,u),setTargetValue:p=>r(u,p),setTargetisMax:p=>a(u,p),setDisabled:p=>l(u,p),disabled:n},u+JSON.stringify(c))),s(gy,{onSelect:d})]})}function gy({tag:e,onSelect:t}){return s(ie,{title:(e&&s(de,{tag:e}))??"Add Final Stat Filter",children:ml.map(n=>s(L,{onClick:()=>t(n),children:s(ge,{statKey:n,showPercent:!0})},n))})}function yy({statFilter:e,delTarget:t,setTarget:n,setTargetValue:o,setTargetisMax:i,setDisabled:r,disabled:a}){const{tag:l,value:d,isMax:c,disabled:u}=e,p=dl(l.q??"");return s(W,{children:y(V,{sx:{display:"flex",gap:1,alignItems:"center"},children:[s(U,{color:u?"secondary":"success",onClick:()=>r(!u),disabled:a,size:"small",children:u?s(ul,{}):s(pl,{})}),s(R,{children:s(de,{tag:l})}),l.q==="dmg_"&&s(xy,{tag:l,setAttribute:h=>{const{attribute:m,...g}=l;n(h?{...g,attribute:h}:g)}}),s(U,{onClick:()=>i(!c),size:"small",children:s("strong",{children:c?"MAX":"MIN"})}),s(qe,{float:!0,value:d,sx:{flexBasis:150,flexGrow:1,height:"100%"},disabled:a,onChange:o,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:y(Mn,{position:"end",sx:{ml:0},children:[p?"%":void 0," ",s(Ke,{"aria-label":"Delete Stat Constraint",onClick:t,edge:"end",children:s(Ts,{fontSize:"small"})})]})}})]})})}function xy({tag:e,setAttribute:t}){return y(ie,{title:e.attribute?s(Se,{attribute:e.attribute}):"No Attribute",color:e.attribute,children:[s(L,{onClick:()=>t(null),children:"No Attribute"}),Ae.map(n=>s(L,{onClick:()=>t(n),children:s(ve,{color:n,children:s(Se,{attribute:n})})},n))]})}const by=f.memo(function({disabled:t=!1}){const{database:n}=O(),{optConfigId:o,optConfig:i}=f.useContext(ae);return y(W,{bgt:"light",children:[s(V,{sx:{display:"flex",gap:1},children:s(R,{sx:{fontWeight:"bold"},children:"Wengine Level Filter"})}),s(ee,{}),s(Pd,{levelLow:(i==null?void 0:i.wlevelLow)??bn,levelHigh:(i==null?void 0:i.wlevelHigh)??bn,setLow:r=>n.optConfigs.set(o,{wlevelLow:r}),setHigh:r=>n.optConfigs.set(o,{wlevelHigh:r}),setBoth:(r,a)=>n.optConfigs.set(o,{wlevelLow:r,wlevelHigh:a}),disabled:t})]})});function $y({wengines:e,disabled:t}){const{database:n}=O(),{optConfigId:o,optConfig:i}=f.useContext(ae),[r,a,l]=ks();return s(W,{bgt:"light",children:s(V,{children:y(B,{spacing:1,children:[y(ye,{sx:{display:"flex",gap:2,justifyContent:"space-between",alignItems:"center"},children:[y(ye,{sx:{display:"flex",gap:1,justifyContent:"space-between"},children:["Wengines:"," ",s(je,{color:e.length?"primary":"error",children:e.length})]}),s(U,{sx:{flexGrow:1},startIcon:i.optWengine?s(fl,{}):s(gl,{}),color:i.optWengine?"success":"secondary",onClick:()=>n.optConfigs.set(o,{optWengine:!i.optWengine}),children:"Optimize Wengine"})]}),s(wy,{show:r,onClose:l,wengines:e}),s(U,{color:"info",fullWidth:!0,onClick:a,disabled:t||!i.optWengine,children:"Wengine Filter Config"})]})})})}function wy({wengines:e,show:t,onClose:n,disabled:o}){const{database:i}=O(),{optConfigId:r,optConfig:a}=f.useContext(ae);return s(xs,{open:t,onClose:n,children:y(W,{children:[s(Bt,{title:"Wengine Filter",action:s(Ke,{onClick:n,children:s(Sn,{})})}),s(ee,{}),s(V,{children:s(f.Suspense,{fallback:s(xc,{width:"100%",height:"500px"}),children:y(B,{spacing:1,children:[s(by,{disabled:o}),s(_y,{disabled:o}),s(U,{disabled:o,onClick:()=>i.optConfigs.set(r,{useEquippedWengine:!a.useEquippedWengine}),color:a.useEquippedWengine?"success":"secondary",children:"Use equipped Wengine"}),s(ky,{wengines:e})]})})})]})})}function _y({disabled:e}){const{database:t}=O(),{optConfigId:n,optConfig:o}=f.useContext(ae),{wEngineTypes:i}=o,r=ds(t.wengines),{key:a}=J(),l=f.useMemo(()=>r&&o.optWengine?t.wengines.values.reduce((d,{key:c,level:u,location:p})=>{if(u<o.wlevelLow||u>o.wlevelHigh||p&&!o.useEquippedWengine&&p!==a)return d;const h=Dn(c).type;return h&&d[h]++,d},Ce(to,()=>0)):Ce(to,()=>0),[a,r,t.wengines,o.wlevelLow,o.wlevelHigh,o.optWengine,o.useEquippedWengine]);return s(yl,{onChange:d=>t.optConfigs.set(n,{wEngineTypes:d}),value:i,disabled:e,totals:l,fullWidth:!0})}function ky({wengines:e}){const t=J(),n=te(t==null?void 0:t.key),{optConfig:o}=f.useContext(ae),{wEngineTypes:i}=o,r=f.useMemo(()=>i.length?Ot.filter(a=>i.includes(Dn(a).type)):Ot,[i]);return y(ye,{children:[s(R,{variant:"h6",children:"Wengine Condtional Configuration"}),s(R,{children:"Wengine stats are displayed to be Lvl 60/60, P1, actual level/phase of wengine will be used in the solver."}),t&&n&&s(jc,{character:t,conditionals:n.conditionals,children:s(se,{container:!0,spacing:1,columns:{xs:2,md:3,lg:4},children:r.map(a=>s(se,{item:!0,xs:1,children:s(Cy,{wengineKey:a,count:e.filter(l=>l.key===a).length})},a))})})]})}function vy(e){return{key:e,level:60,modification:5,phase:1,location:"",lock:!1}}function Cy({wengineKey:e,count:t}){const n=f.useMemo(()=>vy(e),[e]);return s(Gc,{wengine:n,headerAction:s(je,{color:t?"primary":"secondary",children:t}),fade:!t})}function Sy(){const{key:e}=J(),{optConfigId:t}=te(e),{database:n}=O();return f.useEffect(()=>{if(t)return;const o=n.optConfigs.new({wEngineTypes:[kc(e).specialty]});n.charOpts.set(e,{optConfigId:o})},[n,t,e]),t?s(bc,{optConfigId:t,children:s(Dy,{})}):null}function Dy(){const{t:e}=be("optimize"),{database:t}=O(),n=Ft(),{key:o}=J(),{target:i}=te(o),[r,a]=f.useState(8),[l,d]=f.useState(void 0),{optConfig:c,optConfigId:u}=f.useContext(ae),p=ds(t.discs),h=f.useMemo(()=>{const q={4:c.slot4,5:c.slot5,6:c.slot6},K=I=>["4","5","6"].includes(I);return p&&t.discs.values.reduce((I,P)=>{const{slotKey:Q,mainStatKey:Z,level:pe,location:ce}=P;return pe<c.levelLow||pe>c.levelHigh||ce&&!c.useEquipped&&ce!==o||K(Q)&&!q[Q].includes(Z)||I[P.slotKey].push(P),I},{1:[],2:[],3:[],4:[],5:[],6:[]})},[o,p,t.discs,c.levelHigh,c.levelLow,c.slot4,c.slot5,c.slot6,c.useEquipped]),m=ds(t.wengines),g=f.useMemo(()=>m&&t.wengines.values.filter(({key:q,level:K,location:I})=>{if(!c.optWengine)return I===o;if(K<c.wlevelLow||K>c.wlevelHigh||I&&!c.useEquippedWengine&&I!==o)return!1;const{type:P}=Dn(q);return!!c.wEngineTypes.includes(P)}),[o,t.wengines,c.wlevelLow,c.wlevelHigh,c.optWengine,c.wEngineTypes,c.useEquippedWengine,m]),$=f.useMemo(()=>us(Object.values(h))*g.length,[g.length,h]),[C,S]=f.useState(!1),E=f.useRef(()=>{});f.useEffect(()=>()=>E.current(),[]);const A=f.useCallback(async()=>{if(!n||!i)return;const q=new Promise(Q=>E.current=Q);d(void 0),S(!0);const K=(c.statFilters??[]).filter(Q=>!Q.disabled),I=ny(o,n,[{tag:$c(i),multiplier:1}],K,c.setFilter2,c.setFilter4,g,h,r,d);q.then(()=>I.terminate("user cancelled"));let P;try{P=await I.results}catch{return}finally{E.current=()=>{},S(!1)}P.length&&t.optConfigs.newOrSetGeneratedBuildList(u,{builds:P.slice(0,5).map(({ids:Q,value:Z})=>({wengineId:Q[0],discIds:Ce(_s,(pe,ce)=>Q[ce+1]),value:Z})),buildDate:Date.now()})},[n,i,c.statFilters,c.setFilter2,c.setFilter4,o,g,h,r,t.optConfigs,u]),X=f.useCallback(()=>{E.current(),S(!1)},[E]);return s(W,{children:s(V,{children:y(B,{spacing:1,children:[y(M,{sx:{display:"flex",gap:1,flexWrap:"wrap","& .MuiPaper-root":{flexGrow:1}},children:[s(my,{}),s($y,{wengines:g}),s(dy,{discsBySlot:h})]}),l&&s(My,{progress:l,total:$}),y(M,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[s(Od,{numWorkers:r,setNumWorkers:a}),s(U,{disabled:!$||!i,onClick:C?X:A,color:C?"error":"primary",startIcon:C?s(Sn,{}):s(ay,{}),children:e(C?"cancel":"optimize")})]})]})})})}function pn({value:e}){const t=e.toLocaleString();return s(M,{component:"span",sx:{fontFamily:"Monospace",display:"inline"},children:t})}function My(e){const{t}=be("optimize"),{computed:n,remaining:o,skipped:i}=e.progress,r=n+o,a=Math.log1p(r)/Math.log1p(e.total),l=o/r*a;return y(M,{children:[y(R,{children:[t("computed"),": ",s(pn,{value:n})," /"," ",s(pn,{value:r})," "]}),y(R,{children:[t("computed + skipped"),": ",s(pn,{value:n+i})," /"," ",s(pn,{value:e.total})]}),s(xl,{variant:"determinate",value:(1-l)*100,sx:{height:10,borderRadius:5}})]})}const Ey={xs:2,sm:1,md:2,lg:3,xl:4};function Ty({onClick:e}){const t=f.useContext(wc);return s(_c,{discIds:t==null?void 0:t.equippedDiscs,wengineId:t==null?void 0:t.equippedWengine,onClick:e,columns:Ey})}var qt={},ec;function Iy(){if(ec)return qt;ec=1;var e=hs();Object.defineProperty(qt,"__esModule",{value:!0}),qt.default=void 0;var t=e(ms()),n=fs(),o=(0,t.default)((0,n.jsx)("path",{d:"M21.6 18.2 13 11.75v-.91c1.65-.49 2.8-2.17 2.43-4.05-.26-1.31-1.3-2.4-2.61-2.7C10.54 3.57 8.5 5.3 8.5 7.5h2c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5c0 .84-.69 1.52-1.53 1.5-.54-.01-.97.45-.97.99v1.76L2.4 18.2c-.77.58-.36 1.8.6 1.8h18c.96 0 1.37-1.22.6-1.8zM6 18l6-4.5 6 4.5H6z"}),"Checkroom");return qt.default=o,qt}var Ry=Iy();const Ay=gs(Ry);function qy(e){const{database:t}=O();return ps(t.generatedBuildList,e)}const zy=f.memo(function(){const{optConfig:t}=f.useContext(ae),n=qy(t.generatedBuildListId??"");return s(B,{spacing:1,children:n==null?void 0:n.builds.map((o,i)=>s(Oy,{build:o,index:i},`${i}-${o.wengineId}-${Object.values(o.discIds).join("-")}`))})});function Vy({build:{discIds:e,wengineId:t}}){const{t:n}=be("build"),{database:o}=O(),{key:i}=J()??{},r=f.useCallback(()=>{i&&(Object.entries(e).forEach(([a,l])=>l&&o.discs.set(l,{location:i})),t&&o.wengines.set(t,{location:i}))},[i,e,t,o.wengines,o.discs]);return s(U,{color:"info",size:"small",startIcon:s(Ay,{}),onClick:r,children:n("buildDisplay.equipToCrr")})}function Oy({build:e,index:t}){const n=J(),o=te(n.key);return s(Pc,{character:n,charOpt:o,discIds:e.discIds,wengineId:e.wengineId,children:s(W,{children:s(V,{children:y(B,{spacing:1,children:[y(M,{sx:{display:"flex",justifyContent:"space-between",gap:1},children:[y(R,{children:["Build ",t+1,": ",ws(e.value)]}),s(Vy,{build:e})]}),s(M,{children:y(se,{container:!0,spacing:1,children:[s(se,{item:!0,xs:6,md:4,lg:3,xl:3,children:s(Xc,{})}),s(se,{item:!0,xs:6,md:8,lg:9,xl:9,children:s(_c,{discIds:e.discIds,wengineId:e.wengineId})})]})})]})})})})}const Py=210,Qc=f.createContext(Py),jy=0,zt=33,Zc=f.createContext(0);function Wy(){const[e,t]=f.useState(""),n=f.useMemo(()=>({statHighlight:e,setStatHighlight:t}),[e,t]),o=f.useMemo(()=>[["char",s(Ny,{},"char")],["opt",s(Ky,{},"opt")],["builds",s(By,{},"builds")]],[]);return s(yc.Provider,{value:n,children:s(Zc.Provider,{value:o.length,children:s(B,{gap:1,children:o.map(([i,r],a)=>s(Yc,{title:i,index:a,zIndex:100,children:r},i))})})})}function Yc({index:e,title:t,children:n,zIndex:o,top:i=0,bottom:r=0}){const{t:a}=be("page_optimize"),[l,d]=sd(),c=f.useContext(Zc),u=f.useContext(Qc);return y(Lt,{children:[s(W,{sx:p=>({outline:`2px solid ${p.palette.secondary.main}`,position:"sticky",top:u+e*zt+i,bottom:jy+(c-1-e)*zt+r,zIndex:o}),children:s($l,{onClick:d,sx:{px:2},children:s(R,{variant:"h6",children:a(`${t}`)})})}),s(M,{ref:l,sx:{scrollMarginTop:u+(e+1)*zt+i},children:n})]})}function Ny(){const e=J(),{key:t}=e,[n,o]=f.useState(void 0),i=f.useCallback(()=>{e!=null&&e.key&&o(e.key)},[e]),r=f.useMemo(()=>[["eq",s(Ty,{onClick:i},"eq")],["Conditionals",s(Ly,{},"conditionals")],["bonusStats",s(Lg,{},"bonusStats")],["enemyStats",s(Xg,{},"enemyStats")]],[i]),a=nc(),l=bl(a.breakpoints.up("sm"));return y(Lt,{children:[s(Il,{characterKey:n,onClose:()=>o(void 0)}),y(B,{spacing:1,children:[s(W,{sx:{overflow:"visible"},children:s(V,{sx:{display:"flex",gap:1,overflow:"visible"},children:y(se,{container:!0,spacing:2,sx:{flexWrap:"wrap",overflow:"visible"},children:[s(se,{item:!0,xs:12,sm:7,md:5,lg:4,xl:3,sx:{height:l?"100%":void 0,overflow:"visible"},children:y(B,{spacing:1,sx:l?{height:"100%"}:void 0,children:[s(Rl,{characterKey:t,onClick:i}),s(M,{sx:{flexGrow:1},children:s(M,{sx:l?{position:"sticky",top:"115px",bottom:"0px"}:void 0,children:s(Xc,{})})})]})}),s(se,{item:!0,xs:12,sm:5,md:7,lg:8,xl:9,children:s(B,{spacing:1.5,children:r.map(([d,c],u)=>s(Yc,{title:d,index:u,zIndex:99,top:zt,bottom:zt*2,children:c},d))})})]})})}),s(Ad,{formulasRead:z.listing.formulas,buffsRead:z.listing.buffs})]})]})}function Ky(){return s(Sy,{})}function By(){const{key:e}=J(),{optConfigId:t}=te(e);return t?s(bc,{optConfigId:t,children:s(zy,{})}):null}function Ly(){const{equippedDiscs:e,equippedWengine:t}=J(),n=mc(e),o=wl(n),i=hc(t);return s(M,{children:y(se,{container:!0,spacing:1,columns:{xs:1,sm:1,md:2,lg:3},children:[i&&s(se,{item:!0,xs:1,children:s(Gc,{wengine:i})}),Object.entries(o).map(([r,a])=>s(se,{item:!0,xs:1,children:s(Hc,{setKey:r,fade2:a<2,fade4:a<4})},r))]})})}const tc={avg:"Average",crit:"Crit Hit",nonCrit:"Non-Crit Hit"};function Hy(){const{database:e}=O(),t=J(),n=te(t.key),{critMode:o}=n;return s(ie,{title:y(M,{sx:{textWrap:"nowrap"},children:["Hit mode: ",tc[o]]}),children:_l.map(i=>s(L,{selected:o===i,disabled:o===i,onClick:()=>e.charOpts.set(t.key,{critMode:i}),children:tc[i]},i))})}const Fy=[z.final.atk,z.final.hp,z.final.def,z.final.enerRegen,z.final.anomProf,z.final.anomMas];function Gy({character:{key:e},charOpt:{target:t}}){const n=Ft(),{database:o}=O(),i=f.useMemo(()=>{if(t)return $c(t)},[t]);return y(ie,{color:i?"success":"warning",title:i?y(M,{sx:{display:"flex",gap:1},children:[s("strong",{children:"Optimization Target: "}),s(fn,{tag:i})]}):"Select an Optimization Target",variant:i?"outlined":void 0,sx:{height:"100%",flexGrow:1},children:[n==null?void 0:n.listFormulas(z.listing.formulas).map(({tag:r},a)=>{const{name:l,sheet:d}=r;if(!(!l||!d))return s(L,{onClick:()=>o.charOpts.set(e,{target:{sheet:d,name:l}}),children:s(no,{children:s(M,{sx:{display:"flex",gap:1},children:s(fn,{tag:r})})})},`${a}_${r.sheet}_${r.name}`)}),Fy.map(({tag:r},a)=>{const{q:l,qt:d}=r;if(!(!l||!d))return s(L,{onClick:()=>o.charOpts.set(e,{target:{q:l,qt:d}}),children:s(no,{children:s(M,{sx:{display:"flex",gap:1},children:s(fn,{tag:r})})})},`${a}_${l}_${d}`)})]})}function Uy(){const{database:e}=O(),t=J(),n=te(t.key),{target:o}=n,i=f.useCallback(r=>e.charOpts.set(t.key,({target:a={}})=>{const{damageType1:l,...d}=a;return r?{target:{...d,damageType1:r}}:{target:d}}),[e,t.key]);return(o==null?void 0:o.name)!=="standardDmgInst"?null:s(Jc,{dmgType:o==null?void 0:o.damageType1,keys:fc,setDmgType:i})}function Jy({character:e,charOpt:t}){return y(M,{display:"flex",gap:1,sx:{position:"sticky",top:36,zIndex:100,background:"#0C1020"},children:[s(Gy,{character:e,charOpt:t}),s(Qy,{}),s(Uy,{}),s(Xy,{}),s(Hy,{})]})}function Xy(){const{database:e}=O(),t=J(),n=te(t.key),{target:o}=n,i=f.useCallback(r=>e.charOpts.set(t.key,({target:a={}})=>{const{damageType2:l,...d}=a;return r?{target:{...d,damageType2:"aftershock"}}:{target:d}}),[e,t.key]);return(o==null?void 0:o.name)!=="standardDmgInst"?null:s(Uc,{isAftershock:(o==null?void 0:o.damageType2)==="aftershock",setAftershock:i})}function Qy(){const{database:e}=O(),t=J(),n=te(t.key),{target:o}=n,{q:i,qt:r}=o??{};return!i||!r?null:s(ie,{title:Wt[r],children:["final","initial"].map(a=>s(L,{selected:a===r,disabled:a===r,onClick:()=>e.charOpts.set(t.key,{target:{q:i,qt:a}}),children:Wt[a]},a))})}function wx(){const{database:e}=O(),{optCharKey:t}=Tl(e.dbMeta),n=t??kl[0],[o,i,r]=ks(),a=f.useCallback(C=>e.dbMeta.set({optCharKey:C}),[e.dbMeta]),{t:l}=be(["charNames_gen","page_character"]),d=Al(n);f.useEffect(()=>{n&&!d&&e.chars.getOrCreate(n)},[n,d,e.chars]);const c=te(n);f.useEffect(()=>{n&&!c&&e.charOpts.getOrCreate(n)},[n,c,e.charOpts]),od(f.useMemo(()=>{const C=n&&l(`charNames_gen:${n}`);return C?`Optimize - ${C}`:"Optimize"},[n,l]));const u=f.useMemo(()=>{const S=Ce(n?[n]:[],E=>s(ql,{characterKey:E}));return{srcDisplay:S,dstDisplay:S}},[n]),p=f.useCallback((C,S,E,A,X)=>{!vl(C)||!so(E)||!(A===null||so(A))||!Cl(C,S)||e.charOpts.setConditional(n,C,S,E,A,X)},[n,e.charOpts]),h=f.useMemo(()=>({src:n,dst:n,preset:"preset0"}),[n]),[m,g]=f.useState(),$=f.useMemo(()=>({read:m,setRead:g}),[m]);return y(M,{children:[s(f.Suspense,{fallback:!1,children:s(zl,{show:o,onHide:r,onSelect:a})}),s(M,{sx:{position:"sticky",top:0,zIndex:100,background:"#0C1020"},children:s(U,{fullWidth:!0,color:kc(n).attribute,sx:{justifyContent:"flex-start",pl:"6px"},onClick:i,children:y(M,{sx:{display:"flex",gap:1,alignItems:"center"},children:[s(bs,{size:2,src:Sl(n,"circle")}),l(`charNames_gen:${n}`)]})})}),d&&c&&s(wc.Provider,{value:d,children:s(Kt.Provider,{value:h,children:s(Pc,{character:d,charOpt:c,wengineId:d.equippedWengine,discIds:d.equippedDiscs,children:s(Dl.Provider,{value:u,children:s(Ml.Provider,{value:c.conditionals,children:s(El.Provider,{value:p,children:y(ys.Provider,{value:$,children:[s(qd,{}),y(M,{sx:{display:"flex",gap:1,flexDirection:"column",mt:1},children:[s(Jy,{character:d,charOpt:c}),s(Qc.Provider,{value:74,children:s(Wy,{})})]})]})})})})})})})]})}export{wx as default};
