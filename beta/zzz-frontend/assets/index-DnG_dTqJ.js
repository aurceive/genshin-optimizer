var Ks=e=>{throw TypeError(e)};var Ls=(e,t,n)=>t.has(e)||Ks("Cannot "+n);var we=(e,t,n)=>(Ls(e,t,"read from private field"),n?n.call(e):t.get(e)),Te=(e,t,n)=>t.has(e)?Ks("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),Z=(e,t,n,o)=>(Ls(e,t,"write to private field"),o?o.call(e,n):t.set(e,n),n);import{z as _n,E as kn,c as f,H as vn,J as hr,K as mr,_ as Cn,L as j,N as sc,O as fr,P as gr,Q as te,U as be,V as Ot,W as Sn,X as Hs,Y as yr,Z as xr,$ as br,a0 as $r,j as s,a1 as wr,h as pe,a2 as _r,a3 as Fs,a4 as oc,a5 as kr,a6 as Bt,a7 as vr,a8 as ic,a9 as ac,aa as de,ab as yn,ac as cc,ad as os,ae as Cr,i as Sr,u as P,af as hs,ag as rc,ah as Dr,ai as Mr,aj as Er,ak as lc,al as Vt,am as jt,an as F,ao as Tr,ap as Ir,aq as z,ar as xn,as as Rr,at as Ar,au as dc,av as bn,aw as qr,r as ms,a as fs,b as gs,g as ys,ax as Kt,ay as Ne,az as xs,aA as ge,d as y,p as Lt,I as Be,q as Dn,e as O,C as W,aB as is,s as ie,T as R,aC as le,M as bs,aD as xe,aE as zr,aF as Pr,n as E,aG as uc,aH as Or,aI as Vr,aJ as jr,aK as V,aL as se,aM as Wr,aN as Nr,F as Ht,aO as Gs,aP as Us,aQ as $n,aR as Br,aS as ve,aT as je,aU as hn,aV as Kr,aW as Lr,aX as Hr,aY as Wt,aZ as mn,a_ as ye,a$ as Js,b0 as _,b1 as N,b2 as w,b3 as $s,b4 as Fr,w as G,b5 as ws,b6 as D,b7 as v,b8 as pc,b9 as Gr,ba as Mn,bb as Ur,bc as Xs,bd as Qs,be as Jr,bf as Ae,bg as hc,bh as Xr,bi as _s,bj as mc,bk as fc,bl as ue,bm as gc,bn as as,bo as Qr,bp as yc,bq as xc,br as Zr,bs as Ce,B as U,bt as J,bu as Yr,bv as el,bw as qe,bx as En,by as tl,bz as nl,bA as sl,bB as ol,bC as bc,bD as il,bE as al,bF as cl,bG as rl,bH as ll,bI as dl,bJ as Zs,bK as ul,bL as ce,bM as Ys,bN as pl,bO as ks,G as ne,bP as hl,bQ as eo,x as vs,S as $c,bR as ml,bS as to,bT as fl,bU as gl,bV as yl,bW as xl,bX as bl,bY as $l,bZ as wl,b_ as no,b$ as _l,c0 as wc,c1 as _c,c2 as kl,c3 as kc,c4 as vc,c5 as vl,c6 as Cl,c7 as Sl,c8 as Dl,c9 as so,ca as Ml,cb as El,cc as oo,cd as Tl,ce as Il,cf as Rl,cg as Al,ch as ql,ci as zl,cj as Pl,ck as Ol}from"./index-CTc_zDGz.js";import{u as Vl}from"./useDataEntryBase-BDiL9W8L.js";import{A as Se,g as Cc,C as jl,a as Wl,u as Nl,b as Bl,c as Kl}from"./CharacterEditor-0SGeAoAU.js";import"./discSortUtil-CFeUtlL-.js";function Ll(e){return _n("MuiCollapse",e)}kn("MuiCollapse",["root","horizontal","vertical","entered","hidden","wrapper","wrapperInner"]);const Hl=["addEndListener","children","className","collapsedSize","component","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","orientation","style","timeout","TransitionComponent"],Fl=e=>{const{orientation:t,classes:n}=e,o={root:["root",`${t}`],entered:["entered"],hidden:["hidden"],wrapper:["wrapper",`${t}`],wrapperInner:["wrapperInner",`${t}`]};return Sn(o,Ll,n)},Gl=be("div",{name:"MuiCollapse",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[n.orientation],n.state==="entered"&&t.entered,n.state==="exited"&&!n.in&&n.collapsedSize==="0px"&&t.hidden]}})(({theme:e,ownerState:t})=>j({height:0,overflow:"hidden",transition:e.transitions.create("height")},t.orientation==="horizontal"&&{height:"auto",width:0,transition:e.transitions.create("width")},t.state==="entered"&&j({height:"auto",overflow:"visible"},t.orientation==="horizontal"&&{width:"auto"}),t.state==="exited"&&!t.in&&t.collapsedSize==="0px"&&{visibility:"hidden"})),Ul=be("div",{name:"MuiCollapse",slot:"Wrapper",overridesResolver:(e,t)=>t.wrapper})(({ownerState:e})=>j({display:"flex",width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),Jl=be("div",{name:"MuiCollapse",slot:"WrapperInner",overridesResolver:(e,t)=>t.wrapperInner})(({ownerState:e})=>j({width:"100%"},e.orientation==="horizontal"&&{width:"auto",height:"100%"})),Cs=f.forwardRef(function(t,n){const o=vn({props:t,name:"MuiCollapse"}),{addEndListener:i,children:r,className:a,collapsedSize:l="0px",component:d,easing:c,in:u,onEnter:p,onEntered:h,onEntering:m,onExit:b,onExited:x,onExiting:C,orientation:S="vertical",style:M,timeout:A=mr.standard,TransitionComponent:X=hr}=o,q=Cn(o,Hl),B=j({},o,{orientation:S,collapsedSize:l}),I=Fl(B),K=sc(),Q=fr(),ee=f.useRef(null),he=f.useRef(),re=typeof l=="number"?`${l}px`:l,$e=S==="horizontal",It=$e?"width":"height",tn=f.useRef(null),ir=gr(n,tn),Ee=T=>oe=>{if(T){const me=tn.current;oe===void 0?T(me):T(me,oe)}},Gn=()=>ee.current?ee.current[$e?"clientWidth":"clientHeight"]:0,ar=Ee((T,oe)=>{ee.current&&$e&&(ee.current.style.position="absolute"),T.style[It]=re,p&&p(T,oe)}),cr=Ee((T,oe)=>{const me=Gn();ee.current&&$e&&(ee.current.style.position="");const{duration:Rt,easing:nn}=Hs({style:M,timeout:A,easing:c},{mode:"enter"});if(A==="auto"){const Bs=K.transitions.getAutoHeightDuration(me);T.style.transitionDuration=`${Bs}ms`,he.current=Bs}else T.style.transitionDuration=typeof Rt=="string"?Rt:`${Rt}ms`;T.style[It]=`${me}px`,T.style.transitionTimingFunction=nn,m&&m(T,oe)}),rr=Ee((T,oe)=>{T.style[It]="auto",h&&h(T,oe)}),lr=Ee(T=>{T.style[It]=`${Gn()}px`,b&&b(T)}),dr=Ee(x),ur=Ee(T=>{const oe=Gn(),{duration:me,easing:Rt}=Hs({style:M,timeout:A,easing:c},{mode:"exit"});if(A==="auto"){const nn=K.transitions.getAutoHeightDuration(oe);T.style.transitionDuration=`${nn}ms`,he.current=nn}else T.style.transitionDuration=typeof me=="string"?me:`${me}ms`;T.style[It]=re,T.style.transitionTimingFunction=Rt,C&&C(T)}),pr=T=>{A==="auto"&&Q.start(he.current||0,T),i&&i(tn.current,T)};return te.jsx(X,j({in:u,onEnter:ar,onEntered:rr,onEntering:cr,onExit:lr,onExited:dr,onExiting:ur,addEndListener:pr,nodeRef:tn,timeout:A==="auto"?null:A},q,{children:(T,oe)=>te.jsx(Gl,j({as:d,className:Ot(I.root,a,{entered:I.entered,exited:!u&&re==="0px"&&I.hidden}[T]),style:j({[$e?"minWidth":"minHeight"]:re},M),ref:ir},oe,{ownerState:j({},B,{state:T}),children:te.jsx(Ul,{ownerState:j({},B,{state:T}),className:I.wrapper,ref:ee,children:te.jsx(Jl,{ownerState:j({},B,{state:T}),className:I.wrapperInner,children:r})})}))}))});Cs.muiSupportAuto=!0;const Sc=f.createContext({});function Xl(e){return _n("MuiAccordion",e)}const sn=kn("MuiAccordion",["root","rounded","expanded","disabled","gutters","region"]),Ql=["children","className","defaultExpanded","disabled","disableGutters","expanded","onChange","square","slots","slotProps","TransitionComponent","TransitionProps"],Zl=e=>{const{classes:t,square:n,expanded:o,disabled:i,disableGutters:r}=e;return Sn({root:["root",!n&&"rounded",o&&"expanded",i&&"disabled",!r&&"gutters"],region:["region"]},Xl,t)},Yl=be(br,{name:"MuiAccordion",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[{[`& .${sn.region}`]:t.region},t.root,!n.square&&t.rounded,!n.disableGutters&&t.gutters]}})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{position:"relative",transition:e.transitions.create(["margin"],t),overflowAnchor:"none","&::before":{position:"absolute",left:0,top:-1,right:0,height:1,content:'""',opacity:1,backgroundColor:(e.vars||e).palette.divider,transition:e.transitions.create(["opacity","background-color"],t)},"&:first-of-type":{"&::before":{display:"none"}},[`&.${sn.expanded}`]:{"&::before":{opacity:0},"&:first-of-type":{marginTop:0},"&:last-of-type":{marginBottom:0},"& + &":{"&::before":{display:"none"}}},[`&.${sn.disabled}`]:{backgroundColor:(e.vars||e).palette.action.disabledBackground}}},({theme:e})=>({variants:[{props:t=>!t.square,style:{borderRadius:0,"&:first-of-type":{borderTopLeftRadius:(e.vars||e).shape.borderRadius,borderTopRightRadius:(e.vars||e).shape.borderRadius},"&:last-of-type":{borderBottomLeftRadius:(e.vars||e).shape.borderRadius,borderBottomRightRadius:(e.vars||e).shape.borderRadius,"@supports (-ms-ime-align: auto)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}},{props:t=>!t.disableGutters,style:{[`&.${sn.expanded}`]:{margin:"16px 0"}}}]})),on=f.forwardRef(function(t,n){const o=vn({props:t,name:"MuiAccordion"}),{children:i,className:r,defaultExpanded:a=!1,disabled:l=!1,disableGutters:d=!1,expanded:c,onChange:u,square:p=!1,slots:h={},slotProps:m={},TransitionComponent:b,TransitionProps:x}=o,C=Cn(o,Ql),[S,M]=yr({controlled:c,default:a,name:"Accordion",state:"expanded"}),A=f.useCallback($e=>{M(!S),u&&u($e,!S)},[S,u,M]),[X,...q]=f.Children.toArray(i),B=f.useMemo(()=>({expanded:S,disabled:l,disableGutters:d,toggle:A}),[S,l,d,A]),I=j({},o,{square:p,disabled:l,disableGutters:d,expanded:S}),K=Zl(I),Q=j({transition:b},h),ee=j({transition:x},m),[he,re]=xr("transition",{elementType:Cs,externalForwardedProps:{slots:Q,slotProps:ee},ownerState:I});return te.jsxs(Yl,j({className:Ot(K.root,r),ref:n,ownerState:I,square:p},C,{children:[te.jsx(Sc.Provider,{value:B,children:X}),te.jsx(he,j({in:S,timeout:"auto"},re,{children:te.jsx("div",{"aria-labelledby":X.props.id,id:X.props["aria-controls"],role:"region",className:K.region,children:q})}))]}))});function ed(e){return _n("MuiAccordionDetails",e)}kn("MuiAccordionDetails",["root"]);const td=["className"],nd=e=>{const{classes:t}=e;return Sn({root:["root"]},ed,t)},sd=be("div",{name:"MuiAccordionDetails",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>({padding:e.spacing(1,2,2)})),an=f.forwardRef(function(t,n){const o=vn({props:t,name:"MuiAccordionDetails"}),{className:i}=o,r=Cn(o,td),a=o,l=nd(a);return te.jsx(sd,j({className:Ot(l.root,i),ref:n,ownerState:a},r))});function od(e){return _n("MuiAccordionSummary",e)}const Re=kn("MuiAccordionSummary",["root","expanded","focusVisible","disabled","gutters","contentGutters","content","expandIconWrapper"]),id=["children","className","expandIcon","focusVisibleClassName","onClick"],ad=e=>{const{classes:t,expanded:n,disabled:o,disableGutters:i}=e;return Sn({root:["root",n&&"expanded",o&&"disabled",!i&&"gutters"],focusVisible:["focusVisible"],content:["content",n&&"expanded",!i&&"contentGutters"],expandIconWrapper:["expandIconWrapper",n&&"expanded"]},od,t)},cd=be($r,{name:"MuiAccordionSummary",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>{const t={duration:e.transitions.duration.shortest};return{display:"flex",minHeight:48,padding:e.spacing(0,2),transition:e.transitions.create(["min-height","background-color"],t),[`&.${Re.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${Re.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},[`&:hover:not(.${Re.disabled})`]:{cursor:"pointer"},variants:[{props:n=>!n.disableGutters,style:{[`&.${Re.expanded}`]:{minHeight:64}}}]}}),rd=be("div",{name:"MuiAccordionSummary",slot:"Content",overridesResolver:(e,t)=>t.content})(({theme:e})=>({display:"flex",flexGrow:1,margin:"12px 0",variants:[{props:t=>!t.disableGutters,style:{transition:e.transitions.create(["margin"],{duration:e.transitions.duration.shortest}),[`&.${Re.expanded}`]:{margin:"20px 0"}}}]})),ld=be("div",{name:"MuiAccordionSummary",slot:"ExpandIconWrapper",overridesResolver:(e,t)=>t.expandIconWrapper})(({theme:e})=>({display:"flex",color:(e.vars||e).palette.action.active,transform:"rotate(0deg)",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest}),[`&.${Re.expanded}`]:{transform:"rotate(180deg)"}})),cn=f.forwardRef(function(t,n){const o=vn({props:t,name:"MuiAccordionSummary"}),{children:i,className:r,expandIcon:a,focusVisibleClassName:l,onClick:d}=o,c=Cn(o,id),{disabled:u=!1,disableGutters:p,expanded:h,toggle:m}=f.useContext(Sc),b=S=>{m&&m(S),d&&d(S)},x=j({},o,{expanded:h,disabled:u,disableGutters:p}),C=ad(x);return te.jsxs(cd,j({focusRipple:!1,disableRipple:!0,disabled:u,component:"div","aria-expanded":h,className:Ot(C.root,r),focusVisibleClassName:Ot(C.focusVisible,l),onClick:b,ref:n,ownerState:x},c,{children:[te.jsx(rd,{className:C.content,ownerState:x,children:i}),a&&te.jsx(ld,{className:C.expandIconWrapper,ownerState:x,children:a})]}))});function dd({value:e,onChange:t,...n}){const[o,i]=f.useState(e);f.useEffect(()=>{i(e)},[e]);const r=()=>t(o);return s(wr,{value:o,onChange:a=>i(a.target.value),onBlur:r,onKeyDown:a=>a.key==="Enter"&&!n.multiline&&r(),...n})}function ud(){const e=f.useRef(),t=f.useCallback(()=>{var n;return(n=e.current)==null?void 0:n.scrollIntoView({behavior:"smooth"})},[e]);return[e,t]}function pd(e){const{t}=pe("ui"),n=_r({path:"/:page/*"}),o=t("pageTitle"),i=e??((n==null?void 0:n.params.page)&&t(`tabs.${n==null?void 0:n.params.page}`));f.useEffect(()=>{i?document.title=`${i} - ${o}`:document.title=o},[t,o,i])}const Ss={};class Dc{constructor(){this.internal=new hd}ref(t){return t.reduce((n,o)=>n.get(o),this.internal)}*[Symbol.iterator](){for(const[t,n]of this.internal.entries([]))"value"in n&&(yield[[...t],n.value])}*values(){for(const t of this.internal.allRefs())"value"in t&&(yield t.value)}}let hd=class Mc{constructor(){this.map=new Map}get(t){const n=this.map.get(t);if(n)return n;const o=new Mc;return this.map.set(t,o),o}*allRefs(){for(const t of this.map.values())yield*t.allRefs();yield this}*entries(t){const n=t.push(void 0)-1;for(const[o,i]of this.map.entries())t[n]=o,yield*i.entries(t);t.pop(),yield[t,this]}};class Ec{constructor(t,n){this.root=new md(t,n)}subset(t){const n=[];return this._subset(t,o=>n.push(...o[Fs].map(i=>i.value))),n}entries(t){const n=[];return this._subset(t,o=>n.push(...o[Fs])),n}_subset(t,n){const o=t.length;function i(r,a){r<o?a.subset(t[r]).forEach(l=>i(r+1,l)):n(a.leaf)}i(0,this.root)}}let md=class Tc{constructor(t,n){if(this.children=[],t>0)for(const[o,i]of Object.entries(n)){const r=new Map;for(const[a,l]of Object.entries(i))r.set(+a,new Tc(t-1,l));this.children.push({mask:+o,map:r})}else this.leaf=n}subset(t){return this.children.map(({mask:n,map:o})=>o.get(t&n)).filter(n=>!!n)}};class cs{constructor(t){this.root=new Ds(void 0),this.keys=t}at(t){const n=this.keys.get(t),o=n.reduce((i,r)=>i.child(r),this.root);return o.leaf||(o.leaf=new Ms(t,n,this.keys,o)),o.leaf}}class Ds{constructor(t){this.children=new Map,this.parent=t}child(t){let n=this.children.get(t);return n||(n=new Ds(this),this.children.set(t,n),n)}}class Ms{constructor(t,n,o,i){this.tag=Object.fromEntries(Object.entries(t).filter(([r,a])=>a!=null)),this.id=n,this.keys=o,this.internal=i}with(t){const{keys:n}=this,{id:o,firstReplacedByte:i}=n.combine(this.id,t);let r=this.internal;for(let a=i;a<n.tagLen;a++)r=r.parent;for(let a=i;a<n.tagLen;a++)r=r.child(o[a]);return r.leaf||(r.leaf=new Ms({...this.tag,...t},o,n,r)),r.leaf}}class fd{constructor(t,n){this.keys=new oc(t),this.values=new Ec(t.tagLen,n)}subset(t){return this.values.subset(this.keys.get(t))}}const We={sum:e=>e.reduce((t,n)=>t+n,0),prod:e=>e.reduce((t,n)=>t*n,1),min:e=>Math.min(...e),max:e=>Math.max(...e),sumfrac:([e,t])=>e/(e+t),unique:([e])=>e},Es={match:([e,t])=>e===t?0:1,thres:([e,t])=>e>=t?0:1,lookup:([e],t)=>t[e]??0},rn=e=>vr(e,"val");let Ic=class{constructor(t,...n){const o=new oc(t);this.nodes=new Ec(o.tagLen,kr(n)),this.cache=new cs(o).at({}),this.calc=new cs(o).at({}),this.calc.val=this}withTag(t){const n=this.calc.with(t);return n.val??(n.val=Object.assign(new this.constructor(this.cache.keys),this,{cache:this.cache.with(t),calc:n}))}gather(t){return this._gather(this.cache.with(t)).pre}compute(t){return this._compute(t,this.cache)}_gather(t){if(t.val)return t.val;const n=this.nodes.entries(t.id).flatMap(({tag:o,value:i})=>i.op==="reread"?this._gather(t.with(i.tag)).pre:[this.markGathered(t.tag,o,i,this._compute(i,t))]);return t.val={pre:n}}_compute(t,n){const o=(r,a,l,d)=>Object.freeze({val:r,meta:this.computeMeta(t,r,a,l,d)}),{op:i}=t;switch(i){case"const":return o(t.ex,[],[]);case"sum":case"prod":case"min":case"max":case"sumfrac":{const r=t.x.map(a=>this._compute(a,n));return o(We[i](rn(r)),r,[])}case"thres":case"match":case"lookup":{const r=t.br.map(c=>this._compute(c,n)),a=Es[i](rn(r),t.ex),l=[...Array(t.x.length)],d=l[a]=this._compute(t.x[a],n);return o(d.val,l,r)}case"subscript":{const r=this._compute(t.br[0],n);return o(t.ex[r.val],[],[r])}case"vtag":return o(n.tag[t.ex]??"",[],[]);case"tag":{const r=n.with(t.tag),a=this._compute(t.x[0],r);return o(a.val,[a],[],r.tag)}case"dtag":{const r=t.br.map(d=>this._compute(d,n)),a=n.with(Object.fromEntries(r.map((d,c)=>[t.ex[c],d.val]))),l=this._compute(t.x[0],a);return o(l.val,[l],r,a.tag)}case"read":{const r=n.with(t.tag),a=this._gather(r),{pre:l}=a,d=t.ex??this.defaultAccu(r.tag)??"unique";if(d!==t.ex&&(t={...t,ex:d}),a[d])return a[d];if(ic()&&d==="unique"&&l.length!==1)throw new Error(`Ill-form read for ${ac(r.tag)}`);const c=We[d](rn(l));return a[d]=o(c,l,[],r.tag)}case"custom":{const r=t.x.map(a=>this._compute(a,n));return o(Ss[t.ex].calc(rn(r)),r,[])}default:Bt(i)}}defaultAccu(t){}markGathered(t,n,o,i){return i}computeMeta(t,n,o,i,r){}toDebug(){throw new Error("not implemented")}};function gd(e,t,n){function o(a,l){if(a.val)return a.val;const d=n(a.tag);return a.val=d?[yn(d,l)]:t.nodes.subset(a.id).flatMap(c=>c.op!=="reread"?r(c,a):o(a.with(c.tag),l)),a.val}function i(a,l){return a.every(d=>d.op==="const")?de(We[l](a.map(d=>d.ex))):{op:l,x:a,br:[]}}function r(a,l){const{op:d}=a;switch(d){case"const":return a;case"read":{const c=l.with(a.tag),u=a.ex??t.defaultAccu(c.tag)??"unique",p=o(c,u);return u==="unique"?p[0]??de(void 0):i(p,u)}case"sum":case"prod":case"min":case"max":case"sumfrac":{const c=a.x.map(u=>r(u,l));return i(c,d)}case"thres":case"match":case"lookup":{const c=a.br.map(u=>r(u,l));if(c.every(u=>u.op==="const")){const u=c.map(h=>h.ex),p=Es[a.op](u,a.ex);return r(a.x[p],l)}return{...a,x:a.x.map(u=>r(u,l)),br:c}}case"subscript":{const c=r(a.br[0],l);return c.op==="const"?de(a.ex[c.ex]):{...a,br:[c]}}case"vtag":return de(l.tag[a.ex]??"");case"tag":return r(a.x[0],l.with(a.tag));case"dtag":{const c=a.br.map(p=>r(p,l));if(c.some(p=>p.op!=="const"))throw new Error("Dynamic tag must be resolvable during detachment");const u=l.with(Object.fromEntries(c.map((p,h)=>[a.ex[h],p.ex])));return r(a.x[0],u)}case"custom":return{...a,x:a.x.map(c=>r(c,l))};default:Bt(d)}}return e.map(a=>r(a,new cs(t.cache.keys).at({})))}function Ft(e,t){const n=new Map;function o(i){const r=n.get(i);if(r)return r;const a=i,l=Un(i.x,o),d=Un(i.br,o);(i.x!==l||i.br!==d)&&(i={...i,x:l,br:d});const c=t(i,a);return n.set(i,c),c}return Un(e,o)}function rs(e,t){const n=new Set;function o(i){n.has(i)||(t(i,o),n.add(i))}e.forEach(o)}function Un(e,t){const n=e.map(t);return e.every((o,i)=>o===n[i])?e:n}const Ts={arithmetic:We,branching:Es};class yd extends Ic{constructor(t,n=ac,o=()=>!0){super(t.cache.keys),this.gathering=new Set,this.nodes=t.nodes,this.tagStr=n,this.filter=o,this.defaultAccu=i=>t.defaultAccu(i),this.cache=this.cache.with(t.cache.tag)}withTag(t){throw new Error("Unimplemented")}_gather(t){if(this.gathering.has(t))throw new Error(`Loop detected for ${this.tagStr(t.tag)}`);this.gathering.add(t);const n=this.__gather(t);return this.gathering.delete(t),n}__gather(t){if(t.val)return t.val;const n=this.nodes.entries(t.id).flatMap(({tag:o,value:i})=>i.op==="reread"?this._gather(t.with(i.tag)).pre.map(r=>{const a=`${this.tagStr(o)} <= ${this.tagStr(i.tag)} : ${r.meta.readSeq}`;return Object.freeze({...r,meta:{...r.meta,readSeq:a}})}):[this.markGathered(t.tag,o,i,this._compute(i,t))]);return t.val={pre:n}}_compute(t,n){try{return super._compute(t,n)}catch(o){return Object.freeze({val:NaN,meta:{formula:`${o}`,deps:[],omitted:[],val:NaN,x:[],br:[],comp:"ERR",pivot:!0,toJSON:ao}})}}markGathered(t,n,o,i){const r=`${this.tagStr(n)} <- ${this.tagStr(t)}`;return{...i,meta:{...i.meta,readSeq:r,pivot:!0}}}computeMeta(t,n,o,i,r){let a,l;const d=o.filter(m=>m).map(m=>m.meta),c=i.map(m=>m.meta),u=[],p=t.op==="read"?t.ex:t.op,h=[];if(p in We){const m=We[p]([]);for(const b of[...c,...d])b.val!==m||this.filter(b)?u.push(b):h.push(b)}else u.push(...c,...d);switch(t.op){case"const":a=io(t.ex);break;case"read":l=`gather ${d.length} node(s)`,l+=` matching ${this.tagStr(r,t.ex)}`,l+=` (for ${this.tagStr(t.tag)})`,h.length&&(l+=` <${h.length} omitted>`),a=`${this.tagStr(t.tag)}`;break;default:{const m=[];t.ex&&t.op!=="subscript"&&m.push(JSON.stringify(t.ex)),t.tag&&m.push(this.tagStr(t.tag)),m.push(...u.map(b=>b.comp)),h.length&&m.push(`<${h.length} omitted>`),a=`${t.op}(`+m.join(", ")+")"}}return h.push(...u.flatMap(m=>m.pivot?[]:m.omitted)),Object.freeze({formula:`[${io(n)}] ${l??a}`,deps:[...new Set(u.flatMap(m=>m.pivot?[m]:m.deps))],omitted:[...new Set(h)],val:n,x:d,br:c,comp:a,pivot:t.op==="read",toJSON:ao})}}const io=e=>typeof e=="string"?`"${e}"`:e.toString();function ao(){const{formula:e,readSeq:t,deps:n}=this,o={readSeq:t,formula:e,deps:n};return o.readSeq||delete o.readSeq,o.deps.length||delete o.deps,Object.keys(o).length===1?o.formula:o}const{arithmetic:co}=Ts;function xd(e){return e=bd(e),e=$d(e),e=wd(e),e}function bd(e){return Ft(e,t=>{const{op:n}=t;switch(n){case"sum":case"prod":case"min":case"max":if(t.x.length===1)return t.x[0];if(t.x.some(o=>o.op===n)){const o=t.x.flatMap(i=>i.op===n?i.x:[i]);return{...t,x:o}}}return t})}function $d(e){return Ft(e,t=>{const{op:n}=t;switch(n){case"sum":case"prod":case"min":case"max":{const o=t.x.filter(i=>i.op==="const");if(o.length>1){const i=t.x.filter(a=>a.op!=="const"),r=co[n](o.map(a=>a.ex));return r===co[n]([])?{...t,x:i}:{...t,x:[de(r),...i]}}}}return t})}function wd(e){const t=new Map,n=new Dc;return Ft(e,o=>{const{op:i}=o,r=o.x.map(c=>t.get(c)),a=o.br.map(c=>t.get(c));let l;switch(i){case"read":{const c=Object.keys(o.tag).sort();l=[i,o.ex,...c,...c.map(u=>o.tag[u])];break}case"sum":case"prod":case"min":case"max":l=[i,...r.sort()];break;case"thres":case"custom":case"sumfrac":case"lookup":case"subscript":case"const":l=[i,o.ex,...r,...a];break;case"match":l=[i,o.ex,...r,...a.sort()];break;default:Bt(i)}const d=n.ref(l);return"value"in d?d.value:(d.value=o,t.set(o,t.size),o)})}const{arithmetic:_d,branching:kd}=Ts;function vd(e,t,n,o,i){const r=new Cd(e,o,t,n);for(;r.progress;)r.progress=!1,Sd(r),Dd(r,1),Ed(r),Md(r,i);return r.nodes=xd(r.nodes),r}var ke,ze,Pe,Oe,Ve;class Cd{constructor(t,n,o,i){Te(this,ke);Te(this,ze);Te(this,Pe);Te(this,Oe);Te(this,Ve);this.progress=!0,Z(this,ke,t),this.minimum=n,Z(this,ze,o),this.cat=i}get nodes(){return we(this,ke)}set nodes(t){we(this,ke)!==t&&(this.progress=!0,Z(this,ke,t),Z(this,Oe,Z(this,Ve,void 0)))}get candidates(){return we(this,ze)}set candidates(t){this.candidates!==t&&(this.progress=!0,Z(this,ze,t),Z(this,Pe,Z(this,Oe,Z(this,Ve,void 0))))}get cndRanges(){return we(this,Pe)??Z(this,Pe,this.candidates.map(ls))}set cndRanges(t){Z(this,Pe,t)}get nodeRanges(){return we(this,Oe)??Z(this,Oe,Rc(this.nodes,this.cat,this.cndRanges))}get monotonicities(){return we(this,Ve)??Z(this,Ve,Td(this.nodes.slice(0,this.minimum.length),this.cat,this.nodeRanges))}}ke=new WeakMap,ze=new WeakMap,Pe=new WeakMap,Oe=new WeakMap,Ve=new WeakMap;function Sd(e){const{nodes:t,nodeRanges:n}=e,o=Ft(t,(i,r)=>{const a=n.get(r);if(a.min===a.max)return r.op==="const"?i:de(a.min);switch(r.op){case"thres":{const[l,d]=r.br.map(c=>n.get(c));if(l.min>=d.max)return i.x[0];if(l.max<d.min)return i.x[1];break}case"min":{const l=i.x.filter((d,c)=>n.get(r.x[c]).min<=a.max);if(l.length===1)return l[0];if(l.length!==i.x.length)return Cr(...l);break}case"max":{const l=i.x.filter((d,c)=>n.get(r.x[c]).max>=a.min);if(l.length===1)return l[0];if(l.length!==i.x.length)return os(...l);break}case"match":case"lookup":if(i.br.every(l=>l.op==="const")){const l=i.br.map(d=>d.ex);return i.x[kd[r.op](l,r.ex)]}break;case"subscript":if(i.br[0].op==="const")return de(i.ex[i.br[0].ex]);break}return i});e.nodes=o}function Dd(e,t){const{nodeRanges:n,minimum:o,cat:i}=e,r=[...e.candidates],a=[...e.cndRanges],l=[],d=[];let c=!1;if(e.nodes.forEach((p,h)=>{if(h<o.length){if(o[h]>n.get(p).min)c=!0;else if(h>=t)return;d.push(o[h])}l.push(p)}),d.length!=o.length&&(e.nodes=l,e.minimum=d),!c)return;let u=!1;r.forEach((p,h)=>{const m=a[h],b=p.filter(x=>{a[h]=ls([x]);const C=Rc(l,i,a);return d.every((S,M)=>C.get(l[M]).max>=S)});b.length!=p.length?(r[h]=b,a[h]=ls(b),u=!0):a[h]=m}),u&&(e.candidates=r,e.cndRanges=a)}function Md(e,t){const n=[...e.monotonicities],o=e.candidates.map(c=>c.map(u=>{const p={incomp:[],inc:{},c:u};for(const[h,m]of n)m.inc?p.inc[h]=u[h]??0:m.dec?p.inc[h]=-(u[h]??0):p.incomp.push(u[h]??0);return p})),i=o[0][0];if(i===void 0)return;const r=Object.keys(i.inc),a=[...r].reverse(),l=!!i.incomp.length,d=o.map(c=>{const u=new Dc;return l?c.forEach(p=>{const h=u.ref(p.incomp);h.value?h.value.push(p):h.value=[p]}):u.ref([]).value=c,[...u.values()].flatMap(p=>(p.sort(({inc:h},{inc:m})=>{const b=a.find(x=>h[x]!==m[x]);return b===void 0?0:m[b]-h[b]}),p.filter(({inc:h},m)=>{let b=0;for(let x=0,C=m-t;x<=C+b;x++){const S=p[x].inc;if(r.every(M=>S[M]>=h[M])&&++b>=t)return!1}return!0})))});d.some((c,u)=>c.length!=e.candidates[u].length)&&(e.candidates=d.map(c=>c.map(u=>u.c)))}const fe=Symbol();function Ed(e){const{nodes:t,cat:n,candidates:o}=e,i=new Map;rs(t,(c,u)=>{if(c.x.forEach(u),c.br.forEach(u),c.br.length)return;const p=c.x.map(m=>i.get(m));if(p.some(m=>!m))return;let h;switch(c.op){case"sum":{h={[fe]:p.reduce((m,b)=>m+b[fe],0)};for(const m of p)for(const[b,x]of Object.entries(m))h[b]=(h[b]??0)+x;break}case"prod":{const m=c.x.findIndex(x=>x.op!=="const");if(c.x.find((x,C)=>x.op!=="const"&&C!==m))return;h=m!==-1?{...p[m]}:{[fe]:1};const b=p.reduce((x,C,S)=>S===m?x:x*C[fe],1);b!=1&&(Object.keys(h).forEach(x=>h[x]*=b),h[fe]*=b);break}case"read":h={[c.tag[n]]:1,[fe]:0};break;case"const":if(typeof c.ex!="number")return;h={[fe]:c.ex};break;default:return}i.set(c,h)});const r=new Map;if(rs(t,(c,u)=>{const p=i.get(c);p&&Object.keys(p).length?r.set(c,p):(c.x.forEach(u),c.br.forEach(u))}),![...r.keys()].some(c=>{if(c.op==="const"||c.op==="read")return!1;if(c.op==="sum"&&c.x.length===2){if(c.x[0].op==="const"&&c.x[1].op==="read")return!1;if(c.x[1].op==="const"&&c.x[0].op==="read")return!1}return!0}))return;let l=new Map([...r.values()].map(c=>{const u=Object.keys(c).sort();return u.length===1&&c[u[0]]===1?[c,u[0]]:[c,""+u.flatMap(p=>[p,c[p]]).join("")]}));if(!ic()){const c=new Map([...l.values()].map((u,p)=>[u,`c${p}`]));l=new Map([...l].map(([u,p])=>[u,c.get(p)]))}const d=new Map;for(const[c,u]of l){const p=yn({[n]:u});d.set(c,c[fe]!==0?cc(c[fe],p):p)}e.candidates=o.map(c=>c.map(u=>{const p={id:u.id};return l.forEach((h,m)=>{h in p||(p[h]=Object.entries(m).reduce((b,[x,C])=>b+(u[x]??0)*C,0))}),p})),e.nodes=Ft(t,(c,u)=>{const p=r.get(u);return p?d.get(p):c})}function ls(e){const t=e.values(),n=t.next().value;if(!n)return{};const o=Object.fromEntries(Object.entries(n).map(([i,r])=>[i,{min:r,max:r}]));for(const i of t){for(const[r,a]of Object.entries(o)){const l=i[r]??0;a.min>l&&(a.min=l),a.max<l&&(a.max=l)}for(const[r,a]of Object.entries(i))r in o||(o[r]={min:Math.min(0,a),max:Math.max(0,a)})}return o}function Rc(e,t,n){const o=new Map;return rs(e,(i,r)=>{i.x.forEach(r),i.br.forEach(r);const a=i.x.map(p=>o.get(p)),l=a.map(p=>p.min),d=a.map(p=>p.max);function c(p,[h,m]){const b=_d[p],x=[b([h.min,m.min]),b([h.min,m.max]),b([h.max,m.min]),b([h.max,m.max])];return{min:Math.min(...x),max:Math.max(...x)}}let u;switch(i.op){case"const":typeof i.ex=="number"?u={min:i.ex,max:i.ex}:u={min:NaN,max:NaN};break;case"sum":u={min:l.reduce((p,h)=>p+h,0),max:d.reduce((p,h)=>p+h,0)};break;case"prod":u={min:1,max:1},u=a.reduce((p,h)=>c(i.op,[p,h]),u);break;case"min":case"max":u={min:Math[i.op](...l),max:Math[i.op](...d)};break;case"match":case"thres":u={min:Math.min(...l),max:Math.max(...d)};break;case"sumfrac":l[0]+l[1]>0||d[0]+d[1]<0?u=c(i.op,a):u={min:NaN,max:NaN};break;case"read":{u={min:0,max:0};for(const{[i.tag[t]]:p}of n)p&&(u.min+=p.min,u.max+=p.max);break}case"subscript":{if(typeof i.ex[0]!="number")u={min:NaN,max:NaN};else{u={min:1/0,max:-1/0};let{min:p,max:h}=o.get(i.br[0]);p=Math.max(0,Math.ceil(p)),h=Math.min(h,i.ex.length-1);for(let m=p;m<=h;m++){const b=i.ex[m];u.min>b&&(u.min=b),u.max<b&&(u.max=b)}u.min>u.max&&(u={min:NaN,max:NaN})}break}case"lookup":isNaN(l[0])&&isNaN(d[0])&&(l.splice(0,1),d.splice(0,1)),u={min:Math.min(...l),max:Math.max(...d)};break;case"custom":u=Ss[i.ex].range(a);break;default:Bt(i)}o.set(i,u)}),o}function Td(e,t,n){const o=new Map,i=[],r=new Map;function a(l,d){o.has(l)||o.set(l,{inc:!0,dec:!0});const c=o.get(l);if(d&&c.dec)c.dec=!1;else if(!d&&c.inc)c.inc=!1;else return;i.push({node:l,inc:d})}for(e.forEach(l=>a(l,!0));i.length;){const{node:l,inc:d}=i.pop();switch(l.op){case"read":r.set(l.tag[t],o.get(l));break;case"const":break;case"sum":case"min":case"max":l.x.forEach(c=>a(c,d));break;case"thres":{l.x.forEach(p=>a(p,d));const c=n.get(l.x[0]),u=n.get(l.x[1]);c.max>u.min&&(a(l.br[0],d),a(l.br[1],!d)),c.min<u.max&&(a(l.br[0],!d),a(l.br[1],d));break}case"sumfrac":{const[c,u]=l.x.map(p=>n.get(p));u.min<0&&a(l.x[0],!d),u.max>0&&a(l.x[0],d),c.min<0&&a(l.x[1],d),c.max>0&&a(l.x[1],!d);break}case"prod":{const c=n.get(l);if(c.min<0&&c.max>0)l.x.forEach(u=>a(u,!0)),l.x.forEach(u=>a(u,!1));else{const u=d===c.max>0;l.x.forEach(p=>a(p,u===n.get(p).max>0))}break}case"match":case"lookup":l.x.forEach(c=>a(c,d)),l.br.forEach(c=>a(c,!0)),l.br.forEach(c=>a(c,!1));break;case"subscript":{const{br:[c],ex:u}=l;if(typeof u[0]=="number"){let{min:p,max:h}=n.get(c);p=Math.max(0,Math.ceil(p)),h=Math.min(h,u.length-1);for(let m=p+1;m<=h;m++)if(u[m-1]<u[m]){a(c,d);break}for(let m=p+1;m<=h;m++)if(u[m-1]>u[m]){a(c,!d);break}}else a(c,!0),a(c,!1);break}case"custom":Ss[l.ex].monotonicity(l.x.map(c=>n.get(c))).forEach((c,u)=>{c.inc||a(l.x[u],!d),c.dec||a(l.x[u],d)});break;default:Bt(l)}}return r}function ds(e){const[t,n]=Sr();return f.useEffect(()=>e.followAny((o,i)=>i==="update"&&n()),[e,n]),t}function Y(e){const{database:t}=P();return hs(t.charOpts,e)}const{arithmetic:Id}=Ts;let Rd=class extends Ic{computeMeta({op:t,ex:n,tag:o},i,r,a,l){let d=r.filter(m=>!!m);const c=Ad(d,a);function u(m){return Object.freeze(l&&!m.tag?{tag:l,...m}:m)}function p(m,b){return u({op:m,ops:b,...c})}function h(m,b){let{meta:x}=m;return b!=null&&b.some(C=>!x.usedCats.has(C))&&(x={...x,usedCats:new Set([...x.usedCats,...b])}),u(x.conds===c.conds?x:{...x,...c})}if(t==="read"&&(l==null?void 0:l.qt)==="cond"){const{src:m,dst:b,sheet:x,q:C}=l;m&&x&&C&&(c.conds=wn(c.conds,{[b??"All"]:{[m]:{[x]:{[C]:i}}}}))}switch(t==="read"&&n!=="unique"&&([t,n]=[n,void 0]),t){case"sum":case"prod":case"min":case"max":case"sumfrac":if(d.length>1){const m=Id[t]([]);d=d.filter(b=>b.val!==m)}return d.length===1?h(d[0]):p(d.length?t:"const",d);case"const":case"subscript":return p("const",[]);case"vtag":return c.usedCats=new Set([n]),p("const",[]);case"match":case"thres":case"lookup":case"read":return h(d[0]);case"tag":return h(d[0],Object.keys(o));case"dtag":return h(d[0],n);case"custom":return p(n,d);default:rc(t)}}markGathered(t,n,o,i){const{val:r}=i,a={...i.meta};let l=!1;const d=new Set([...a.usedCats,...Object.keys(n)]);return a.usedCats.size!==d.size&&(a.usedCats=d,l=!0),l?{val:r,meta:Object.freeze(a)}:i}listFormulas(t){return this.gather(t.tag).filter(n=>n.val).map(({val:n,meta:o})=>Dr.withTag(o.tag)[n])}listCondFormulas(t){return this.listFormulas(t).map(n=>this.compute(n).meta.conds).reduce(wn,{})}};function Ad(e,t){var a;const n=[...e.map(l=>l.meta),...t.map(l=>l.meta)];let o={},i=new Set;for(const l of n)o=wn(o,l.conds),l.usedCats.forEach(d=>i.add(d));const r=i.size;return i=((a=n.find(l=>l.usedCats.size===r))==null?void 0:a.usedCats)??i,{usedCats:i,conds:o}}function wn(e,t){if(e===t)return e;if(typeof e!="object")throw new Error(`cannot merge ${e} and ${t}`);if(Object.keys(t).length>Object.keys(e).length&&([e,t]=[t,e]),!Object.keys(t).length)return e;let n=!1;const o={...e};for(const[i,r]of Object.entries(t)){const a=o[i],l=i in o?wn(a,r):r;a!==l&&(o[i]=l,n=!0)}return Object.freeze(n?o:e)}function qd(e){const t=new Set(e);return n=>!zd(n,t)}function zd(e,t){const n=e.formula.match(/(\S+) (\S+) common.count/);if(!n)return!1;const[,o,i]=n;return i==="own"&&t.has(o)}class Pd extends Rd{toDebug(){return new yd(this,Mr,qd([...Vt,...jt]))}defaultAccu(t){var i,r,a,l;const{qt:n,q:o}=t;if(!(!n||!o))switch(t.et){case"own":case"target":return(r=(i=lc[n])==null?void 0:i[o])==null?void 0:r.accu;case"enemy":return(l=(a=Er[n])==null?void 0:a[o])==null?void 0:l.accu;case"team":if(n==="common"&&o==="count")return"sum";throw new Error("non-explicit team value accumulator")}}}function fn(e,...t){return t.map(({tag:n,value:o})=>({tag:{...n,preset:e},value:o}))}function Ac(e,...t){return t.map(({tag:n,value:o})=>({tag:{...n,src:e},value:o}))}function qc(e){const{lvl:t,promotion:n,basic:o,dodge:i,special:r,chain:a,assist:l,core:d,mindscape:c}=z.char,{char:u,iso:p,[e.key]:h}=F.withAll("sheet",[]);return[u.reread(h),p.reread(h),t.add(e.level),o.add(e.basic),i.add(e.dodge),r.add(e.special),a.add(e.chain),l.add(e.assist),d.add(e.core),n.add(e.promotion),c.add(e.mindscape),xn.base.crit_.add(.05),xn.base.crit_dmg_.add(.5)]}function Od(e,t,n,o){return[F.sheet("agg").reread(F.sheet("wengine")),z.common.count.sheet(e).add(1),z.wengine.lvl.add(t),z.wengine.modification.add(n),z.wengine.phase.add(o)]}function zc(e,t){const{common:{count:n},initial:o}=Rr(lc,{sheet:"disc",et:"own"});return[F.sheet("agg").reread(F.sheet("disc")),F.withTag({sheet:"disc",qt:"initial"}).reread(F.sheet("dyn")),...Object.entries(e).map(([i,r])=>Ar(o,i).sheet("dyn").add(r)),...Object.entries(t).map(([i,r])=>n.sheet(i).add(r))]}function Pc(e){const t=F.with("et","team"),{own:n,enemy:o,teamBuff:i,notOwnBuff:r}=F.sheet("agg").withAll("et",[]);return[e.map(a=>F.withTag({et:"target",dst:a}).reread(F.withTag({et:"own",dst:null,src:a}))),e.flatMap(a=>{const l=n.with("src",a);return e.map(d=>l.reread(i.withTag({dst:a,src:d,name:null})))}),e.flatMap(a=>{const l=n.with("src",a);return e.filter(d=>d!==a).map(d=>l.reread(r.withTag({dst:a,src:d,name:null})))}),e.map(a=>o.reread(F.withTag({et:"enemyDeBuff",dst:null,src:a,name:null}))),e.flatMap((a,l)=>{const{stackIn:d,stackTmp:c}=F.withAll("qt",[]),u=F.withTag({src:a,et:"own"});return[u.with("qt","stackTmp").add(Tr(d,0,l+1)),u.with("qt","stackOut").add(Ir(c.max.with("et","team"),l+1,d))]}),e.map(a=>t.add(F.withTag({src:a,et:"own"})))].flat()}function Oc(e){const t=dc(bn,e);return new Pd(bn,qr,t)}function Vd(e){return new fd(bn,dc(bn,e))}var At={},ro;function jd(){if(ro)return At;ro=1;var e=ms();Object.defineProperty(At,"__esModule",{value:!0}),At.default=void 0;var t=e(fs()),n=gs(),o=(0,t.default)((0,n.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore");return At.default=o,At}var Wd=jd();const ln=ys(Wd);function Nd({formulasRead:e,buffsRead:t}){var d;const n=f.useContext(Kt),o=(d=f.useContext(Ne))==null?void 0:d.withTag(n),i=o==null?void 0:o.toDebug(),[r,a]=f.useState(!1),l=c=>(u,p)=>{a(p?c:!1)};return s(W,{bgt:"dark",children:y(O,{children:[y(on,{expanded:r==="formulas",onChange:l("formulas"),slotProps:{transition:{unmountOnExit:!0}},children:[s(cn,{expandIcon:s(ln,{}),children:"All target listings"}),s(an,{children:s(is,{children:o&&i&&r==="formulas"&&o.listFormulas(e).map((c,u)=>{const p=o.compute(c),h=i.compute(c).meta,m=c.tag.name||c.tag.q;return y(xe,{children:[y(R,{children:[m,": ",p.val]}),y(on,{children:[y(cn,{expandIcon:s(ln,{}),children:["debug for ",m]}),y(an,{children:["conds:",s(le,{text:ge(p.meta.conds)}),"read:",s(le,{text:ge(c)}),"formula:",s(le,{text:ge(h)})]})]})]},`${m}${u}`)})})})]}),y(on,{expanded:r==="buffs",onChange:l("buffs"),slotProps:{transition:{unmountOnExit:!0}},children:[s(cn,{expandIcon:s(ln,{}),children:"All target buffs"}),s(an,{children:s(is,{children:o&&i&&r==="buffs"&&o.listFormulas(t).map((c,u)=>{const p=o.compute(c),h=i.compute(c).meta,m=c.tag.name||c.tag.q;return y(xe,{children:[y(R,{children:[m,": ",p.val]}),y(on,{children:[y(cn,{expandIcon:s(ln,{}),children:["debug for ",m]}),y(an,{children:["conds:",s(le,{text:ge(p.meta.conds)}),"read:",s(le,{text:ge(c)}),"formula:",s(le,{text:ge(h)})]})]})]},`${m}${u}`)})})})]})]})})}function Bd(){var u;const e=f.useContext(Kt),t=(u=f.useContext(Ne))==null?void 0:u.withTag(e),n=t==null?void 0:t.toDebug(),{read:o,setRead:i}=f.useContext(xs),r=o&&(t==null?void 0:t.compute(o)),a=o&&(n==null?void 0:n.compute(o)),l=(o==null?void 0:o.tag.name)||(o==null?void 0:o.tag.q),d=a==null?void 0:a.meta,c=d&&ge(d);return s(bs,{open:!!o,onClose:()=>i(void 0),children:y(W,{bgt:"dark",children:[s(Lt,{title:`Debug formula for ${l}`,action:s(Be,{onClick:()=>i(void 0),children:s(Dn,{})})}),s(O,{children:s(W,{bgt:"normal",children:s(O,{children:y(is,{gap:1,children:["Computed value: ",r==null?void 0:r.val,s(ie,{}),s(R,{variant:"h6",children:"Read"}),s(le,{text:ge(o)}),s(ie,{}),s(R,{variant:"h6",children:"Calculator Tag"}),s(le,{text:JSON.stringify(t==null?void 0:t.cache.tag)}),s(ie,{}),s(R,{variant:"h6",children:"Tag Context"}),s(le,{text:JSON.stringify(e)}),s(ie,{}),s(R,{variant:"h6",children:"Conditionals"}),s(le,{text:ge(r==null?void 0:r.meta.conds)}),s(ie,{}),s(R,{variant:"h6",children:"Formula"}),s(le,{text:c||""})]})})})})]})})}function Vc({document:e,bgt:t="normal",collapse:n=!1,typoVariant:o="body1"}){switch(e.type){case"fields":return s(Kd,{fieldsDocument:e,bgt:t});case"text":return n?s(Ld,{textDocument:e,typoVariant:o}):s(jc,{textDocument:e,typoVariant:o});case"conditional":return s(zr,{conditional:e.conditional,bgt:t});default:return null}}function Kd({fieldsDocument:e,bgt:t="normal"}){return y(W,{bgt:t,children:[e.header&&s(Or,{header:e.header,hideDivider:e.fields.length===0}),s(Vr,{bgt:t,fields:e.fields})]})}function jc({textDocument:e,typoVariant:t}){const n=f.useContext(Ne),o=f.useContext(Kt);return n?s(R,{variant:t,children:uc(e.text,n.withTag(o))}):null}function Ld({textDocument:e,typoVariant:t}){const[n,o]=f.useState(!1),[i,r]=f.useState(!1);return y(E,{sx:{position:"relative"},children:[!n&&s(E,{sx:{pointerEvents:"none",position:"absolute",mx:"auto",width:"100%",display:"flex",justifyContent:"center",height:"100%",alignItems:"flex-end",zIndex:"10",transition:"transform 0.3s ease",transform:i?"translate(0,-5px)":void 0},children:s(Pr,{})}),s(Cs,{onMouseEnter:()=>r(!0),onMouseLeave:()=>r(!1),collapsedSize:55,onClick:()=>o(a=>!a),in:n,sx:{cursor:"pointer",position:"relative",maskImage:n?void 0:"linear-gradient(to bottom, black 0%, transparent 100%)","&:hover":{maskImage:n?void 0:"linear-gradient(to bottom, black 50%, transparent 100%)"}},children:s(jc,{textDocument:e,typoVariant:t})})]})}function Hd({numWorkers:e,setNumWorkers:t}){const{t:n}=pe("page_optimize"),o=navigator.hardwareConcurrency||8;return y(se,{title:`${e} Workers`,children:[s(V,{disabled:!0,children:"Scales with available CPU cores."}),jr(1,o).map(i=>s(V,{onClick:()=>t(i),children:n("worker",{count:i})},i))]})}function Fd({maxBuildsToShow:e,optConfigId:t}){const{database:n}=P(),{t:o}=pe("page_optimize");return y(se,{title:o("build",{count:e}),children:[s(V,{children:s(R,{variant:"caption",color:"info.main",children:o("buildDropdownDesc")})}),Wr.map(i=>s(V,{onClick:()=>n.optConfigs.set(t,{maxBuildsToShow:i}),children:o("build",{count:i})},i))]})}const Is=Nr(te.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zm2.46-7.12 1.41-1.41L12 12.59l2.12-2.12 1.41 1.41L13.41 14l2.12 2.12-1.41 1.41L12 15.41l-2.12 2.12-1.41-1.41L10.59 14l-2.13-2.12zM15.5 4l-1-1h-5l-1 1H5v2h14V4z"}),"DeleteForever");function Gd({levelLow:e,levelHigh:t,setLow:n,setHigh:o,setBoth:i,dark:r=!1,disabled:a=!1,showLevelText:l=!1}){const{t:d}=pe("wengine"),[c,u]=f.useState(e),[p,h]=f.useState(t),m=f.useCallback((b,x)=>{if(typeof x=="number")throw new TypeError;const[C,S]=x;u(C),h(S)},[u,h]);return f.useEffect(()=>u(e),[u,e]),f.useEffect(()=>h(t),[h,t]),y(E,{sx:{width:"100%",display:"flex",alignItems:"center",bgcolor:r?"contentNormal.main":"contentLight.main",overflow:"visible"},children:[y(E,{sx:{width:"max-content",height:32,display:"flex"},children:[l?y(Ht,{children:[s("span",{style:{padding:"0 1em",width:"max-content",borderRadius:"4px 0 0 4px",display:"flex",justifyContent:"center",alignItems:"center",color:"rgba(255,255,255,0.9)",backgroundColor:"rgb(30,120,200)"},children:d("levelSliderTitle")}),s(ie,{orientation:"vertical",flexItem:!0})]}):void 0,s(Us,{value:c,onChange:b=>n(Gs(b??0,0,t)),sx:{px:1,width:"3em"},inputProps:{sx:{textAlign:l?"right":"center"}},disabled:a})]}),s(Br,{sx:{flex:"0 1 100%",mx:2},getAriaLabel:()=>"Wengine Level Range",value:[c,p],onChange:m,onChangeCommitted:(b,x)=>Array.isArray(x)&&i(x[0],x[1]),valueLabelDisplay:"auto",min:0,max:$n,step:1,marks:!0,disabled:a}),s(Us,{value:p,onChange:b=>o(Gs(b??0,e,$n)),sx:{px:1,flex:"0 0 3em"},inputProps:{sx:{textAlign:"center"}},disabled:a})]})}function Ke(){const e=f.useContext(Ne),t=f.useContext(Kt);return f.useMemo(()=>e==null?void 0:e.withTag(t),[e,t])}const Nt={initial:"Initial",combat:"Combat",final:"Final",base:"Base"};function ae({tag:e,showPercent:t}){return s(ve,{color:Hg(e),children:s(Xd,{tag:e,showPercent:t})})}function gn({tag:e,showPercent:t}){return y(Ht,{children:[s(ae,{tag:e,showPercent:t}),Gg(e).map(n=>s(je,{children:Me[n]},n)),e.attribute&&s(je,{color:e.attribute,children:s(Se,{attribute:e.attribute})})]})}const Ud=["hp","hp_","atk","atk_","def","def_"],Jd=e=>Ud.includes(e),lo={dmg_:"DMG",common_dmg_:"DMG",resIgn_:"Res Ignore"};function Xd({tag:e,showPercent:t}){var r;const n=Ke(),o=(r=Ug.subset(e)[0])==null?void 0:r.title;if(o)return o;if(e.qt==="cond"&&e.q&&e.sheet&&n){const a=us.get(`${e.sheet}:${e.q}`);if(a)return uc(a.label,n,n==null?void 0:n.compute(new hn(e,"max")).val)}const i=Wc(e);if(Jd(i))return y("span",{children:[s(Lr,{statKey:i,iconProps:Kr})," ",y("span",{children:[(e.qt&&Nt[e.qt])??e.qt," ",Hr[i],t&&Wt(i)]})]});if(lo[i]){const a=[...e.attribute?[mn[e.attribute]]:[],...e.damageType1?[Me[e.damageType1]]:[],...e.damageType2?[Me[e.damageType2]]:[],lo[i]];return s("span",{children:a.join(" ")})}return s(ye,{statKey:i,showPercent:t})}function $(e,t){return[(n,o)=>s(Js,{ns:`${e}_${t}_gen`,key18:n,values:o}),(n,o)=>s(Js,{ns:`${e}_${t}`,key18:n,values:o})]}function g(e){return{title:s(ae,{tag:e}),fieldRef:e}}function Wc(e){if(!e)return"";const{et:t,q:n,qt:o,name:i}=e;return t==="own"&&o==="formula"&&n!=="base"?i??n??"":n??""}const Tn="AstralVoice",[uo,Qd]=$("disc",Tn),po=N(Tn),Zd=_[Tn],Yd=w[Tn],eu={2:{title:s(L,{}),img:po,documents:[{type:"text",text:uo("desc2")}]},4:{title:s(H,{}),img:po,documents:[{type:"text",text:uo("desc4")},{type:"conditional",conditional:{label:Qd("set4_cond"),metadata:Zd.astral,fields:[g(Yd.set4_team_dmg_.tag)]}}]}},In="BranchBladeSong",[ho,tu]=$("disc",In),mo=N(In),nu=_[In],fo=w[In],su={2:{title:s(L,{}),img:mo,documents:[{type:"text",text:ho("desc2")}]},4:{title:s(H,{}),img:mo,documents:[{type:"text",text:ho("desc4")},{type:"fields",fields:[g(fo.set4_passive.tag)]},{type:"conditional",conditional:{label:tu("set4_cond"),metadata:nu.apply_or_trigger,fields:[g(fo.set4_cond.tag)]}}]}},Rn="ChaosJazz",[go,ou]=$("disc",Rn),yo=N(Rn),iu=_[Rn],dn=w[Rn],au={2:{title:s(L,{}),img:yo,documents:[{type:"text",text:go("desc2")}]},4:{title:s(H,{}),img:yo,documents:[{type:"text",text:go("desc4")},{type:"fields",fields:[g(dn.set4_passive_fire_dmg_.tag),g(dn.set4_passive_electric_dmg_.tag)]},{type:"conditional",conditional:{label:ou("set4_cond"),metadata:iu.while_off_field,fields:[{title:"EX Special Attack DMG",fieldRef:dn.set4_off_field_special_dmg_.tag},{title:"Assist Attack Attack DMG",fieldRef:dn.set4_off_field_assist_dmg_.tag}]}}]}},An="ChaoticMetal",[xo,cu]=$("disc",An),bo=N(An),ru=_[An],$o=w[An],lu={2:{title:s(L,{}),img:bo,documents:[{type:"text",text:xo("desc2")}]},4:{title:s(H,{}),img:bo,documents:[{type:"text",text:xo("desc4")},{type:"fields",fields:[g($o.set4_passive.tag)]},{type:"conditional",conditional:{label:cu("set4_cond"),metadata:ru.trigger_corruption,fields:[g($o.set4_cond_trigger_corruption.tag)]}}]}},qn="FangedMetal",[wo,du]=$("disc",qn),_o=N(qn),uu=_[qn],pu=w[qn],hu={2:{title:s(L,{}),img:_o,documents:[{type:"text",text:wo("desc2")}]},4:{title:s(H,{}),img:_o,documents:[{type:"text",text:wo("desc4")},{type:"conditional",conditional:{label:du("set4_cond"),metadata:uu.inflict_assault,fields:[g(pu.set4_cond_inflict_assault.tag)]}}]}},Nc="FreedomBlues",[ko,hx]=$("disc",Nc),vo=N(Nc),mu={2:{title:s(L,{}),img:vo,documents:[{type:"text",text:ko("desc2")}]},4:{title:s(H,{}),img:vo,documents:[{type:"text",text:ko("desc4")}]}},zn="HormonePunk",[Co,fu]=$("disc",zn),So=N(zn),gu=_[zn],yu=w[zn],xu={2:{title:s(L,{}),img:So,documents:[{type:"text",text:Co("desc2")}]},4:{title:s(H,{}),img:So,documents:[{type:"text",text:Co("desc4")},{type:"conditional",conditional:{label:fu("set4_cond"),metadata:gu.entering_combat,fields:[g(yu.set4_cond_entering_combat.tag)]}}]}},Pn="InfernoMetal",[Do,bu]=$("disc",Pn),Mo=N(Pn),$u=_[Pn],wu=w[Pn],_u={2:{title:s(L,{}),img:Mo,documents:[{type:"text",text:Do("desc2")}]},4:{title:s(H,{}),img:Mo,documents:[{type:"text",text:Do("desc4")},{type:"conditional",conditional:{label:bu("set4_cond"),metadata:$u.hitting_burning_enemy,fields:[g(wu.set4_cond_hitting_burning_enemy.tag)]}}]}},On="PhaethonsMelody",[Eo,To]=$("disc",On),Io=N(On),Ro=_[On],Ao=w[On],ku={2:{title:s(L,{}),img:Io,documents:[{type:"text",text:Eo("desc2")}]},4:{title:s(H,{}),img:Io,documents:[{type:"text",text:Eo("desc4")},{type:"conditional",conditional:{label:To("set4_cond_squad_use_ex"),metadata:Ro.squad_use_ex,fields:[g(Ao.set4_squad_anomProf.tag)]}},{type:"conditional",conditional:{label:To("set4_cond_not_char_use_ex"),metadata:Ro.not_char_use_ex,fields:[g(Ao.set4_not_self_ether_.tag)]}}]}},Vn="PolarMetal",[qo,vu]=$("disc",Vn),zo=N(Vn),Cu=_[Vn],Po=w[Vn],Su={2:{title:s(L,{}),img:zo,documents:[{type:"text",text:qo("desc2")}]},4:{title:s(H,{}),img:zo,documents:[{type:"text",text:qo("desc4")},{type:"conditional",conditional:{label:vu("set4_cond"),metadata:Cu.freeze_shatter}},{type:"fields",fields:[{title:"Basic Attack DMG",fieldRef:Po.set4_basic_dmg_.tag},{title:"Dash Attack DMG",fieldRef:Po.set4_dash_dmg_.tag}]}]}},jn="ProtoPunk",[Oo,Du]=$("disc",jn),Vo=N(jn),Mu=_[jn],Eu=w[jn],Tu={2:{title:s(L,{}),img:Vo,documents:[{type:"text",text:Oo("desc2")}]},4:{title:s(H,{}),img:Vo,documents:[{type:"text",text:Oo("desc4")},{type:"conditional",conditional:{label:Du("set4_cond"),metadata:Mu.def_assist_or_evasive_assist,fields:[g(Eu.set4_cond_def_assist_or_evasive_assist_dmg_.tag)]}}]}},Wn="PufferElectro",[jo,Iu]=$("disc",Wn),Wo=N(Wn),Ru=_[Wn],No=w[Wn],Au={2:{title:s(L,{}),img:Wo,documents:[{type:"text",text:jo("desc2")}]},4:{title:s(H,{}),img:Wo,documents:[{type:"text",text:jo("desc4")},{type:"fields",fields:[{title:"Ultimate DMG",fieldRef:No.set4_dmg_.tag}]},{type:"conditional",conditional:{label:Iu("set4_cond"),metadata:Ru.launching_ult,fields:[g(No.set4_cond_launching_ult_atk_.tag)]}}]}},Nn="ShadowHarmony",[Bo,qu]=$("disc",Nn),Ko=N(Nn),zu=_[Nn],Lo=w[Nn],Pu={2:{title:s(L,{}),img:Ko,documents:[{type:"text",text:Bo("desc2")}]},4:{title:s(H,{}),img:Ko,documents:[{type:"text",text:Bo("desc4")},{type:"conditional",conditional:{label:qu("set4_cond_stacks"),metadata:zu.stacks,fields:[g(Lo.set4_stack_atk_.tag),g(Lo.set4_stack_crit_.tag)]}}]}},Rs="ShockstarDisco",[Ho,mx]=$("disc",Rs),Fo=N(Rs),Ou=w[Rs],Vu={2:{title:s(L,{}),img:Fo,documents:[{type:"text",text:Ho("desc2")}]},4:{title:s(H,{}),img:Fo,documents:[{type:"text",text:Ho("desc4")},{type:"fields",fields:[{title:"Basic Attack Daze",fieldRef:Ou.set4_basic_daze_.tag}]}]}},Bc="SoulRock",[Go,fx]=$("disc",Bc),Uo=N(Bc),ju={2:{title:s(L,{}),img:Uo,documents:[{type:"text",text:Go("desc2")}]},4:{title:s(H,{}),img:Uo,documents:[{type:"text",text:Go("desc4")}]}},Bn="SwingJazz",[Jo,Wu]=$("disc",Bn),Xo=N(Bn),Nu=_[Bn],Bu=w[Bn],Ku={2:{title:s(L,{}),img:Xo,documents:[{type:"text",text:Jo("desc2")}]},4:{title:s(H,{}),img:Xo,documents:[{type:"text",text:Jo("desc4")},{type:"conditional",conditional:{label:Wu("set4_cond"),metadata:Nu.chain_or_ult,fields:[g(Bu.set4_cond_chain_or_ult.tag)]}}]}},Kn="ThunderMetal",[Qo,Lu]=$("disc",Kn),Zo=N(Kn),Hu=_[Kn],Fu=w[Kn],Gu={2:{title:s(L,{}),img:Zo,documents:[{type:"text",text:Qo("desc2")}]},4:{title:s(H,{}),img:Zo,documents:[{type:"text",text:Qo("desc4")},{type:"conditional",conditional:{label:Lu("set4_cond"),metadata:Hu.enemy_shocked,fields:[g(Fu.set4_cond_enemy_shocked_atk_.tag)]}}]}},Ln="WoodpeckerElectro",[Yo,Uu]=$("disc",Ln),ei=N(Ln),Ju=_[Ln],Xu=w[Ln],Qu={2:{title:s(L,{}),img:ei,documents:[{type:"text",text:Yo("desc2")}]},4:{title:s(H,{}),img:ei,documents:[{type:"text",text:Yo("desc4")},{type:"conditional",conditional:{label:Uu("set4_cond"),metadata:Ju.crit_basic_dodge_ex,fields:[g(Xu.set4_cond_crit_basic_dodge_ex_atk_.tag)]}}]}},Kc={AstralVoice:eu,BranchBladeSong:su,ChaosJazz:au,ChaoticMetal:lu,FangedMetal:hu,FreedomBlues:mu,HormonePunk:xu,InfernoMetal:_u,PhaethonsMelody:ku,PolarMetal:Su,ProtoPunk:Tu,PufferElectro:Au,ShadowHarmony:Pu,ShockstarDisco:Vu,SoulRock:ju,SwingJazz:Ku,ThunderMetal:Gu,WoodpeckerElectro:Qu};function Lc({setKey:e,fade2:t=!1,fade4:n=!1,children:o}){const i=Kc[e];return i?y(ws,{bgt:"light",sx:{height:"100%"},children:[s(Lt,{title:s(Fr,{setKey:e}),avatar:s($s,{src:N(e),size:2})}),o,s(G,{divider:s(ie,{}),children:Object.entries(i).map(([r,a])=>s(E,{sx:{opacity:(r==="2"?t:n)?.5:1},children:s(Zu,{uiSheetElement:a,collapse:r!=="2"})},r))})]}):null}function Zu({uiSheetElement:e,collapse:t=!1}){const{documents:n,title:o}=e;return y(O,{children:[s(R,{variant:"subtitle1",children:o}),s(G,{spacing:1,children:n.map((i,r)=>s(Vc,{document:i,typoVariant:"body2",collapse:t},r))})]})}function L(){return"2-Set"}function H(){return"4-Set"}function k({wKey:e,children:t}){const n=Ke();let o=1;return n&&n.compute(z.common.count.sheet(e)).val&&(o=n.compute(z.wengine.phase).val??1),t(o)}const Le="BashfulDemon",[ti,Yu]=$("wengine",Le),ep=D.wengine[Le],tp=v(Le,"icon"),np=_[Le],ni=w[Le],sp={title:ti("phase"),img:tp,documents:[{type:"text",text:s(k,{wKey:Le,children:e=>ti(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(ni.passive_ice_dmg_.tag)]},{type:"conditional",conditional:{label:Yu("cond"),metadata:np.launch_ex_attack,fields:[g(ni.team_atk_.tag),{title:"Duration",fieldValue:ep.duration}]}}]},Gt="BigCylinder",[si,gx]=$("wengine",Gt),op=D.wengine[Gt],ip=v(Gt,"icon"),ap=pc[Gt],cp={title:si("phase"),img:ip,documents:[{type:"text",text:s(k,{wKey:Gt,children:e=>si(`phaseDescs.${e-1}`)})},{type:"fields",fields:[{title:"Additional DMG",fieldRef:ap.damage.tag},{title:"Cooldown",fieldValue:op.cooldown}]}]},He="BlazingLaurel",[oi,ii]=$("wengine",He),ai=D.wengine[He],rp=v(He,"icon"),ci=_[He],Jn=w[He],lp={title:oi("phase"),img:rp,documents:[{type:"text",text:s(k,{wKey:He,children:e=>oi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:ii("cond1"),metadata:ci.quickOrPerfectAssistUsed,fields:[g(Jn.impact_.tag),{title:"Duration",fieldValue:ai.duration}]}},{type:"conditional",conditional:{label:ii("cond2"),metadata:ci.wilt,fields:[g(Jn.crit_dmg_ice_.tag),g(Jn.crit_dmg_fire_.tag),{title:"Duration",fieldValue:ai.wilt_duration}]}}]},Fe="BoxCutter",[ri,dp]=$("wengine",Fe),up=D.wengine[Fe],pp=v(Fe,"icon"),hp=_[Fe],mp=w[Fe],fp={title:ri("phase"),img:pp,documents:[{type:"text",text:s(k,{wKey:Fe,children:e=>ri(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:dp("cond"),metadata:hp.launchedAftershock,fields:[g(mp.physical_dmg_.tag),{title:"Duration",fieldValue:up.duration}]}}]},Ut="BunnyBand",[li,gp]=$("wengine",Ut),yp=v(Ut,"icon"),xp=_[Ut],di=w[Ut],bp={title:li("phase"),img:yp,documents:[{type:"text",text:s(k,{wKey:Ut,children:e=>li(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(di.passive_hp_.tag)]},{type:"conditional",conditional:{label:gp("cond"),metadata:xp.wearerShielded,fields:[g(di.atk_.tag)]}}]},De="CannonRotor",[ui,yx]=$("wengine",De),$p=D.wengine[De],wp=v(De,"icon"),_p=pc[De],kp=w[De],vp={title:ui("phase"),img:wp,documents:[{type:"text",text:s(k,{wKey:De,children:e=>ui(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(kp.passive_atk_.tag)]},{type:"fields",fields:[{title:"Additional DMG",fieldRef:_p.damage.tag},{title:"Cooldown",fieldValue:s(k,{wKey:De,children:e=>$p.cooldown[e]})}]}]},Ge="DeepSeaVisitor",[pi,hi]=$("wengine",Ge),mi=D.wengine[Ge],Cp=v(Ge,"icon"),fi=_[Ge],Xn=w[Ge],Sp={title:pi("phase"),img:Cp,documents:[{type:"text",text:s(k,{wKey:Ge,children:e=>pi(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(Xn.passive_ice_dmg_.tag)]},{type:"conditional",conditional:{label:hi("cond1"),metadata:fi.basicHit,fields:[g(Xn.crit_.tag),{title:"Duration",fieldValue:mi.duration}]}},{type:"conditional",conditional:{label:hi("cond2"),metadata:fi.iceDashAtkHit,fields:[g(Xn.extra_crit_.tag),{title:"Duration",fieldValue:mi.extra_duration}]}}]},Ue="DemaraBatteryMarkII",[gi,Dp]=$("wengine",Ue),Mp=D.wengine[Ue],Ep=v(Ue,"icon"),Tp=_[Ue],yi=w[Ue],Ip={title:gi("phase"),img:Ep,documents:[{type:"text",text:s(k,{wKey:Ue,children:e=>gi(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(yi.passive_electric_dmg_.tag)]},{type:"conditional",conditional:{label:Dp("cond"),metadata:Tp.dodgeCounterOrAssistHit,fields:[g(yi.enerRegen_.tag),{title:"Duration",fieldValue:Mp.duration}]}}]},Je="DrillRigRedAxis",[xi,Rp]=$("wengine",Je),bi=D.wengine[Je],Ap=v(Je,"icon"),qp=_[Je],$i=w[Je],zp={title:xi("phase"),img:Ap,documents:[{type:"text",text:s(k,{wKey:Je,children:e=>xi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Rp("cond"),metadata:qp.exSpecialOrChainUsed,fields:[g($i.basic_eletric_dmg_.tag),g($i.dash_eletric_dmg_.tag),{title:"Duration",fieldValue:bi.duration},{title:"Cooldown",fieldValue:bi.cooldown}]}}]},Jt="ElectroLipGloss",[wi,Pp]=$("wengine",Jt),Op=v(Jt,"icon"),Vp=_[Jt],_i=w[Jt],jp={title:wi("phase"),img:Op,documents:[{type:"text",text:s(k,{wKey:Jt,children:e=>wi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Pp("cond"),metadata:Vp.anomalyOnEnemy,fields:[g(_i.atk_.tag),g(_i.common_dmg_.tag)]}}]},Xe="ElegantVanity",[ki,Wp]=$("wengine",Xe),Np=D.wengine[Xe],Bp=v(Xe,"icon"),Kp=_[Xe],Lp=w[Xe],Hp={title:ki("phase"),img:Bp,documents:[{type:"text",text:s(k,{wKey:Xe,children:e=>ki(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Wp("cond"),metadata:Kp.consumed25Energy,fields:[g(Lp.common_dmg_.tag),{title:"Duration",fieldValue:Np.buffDuration}]}}]},Qe="FlamemakerShaker",[vi,Ci]=$("wengine",Qe),Qn=D.wengine[Qe],Fp=v(Qe,"icon"),Si=_[Qe],Zn=w[Qe],Gp={title:vi("phase"),img:Fp,documents:[{type:"text",text:s(k,{wKey:Qe,children:e=>vi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Ci("cond1"),metadata:Si.offField,fields:[g(Zn.enerRegen.tag)]}},{type:"conditional",conditional:{label:Ci("cond2"),metadata:Si.exSpecialAssistHits,fields:[g(Zn.common_dmg_.tag),{title:"Duration",fieldValue:Qn.duration},{title:"Cooldown",fieldValue:Qn.cooldown},g(Zn.anomProf.tag),{title:"Duration",fieldValue:Qn.anomProfDuration}]}}]},Ze="FusionCompiler",[Di,Up]=$("wengine",Ze),Jp=D.wengine[Ze],Xp=v(Ze,"icon"),Qp=_[Ze],Mi=w[Ze],Zp={title:Di("phase"),img:Xp,documents:[{type:"text",text:s(k,{wKey:Ze,children:e=>Di(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(Mi.passive_atk_.tag)]},{type:"conditional",conditional:{label:Up("cond"),metadata:Qp.specialUsed,fields:[g(Mi.anomProf.tag),{title:"Duration",fieldValue:Jp.duration}]}}]},Hn="GildedBlossom",[Ei,xx]=$("wengine",Hn),Yp=v(Hn,"icon"),Ti=w[Hn],eh={title:Ei("phase"),img:Yp,documents:[{type:"text",text:s(k,{wKey:Hn,children:e=>Ei(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(Ti.passive_atk_.tag),g(Ti.passive_exSpecial_dmg_.tag)]}]},Ye="HailstormShrine",[Ii,th]=$("wengine",Ye),nh=D.wengine[Ye],sh=v(Ye,"icon"),oh=_[Ye],Ri=w[Ye],ih={title:Ii("phase"),img:sh,documents:[{type:"text",text:s(k,{wKey:Ye,children:e=>Ii(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(Ri.passive_crit_dmg_.tag)]},{type:"conditional",conditional:{label:th("cond"),metadata:oh.exSpecialOrAnomaly,fields:[g(Ri.ice_dmg_.tag),{title:"Duration",fieldValue:nh.duration}]}}]},et="HeartstringNocturne",[Ai,ah]=$("wengine",et),ch=D.wengine[et],rh=v(et,"icon"),lh=_[et],Yn=w[et],dh={title:Ai("phase"),img:rh,documents:[{type:"text",text:s(k,{wKey:et,children:e=>Ai(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(Yn.passive_crit_dmg_.tag)]},{type:"conditional",conditional:{label:ah("cond"),metadata:lh.heartstring,fields:[g(Yn.chain_resIgn_fire_.tag),g(Yn.ult_resIgn_fire_.tag),{title:"Duration",fieldValue:ch.duration}]}}]},tt="HellfireGears",[qi,zi]=$("wengine",tt),uh=D.wengine[tt],ph=v(tt,"icon"),Pi=_[tt],Oi=w[tt],hh={title:qi("phase"),img:ph,documents:[{type:"text",text:s(k,{wKey:tt,children:e=>qi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:zi("cond1"),metadata:Pi.offField,fields:[g(Oi.enerRegen.tag)]}},{type:"conditional",conditional:{label:zi("cond1"),metadata:Pi.exSpecialUsed,fields:[g(Oi.impact_.tag),{title:"Duration",fieldValue:uh.duration}]}}]},nt="Housekeeper",[Vi,ji]=$("wengine",nt),mh=D.wengine[nt],fh=v(nt,"icon"),Wi=_[nt],Ni=w[nt],gh={title:Vi("phase"),img:fh,documents:[{type:"text",text:s(k,{wKey:nt,children:e=>Vi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:ji("cond1"),metadata:Wi.offField,fields:[g(Ni.enerRegen.tag)]}},{type:"conditional",conditional:{label:ji("cond2"),metadata:Wi.exSpecialHits,fields:[g(Ni.physical_dmg_.tag),{title:"Duration",fieldValue:mh.duration}]}}]},st="IceJadeTeapot",[Bi,yh]=$("wengine",st),Ki=D.wengine[st],xh=v(st,"icon"),bh=_[st],Li=w[st],$h={title:Bi("phase"),img:xh,documents:[{type:"text",text:s(k,{wKey:st,children:e=>Bi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:yh("cond"),metadata:bh.teariffic,fields:[g(Li.impact_.tag),{title:"Duration",fieldValue:Ki.duration},g(Li.common_dmg_.tag),{title:"Duration",fieldValue:Ki.teamBuffDuration}]}}]},ot="IdentityBase",[Hi,wh]=$("wengine",ot),_h=D.wengine[ot],kh=v(ot,"icon"),vh=_[ot],Ch=w[ot],Sh={title:Hi("phase"),img:kh,documents:[{type:"text",text:s(k,{wKey:ot,children:e=>Hi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:wh("cond"),metadata:vh.equipperAttacked,fields:[g(Ch.def_.tag),{title:"Duration",fieldValue:_h.duration}]}}]},As="IdentityInflection",[Fi,bx]=$("wengine",As),Dh=v(As,"icon"),Mh={title:Fi("phase"),img:Dh,documents:[{type:"text",text:s(k,{wKey:As,children:e=>Fi(`phaseDescs.${e-1}`)})}]},it="KaboomTheCannon",[Gi,Eh]=$("wengine",it),Th=D.wengine[it],Ih=v(it,"icon"),Rh=_[it],Ah=w[it],qh={title:Gi("phase"),img:Ih,documents:[{type:"text",text:s(k,{wKey:it,children:e=>Gi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Eh("cond"),metadata:Rh.allyHitsEnemy,fields:[g(Ah.atk_.tag),{title:"Duration",fieldValue:Th.duration}]}}]},at="LunarDecrescent",[Ui,zh]=$("wengine",at),Ph=D.wengine[at],Oh=v(at,"icon"),Vh=_[at],jh=w[at],Wh={title:Ui("phase"),img:Oh,documents:[{type:"text",text:s(k,{wKey:at,children:e=>Ui(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:zh("cond"),metadata:Vh.chainOrUltUsed,fields:[g(jh.common_dmg_.tag),{title:"Duration",fieldValue:Ph.duration}]}}]},qs="LunarNoviluna",[Ji,$x]=$("wengine",qs),Nh=v(qs,"icon"),Bh={title:Ji("phase"),img:Nh,documents:[{type:"text",text:s(k,{wKey:qs,children:e=>Ji(`phaseDescs.${e-1}`)})}]},Fn="LunarPleniluna",[Xi,wx]=$("wengine",Fn),Kh=v(Fn,"icon"),es=w[Fn],Lh={title:Xi("phase"),img:Kh,documents:[{type:"text",text:s(k,{wKey:Fn,children:e=>Xi(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(es.basic_dmg_.tag),g(es.dash_dmg_.tag),g(es.dodgeCounter_dmg_.tag)]}]},ct="MagneticStormAlpha",[Qi,Hh]=$("wengine",ct),Zi=D.wengine[ct],Fh=v(ct,"icon"),Gh=_[ct],Uh=w[ct],Jh={title:Qi("phase"),img:Fh,documents:[{type:"text",text:s(k,{wKey:ct,children:e=>Qi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Hh("cond"),metadata:Gh.anomalyBuildupIncreased,fields:[g(Uh.anomMas.tag),{title:"Duration",fieldValue:Zi.duration},{title:"Cooldown",fieldValue:Zi.cooldown}]}}]},rt="MagneticStormBravo",[Yi,Xh]=$("wengine",rt),ea=D.wengine[rt],Qh=v(rt,"icon"),Zh=_[rt],Yh=w[rt],em={title:Yi("phase"),img:Qh,documents:[{type:"text",text:s(k,{wKey:rt,children:e=>Yi(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Xh("cond"),metadata:Zh.anomalyBuildupIncreased,fields:[g(Yh.anomProf.tag),{title:"Duration",fieldValue:ea.duration},{title:"Cooldown",fieldValue:ea.cooldown}]}}]},zs="MagneticStormCharlie",[ta,_x]=$("wengine",zs),tm=v(zs,"icon"),nm={title:ta("phase"),img:tm,documents:[{type:"text",text:s(k,{wKey:zs,children:e=>ta(`phaseDescs.${e-1}`)})}]},lt="MarcatoDesire",[na,sa]=$("wengine",lt),sm=D.wengine[lt],om=v(lt,"icon"),oa=_[lt],im=w[lt],am={title:na("phase"),img:om,documents:[{type:"text",text:s(k,{wKey:lt,children:e=>na(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:sa("cond1"),metadata:oa.exSpecialOrChainHitsEnemy,fields:[g(im.atk_.tag),{title:"Duration",fieldValue:sm.duration}]}},{type:"conditional",conditional:{label:sa("cond2"),metadata:oa.attributeAnomalyInflicted}}]},dt="OriginalTransmorpher",[ia,cm]=$("wengine",dt),rm=D.wengine[dt],lm=v(dt,"icon"),dm=_[dt],aa=w[dt],um={title:ia("phase"),img:lm,documents:[{type:"text",text:s(k,{wKey:dt,children:e=>ia(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(aa.passive_hp_.tag)]},{type:"conditional",conditional:{label:cm("cond"),metadata:dm.equipperHit,fields:[g(aa.impact_.tag),{title:"Duration",fieldValue:rm.duration}]}}]},Xt="PeacekeeperSpecialized",[ca,pm]=$("wengine",Xt),hm=v(Xt,"icon"),mm=_[Xt],fm=w[Xt],gm={title:ca("phase"),img:hm,documents:[{type:"text",text:s(k,{wKey:Xt,children:e=>ca(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:pm("cond"),metadata:mm.shielded,fields:[g(fm.enerRegen.tag)]}}]},Ps="PreciousFossilizedCore",[ra,kx]=$("wengine",Ps),ym=v(Ps,"icon"),xm={title:ra("phase"),img:ym,documents:[{type:"text",text:s(k,{wKey:Ps,children:e=>ra(`phaseDescs.${e-1}`)})}]},ut="RainforestGourmet",[la,bm]=$("wengine",ut),$m=D.wengine[ut],wm=v(ut,"icon"),_m=_[ut],km=w[ut],vm={title:la("phase"),img:wm,documents:[{type:"text",text:s(k,{wKey:ut,children:e=>la(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:bm("cond"),metadata:_m.energyConsumed,fields:[g(km.atk_.tag),{title:"Duration",fieldValue:$m.duration}]}}]},pt="ReverbMarkI",[da,Cm]=$("wengine",pt),Sm=D.wengine[pt],Dm=v(pt,"icon"),Mm=_[pt],Em=w[pt],Tm={title:da("phase"),img:Dm,documents:[{type:"text",text:s(k,{wKey:pt,children:e=>da(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Cm("cond"),metadata:Mm.exSpecialUsed,fields:[g(Em.impact_.tag),{title:"Duration",fieldValue:Sm.duration}]}}]},ht="ReverbMarkII",[ua,Im]=$("wengine",ht),Rm=D.wengine[ht],Am=v(ht,"icon"),qm=_[ht],pa=w[ht],zm={title:ua("phase"),img:Am,documents:[{type:"text",text:s(k,{wKey:ht,children:e=>ua(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Im("cond"),metadata:qm.exSpecialOrChainUsed,fields:[g(pa.anomMas.tag),g(pa.anomProf.tag),{title:"Duration",fieldValue:Rm.duration}]}}]},mt="ReverbMarkIII",[ha,Pm]=$("wengine",mt),Om=D.wengine[mt],Vm=v(mt,"icon"),jm=_[mt],Wm=w[mt],Nm={title:ha("phase"),img:Vm,documents:[{type:"text",text:s(k,{wKey:mt,children:e=>ha(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Pm("cond"),metadata:jm.chainOrUltUsed,fields:[g(Wm.atk_.tag),{title:"Duration",fieldValue:Om.duration}]}}]},Qt="RiotSuppressorMarkVI",[ma,Bm]=$("wengine",Qt),Km=v(Qt,"icon"),Lm=_[Qt],fa=w[Qt],Hm={title:ma("phase"),img:Km,documents:[{type:"text",text:s(k,{wKey:Qt,children:e=>ma(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(fa.passive_crit_.tag)]},{type:"conditional",conditional:{label:Bm("cond"),metadata:Lm.charge,fields:[g(fa.basic_ether_dmg_.tag)]}}]},ft="RoaringRide",[ga,ya]=$("wengine",ft),xa=D.wengine[ft],Fm=v(ft,"icon"),ba=_[ft],$a=w[ft],Gm={title:ga("phase"),img:Fm,documents:[{type:"text",text:s(k,{wKey:ft,children:e=>ga(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:ya("cond_atk_"),metadata:ba.atk_,fields:[g($a.atk_.tag),{title:"Duration",fieldValue:xa.duration}]}},{type:"conditional",conditional:{label:ya("cond_anomProf"),metadata:ba.anomProf,fields:[g($a.anomProf.tag),{title:"Duration",fieldValue:xa.duration}]}}]},gt="SeveredInnocence",[wa,Um]=$("wengine",gt),Jm=D.wengine[gt],Xm=v(gt,"icon"),Qm=_[gt],ts=w[gt],Zm={title:wa("phase"),img:Xm,documents:[{type:"text",text:s(k,{wKey:gt,children:e=>wa(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(ts.passive_crit_dmg_.tag)]},{type:"conditional",conditional:{label:Um("cond"),metadata:Qm.basicSpecialAftershockHit,fields:[g(ts.crit_dmg_.tag),g(ts.electric_dmg_.tag),{title:"Duration",fieldValue:Jm.duration}]}}]},yt="SharpenedStinger",[_a,Ym]=$("wengine",yt),ef=D.wengine[yt],tf=v(yt,"icon"),nf=_[yt],sf=w[yt],of={title:_a("phase"),img:tf,documents:[{type:"text",text:s(k,{wKey:yt,children:e=>_a(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Ym("cond"),metadata:nf.predatoryInstinct,fields:[g(sf.physical_dmg_.tag),{title:"Duration",fieldValue:ef.duration}]}}]},Os="SixShooter",[ka,vx]=$("wengine",Os),af=v(Os,"icon"),cf={title:ka("phase"),img:af,documents:[{type:"text",text:s(k,{wKey:Os,children:e=>ka(`phaseDescs.${e-1}`)})}]},Vs="SliceOfTime",[va,Cx]=$("wengine",Vs),rf=v(Vs,"icon"),lf={title:va("phase"),img:rf,documents:[{type:"text",text:s(k,{wKey:Vs,children:e=>va(`phaseDescs.${e-1}`)})}]},xt="SpectralGaze",[Ca,Sa]=$("wengine",xt),Da=D.wengine[xt],df=v(xt,"icon"),Ma=_[xt],Ea=w[xt],uf={title:Ca("phase"),img:df,documents:[{type:"text",text:s(k,{wKey:xt,children:e=>Ca(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Sa("cond1"),metadata:Ma.hit_aftershock_electric,fields:[g(Ea.cond_defRed_.tag),{title:"Duration",fieldValue:Da.duration1}]}},{type:"conditional",conditional:{label:Sa("cond2"),metadata:Ma.spiritLock,fields:[g(Ea.cond_impact_.tag),{title:"Duration",fieldValue:Da.duration2}]}}]},bt="SpringEmbrace",[Ta,pf]=$("wengine",bt),hf=D.wengine[bt],mf=v(bt,"icon"),ff=_[bt],gf=w[bt],yf={title:Ta("phase"),img:mf,documents:[{type:"text",text:s(k,{wKey:bt,children:e=>Ta(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:pf("cond"),metadata:ff.when_attacked,fields:[g(gf.cond_enerRegen_.tag),{title:"Duration",fieldValue:hf.duration}]}}]},$t="StarlightEngine",[Ia,xf]=$("wengine",$t),bf=D.wengine[$t],$f=v($t,"icon"),wf=_[$t],_f=w[$t],kf={title:Ia("phase"),img:$f,documents:[{type:"text",text:s(k,{wKey:$t,children:e=>Ia(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:xf("cond"),metadata:wf.dodgecounter_quickassist,fields:[g(_f.cond_dmg_.tag),{title:"Duration",fieldValue:bf.duration}]}}]},wt="StarlightEngineReplica",[Ra,vf]=$("wengine",wt),Cf=D.wengine[wt],Sf=v(wt,"icon"),Df=_[wt],Mf=w[wt],Ef={title:Ra("phase"),img:Sf,documents:[{type:"text",text:s(k,{wKey:wt,children:e=>Ra(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:vf("cond"),metadata:Df.hit_away,fields:[g(Mf.cond_dmg_.tag),{title:"Duration",fieldValue:Cf.duration}]}}]},_t="SteamOven",[Aa,Tf]=$("wengine",_t),If=D.wengine[_t],Rf=v(_t,"icon"),Af=_[_t],qf=w[_t],zf={title:Aa("phase"),img:Rf,documents:[{type:"text",text:s(k,{wKey:_t,children:e=>Aa(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Tf("cond"),metadata:Af.stacks,fields:[g(qf.cond_impact_.tag),{title:"Duration",fieldValue:If.duration}]}}]},Zt="SteelCushion",[qa,Pf]=$("wengine",Zt),Of=v(Zt,"icon"),Vf=_[Zt],za=w[Zt],jf={title:qa("phase"),img:Of,documents:[{type:"text",text:s(k,{wKey:Zt,children:e=>qa(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(za.passive_physical_dmg_.tag)]},{type:"conditional",conditional:{label:Pf("cond"),metadata:Vf.hit_behind,fields:[g(za.cond_dmg_.tag)]}}]},Yt="StreetSuperstar",[Pa,Wf]=$("wengine",Yt),Nf=v(Yt,"icon"),Bf=_[Yt],Kf=w[Yt],Lf={title:Pa("phase"),img:Nf,documents:[{type:"text",text:s(k,{wKey:Yt,children:e=>Pa(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Wf("cond"),metadata:Bf.charge,fields:[g(Kf.cond_ult_dmg_.tag)]}}]},kt="TheBrimstone",[Oa,Hf]=$("wengine",kt),Ff=D.wengine[kt],Gf=v(kt,"icon"),Uf=_[kt],Jf=w[kt],Xf={title:Oa("phase"),img:Gf,documents:[{type:"text",text:s(k,{wKey:kt,children:e=>Oa(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Hf("cond"),metadata:Uf.hit_basic_dash_dodge,fields:[g(Jf.cond_atk_.tag),{title:"Duration",fieldValue:Ff.duration}]}}]},js="TheRestrained",[Va,Sx]=$("wengine",js),Qf=v(js,"icon"),Zf={title:Va("phase"),img:Qf,documents:[{type:"text",text:s(k,{wKey:js,children:e=>Va(`phaseDescs.${e-1}`)})}]},vt="TheVault",[ja,Yf]=$("wengine",vt),eg=D.wengine[vt],tg=v(vt,"icon"),ng=_[vt],sg=w[vt],og={title:ja("phase"),img:tg,documents:[{type:"text",text:s(k,{wKey:vt,children:e=>ja(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Yf("cond"),metadata:ng.ether_hit,fields:[g(sg.cond_dmg_.tag),{title:"Duration",fieldValue:eg.duration}]}}]},Ct="Timeweaver",[Wa,ig]=$("wengine",Ct),ag=D.wengine[Ct],cg=v(Ct,"icon"),rg=_[Ct],Na=w[Ct],lg={title:Wa("phase"),img:cg,documents:[{type:"text",text:s(k,{wKey:Ct,children:e=>Wa(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(Na.passive_disorder_dmg_.tag)]},{type:"conditional",conditional:{label:ig("cond"),metadata:rg.hit_anomaly,fields:[g(Na.cond_anomProf.tag),{title:"Duration",fieldValue:ag.duration}]}}]},St="TusksOfFury",[Ba,dg]=$("wengine",St),ug=D.wengine[St],pg=v(St,"icon"),hg=_[St],Ka=w[St],mg={title:Ba("phase"),img:pg,documents:[{type:"text",text:s(k,{wKey:St,children:e=>Ba(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(Ka.passive_shield_.tag)]},{type:"conditional",conditional:{label:dg("cond"),metadata:hg.interrupt_perfdodge,fields:[g(Ka.cond_dmg_.tag),{title:"Duration",fieldValue:ug.duration}]}}]},Dt="UnfetteredGameBall",[La,fg]=$("wengine",Dt),gg=D.wengine[Dt],yg=v(Dt,"icon"),xg=_[Dt],bg=w[Dt],$g={title:La("phase"),img:yg,documents:[{type:"text",text:s(k,{wKey:Dt,children:e=>La(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:fg("cond"),metadata:xg.anomaly_counter,fields:[g(bg.cond_crit_.tag),{title:"Duration",fieldValue:gg.duration}]}}]},Ws="VortexArrow",[Ha,Dx]=$("wengine",Ws),wg=v(Ws,"icon"),_g={title:Ha("phase"),img:wg,documents:[{type:"text",text:s(k,{wKey:Ws,children:e=>Ha(`phaseDescs.${e-1}`)})}]},Mt="VortexHatchet",[Fa,kg]=$("wengine",Mt),Ga=D.wengine[Mt],vg=v(Mt,"icon"),Cg=_[Mt],Sg=w[Mt],Dg={title:Fa("phase"),img:vg,documents:[{type:"text",text:s(k,{wKey:Mt,children:e=>Fa(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:kg("cond"),metadata:Cg.entering,fields:[g(Sg.cond_impact_.tag),{title:"Duration",fieldValue:Ga.duration},{title:"Cooldown",fieldValue:Ga.cooldown}]}}]},Ns="VortexRevolver",[Ua,Mx]=$("wengine",Ns),Mg=v(Ns,"icon"),Eg={title:Ua("phase"),img:Mg,documents:[{type:"text",text:s(k,{wKey:Ns,children:e=>Ua(`phaseDescs.${e-1}`)})}]},Et="WeepingCradle",[Ja,Xa]=$("wengine",Et),Tg=D.wengine[Et],Ig=v(Et,"icon"),Qa=_[Et],Rg=w[Et],Ag={title:Ja("phase"),img:Ig,documents:[{type:"text",text:s(k,{wKey:Et,children:e=>Ja(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:Xa("cond_atk"),metadata:Qa.attack}},{type:"conditional",conditional:{label:Xa("cond_stacks"),metadata:Qa.stacks,fields:[g(Rg.cond_dmg_.tag),{title:"Duration",fieldValue:Tg.duration}]}}]},en="WeepingGemini",[Za,qg]=$("wengine",en),zg=v(en,"icon"),Pg=_[en],Og=w[en],Vg={title:Za("phase"),img:zg,documents:[{type:"text",text:s(k,{wKey:en,children:e=>Za(`phaseDescs.${e-1}`)})},{type:"conditional",conditional:{label:qg("cond"),metadata:Pg.anomaly_stack,fields:[g(Og.anomaly_stack.tag)]}}]},Tt="ZanshinHerbCase",[Ya,jg]=$("wengine",Tt),Wg=D.wengine[Tt],Ng=v(Tt,"icon"),Bg=_[Tt],ns=w[Tt],Kg={title:Ya("phase"),img:Ng,documents:[{type:"text",text:s(k,{wKey:Tt,children:e=>Ya(`phaseDescs.${e-1}`)})},{type:"fields",fields:[g(ns.passive_crit_.tag),g(ns.passive_electric_dmg_.tag)]},{type:"conditional",conditional:{label:jg("cond"),metadata:Bg.apply_anom_stun,fields:[g(ns.cond_crit_.tag),{title:"Duration",fieldValue:Wg.duration}]}}]},Hc={BashfulDemon:sp,BigCylinder:cp,BlazingLaurel:lp,BoxCutter:fp,BunnyBand:bp,CannonRotor:vp,DeepSeaVisitor:Sp,DemaraBatteryMarkII:Ip,DrillRigRedAxis:zp,ElectroLipGloss:jp,ElegantVanity:Hp,FlamemakerShaker:Gp,FusionCompiler:Zp,GildedBlossom:eh,HailstormShrine:ih,HeartstringNocturne:dh,HellfireGears:hh,Housekeeper:gh,IceJadeTeapot:$h,IdentityBase:Sh,IdentityInflection:Mh,KaboomTheCannon:qh,LunarDecrescent:Wh,LunarNoviluna:Bh,LunarPleniluna:Lh,MagneticStormAlpha:Jh,MagneticStormBravo:em,MagneticStormCharlie:nm,MarcatoDesire:am,OriginalTransmorpher:um,PeacekeeperSpecialized:gm,PreciousFossilizedCore:xm,RainforestGourmet:vm,ReverbMarkI:Tm,ReverbMarkII:zm,ReverbMarkIII:Nm,RiotSuppressorMarkVI:Hm,RoaringRide:Gm,SeveredInnocence:Zm,SharpenedStinger:of,SixShooter:cf,SliceOfTime:lf,SpectralGaze:uf,SpringEmbrace:yf,StarlightEngine:kf,StarlightEngineReplica:Ef,SteamOven:zf,SteelCushion:jf,StreetSuperstar:Lf,TheBrimstone:Xf,TheRestrained:Zf,TheVault:og,Timeweaver:lg,TusksOfFury:mg,UnfetteredGameBall:$g,VortexArrow:_g,VortexHatchet:Dg,VortexRevolver:Eg,WeepingCradle:Ag,WeepingGemini:Vg,ZanshinHerbCase:Kg};function Fc({headerAction:e,fade:t=!1,wengine:n}){const{key:o,level:i,phase:r,modification:a}=n,l=Hc[o],d=Gr(o,i,r,a),c="atk_base",u=Mn(o).second_statkey;return l?y(ws,{bgt:"light",sx:{height:"100%"},children:[s(Lt,{title:s(Ur,{wKey:o}),avatar:s($s,{src:v(o,"icon"),size:2}),action:e}),y(O,{sx:{py:0},children:[y(R,{sx:{display:"flex",justifyContent:"space-between"},children:[s(ye,{statKey:"atk"}),y("span",{children:[Xs(d[c],c).toFixed(Qs(c)),Wt(c)]})]}),y(R,{sx:{display:"flex",justifyContent:"space-between"},children:[s(ye,{statKey:u}),y("span",{children:[Xs(d[u],u).toFixed(Qs(u)),Wt(u)]})]})]}),s(E,{sx:{opacity:t?.5:1},children:s(Lg,{uiSheetElement:l})})]}):null}function Lg({uiSheetElement:e}){const{documents:t,title:n}=e;return y(O,{children:[s(R,{variant:"subtitle1",children:n}),s(G,{spacing:1,children:t.map((o,i)=>s(Vc,{document:o,typoVariant:"body2",collapse:!0},i))})]})}function Hg(e){const{attribute:t}=e;if(t)return t}function Fg(e){const{q:t}=e;return["standardDmg","anomalyDmg"].includes(t)}function Gg(e){const{damageType1:t,damageType2:n}=e,o=[];return Fg(e)?(t&&o.push(t),n&&o.push(n),o):[]}const Me={basic:"Basic",dash:"Dash",dodgeCounter:"Dodge Counter",special:"Special",exSpecial:"EX Special",chain:"Chain",ult:"Ultimate",quickAssist:"Quick Assist",defensiveAssist:"Defensive Assist",evasiveAssist:"Evasive Assist",assistFollowUp:"Assist Follow Up",anomaly:"Anomaly",disorder:"Disorder",aftershock:"Aftershock",elemental:"Elemental"},Gc=["crit_","crit_dmg_","impact","pen","pen_","enerRegen","anomProf","anomMas"].map(e=>{if(Jr.includes(e)){const t={...z.final.dmg_.tag,attribute:e.slice(0,-5)};return{title:s(ye,{statKey:e}),fieldRef:t}}return e==="crit_"?{fieldRef:z.common.cappedCrit_.tag,title:s(ye,{statKey:e})}:{fieldRef:z.final[e].tag,title:s(ye,{statKey:e})}});Gc.push(...Ae.map(e=>({fieldRef:{et:"own",qt:"formula",q:"standardDmg",attribute:e,name:"standardDmgInst"},title:y(ve,{color:e,children:[mn[e]," Damage"]})})),...Ae.flatMap(e=>hc.map(t=>({fieldRef:{et:"own",qt:"formula",q:"standardDmg",attribute:e,damageType1:t,name:"standardDmgInst"},title:y(ve,{color:e,children:[mn[e]," ",Me[t]," Damage"]})}))),...Ae.map(e=>({fieldRef:{et:"own",qt:"formula",q:"anomalyDmg",attribute:e,damageType1:"anomaly",name:"anomalyDmgInst"},title:y(ve,{color:e,children:[mn[e]," Anomaly Damage"]})})));const Uc=[];Gc.forEach(e=>{Uc.push({tag:e.fieldRef,value:e})});const Ug=Vd(Uc),us=new Map;function Jc(e,t){if(us.get(e))throw new Error(`Duplicate conditional ${e}`);us.set(e,t)}Object.values(Hc).forEach(({documents:e})=>{e.forEach(t=>{t.type==="conditional"&&Jc(`${t.conditional.metadata.sheet}:${t.conditional.metadata.name}`,t.conditional)})});Object.values(Kc).forEach(e=>Object.values(e).forEach(({documents:t})=>{t.forEach(n=>{n.type==="conditional"&&Jc(`${n.conditional.metadata.sheet}:${n.conditional.metadata.name}`,n.conditional)})}));function Xc(e,t=new Map){const n=t.get(e);if(n)return n;const{val:o,meta:{tag:i,op:r,ops:a,usedCats:l}}=e,d=i&&Xr(i,(S,M)=>l.has(M)),c=_s(o,Wt(Wc(i))),u=new Set;function p(S,M){return S.map((A,X)=>{const q=Xc(A,t);return q.name?(u.add(q),q.name):(q.deps.forEach(B=>u.add(B)),q.prec>=M?q.formula:y("span",{children:["(",q.formula,")"]},X))})}let h,m=1/0;switch(r){case"const":h=c,m=1/0;break;case"sum":case"prod":case"max":case"min":{const{head:S,joiner:M,end:A}=ss[r];m=ss[r].prec,h=y("span",{children:[S,p(a,m).map((X,q)=>y(f.Fragment,{children:[X,q<a.length-1&&M]},q)),A]})}break;case"sumfrac":{const[S]=p(a,2),[M,A]=p(a,1);h=y("span",{children:[S," / (",M," + ",A,")"]}),m=ss.prod.prec;break}default:rc(r)}let b,x;d&&(b=d.q==="_"?void 0:y("span",{children:[s(ae,{tag:d})," ",c]}),x=void 0);const C={name:b,formula:h,prec:m,sheet:x,deps:[...new Set(u)]};return t.set(e,C),C}const ss={sum:{head:"",joiner:" + ",end:"",prec:1},prod:{head:"",joiner:" * ",end:"",prec:2},max:{head:"Max(",joiner:", ",end:")",prec:1/0},min:{head:"Min(",joiner:", ",end:")",prec:1/0}};function Jg(e){const t={},n={};return e.forEach(({setKey:o,mainStatKey:i,substats:r,level:a,rarity:l})=>{t[o]=(t[o]??0)+1,n[i]=(n[i]??0)+mc(l,i,a),r.forEach(({key:d,upgrades:c})=>{!d||!c||(n[d]=(n[d]??0)+fc(d,l)*c)})}),zc(n,t)}function Qc({character:e,charOpt:t,wengineId:n,discIds:o,children:i}){const r=Xg(e,n,o),a=f.useMemo(()=>Oc([...Pc([e.key]),...r,xn.common.critMode.add(t.critMode),ue.common.lvl.add(t.enemyLvl),ue.common.def.add(t.enemyDef),ue.common.isStunned.add(t.enemyisStunned?1:0),ue.common.stun_.add(t.enemyStunMultiplier/100),ue.common.unstun_.add(1),...t.conditionals.flatMap(({sheet:d,src:c,dst:u,condKey:p,condValue:h})=>fn("preset0",gc(d,c,u)(p,h))),...t.bonusStats.flatMap(({tag:d,value:c})=>fn("preset0",{tag:{...d,src:e.key,sheet:"agg",et:"own"},value:de(as(c,d.q??""))})),...t.enemyStats.flatMap(({tag:d,value:c})=>fn("preset0",{tag:{...d,qt:"common",et:"enemy",sheet:"agg"},value:de(as(c,d.q??""))}))]),[r,t,e.key]),l=f.useMemo(()=>a&&new Map,[a]);return s(Qr.Provider,{value:l,children:s(Ne.Provider,{value:a,children:i})})}function Xg(e,t,n){const o=yc(t),i=xc(n),r=f.useMemo(()=>o?Od(o.key,o.level,o.modification,o.phase):[],[o]),a=f.useMemo(()=>i?Jg(Object.values(i).filter(Zr)):[],[i]);return f.useMemo(()=>e?Ac(e.key,...qc(e),...r,...a):[],[e,r,a])}function Zc({character:e,conditionals:t,children:n}){const o=f.useMemo(()=>Oc([...Pc([e.key]),...Ac(e.key,...qc(e),...zc({},Ce(jt,()=>4)),F.sheet("agg").reread(F.sheet("wengine")),z.wengine.lvl.add(60),z.wengine.modification.add(5),z.wengine.phase.add(1),...Vt.map(i=>z.common.count.sheet(i).add(1))),xn.common.critMode.add("avg"),ue.common.lvl.add(100),ue.common.def.add(900),ue.common.isStunned.add(0),ue.common.stun_.add(1.5),ue.common.unstun_.add(1),...t.flatMap(({sheet:i,src:r,dst:a,condKey:l,condValue:d})=>fn("preset0",gc(i,r,a)(l,d)))]),[e,t]);return s(Ne.Provider,{value:o,children:n})}function Yc({isAftershock:e,setAftershock:t}){return s(U,{onClick:()=>t(!e),color:e?"success":"secondary",children:Me.aftershock})}function er({dmgType:e,keys:t,setDmgType:n}){return y(se,{title:y(E,{sx:{textWrap:"nowrap"},children:["Dmg Type: ",e?Me[e]:"Any"]}),children:[s(V,{selected:!e,disabled:!e,onClick:()=>n(),children:"Any"},"any"),t.map(o=>s(V,{selected:e===o,disabled:e===o,onClick:()=>n(o),children:Me[o]},o))]})}function Qg(){var d;const{t:e}=pe("page_optimize"),{database:t}=P(),{key:n}=J(),{bonusStats:o}=Y(n),i=(d=hs(t.charMeta,n))==null?void 0:d.description,r=f.useCallback((c,u,p)=>t.charOpts.setBonusStat(n,c,u,p),[t,n]),a=c=>t.charOpts.setBonusStat(n,tl(c),0),l=f.useCallback(c=>{t.charMeta.set(n,{description:c})},[t.charMeta,n]);return y(G,{spacing:1,children:[o.map(({tag:c,value:u},p)=>s(Yg,{tag:c,value:u,setValue:h=>r(c,h,p),onDelete:()=>r(c,null,p),setTag:h=>r(h,u,p)},JSON.stringify(c)+p)),s(Zg,{onSelect:a}),s(dd,{placeholder:e("bonusStatsNotes"),value:i,disabled:!n,onChange:c=>l(c),multiline:!0,minRows:3,fullWidth:!0})]})}function Zg({tag:e,onSelect:t}){return s(se,{title:(e&&s(ae,{tag:e}))??"Add Bonus Stat",children:nl.map(n=>s(V,{onClick:()=>t(n),children:s(ye,{statKey:n,showPercent:!0})},n))})}function Yg({tag:e,setTag:t,value:n,setValue:o,onDelete:i}){var a;const r=(a=e.q)==null?void 0:a.endsWith("_");return s(W,{bgt:"light",children:y(O,{sx:{display:"flex",gap:1,justifyContent:"space-around",alignItems:"center",flexWrap:"wrap"},children:[s(R,{children:s(ae,{tag:e})}),s(ty,{qt:e.qt,setQt:l=>t({...e,qt:l})}),e.q==="dmg_"&&s(ey,{tag:e,setAttribute:l=>{const{attribute:d,...c}=e;t(l?{...c,attribute:l}:c)}}),Yr.includes(e.q)&&s(er,{dmgType:e.damageType1,keys:el,setDmgType:l=>{const{damageType1:d,...c}=e;t(l?{...c,damageType1:l}:c)}}),["dmg_","crit_dmg_"].includes(e.q)&&s(Yc,{isAftershock:e.damageType2==="aftershock",setAftershock:l=>{const{damageType2:d,...c}=e;t(l?{...c,damageType2:"aftershock"}:c)}}),s(qe,{float:!0,value:n,sx:{flexBasis:150,flexGrow:1,height:"100%"},onChange:o,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:y(En,{position:"end",sx:{ml:0},children:[r?"%":void 0," ",s(Be,{"aria-label":"Delete Bonus Stat",onClick:i,edge:"end",children:s(Is,{fontSize:"small"})})]})}})]})})}function ey({tag:e,setAttribute:t}){return y(se,{title:e.attribute?s(Se,{attribute:e.attribute}):"No Attribute",color:e.attribute,children:[s(V,{onClick:()=>t(null),children:"No Attribute"}),Ae.map(n=>s(V,{onClick:()=>t(n),children:s(ve,{color:n,children:s(Se,{attribute:n})})},n))]})}function ty({qt:e,setQt:t}){return s(se,{title:e&&Nt[e],children:sl.map(n=>s(V,{onClick:()=>t(n),selected:e===n,disabled:e===n,children:Nt[n]},n))})}function tr(){const e=Ke();return s(ws,{children:s(O,{children:e==null?void 0:e.listFormulas(z.listing.formulas).map((t,n)=>s(ny,{read:t},n))})})}function ny({read:e}){var x,C,S,M,A,X,q;const t=Ke(),{setRead:n}=f.useContext(xs),o=J(),i=Y(o==null?void 0:o.key),r=e.tag.sheet===((x=i==null?void 0:i.target)==null?void 0:x.sheet)&&e.tag.name===((C=i==null?void 0:i.target)==null?void 0:C.name)||((S=i==null?void 0:i.target)==null?void 0:S.q)===e.tag.q,a=f.useMemo(()=>{var B,I,K,Q;return e.tag.sheet===((B=i==null?void 0:i.target)==null?void 0:B.sheet)&&e.tag.name===((I=i==null?void 0:i.target)==null?void 0:I.name)?ol(e.tag,(K=i==null?void 0:i.target)==null?void 0:K.damageType1,(Q=i==null?void 0:i.target)==null?void 0:Q.damageType2):e.tag},[e.tag,(M=i==null?void 0:i.target)==null?void 0:M.sheet,(A=i==null?void 0:i.target)==null?void 0:A.name,(X=i==null?void 0:i.target)==null?void 0:X.damageType1,(q=i==null?void 0:i.target)==null?void 0:q.damageType2]),l=f.useMemo(()=>({...e,tag:a}),[a,e]),d=t==null?void 0:t.compute(l),c=a.name||a.q,{statHighlight:u,setStatHighlight:p}=f.useContext(bc),h=a.name?"":a.attribute?`${a.attribute}_${a.q}`:a.q==="cappedCrit_"?"crit_":a.q,m=h?il(u,h):!1;if(!d)return null;const b=_s(d.val,Wt(c??""));return y(E,{onMouseEnter:()=>h&&p(h),onMouseLeave:()=>p(""),sx:{display:"flex",gap:1,alignItems:"center",p:.5,borderRadius:.5,backgroundColor:r?"rgba(0,200,0,0.2)":void 0,position:"relative","::after":{content:'""',position:"absolute",top:0,left:0,width:"100%",height:"100%",borderRadius:.5,backgroundColor:al(m),transition:"background-color 0.3s ease-in-out",pointerEvents:"none"}},children:[s(E,{sx:{flexGrow:1},children:s(ae,{tag:a})}),b,s(cl,{tag:a,onClick:()=>{n(l)}})]})}function sy(){const{database:e}=P(),{key:t}=J(),{enemyStats:n,enemyLvl:o,enemyDef:i,enemyisStunned:r,enemyStunMultiplier:a}=Y(t),l=f.useCallback((c,u,p)=>e.charOpts.setEnemyStat(t,c,u,p),[e,t]),d=c=>e.charOpts.setEnemyStat(t,ll(c),0);return y(G,{spacing:1,children:[y(E,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[s(qe,{label:"Enemy Lvl",value:o,inputProps:{min:0,sx:{width:"4em"}},onChange:c=>e.charOpts.set(t,{enemyLvl:c})}),s(qe,{label:"Enemy DEF",value:i,inputProps:{min:0,sx:{width:"4em"}},onChange:c=>e.charOpts.set(t,{enemyDef:c})}),s(qe,{label:"Enemy Stun Multiplier",value:a,inputProps:{min:0,sx:{width:"8em"}},onChange:c=>e.charOpts.set(t,{enemyStunMultiplier:c}),InputProps:{endAdornment:s(En,{position:"end",children:"%"})}}),s(U,{onClick:()=>e.charOpts.set(t,{enemyisStunned:!r}),color:r?"success":"secondary",children:r?"Stunned":"Not Stunned"})]}),n.map(({tag:c,value:u},p)=>s(iy,{tag:c,value:u,setValue:h=>l(c,h,p),onDelete:()=>l(c,null,p),setTag:h=>l(h,u,p)},JSON.stringify(c)+p)),s(oy,{onSelect:d})]})}function oy({tag:e,onSelect:t}){return s(se,{title:(e&&s(ae,{tag:{...e,qt:"common",et:"enemy",sheet:"agg"}}))??"Add Enemy Stat",children:dl.map(n=>s(V,{onClick:()=>t(n),children:s(ae,{tag:{q:n,qt:"common",et:"enemy",sheet:"agg"},showPercent:!0})},n))})}function iy({tag:e,setTag:t,value:n,setValue:o,onDelete:i}){var a;const r=(a=e.q)==null?void 0:a.endsWith("_");return s(W,{bgt:"light",children:y(O,{sx:{display:"flex",gap:1,justifyContent:"space-around",alignItems:"center",flexWrap:"wrap"},children:[s(R,{children:s(ae,{tag:e})}),rl(["res_","resRed_"],e.q)&&s(ay,{tag:e,setAttribute:l=>{const{attribute:d,...c}=e;t(l?{...c,attribute:l}:c)}}),s(qe,{float:!0,value:n,sx:{flexBasis:150,flexGrow:1,height:"100%"},onChange:o,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:y(En,{position:"end",sx:{ml:0},children:[r?"%":void 0," ",s(Be,{"aria-label":"Delete Enemy Stat",onClick:i,edge:"end",children:s(Is,{fontSize:"small"})})]})}})]})})}function ay({tag:e,setAttribute:t}){return y(se,{title:e.attribute?s(Se,{attribute:e.attribute}):"No Attribute",color:e.attribute,children:[s(V,{onClick:()=>t(null),children:"No Attribute"}),Ae.map(n=>s(V,{onClick:()=>t(n),children:s(ve,{color:n,children:s(Se,{attribute:n})})},n))]})}function ps(e){return e.reduce((t,n)=>t*n.length,1)}const cy=50;class ry{constructor(t){this.info=new Map,this.progress={computed:0,failed:0,skipped:0,remaining:0},this.nextReport=Date.now(),this.finalize=()=>{},this.terminate=()=>{};const{progress:n}=this,{topN:o,numWorkers:i,setProgress:r}=t,a=[...Array(i)].map(()=>new Worker(new URL(""+new URL("workerHandle-CSrCyUap.js",import.meta.url).href,import.meta.url),{type:"module"})),l=vd(t.nodes,t.candidates,"q",t.minimum,o),{nodes:d,minimum:c,candidates:u}=l;if(n.remaining=ps(u),n.skipped=ps(t.candidates)-n.remaining,n.remaining>Number.MAX_SAFE_INTEGER)throw new Error("too many combinations");this.topN=o,this.optThreshold=c[0],this.info=new Map(a.map(m=>[m,{builds:[]}]));const p=u.map(m=>m.map(b=>b.id));this.state={ty:"work",works:[{ids:p,count:n.remaining}]},this.report=()=>r({...n}),this.results=new Promise((m,b)=>{this.finalize=x=>(this.report(),m(x)),this.terminate=b});const h=()=>a.forEach(m=>m.terminate());this.results.then(h,h);for(const m of a)m.onmessage=({data:b})=>{try{this.onWorkerMsg(b,m)}catch(x){this.terminate(x)}},un(m,{ty:"init",nodes:d,minimum:c,candidates:u,topN:o})}distribute(t){const{state:n}=this;if(n.ty==="work"){n.works.push(...t);return}for(const o of n.workers)if(this.give(t,o))n.workers.delete(o);else return;this.state={ty:"work",works:t}}idle(t){const{state:n,progress:o,info:i}=this;if(n.ty==="idle")n.workers.add(t);else if(this.give(n.works,t)){const r=o.remaining/(i.size+.5);i.forEach((a,l)=>un(l,{ty:"work?",maxKeep:r}))}else this.state={ty:"idle",workers:new Set([t])}}give(t,n){if(!t.length)return!1;let o=this.progress.remaining/(this.info.size+.5),i=t.findIndex(a=>(o-=a.count)<0)+1;i>1&&(i-=1);const r=t.splice(0,i||t.length);return un(n,{ty:"add",works:r}),!0}onWorkerMsg(t,n){var o;switch(t.ty){case"progress":{const i=this.progress,r=this.info.get(n);i.remaining-=t.computed+t.skipped,i.computed+=t.computed,i.failed+=t.failed,i.skipped+=t.skipped,r.builds=t.builds,t.idle&&this.idle(n);const a=Date.now();if(this.nextReport<=a||!t.remaining){this.nextReport=a+cy,this.report();const l=[...this.info.values()].flatMap(c=>c.builds);l.sort((c,u)=>u.value-c.value);const d=((o=l[this.topN])==null?void 0:o.value)??-1/0;d>this.optThreshold&&(this.optThreshold=d,this.info.forEach((c,u)=>un(u,{ty:"config",threshold:d}))),this.progress.remaining||this.finalize(l.slice(0,this.topN))}break}case"add":this.distribute(t.works);break;case"err":this.terminate(t.msg+" (Worker Error)")}}}function un(e,t){e.postMessage(t)}function ly(e,t,n,o,i,r,a,l,d,c,u){const p=new Set(jt),h=new Set(Vt),m=[cc(...n.map((x,C)=>Zs(x.multiplier,new hn({src:e,...x.tag},void 0).with("preset",`preset${C}`)))),...o.map(({tag:x,isMax:C})=>{const S={...ul(x),src:e,preset:"preset0"};return C?Zs(-1,new hn(S,void 0)):new hn(S,void 0)})],b=gd(m,t,x=>{if(x.src===e&&x.et==="own"){if(x.sheet==="dyn"&&x.qt==="initial")return x.q==="dmg_"?{q:`${x.attribute}_dmg_`}:{q:x.q};if(x.q==="count"&&p.has(x.sheet))return{q:x.sheet};if(x.qt=="wengine"&&["lvl","phase","modification"].includes(x.q))return{q:x.q};if(x.q==="count"&&h.has(x.sheet))return{q:x.sheet}}});return b.push(i.length?os(...i.map(x=>yn({q:x},"sum"))):de(1/0),r.length?os(...r.map(x=>yn({q:x},"sum"))):de(1/0)),new ry({nodes:b,candidates:[a.map(dy),l[1].map(Ie),l[2].map(Ie),l[3].map(Ie),l[4].map(Ie),l[5].map(Ie),l[6].map(Ie)],minimum:[-1/0,...o.map(({value:x,isMax:C,tag:S})=>{const M=as(x,S.q??"");return C?M*-1:M}),2,4],numWorkers:d,topN:c,setProgress:u})}function Ie(e){const{id:t,mainStatKey:n,level:o,rarity:i,setKey:r,substats:a}=e;return{id:t,[n]:mc(i,n,o),...Object.fromEntries(a.filter(({key:l,upgrades:d})=>l&&d).map(({key:l,upgrades:d})=>[l,fc(l,i)*d])),[r]:1}}function dy(e){const{id:t,key:n,level:o,modification:i,phase:r}=e;return{id:t,lvl:o,modification:i,phase:r,[n]:1}}var qt={},ec;function uy(){if(ec)return qt;ec=1;var e=ms();Object.defineProperty(qt,"__esModule",{value:!0}),qt.default=void 0;var t=e(fs()),n=gs(),o=(0,t.default)((0,n.jsx)("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp");return qt.default=o,qt}var py=uy();const hy=ys(py),my=f.memo(function({disabled:t=!1}){const{database:n}=P(),{optConfigId:o,optConfig:i}=f.useContext(ce);return y(W,{bgt:"light",children:[s(O,{sx:{display:"flex",gap:1},children:s(R,{sx:{fontWeight:"bold"},children:"Disc Level Filter"})}),s(ie,{}),s(pl,{levelLow:(i==null?void 0:i.levelLow)??Ys.S,levelHigh:(i==null?void 0:i.levelHigh)??Ys.S,setLow:r=>n.optConfigs.set(o,{levelLow:r}),setHigh:r=>n.optConfigs.set(o,{levelHigh:r}),setBoth:(r,a)=>n.optConfigs.set(o,{levelLow:r,levelHigh:a}),disabled:t})]})});function fy({discBySlot:e,setFilter4:t,setFilter2:n,setSetFilter4:o,setSetFilter2:i}){const r=J(),a=Y(r==null?void 0:r.key),l=f.useMemo(()=>{const d=Ce(jt,()=>Ce(ks,()=>0));return Object.values(e).forEach(c=>c.forEach(({setKey:u,slotKey:p})=>d[u][p]++)),d},[e]);return y(Ht,{children:[y(E,{sx:{display:"flex",gap:1,alignItems:"center"},children:[s(R,{variant:"h6",sx:{flexGrow:1},children:"Disc Set Config"}),s(U,{disabled:!t.length,onClick:()=>o([]),children:"Reset 4p filter"}),s(U,{disabled:!n.length,onClick:()=>i([]),children:"Reset 2p filter"})]}),s(E,{children:r&&a&&s(Zc,{character:r,conditionals:a.conditionals,children:s(ne,{container:!0,spacing:1,children:jt.map(d=>s(ne,{item:!0,xs:1,md:2,lg:3,children:s(gy,{numSlot:l[d],setKey:d,setFilter4:t,setFilter2:n,setSetFilter4:o,setSetFilter2:i})},d))})})})]})}function gy({numSlot:e,setKey:t,setFilter4:n,setFilter2:o,setSetFilter4:i,setSetFilter2:r}){const a=!!o.length&&!o.includes(t),l=!!n.length&&!n.includes(t);return y(Lc,{setKey:t,fade2:a,fade4:l,children:[s(E,{sx:{display:"flex",justifyContent:"space-around",pb:1},children:Object.entries(e).map(([d,c])=>s(E,{children:s(je,{color:c?"primary":"secondary",children:c})},d))}),y(hl,{fullWidth:!0,children:[s(U,{sx:{borderRadius:0},color:!n.length||n.includes(t)?"success":"secondary",onClick:()=>i(n.length?eo([...n],t):[t]),children:"Allow 4p"}),s(U,{sx:{borderRadius:0},color:!o.length||o.includes(t)?"success":"secondary",onClick:()=>r(o.length?eo([...o],t):[t]),children:"Allow 2p"})]})]})}function yy({discsBySlot:e}){const[t,n,o]=vs();return s(W,{bgt:"light",children:s(O,{children:y(G,{spacing:1,children:[s(xe,{sx:{display:"flex",gap:2,justifyContent:"space-between"},children:ks.map(i=>s(_e,{discsBySlot:e,slotKey:i},i))}),s(xy,{show:t,onClose:o,discsBySlot:e}),s(U,{color:"info",fullWidth:!0,onClick:n,children:"Disc Filter Config"})]})})})}function _e({discsBySlot:e,slotKey:t}){return y(R,{children:["Disc ",t," ",s(je,{color:e[t].length?"primary":"error",children:e[t].length})]})}function xy({discsBySlot:e,show:t,onClose:n,disabled:o}){const{database:i}=P(),{optConfigId:r,optConfig:a}=f.useContext(ce);return s(bs,{open:t,onClose:n,children:y(W,{children:[s(Lt,{title:"Disc Filter",action:s(Be,{onClick:n,children:s(Dn,{})})}),s(ie,{}),s(O,{children:s(f.Suspense,{fallback:s($c,{width:"100%",height:"500px"}),children:y(G,{spacing:1,children:[s(my,{disabled:o}),s(by,{discsBySlot:e,disabled:o}),s(U,{disabled:o,onClick:()=>i.optConfigs.set(r,{useEquipped:!a.useEquipped}),color:a.useEquipped?"success":"secondary",children:"Use equipped Discs"}),s($y,{discBySlot:e,disabled:o})]})})})]})})}function by({discsBySlot:e,disabled:t}){const{database:n}=P(),{optConfigId:o,optConfig:i}=f.useContext(ce),r=a=>{const l=ml([...to[a]]),d={4:i.slot4??[],5:i.slot5??[],6:i.slot6??[]},c={4:u=>n.optConfigs.set(o,{slot4:u}),5:u=>n.optConfigs.set(o,{slot5:u}),6:u=>n.optConfigs.set(o,{slot6:u})};return s(xe,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:to[a].map(u=>s(U,{disabled:t,variant:d[a].includes(u)?"contained":"outlined",onClick:()=>c[a](l([...d[a]],u)),children:s(ye,{statKey:u,showPercent:!0})},u))})};return s(W,{bgt:"light",children:s(O,{children:y(G,{spacing:1,children:[y(xe,{sx:{display:"flex",justifyContent:"space-between"},children:[s(_e,{slotKey:"1",discsBySlot:e}),s(_e,{slotKey:"2",discsBySlot:e}),s(_e,{slotKey:"3",discsBySlot:e})]}),s(_e,{slotKey:"4",discsBySlot:e}),r("4"),s(_e,{slotKey:"5",discsBySlot:e}),r("5"),s(_e,{slotKey:"6",discsBySlot:e}),r("6")]})})})}function $y({discBySlot:e,disabled:t}){const{database:n}=P(),{optConfigId:o,optConfig:i}=f.useContext(ce),{setFilter2:r=[],setFilter4:a=[]}=i,l=f.useCallback(c=>{n.optConfigs.set(o,{setFilter2:c})},[n,o]),d=f.useCallback(c=>{n.optConfigs.set(o,{setFilter4:c})},[n,o]);return s(fy,{discBySlot:e,disabled:t,setFilter2:r,setFilter4:a,setSetFilter2:l,setSetFilter4:d})}function wy({disabled:e=!1}){const{optConfigId:t,optConfig:{statFilters:n}}=f.useContext(ce),{database:o}=P(),i=f.useCallback(r=>o.optConfigs.set(t,{statFilters:r}),[o,t]);return y(W,{bgt:"light",children:[s(O,{sx:{display:"flex",gap:1,justifyContent:"space-between",flexDirection:"column"},children:s(E,{display:"flex",justifyContent:"space-between",children:s(R,{sx:{fontWeight:"bold"},children:"Stat Filter"})})}),s(ie,{}),s(O,{children:s(_y,{statFilters:n,setStatFilters:i,disabled:e})})]})}function _y({statFilters:e,setStatFilters:t,disabled:n=!1}){const o=f.useCallback((c,u)=>{const p=structuredClone(e);typeof u>"u"?p.push({tag:c,value:0,isMax:!1,disabled:!1}):p[u].tag=c,t(p)},[t,e]),i=f.useCallback(c=>{const u=structuredClone(e);u.splice(c,1),t(u)},[t,e]),r=f.useCallback((c,u)=>{const p=structuredClone(e);p[c].value=u,t(p)},[t,e]),a=f.useCallback((c,u)=>{const p=structuredClone(e);p[c].isMax=u,t(p)},[t,e]),l=f.useCallback((c,u)=>{const p=structuredClone(e);p[c].disabled=u,t(p)},[t,e]),d=c=>o(xl(c));return y(E,{display:"flex",flexDirection:"column",gap:1,children:[e.map((c,u)=>s(vy,{statFilter:c,delTarget:()=>i(u),setTarget:p=>o(p,u),setTargetValue:p=>r(u,p),setTargetisMax:p=>a(u,p),setDisabled:p=>l(u,p),disabled:n},u+JSON.stringify(c))),s(ky,{onSelect:d})]})}function ky({tag:e,onSelect:t}){return s(se,{title:(e&&s(ae,{tag:e}))??"Add Final Stat Filter",children:bl.map(n=>s(V,{onClick:()=>t(n),children:s(ye,{statKey:n,showPercent:!0})},n))})}function vy({statFilter:e,delTarget:t,setTarget:n,setTargetValue:o,setTargetisMax:i,setDisabled:r,disabled:a}){const{tag:l,value:d,isMax:c,disabled:u}=e,p=fl(l.q??"");return s(W,{children:y(O,{sx:{display:"flex",gap:1,alignItems:"center"},children:[s(U,{color:u?"secondary":"success",onClick:()=>r(!u),disabled:a,size:"small",children:u?s(gl,{}):s(yl,{})}),s(R,{children:s(ae,{tag:l})}),l.q==="dmg_"&&s(Cy,{tag:l,setAttribute:h=>{const{attribute:m,...b}=l;n(h?{...b,attribute:h}:b)}}),s(U,{onClick:()=>i(!c),size:"small",children:s("strong",{children:c?"MAX":"MIN"})}),s(qe,{float:!0,value:d,sx:{flexBasis:150,flexGrow:1,height:"100%"},disabled:a,onChange:o,placeholder:"Stat Value",size:"small",inputProps:{sx:{textAlign:"right"}},InputProps:{endAdornment:y(En,{position:"end",sx:{ml:0},children:[p?"%":void 0," ",s(Be,{"aria-label":"Delete Stat Constraint",onClick:t,edge:"end",children:s(Is,{fontSize:"small"})})]})}})]})})}function Cy({tag:e,setAttribute:t}){return y(se,{title:e.attribute?s(Se,{attribute:e.attribute}):"No Attribute",color:e.attribute,children:[s(V,{onClick:()=>t(null),children:"No Attribute"}),Ae.map(n=>s(V,{onClick:()=>t(n),children:s(ve,{color:n,children:s(Se,{attribute:n})})},n))]})}const Sy=f.memo(function({disabled:t=!1}){const{database:n}=P(),{optConfigId:o,optConfig:i}=f.useContext(ce);return y(W,{bgt:"light",children:[s(O,{sx:{display:"flex",gap:1},children:s(R,{sx:{fontWeight:"bold"},children:"Wengine Level Filter"})}),s(ie,{}),s(Gd,{levelLow:(i==null?void 0:i.wlevelLow)??$n,levelHigh:(i==null?void 0:i.wlevelHigh)??$n,setLow:r=>n.optConfigs.set(o,{wlevelLow:r}),setHigh:r=>n.optConfigs.set(o,{wlevelHigh:r}),setBoth:(r,a)=>n.optConfigs.set(o,{wlevelLow:r,wlevelHigh:a}),disabled:t})]})});function Dy({wengines:e,disabled:t}){const{database:n}=P(),{optConfigId:o,optConfig:i}=f.useContext(ce),[r,a,l]=vs();return s(W,{bgt:"light",children:s(O,{children:y(G,{spacing:1,children:[y(xe,{sx:{display:"flex",gap:2,justifyContent:"space-between",alignItems:"center"},children:[y(xe,{sx:{display:"flex",gap:1,justifyContent:"space-between"},children:["Wengines:"," ",s(je,{color:e.length?"primary":"error",children:e.length})]}),s(U,{sx:{flexGrow:1},startIcon:i.optWengine?s($l,{}):s(wl,{}),color:i.optWengine?"success":"secondary",onClick:()=>n.optConfigs.set(o,{optWengine:!i.optWengine}),children:"Optimize Wengine"})]}),s(My,{show:r,onClose:l,wengines:e}),s(U,{color:"info",fullWidth:!0,onClick:a,disabled:t||!i.optWengine,children:"Wengine Filter Config"})]})})})}function My({wengines:e,show:t,onClose:n,disabled:o}){const{database:i}=P(),{optConfigId:r,optConfig:a}=f.useContext(ce);return s(bs,{open:t,onClose:n,children:y(W,{children:[s(Lt,{title:"Wengine Filter",action:s(Be,{onClick:n,children:s(Dn,{})})}),s(ie,{}),s(O,{children:s(f.Suspense,{fallback:s($c,{width:"100%",height:"500px"}),children:y(G,{spacing:1,children:[s(Sy,{disabled:o}),s(Ey,{disabled:o}),s(U,{disabled:o,onClick:()=>i.optConfigs.set(r,{useEquippedWengine:!a.useEquippedWengine}),color:a.useEquippedWengine?"success":"secondary",children:"Use equipped Wengine"}),s(Ty,{wengines:e})]})})})]})})}function Ey({disabled:e}){const{database:t}=P(),{optConfigId:n,optConfig:o}=f.useContext(ce),{wEngineTypes:i}=o,r=ds(t.wengines),{key:a}=J(),l=f.useMemo(()=>r&&o.optWengine?t.wengines.values.reduce((d,{key:c,level:u,location:p})=>{if(u<o.wlevelLow||u>o.wlevelHigh||p&&!o.useEquippedWengine&&p!==a)return d;const h=Mn(c).type;return h&&d[h]++,d},Ce(no,()=>0)):Ce(no,()=>0),[a,r,t.wengines,o.wlevelLow,o.wlevelHigh,o.optWengine,o.useEquippedWengine]);return s(_l,{onChange:d=>t.optConfigs.set(n,{wEngineTypes:d}),value:i,disabled:e,totals:l,fullWidth:!0})}function Ty({wengines:e}){const t=J(),n=Y(t==null?void 0:t.key),{optConfig:o}=f.useContext(ce),{wEngineTypes:i}=o,r=f.useMemo(()=>i.length?Vt.filter(a=>i.includes(Mn(a).type)):Vt,[i]);return y(xe,{children:[s(R,{variant:"h6",children:"Wengine Condtional Configuration"}),s(R,{children:"Wengine stats are displayed to be Lvl 60/60, P1, actual level/phase of wengine will be used in the solver."}),t&&n&&s(Zc,{character:t,conditionals:n.conditionals,children:s(ne,{container:!0,spacing:1,columns:{xs:2,md:3,lg:4},children:r.map(a=>s(ne,{item:!0,xs:1,children:s(Ry,{wengineKey:a,count:e.filter(l=>l.key===a).length})},a))})})]})}function Iy(e){return{key:e,level:60,modification:5,phase:1,location:"",lock:!1}}function Ry({wengineKey:e,count:t}){const n=f.useMemo(()=>Iy(e),[e]);return s(Fc,{wengine:n,headerAction:s(je,{color:t?"primary":"secondary",children:t}),fade:!t})}function Ay(){const{key:e}=J(),{optConfigId:t}=Y(e),{database:n}=P();return f.useEffect(()=>{if(t)return;const o=n.optConfigs.new({wEngineTypes:[Cc(e).specialty]});n.charOpts.set(e,{optConfigId:o})},[n,t,e]),t?s(wc,{optConfigId:t,children:s(qy,{})}):null}function qy(){const{t:e}=pe("optimize"),{database:t}=P(),n=Ke(),{key:o}=J(),{target:i}=Y(o),[r,a]=f.useState(8),[l,d]=f.useState(void 0),{optConfig:c,optConfigId:u}=f.useContext(ce),p=ds(t.discs),h=f.useMemo(()=>{const q={4:c.slot4,5:c.slot5,6:c.slot6},B=I=>["4","5","6"].includes(I);return p&&t.discs.values.reduce((I,K)=>{const{slotKey:Q,mainStatKey:ee,level:he,location:re}=K;return he<c.levelLow||he>c.levelHigh||re&&!c.useEquipped&&re!==o||B(Q)&&!q[Q].includes(ee)||I[K.slotKey].push(K),I},{1:[],2:[],3:[],4:[],5:[],6:[]})},[o,p,t.discs,c.levelHigh,c.levelLow,c.slot4,c.slot5,c.slot6,c.useEquipped]),m=ds(t.wengines),b=f.useMemo(()=>m&&t.wengines.values.filter(({key:q,level:B,location:I})=>{if(!c.optWengine)return I===o;if(B<c.wlevelLow||B>c.wlevelHigh||I&&!c.useEquippedWengine&&I!==o)return!1;const{type:K}=Mn(q);return!!c.wEngineTypes.includes(K)}),[o,t.wengines,c.wlevelLow,c.wlevelHigh,c.optWengine,c.wEngineTypes,c.useEquippedWengine,m]),x=f.useMemo(()=>ps(Object.values(h))*b.length,[b.length,h]),[C,S]=f.useState(!1),M=f.useRef(()=>{});f.useEffect(()=>()=>M.current(),[]);const A=f.useCallback(async()=>{if(!n||!i)return;const q=new Promise(Q=>M.current=Q);d(void 0),S(!0);const B=(c.statFilters??[]).filter(Q=>!Q.disabled),I=ly(o,n,[{tag:_c(i),multiplier:1}],B,c.setFilter2,c.setFilter4,b,h,r,c.maxBuildsToShow,d);q.then(()=>I.terminate("user cancelled"));let K;try{K=await I.results}catch{return}finally{M.current=()=>{},S(!1)}K.length&&t.optConfigs.newOrSetGeneratedBuildList(u,{builds:K.map(({ids:Q,value:ee})=>({wengineId:Q[0],discIds:Ce(ks,(he,re)=>Q[re+1]),value:ee})),buildDate:Date.now()})},[n,i,c.statFilters,c.setFilter2,c.setFilter4,c.maxBuildsToShow,o,b,h,r,t.optConfigs,u]),X=f.useCallback(()=>{M.current(),S(!1)},[M]);return s(W,{children:s(O,{children:y(G,{spacing:1,children:[y(E,{sx:{display:"flex",gap:1,flexWrap:"wrap","& .MuiPaper-root":{flexGrow:1}},children:[s(wy,{}),s(Dy,{wengines:b}),s(yy,{discsBySlot:h})]}),l&&s(zy,{progress:l,total:x}),y(E,{sx:{display:"flex",justifyContent:"flex-end",gap:1},children:[s(Fd,{maxBuildsToShow:c.maxBuildsToShow,optConfigId:u}),s(Hd,{numWorkers:r,setNumWorkers:a}),s(U,{disabled:!x||!i,onClick:C?X:A,color:C?"error":"primary",startIcon:C?s(Dn,{}):s(hy,{}),children:e(C?"cancel":"optimize")})]})]})})})}function pn({value:e}){const t=e.toLocaleString();return s(E,{component:"span",sx:{fontFamily:"Monospace",display:"inline"},children:t})}function zy(e){const{t}=pe("optimize"),{computed:n,remaining:o,skipped:i}=e.progress,r=n+o,a=Math.log1p(r)/Math.log1p(e.total),l=o/r*a;return y(E,{children:[y(R,{children:[t("computed"),": ",s(pn,{value:n})," /"," ",s(pn,{value:r})," "]}),y(R,{children:[t("computed + skipped"),": ",s(pn,{value:n+i})," /"," ",s(pn,{value:e.total})]}),s(kl,{variant:"determinate",value:(1-l)*100,sx:{height:10,borderRadius:5}})]})}const Py={xs:2,sm:1,md:2,lg:3,xl:4};function Oy({onClick:e}){const t=f.useContext(kc);return s(vc,{discIds:t==null?void 0:t.equippedDiscs,wengineId:t==null?void 0:t.equippedWengine,onClick:e,columns:Py})}var zt={},tc;function Vy(){if(tc)return zt;tc=1;var e=ms();Object.defineProperty(zt,"__esModule",{value:!0}),zt.default=void 0;var t=e(fs()),n=gs(),o=(0,t.default)((0,n.jsx)("path",{d:"M21.6 18.2 13 11.75v-.91c1.65-.49 2.8-2.17 2.43-4.05-.26-1.31-1.3-2.4-2.61-2.7C10.54 3.57 8.5 5.3 8.5 7.5h2c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5c0 .84-.69 1.52-1.53 1.5-.54-.01-.97.45-.97.99v1.76L2.4 18.2c-.77.58-.36 1.8.6 1.8h18c.96 0 1.37-1.22.6-1.8zM6 18l6-4.5 6 4.5H6z"}),"Checkroom");return zt.default=o,zt}var jy=Vy();const Wy=ys(jy);function Ny(e){const{database:t}=P();return hs(t.generatedBuildList,e)}const By=f.memo(function(){const{optConfig:t}=f.useContext(ce),n=Ny(t.generatedBuildListId??"");return s(G,{spacing:1,children:n==null?void 0:n.builds.map((o,i)=>s(Ly,{build:o,index:i},`${i}-${o.wengineId}-${Object.values(o.discIds).join("-")}`))})});function Ky({build:{discIds:e,wengineId:t}}){const{t:n}=pe("build"),{database:o}=P(),{key:i}=J()??{},r=f.useCallback(()=>{i&&(Object.entries(e).forEach(([a,l])=>l&&o.discs.set(l,{location:i})),t&&o.wengines.set(t,{location:i}))},[i,e,t,o.wengines,o.discs]);return s(U,{color:"info",size:"small",startIcon:s(Wy,{}),onClick:r,children:n("buildDisplay.equipToCrr")})}function Ly({build:e,index:t}){const n=J(),o=Y(n.key);return s(Qc,{character:n,charOpt:o,discIds:e.discIds,wengineId:e.wengineId,children:s(W,{children:s(O,{children:y(G,{spacing:1,children:[y(E,{sx:{display:"flex",justifyContent:"space-between",gap:1},children:[y(R,{children:["Build ",t+1,": ",_s(e.value)]}),s(Ky,{build:e})]}),s(E,{children:y(ne,{container:!0,spacing:1,children:[s(ne,{item:!0,xs:6,md:4,lg:3,xl:3,children:s(tr,{})}),s(ne,{item:!0,xs:6,md:8,lg:9,xl:9,children:s(vc,{discIds:e.discIds,wengineId:e.wengineId})})]})})]})})})})}const Hy=210,nr=f.createContext(Hy),Fy=0,Pt=33,sr=f.createContext(0);function Gy(){const[e,t]=f.useState(""),n=f.useMemo(()=>({statHighlight:e,setStatHighlight:t}),[e,t]),o=f.useMemo(()=>[["char",s(Uy,{},"char")],["opt",s(Jy,{},"opt")],["builds",s(Xy,{},"builds")]],[]);return s(bc.Provider,{value:n,children:s(sr.Provider,{value:o.length,children:s(G,{gap:1,children:o.map(([i,r],a)=>s(or,{title:i,index:a,zIndex:100,children:r},i))})})})}function or({index:e,title:t,children:n,zIndex:o,top:i=0,bottom:r=0}){const{t:a}=pe("page_optimize"),[l,d]=ud(),c=f.useContext(sr),u=f.useContext(nr);return y(Ht,{children:[s(W,{sx:p=>({outline:`2px solid ${p.palette.secondary.main}`,position:"sticky",top:u+e*Pt+i,bottom:Fy+(c-1-e)*Pt+r,zIndex:o}),children:s(Cl,{onClick:d,sx:{px:2},children:s(R,{variant:"h6",children:a(`${t}`)})})}),s(E,{ref:l,sx:{scrollMarginTop:u+(e+1)*Pt+i},children:n})]})}function Uy(){const e=J(),{key:t}=e,[n,o]=f.useState(void 0),i=f.useCallback(()=>{e!=null&&e.key&&o(e.key)},[e]),r=f.useMemo(()=>[["eq",s(Oy,{onClick:i},"eq")],["Conditionals",s(Qy,{},"conditionals")],["bonusStats",s(Qg,{},"bonusStats")],["enemyStats",s(sy,{},"enemyStats")]],[i]),a=sc(),l=vl(a.breakpoints.up("sm"));return y(Ht,{children:[s(jl,{characterKey:n,onClose:()=>o(void 0)}),y(G,{spacing:1,children:[s(W,{sx:{overflow:"visible"},children:s(O,{sx:{display:"flex",gap:1,overflow:"visible"},children:y(ne,{container:!0,spacing:2,sx:{flexWrap:"wrap",overflow:"visible"},children:[s(ne,{item:!0,xs:12,sm:7,md:5,lg:4,xl:3,sx:{height:l?"100%":void 0,overflow:"visible"},children:y(G,{spacing:1,sx:l?{height:"100%"}:void 0,children:[s(Wl,{characterKey:t,onClick:i}),s(E,{sx:{flexGrow:1},children:s(E,{sx:l?{position:"sticky",top:"115px",bottom:"0px"}:void 0,children:s(tr,{})})})]})}),s(ne,{item:!0,xs:12,sm:5,md:7,lg:8,xl:9,children:s(G,{spacing:1.5,children:r.map(([d,c],u)=>s(or,{title:d,index:u,zIndex:99,top:Pt,bottom:Pt*2,children:c},d))})})]})})}),s(Nd,{formulasRead:z.listing.formulas,buffsRead:z.listing.buffs})]})]})}function Jy(){return s(Ay,{})}function Xy(){const{key:e}=J(),{optConfigId:t}=Y(e);return t?s(wc,{optConfigId:t,children:s(By,{})}):null}function Qy(){const{equippedDiscs:e,equippedWengine:t}=J(),n=xc(e),o=Sl(n),i=yc(t);return s(E,{children:y(ne,{container:!0,spacing:1,columns:{xs:1,sm:1,md:2,lg:3},children:[i&&s(ne,{item:!0,xs:1,children:s(Fc,{wengine:i})}),Object.entries(o).map(([r,a])=>s(ne,{item:!0,xs:1,children:s(Lc,{setKey:r,fade2:a<2,fade4:a<4})},r))]})})}const nc={avg:"Average",crit:"Crit Hit",nonCrit:"Non-Crit Hit"};function Zy(){const{database:e}=P(),t=J(),n=Y(t.key),{critMode:o}=n;return s(se,{title:y(E,{sx:{textWrap:"nowrap"},children:["Hit mode: ",nc[o]]}),children:Dl.map(i=>s(V,{selected:o===i,disabled:o===i,onClick:()=>e.charOpts.set(t.key,{critMode:i}),children:nc[i]},i))})}const Yy=[z.final.atk,z.final.hp,z.final.def,z.final.enerRegen,z.final.anomProf,z.final.anomMas];function ex({character:{key:e},charOpt:{target:t}}){const n=Ke(),{database:o}=P(),i=f.useMemo(()=>{if(t)return _c(t)},[t]);return y(se,{color:i?"success":"warning",title:i?y(E,{sx:{display:"flex",gap:1},children:[s("strong",{children:"Optimization Target: "}),s(gn,{tag:i})]}):"Select an Optimization Target",variant:i?"outlined":void 0,sx:{height:"100%",flexGrow:1},children:[n==null?void 0:n.listFormulas(z.listing.formulas).map(({tag:r},a)=>{const{name:l,sheet:d}=r;if(!(!l||!d))return s(V,{onClick:()=>o.charOpts.set(e,{target:{sheet:d,name:l}}),children:s(so,{children:s(E,{sx:{display:"flex",gap:1},children:s(gn,{tag:r})})})},`${a}_${r.sheet}_${r.name}`)}),Yy.map(({tag:r},a)=>{const{q:l,qt:d}=r;if(!(!l||!d))return s(V,{onClick:()=>o.charOpts.set(e,{target:{q:l,qt:d}}),children:s(so,{children:s(E,{sx:{display:"flex",gap:1},children:s(gn,{tag:r})})})},`${a}_${l}_${d}`)})]})}function tx(){const{database:e}=P(),t=J(),n=Y(t.key),{target:o}=n,i=f.useCallback(r=>e.charOpts.set(t.key,({target:a={}})=>{const{damageType1:l,...d}=a;return r?{target:{...d,damageType1:r}}:{target:d}}),[e,t.key]);return(o==null?void 0:o.name)!=="standardDmgInst"?null:s(er,{dmgType:o==null?void 0:o.damageType1,keys:hc,setDmgType:i})}function nx({character:e,charOpt:t}){return y(E,{display:"flex",gap:1,sx:{position:"sticky",top:36,zIndex:100,background:"#0C1020"},children:[s(ex,{character:e,charOpt:t}),s(ox,{}),s(tx,{}),s(sx,{}),s(Zy,{})]})}function sx(){const{database:e}=P(),t=J(),n=Y(t.key),{target:o}=n,i=f.useCallback(r=>e.charOpts.set(t.key,({target:a={}})=>{const{damageType2:l,...d}=a;return r?{target:{...d,damageType2:"aftershock"}}:{target:d}}),[e,t.key]);return(o==null?void 0:o.name)!=="standardDmgInst"?null:s(Yc,{isAftershock:(o==null?void 0:o.damageType2)==="aftershock",setAftershock:i})}function ox(){const{database:e}=P(),t=J(),n=Y(t.key),{target:o}=n,{q:i,qt:r}=o??{};return!i||!r?null:s(se,{title:Nt[r],children:["final","initial"].map(a=>s(V,{selected:a===r,disabled:a===r,onClick:()=>e.charOpts.set(t.key,{target:{q:i,qt:a}}),children:Nt[a]},a))})}function Ex(){const{database:e}=P(),{optCharKey:t}=Vl(e.dbMeta),n=t??Ml[0],[o,i,r]=vs(),a=f.useCallback(C=>e.dbMeta.set({optCharKey:C}),[e.dbMeta]),{t:l}=pe(["charNames_gen","page_character"]),d=Nl(n);f.useEffect(()=>{n&&!d&&e.chars.getOrCreate(n)},[n,d,e.chars]);const c=Y(n);f.useEffect(()=>{n&&!c&&e.charOpts.getOrCreate(n)},[n,c,e.charOpts]),pd(f.useMemo(()=>{const C=n&&l(`charNames_gen:${n}`);return C?`Optimize - ${C}`:"Optimize"},[n,l]));const u=f.useMemo(()=>{const S=Ce(n?[n]:[],M=>s(Bl,{characterKey:M}));return{srcDisplay:S,dstDisplay:S}},[n]),p=f.useCallback((C,S,M,A,X)=>{!El(C)||!oo(M)||!(A===null||oo(A))||!Tl(C,S)||e.charOpts.setConditional(n,C,S,M,A,X)},[n,e.charOpts]),h=f.useMemo(()=>({src:n,dst:n,preset:"preset0"}),[n]),[m,b]=f.useState(),x=f.useMemo(()=>({read:m,setRead:b}),[m]);return s(ix,{children:y(E,{children:[s(f.Suspense,{fallback:!1,children:s(Kl,{show:o,onHide:r,onSelect:a})}),s(E,{sx:{position:"sticky",top:0,zIndex:100,background:"#0C1020"},children:s(U,{fullWidth:!0,color:Cc(n).attribute,sx:{justifyContent:"flex-start",pl:"6px"},onClick:i,children:y(E,{sx:{display:"flex",gap:1,alignItems:"center"},children:[s($s,{size:2,src:Il(n,"circle")}),l(`charNames_gen:${n}`)]})})}),d&&c&&s(kc.Provider,{value:d,children:s(Kt.Provider,{value:h,children:s(Qc,{character:d,charOpt:c,wengineId:d.equippedWengine,discIds:d.equippedDiscs,children:s(Rl.Provider,{value:u,children:s(Al.Provider,{value:c.conditionals,children:s(ql.Provider,{value:p,children:y(xs.Provider,{value:x,children:[s(Bd,{}),y(E,{sx:{display:"flex",gap:1,flexDirection:"column",mt:1},children:[s(nx,{character:d,charOpt:c}),s(nr.Provider,{value:74,children:s(Gy,{})})]})]})})})})})})})]})})}function ix({children:e}){return s(Ol.Provider,{value:Xc,children:s(zl.Provider,{value:ae,children:s(Pl.Provider,{value:gn,children:e})})})}export{Ex as default};
